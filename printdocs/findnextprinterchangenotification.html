<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>FindNextPrinterChangeNotification function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: The FindNextPrinterChangeNotification function retrieves information about the most recent change notification for a change notification object associated with a printer or print server.
ms.assetid: ea7774ae-361f-41e4-bbc6-3f100028b22a
title: FindNextPrinterChangeNotification function (Winspool.h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>FindNextPrinterChangeNotification
api_type:</li>
<li>DllExport
api_location:</li>
<li>Spoolss.dll</li>
</ul>
<hr />
<h1>FindNextPrinterChangeNotification function</h1>
<p>The <strong>FindNextPrinterChangeNotification</strong> function retrieves information about the most recent change notification for a change notification object associated with a printer or print server. Call this function when a wait operation on the change notification object is satisfied.</p>
<p>The function also resets the change notification object to the not-signaled state. You can then use the object in another wait operation to continue monitoring the printer or print server. The operating system will set the object to the signaled state the next time one of a specified set of changes occurs to the printer or print server. The <a href="findfirstprinterchangenotification.html"><strong>FindFirstPrinterChangeNotification</strong></a> function creates the change notification object and specifies the set of changes to be monitored.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>BOOL FindNextPrinterChangeNotification(
  _In_      HANDLE hChange,
  _Out_opt_ PDWORD pdwChange,
  _In_opt_  LPVOID pPrinterNotifyOptions,
  _Out_opt_ LPVOID *ppPrinterNotifyInfo
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>hChange</em> [in]</p>
<!-- raw HTML omitted -->
<p>A handle to a change notification object associated with a printer or print server. You obtain such a handle by calling the <a href="findfirstprinterchangenotification.html"><strong>FindFirstPrinterChangeNotification</strong></a> function. The operating system sets this change notification object to the signaled state when it detects one of the changes specified in the object's change notification filter.</p>
<!-- raw HTML omitted -->
<p><em>pdwChange</em> [out, optional]</p>
<!-- raw HTML omitted -->
<p>A pointer to a variable whose bits are set to indicate the changes that occurred to cause the most recent notification. The bit flags that might be set correspond to those specified in the <em>fdwFilter</em> parameter of the <a href="findfirstprinterchangenotification.html"><strong>FindFirstPrinterChangeNotification</strong></a> call. The system sets one or more of the following bit flags.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_ADD_FORM</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A form was added to the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_ADD_JOB</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A print job was sent to the printer.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_ADD_PORT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A port or monitor was added to the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_ADD_PRINT_PROCESSOR</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A print processor was added to the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_ADD_PRINTER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A printer was added to the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_ADD_PRINTER_DRIVER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A printer driver was added to the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_CONFIGURE_PORT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A port was configured on the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_DELETE_FORM</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A form was deleted from the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_DELETE_JOB</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A job was deleted.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_DELETE_PORT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A port or monitor was deleted from the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_DELETE_PRINT_PROCESSOR</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A print processor was deleted from the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_DELETE_PRINTER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A printer was deleted.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_DELETE_PRINTER_DRIVER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A printer driver was deleted from the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_FAILED_CONNECTION_PRINTER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A printer connection has failed.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_SET_FORM</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A form was set on the server.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_SET_JOB</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A job was set.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_SET_PRINTER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A printer was set.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_SET_PRINTER_DRIVER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A printer driver was set.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_WRITE_JOB</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Job data was written.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_TIMEOUT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The job timed out.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PRINTER_CHANGE_SERVER</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Windows 7: A change occurred on the server.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p><em>pPrinterNotifyOptions</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>A pointer to a <a href="printer-notify-options.html"><strong>PRINTER_NOTIFY_OPTIONS</strong></a> structure. Set the <strong>Flags</strong> member of this structure to <strong>PRINTER_NOTIFY_OPTIONS_REFRESH</strong>, to cause the function to return the current data for all monitored printer information fields. The function ignores all other members of the structure. This parameter can be <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><em>ppPrinterNotifyInfo</em> [out, optional]</p>
<!-- raw HTML omitted -->
<p>A pointer to a pointer variable that receives a pointer to a system-allocated, read-only buffer. Call the <a href="freeprinternotifyinfo.html"><strong>FreePrinterNotifyInfo</strong></a> function to free the buffer when you are finished with it. This parameter can be <strong>NULL</strong> if no information is required.</p>
<p>The buffer contains a <a href="printer-notify-info.html"><strong>PRINTER_NOTIFY_INFO</strong></a> structure, which contains an array of <a href="printer-notify-info-data.html"><strong>PRINTER_NOTIFY_INFO_DATA</strong></a> structures. Each element of the array contains information about one of the fields specified in the <em>pPrinterNotifyOptions</em> parameter of the <a href="findfirstprinterchangenotification.html"><strong>FindFirstPrinterChangeNotification</strong></a> call. Typically, the function provides data only for the fields that changed to cause the most recent notification. However, if the structure pointed to by the <em>pPrinterNotifyOptions</em> parameter specifies <strong>PRINTER_NOTIFY_OPTIONS_REFRESH</strong>, the function provides data for all monitored fields.</p>
<p>If the <strong>PRINTER_NOTIFY_INFO_DISCARDED</strong> bit is set in the <strong>Flags</strong> member of the <a href="printer-notify-info.html"><strong>PRINTER_NOTIFY_INFO</strong></a> structure, an overflow or error occurred, and notifications may have been lost. In this case, no additional notifications will be sent until you make a second <strong>FindNextPrinterChangeNotification</strong> call that specifies <strong>PRINTER_NOTIFY_OPTIONS_REFRESH</strong>.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the function succeeds, the return value is a nonzero value.</p>
<p>If the function fails, the return value is zero.</p>
<h2>Remarks</h2>
<blockquote>
<p>[!Note]<br />
This is a blocking or synchronous function and might not return immediately. How quickly this function returns depends on run-time factors such as network status, print server configuration, and printer driver implementation factors that are difficult to predict when writing an application. Calling this function from a thread that manages interaction with the user interface could make the application appear to be unresponsive.</p>
</blockquote>
<p>Call the <strong>FindNextPrinterChangeNotification</strong> function after a wait operation on a notification object created by <a href="findfirstprinterchangenotification.html"><strong>FindFirstPrinterChangeNotification</strong></a> has been satisfied. Calling <strong>FindNextPrinterChangeNotification</strong> lets you obtain information about the change that satisfied the wait operation, and resets the notification object so it can be signaled when the next change occurs.</p>
<p>With one exception, do not call the <strong>FindNextPrinterChangeNotification</strong> function if the change notification object is not in the signaled state. If a wait function returns the value <strong>WAIT_TIMEOUT</strong>, the change object is not in the signaled state. Call the <strong>FindNextPrinterChangeNotification</strong> function only if the wait function succeeds without timing out. The exception is when <strong>FindNextPrinterChangeNotification</strong> is called with the <strong>PRINTER_NOTIFY_OPTIONS_REFRESH</strong> bit set in the <em>pPrinterNotifyOptions</em> parameter. Note that even when this flag is set, it is still possible for the <strong>PRINTER_NOTIFY_INFO_DISCARDED</strong> flag to be set in the <em>ppPrinterNotifyInfo</em> parameter.</p>
<p>To continue monitoring the printer or print server for changes, repeat the cycle of calling one of the <a href="/windows/desktop/Sync/wait-functions">wait functions</a> , and then calling the <strong>FindNextPrinterChangeNotification</strong> function to examine the change and reset the notification object.</p>
<p><strong>FindNextPrinterChangeNotification</strong> may combine multiple changes to the same printer information field into a single notification. When this occurs, the function typically collapses all changes for the field into a single entry in the array of <a href="printer-notify-info-data.html"><strong>PRINTER_NOTIFY_INFO_DATA</strong></a> structures in <em>ppPrinterNotifyInfo</em>; the single entry reports only the most current information. However, for some job and printer information fields, the function can return multiple array entries for the same field. In this case, the last array entry for the field reports the current data, and the earlier entries contain the data for the intermediate stages.</p>
<p>When you no longer need the change notification object, close it by calling the <a href="findcloseprinterchangenotification.html"><strong>FindClosePrinterChangeNotification</strong></a> function.</p>
<blockquote>
<p>[!Note]<br />
In Windows XP with Service Pack 2 (SP2) and later, the Internet Connection Firewall (ICF) blocks printer ports by default, but an exception for File and Print Sharing can be enabled. If a user makes a printer connection to another machine, and the exception is not enabled, then the user will not receive printer change notifications from the server. A machine admin will have to enable exception.</p>
</blockquote>
<h2>Examples</h2>
<p>The following code sample illustrates how you might monitor printer status by using these functions.</p>
<pre lang="C++"><code>// Get change notification handle for the printer   
chgObject = FindFirstPrinterChangeNotification( 
                hPrinter, 
                PRINTER_CHANGE_JOB, 
                0, 
                NULL); 

if (chgObject != INVALID_HANDLE_VALUE) {
    while (bKeepMonitoring) {
        // Wait for the change notification 
        WaitForSingleObject(chgObject, INFINITE);

        fcnreturn = FindNextPrinterChangeNotification(
                        chgObject, 
                        pdwChange, 
                        NULL, 
                        NULL);

        if (fcnreturn) {
            // Check value of *pdwChange and 
            //  deal with the indicated change 
        }
        // Insert some mechanism to stop monitoring
        //  such as: 
        //
        // if (something happens) {
        //     bKeepMonitoring = false; 
        // }
        //
    }
    // Close Printer Change Notification handle when finished. 
    FindClosePrinterChangeNotification(chgObject);
} else {
    // Unable to open printer change notification handle 
    dwStatus = GetLastError();
}
</code></pre>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows 2000 Professional [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows 2000 Server [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Winspool.h (include Windows.h)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Winspool.lib<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Spoolss.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="printdocs-printing.html">Printing</a></p>
<!-- raw HTML omitted -->
<p><a href="printing-and-print-spooler-functions.html">Print Spooler API Functions</a></p>
<!-- raw HTML omitted -->
<p><a href="findcloseprinterchangenotification.html"><strong>FindClosePrinterChangeNotification</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="findfirstprinterchangenotification.html"><strong>FindFirstPrinterChangeNotification</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="printer-notify-info.html"><strong>PRINTER_NOTIFY_INFO</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="printer-notify-info-data.html"><strong>PRINTER_NOTIFY_INFO_DATA</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="printer-notify-options.html"><strong>PRINTER_NOTIFY_OPTIONS</strong></a></p>
<!-- raw HTML omitted -->
</body>
