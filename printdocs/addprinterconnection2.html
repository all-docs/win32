<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>AddPrinterConnection2 function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Adds a connection to the specified printer for the current user and specifies connection details.
ms.assetid: 5ae98157-5978-449e-beb1-4787110925fa
title: AddPrinterConnection2 function (Winspool.h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>AddPrinterConnection2</li>
<li>AddPrinterConnection2W
api_type:</li>
<li>DllExport
api_location:</li>
<li>Winspool.drv</li>
</ul>
<hr />
<h1>AddPrinterConnection2 function</h1>
<p>Adds a connection to the specified printer for the current user and specifies connection details.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>BOOL AddPrinterConnection2(
  _In_ HWND    hWnd,
  _In_ LPCTSTR pszName,
       DWORD   dwLevel,
  _In_ PVOID   pConnectionInfo
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>hWnd</em> [in]</p>
<!-- raw HTML omitted -->
<p>A handle to the parent window in which the dialog box will be displayed if the print system must download a printer driver from the print server for this connection.</p>
<!-- raw HTML omitted -->
<p><em>pszName</em> [in]</p>
<!-- raw HTML omitted -->
<p>A pointer to a constant null-terminated string specifying the name of the printer to which the current user wishes to connect.</p>
<!-- raw HTML omitted -->
<p><em>dwLevel</em></p>
<!-- raw HTML omitted -->
<p>The version of the structure pointed to by <em>pConnectionInfo</em>. Currently, only level 1 is defined so the value of <em>dwLevel</em> must be 1.</p>
<!-- raw HTML omitted -->
<p><em>pConnectionInfo</em> [in]</p>
<!-- raw HTML omitted -->
<p>A pointer to a <a href="printer-connection-info-1.html"><strong>PRINTER_CONNECTION_INFO_1</strong></a> structure. See the Remarks section for more about this parameter.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the function succeeds, the return value is a nonzero value.</p>
<p>If the function fails, the return value is zero. For extended error information, call <a href="/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror"><strong>GetLastError</strong></a>.</p>
<h2>Remarks</h2>
<blockquote>
<p>[!Note]<br />
This is a blocking or synchronous function and might not return immediately. How quickly this function returns depends on run-time factors such as network status, print server configuration, and printer driver implementation factors that are difficult to predict when writing an application. Calling this function from a thread that manages interaction with the user interface could make the application appear to be unresponsive.</p>
</blockquote>
<p>When Windows Vista makes a connection to a printer, it may need to copy printer driver files from the server to which the printer is attached. If the user does not have permission to copy files to the appropriate location, the <strong>AddPrinterConnection2</strong> function fails and <a href="/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror"><strong>GetLastError</strong></a> returns ERROR_ACCESS_DENIED.</p>
<p>If the printer driver files must be copied from the print server but cannot be copied silently due to the group policies that are in effect and PRINTER_CONNECTION_NO_UI is set in <em>pConnectionInfo-&gt;dwFlags</em>, no dialog boxes will be displayed and the call will fail.</p>
<p>If the local printer driver can be used to render print jobs for this printer and the version of the local driver must not match the version of the printer driver on the server, set PRINTER_CONNECTION_MISMATCH in <em>pConnectionInfo-&gt;dwFlags</em> and assign the pointer to a string variable that contains the path to the local printer driver to <em>pConnectionInfo-&gt;pszDriverName</em>.</p>
<p>A printer connection that is established by calling <strong>AddPrinterConnection2</strong> will be enumerated when <a href="enumprinters.html"><strong>EnumPrinters</strong></a> is called with <em>dwType</em> set to PRINTER_ENUM_CONNECTION.</p>
<p>The ANSI version of this function, <strong>AddPrinterConnection2A</strong>, is not supported and returns <strong>ERROR_NOT_SUPPORTED</strong>.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows Vista [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2008 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Winspool.h (include Windows.h)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Winspool.lib<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Winspool.drv<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Unicode and ANSI names<!-- raw HTML omitted --></td>
<td><strong>AddPrinterConnection2W</strong> (Unicode)<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="printdocs-printing.html">Printing</a></p>
<!-- raw HTML omitted -->
<p><a href="printing-and-print-spooler-functions.html">Print Spooler API Functions</a></p>
<!-- raw HTML omitted -->
<p><a href="connecttoprinterdlg.html"><strong>ConnectToPrinterDlg</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="enumprinters.html"><strong>EnumPrinters</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="deleteprinterconnection.html"><strong>DeletePrinterConnection</strong></a></p>
<!-- raw HTML omitted -->
</body>
