<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>CryptoAPI 2.0 Private Keys</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Schannel credentials are represented internally as CERT_CONTEXT structures.
ms.assetid: 3d2deb61-8e86-4461-8f2a-4880ca5b9d34
title: CryptoAPI 2.0 Private Keys
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>CryptoAPI 2.0 Private Keys</h1>
<p>Schannel credentials are represented internally as <a href="/windows/desktop/api/wincrypt/ns-wincrypt-cert_context"><strong>CERT_CONTEXT</strong></a> structures. Schannel locates the <a href="/windows/desktop/SecGloss/p-gly"><em>private key</em></a> associated with a particular certificate context using the certificate's CERT_KEY_PROV_INFO_PROP_ID property. Using this property, Schannel accesses the <em>private key</em> by calling the <a href="/windows/desktop/api/wincrypt/nf-wincrypt-cryptacquirecontexta"><strong>CryptAcquireContext</strong></a> function. For additional details, see <a href="/windows/desktop/SecCrypto/public-private-key-pairs">Public/Private Key Pairs</a>.</p>
<p>Every Schannel credential contains a reference to one or more private keys, each associated with a particular certificate. The <a href="/windows/desktop/SecGloss/p-gly"><em>private keys</em></a> are handled quite differently depending on whether the credential is for a client or a server.</p>
<h2>Client Private Keys</h2>
<p>Client <a href="/windows/desktop/SecGloss/p-gly"><em>private keys</em></a> are managed by the <a href="/windows/desktop/SecGloss/c-gly"><em>cryptographic service provider</em></a> (CSP) in use. Client private keys are typically stored by CSPs of type <a href="/windows/desktop/SecCrypto/prov-rsa-full">PROV_RSA_FULL</a> or PROV_RSA_SIGNATURE.</p>
<p>If the client application makes the <a href="/windows/desktop/api/wincrypt/nf-wincrypt-cryptacquirecontexta"><strong>CryptAcquireContext</strong></a> call manually then before calling <a href="/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea"><strong>AcquireCredentialsHandle</strong></a>, the client must bind the CSP's handle to the certificate context using the CERT_KEY_PROV_HANDLE_PROP_ID property. If Schannel finds this property set, it does not use the CERT_KEY_PROV_INFO_PROP_ID property.</p>
<h2>Server Private Keys</h2>
<p>Server private keys are stored by one of the following CSPs:</p>
<ul>
<li>PROV_RSA_SCHANNEL</li>
<li>PROV_DH_SCHANNEL</li>
<li>PROV_FORTEZZA CSP</li>
</ul>
<p>The choice of CSP depends on the selected <a href="/windows/desktop/SecGloss/k-gly"><em>key exchange algorithm</em></a>. Server private keys must be of type AT_KEYEXCHANGE.</p>
<p>Â </p>
<p>Â </p>
</body>
