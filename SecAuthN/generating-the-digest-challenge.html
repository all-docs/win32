<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Generating the Digest Challenge</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: The Microsoft Digest challenge is generated by the server's initial call to the AcceptSecurityContext (Digest) function.
ms.assetid: d33383c2-5c0d-401f-ab28-2a985f6508e0
title: Generating the Digest Challenge
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Generating the Digest Challenge</h1>
<p>The Microsoft Digest challenge is generated by the server's initial call to the <a href="/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext"><strong>AcceptSecurityContext (Digest)</strong></a> function. This function call generates a nonce, which is a unique value that contains information that can be used to detect security violations. This call also generates a partial <a href="/windows/desktop/SecGloss/s-gly"><em>security context</em></a> which is used to maintain state information. When calling <strong>AcceptSecurityContext (Digest)</strong> you specify context requirements flags to control the behavior of Microsoft Digest and to set the quality of protection. For more information, see <a href="#digest-challenge-context-requirements">Digest Challenge Context Requirements</a>.</p>
<p>The output from the initial call to the <a href="/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext"><strong>AcceptSecurityContext (Digest)</strong></a> <a href="/windows/desktop/SecGloss/c-gly"><em>function</em></a> is a security buffer that contains a token that is sent to the client with an HTTP 401 response (Access Denied).</p>
<blockquote>
<p>[!Note]<br />
Calls to <a href="/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext"><strong>AcceptSecurityContext (Digest)</strong></a> that do not contain information in the input buffers return a Digest challenge.</p>
</blockquote>
<p>Â </p>
<h2>Digest Challenge Context Requirements</h2>
<p>Context requirements are flags that determine:</p>
<ul>
<li>Whether Microsoft Digest functions as a SASL mechanism or HTTP authentication protocol.</li>
<li>The quality of protection supported by the security context shared by the client and server.</li>
</ul>
<p>By default, Microsoft Digest functions as a SASL mechanism. To use it for HTTP authentication, the ASC_REQ_HTTP ( 0x10000000) flag must be set by the server.</p>
<p>Context requirements are specified as flags passed to the <em>fContextReq</em> parameter of the <a href="/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext"><strong>AcceptSecurityContext (Digest)</strong></a> function. The flags affect the security context's quality of protection by controlling the qop directive in the challenge.</p>
<p>By default, the qop directive is set to &quot;auth&quot;. To generate a challenge that sets the qop directive to &quot;auth-int&quot;, the server must specify one or more of the following flags:</p>
<ul>
<li>ASC_REQ_INTEGRITY</li>
<li>ASC_REQ_REPLAY_DETECT</li>
<li>ASC_REQ_SEQUENCE_DETECT</li>
</ul>
<p>For SASL only: Generate a challenge with the qop directive set to &quot;auth-conf&quot; by specifying the ASC_REQ_CONFIDENTIALITY context requirement flag. Because this flag is not valid for HTTP authentication, it cannot be used with the ASC_REQ_HTTP flag.</p>
<p>For more information about the qop directive, see <a href="quality-of-protection-and-ciphers.html">Quality of Protection and Ciphers</a>.</p>
<p>For more information about challenges, see <a href="contents-of-a-digest-challenge.html">Contents of a Digest Challenge</a>.</p>
<p>Â </p>
<p>Â </p>
</body>
