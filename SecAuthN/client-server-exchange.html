<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Client/Server Exchange</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Client/Server Exchange
ms.assetid: 2449c4b3-720d-4b84-b3cf-fcc4abd05d33
title: Client/Server Exchange
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Client/Server Exchange</h1>
<p>After a user has a ticket to a server, the workstation client can establish a secure communications session with that server.</p>
<p><strong>To establish a secure communications session with a server</strong></p>
<ol>
<li>The client sends the server a message of type KRB_AP_REQ (Kerberos Application Request). This message contains an authenticator message that is encrypted with the key sent by the <a href="/windows/desktop/SecGloss/k-gly"><em>Key Distribution Center</em></a> (KDC) for the session with the server, the ticket for sessions with the server, and a flag that indicates whether the client requests mutual authentication. Setting the flag that requests mutual authentication is one of the options in configuring <a href="/windows/desktop/SecGloss/k-gly"><em>Kerberos</em></a>. The user is never asked whether mutual authentication should be used.</li>
<li>The server receives KRB_AP_REQ, decrypts the ticket, and extracts the user's authorization data and the <a href="/windows/desktop/SecGloss/s-gly"><em>session key</em></a>.</li>
<li>The server uses the session key from the ticket to decrypt the user's authenticator message and evaluates the time stamp inside.</li>
<li>If the authenticator message is valid, the server checks the mutual authentication flag in the client's request.</li>
<li>If the mutual authentication flag is set, the server uses the session key to encrypt the time from the user's authenticator message and returns the result in a message of type KRB_AP_REP (Kerberos Application Reply).</li>
<li>When the client receives KRB_AP_REP, it decrypts the server's authenticator message with the session key it shares with the server and compares the time sent back by the service with the time in its original authenticator message. If they match, the client is assured that the service is genuine, and the connection proceeds.</li>
</ol>
<p>Â </p>
<p>Â </p>
</body>
