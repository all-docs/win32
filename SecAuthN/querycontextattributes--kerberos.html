<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>QueryContextAttributes (Kerberos) function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Enables a transport application to query the Kerberos <a href="../secgloss/s-gly.html"><em>security package</em></a> for certain attributes of a <a href="../secgloss/s-gly.html"><em>security context</em></a>.
ms.assetid: 8e80a9ed-0631-4932-aacc-ba3badcbd0a5
title: QueryContextAttributes (Kerberos) function (Sspi.h)
ms.topic: reference
ms.date: 07/25/2019</h2>
<h1>QueryContextAttributes (Kerberos) function</h1>
<p>The <strong>QueryContextAttributes (Kerberos)</strong> function enables a transport application to query the Kerberos <a href="../secgloss/s-gly.html"><em>security package</em></a> for certain <a href="../secgloss/a-gly.md#_security_attribute_gly"><em>attributes</em></a> of a <a href="../secgloss/s-gly.html"><em>security context</em></a>.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>SECURITY_STATUS SEC_ENTRY QueryContextAttributes(
  _In_  PCtxtHandle phContext,
  _In_  ULONG       ulAttribute,
  _Out_ PVOID       pBuffer
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>phContext</em> [in]</p>
<!-- raw HTML omitted -->
<p>A handle to the <a href="../secgloss/s-gly.html"><em>security context</em></a> to be queried.</p>
<!-- raw HTML omitted -->
<p><em>ulAttribute</em> [in]</p>
<!-- raw HTML omitted -->
<p>Specifies the attribute of the context to be returned. This parameter can be one of the following values.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_ACCESS_TOKEN</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->18<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_accesstoken"><strong>SecPkgContext_AccessToken</strong></a> structure.<!-- raw HTML omitted --> Returns a handle to the access token.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_AUTHORITY</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->6<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_authoritya"><strong>SecPkgContext_Authority</strong></a> structure.<!-- raw HTML omitted --> Queries the name of the authenticating authority.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_CLIENT_SPECIFIED_TARGET</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->27<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_clientspecifiedtarget"><strong>SecPkgContext_ClientSpecifiedTarget</strong></a> structure that represents the service principal name (SPN) of the initial target supplied by the client. <!-- raw HTML omitted --> This value is supported only when using channel bindings.<!-- raw HTML omitted --> <strong>Windows ServerÂ 2008, WindowsÂ Vista, Windows ServerÂ 2003 and WindowsÂ XP:</strong> This value is not supported.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_CREDS_2</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x80000086<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/credssp/ns-credssp-secpkgcontext_clientcreds"><strong>SecPkgContext_ClientCreds</strong></a> structure that specifies client credentials. <!-- raw HTML omitted --> If the client credential is user name and password, the buffer is a packed <a href="/windows/win32/api/ntsecapi/ns-ntsecapi-kerb_interactive_logon"><strong>KERB_INTERACTIVE_LOGON</strong></a> structure.<!-- raw HTML omitted --> If the client credential is user name and smart card PIN, the buffer is a packed <a href="/windows/win32/api/ntsecapi/ns-ntsecapi-kerb_certificate_logon"><strong>KERB_CERTIFICATE_LOGON</strong></a> structure.<!-- raw HTML omitted --> If the client credential is an online identity credential, the buffer is a marshaled <a href="/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_ex2"><strong>SEC_WINNT_AUTH_IDENTITY_EX2</strong></a> structure.<!-- raw HTML omitted --> This attribute is supported only on the CredSSP server.<!-- raw HTML omitted --> <strong>Windows ServerÂ 2008Â R2, WindowsÂ 7, Windows ServerÂ 2008, WindowsÂ Vista, Windows ServerÂ 2003 and WindowsÂ XP:</strong> This value is not supported.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_DCE_INFO</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->3<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_dceinfo"><strong>SecPkgContext_DceInfo</strong></a> structure.<!-- raw HTML omitted --> Queries for authorization data used by DCE services.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_FLAGS</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->14<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_flags"><strong>SecPkgContext_Flags</strong></a> structure.<!-- raw HTML omitted --> Returns information about the negotiated context flags.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_KEY_INFO</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->5<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_keyinfoa"><strong>SecPkgContext_KeyInfo</strong></a> structure.<!-- raw HTML omitted --> Queries information about the keys used in a <a href="../secgloss/s-gly.html"><em>security context</em></a>.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_LAST_CLIENT_TOKEN_STATUS</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->30<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_lastclienttokenstatus"><strong>SecPkgContext_LastClientTokenStatus</strong></a> structure that specifies whether the token from the most recent call to the <a href="initializesecuritycontext--general.html"><strong>InitializeSecurityContext</strong></a> function is the last token from the client.<!-- raw HTML omitted --> <strong>Windows ServerÂ 2008, WindowsÂ Vista, Windows ServerÂ 2003 and WindowsÂ XP:</strong> This value is not supported.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_LIFESPAN</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->2<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_lifespan"><strong>SecPkgContext_Lifespan</strong></a> structure.<!-- raw HTML omitted --> Queries the life span of the context.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_LOCAL_CRED</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <strong>SecPkgContext_LocalCredentialInfo</strong> structure. (obsolete)<!-- raw HTML omitted --> Superseded by SECPKG_ATTR_LOCAL_CERT_CONTEXT.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_NAMES</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->1<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_namesa"><strong>SecPkgContext_Names</strong></a> structure.<!-- raw HTML omitted --> Queries the name associated with the context.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_NATIVE_NAMES</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->13<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-_secpkgcontext_nativenamesa"><strong>SecPkgContext_NativeNames</strong></a> structure.<!-- raw HTML omitted --> Returns the principal name (CNAME) from the outbound ticket.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_NEGOTIATION_INFO</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->12<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_negotiationinfoa"><strong>SecPkgContext_NegotiationInfo</strong></a> structure.<!-- raw HTML omitted --> Returns information about the <a href="../secgloss/s-gly.html"><em>security package</em></a> to be used with the negotiation process and the current state of the negotiation for the use of that package.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_PACKAGE_INFO</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->10<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkginfoa"><strong>SecPkgContext_PackageInfo</strong></a> structure.<!-- raw HTML omitted --> Returns information on the SSP in use.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_PASSWORD_EXPIRY</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->8<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_passwordexpiry"><strong>SecPkgContext_PasswordExpiry</strong></a> structure.<!-- raw HTML omitted --> Returns password expiration information.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_ROOT_STORE</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x55<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <strong>HCERTCONTEXT</strong>. Finds a certificate context that contains a certificate supplied by the Root store.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_SESSION_KEY</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->9<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_sessionkey"><strong>SecPkgContext_SessionKey</strong></a> structure.<!-- raw HTML omitted --> Returns information about the <a href="../secgloss/s-gly.html"><em>session key</em></a>s.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_SIZES</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes"><strong>SecPkgContext_Sizes</strong></a> structure.<!-- raw HTML omitted --> Queries the sizes of the structures used in the per-message functions.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SECPKG_ATTR_TARGET_INFORMATION</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->17<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>pBuffer</em> parameter contains a pointer to a <a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_targetinformation"><strong>SecPkgContext_TargetInformation</strong></a> structure.<!-- raw HTML omitted --> Returns information about the name of the remote server.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<p><em>pBuffer</em> [out]</p>
<!-- raw HTML omitted -->
<p>A pointer to a structure that receives the attributes. The type of structure pointed to depends on the value specified in the <em>ulAttribute</em> parameter.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the function succeeds, the return value is SEC_E_OK.</p>
<p>If the function fails, the return value is a nonzero error code.</p>
<h2>Remarks</h2>
<p>The structure pointed to by the <em>pBuffer</em> parameter varies depending on the attribute being queried. The caller must allocate the <em>pBuffer</em> structure itself, but the SSP allocates any memory required to hold variable sized members of the <em>pBuffer</em> structure. Memory allocated by the SSP can be freed by calling the <a href="/windows/win32/api/sspi/nf-sspi-freecontextbuffer"><strong>FreeContextBuffer</strong></a> function.</p>
<p>After the SECPKG_ATTR_REMOTE_CERT_CONTEXT or SECPKG_ATTR_LOCAL_CERT_CONTEXT value has been read, the <strong>hCertStore</strong> member will be set to a handle to a certificate store that contains the intermediate certificates, if any. Also, the application is responsible for calling <a href="/windows/win32/api/wincrypt/nf-wincrypt-certfreecertificatecontext"><strong>CertFreeCertificateContext</strong></a> to release the memory used by the certificate context.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ XP [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows ServerÂ 2003 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Sspi.h (include Security.h)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Secur32.lib<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Secur32.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Unicode and ANSI names<!-- raw HTML omitted --></td>
<td><strong>QueryContextAttributesW</strong> (Unicode) and <strong>QueryContextAttributesA</strong> (ANSI)<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="authentication-functions.md#sspi-functions">SSPI Functions</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/wincrypt/ns-wincrypt-cert_context"><strong>CERT_CONTEXT</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/nf-sspi-freecontextbuffer"><strong>FreeContextBuffer</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_authoritya"><strong>SecPkgContext_Authority</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/schannel/ns-schannel-secpkgcontext_connectioninfo"><strong>SecPkgContext_ConnectionInfo</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_dceinfo"><strong>SecPkgContext_DceInfo</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/schannel/ns-schannel-secpkgcontext_issuerlistinfoex"><strong>SecPkgContext_IssuerListInfoEx</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_keyinfoa"><strong>SecPkgContext_KeyInfo</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_lifespan"><strong>SecPkgContext_Lifespan</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_namesa"><strong>SecPkgContext_Names</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes"><strong>SecPkgContext_Sizes</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sspi/ns-sspi-secpkgcontext_streamsizes"><strong>SecPkgContext_StreamSizes</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
