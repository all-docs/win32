<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Establishing a Secure Connection with Authentication</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: In a client/server application protocol, a server binds to a communication port such as a socket or an RPC interface.
ms.assetid: 176d4ca5-83dd-42ef-b116-227d4badc0dd
title: Establishing a Secure Connection with Authentication
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Establishing a Secure Connection with Authentication</h1>
<p>In a client/server <a href="/windows/desktop/SecGloss/a-gly"><em>application protocol</em></a>, a server binds to a communication port such as a socket or an RPC interface. The server then waits for a client to connect and request service. The role of security at connection setup is two-fold in the case of mutual authentication:</p>
<ul>
<li>Client authentication by the server.</li>
<li>Server authentication by the client.</li>
</ul>
<p>The client and server components of a transport application use a <a href="/windows/desktop/SecGloss/s-gly"><em>security package</em></a> to establish a secure connection for transmitting messages. The first step in establishing a secure connection is to create a <a href="/windows/desktop/SecGloss/s-gly"><em>security context</em></a>; that is, an opaque data structure that contains the security data relevant to a connection, such as a <a href="/windows/desktop/SecGloss/s-gly"><em>session key</em></a> and the duration of the session.</p>
<p>A security context is essentially a message from the security package associated with the client to the security package associated with the server. Consequently, creating a security context typically requires both client and server to make calls to their respective security packages. For more information on context functions, see <a href="authentication-functions.html">Context Management</a>.</p>
<p>The protocol used to establish a secure, authenticated connection involves the exchange of one or more &quot;security tokens&quot; between the client and the server. These tokens are sent as opaque messages by the two sides along with any other <a href="/windows/desktop/SecGloss/a-gly"><em>application protocol</em></a>-specific information. As an opaque message, the token is received from a security package function by the client, which cannot interpret or change it, and forwarded as a message to the server. The token is also opaque to the server, which can neither interpret nor change the token. The server forwards the opaque token to its security package for interpretation. The package then informs the server of the client authentication or failure to authenticate.</p>
<p>The client receives the server's token in a message, retrieves the token from the received message, and uses that token in a call to its security package. The client then calls the security package again indicating whether a secure connection has been established or whether further exchanges are needed before a secure connection is ready. Theoretically, there is no limit to the number of exchanges of security tokens needed. In practice, only a limited number of exchanges is required. NTLM authentication is based on the challenge/response scheme, and uses three legs to authenticate a client to the server. The <a href="/windows/desktop/SecGloss/k-gly"><em>Kerberos</em></a> version 5.0 protocol can require additional message exchanges.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="client-context-initialization.html">Client Context Initialization</a></p>
<!-- raw HTML omitted -->
<p><a href="server-context-initialization.html">Server Context Initialization</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
