<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>About VHD</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: The Virtual Hard Disk (VHD) format is a publicly-available image format specification that allows encapsulation of the hard disk into an individual file for use by the operating system as a virtual disk in all the same ways physical hard disks are used.
MS-HAID: vhd.about_vhd
MSHAttr:</p>
<ul>
<li>PreferredSiteName:MSDN</li>
<li>PreferredLib:/library/windows/desktop
title: About VHD
ms.topic: article
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1><!-- raw HTML omitted --><!-- raw HTML omitted -->About VHD</h1>
<p>The Virtual Hard Disk (VHD) format is a publicly-available image format <a href="https://download.microsoft.com/download/f/f/e/ffef50a5-07dd-4cf8-aaa3-442c0673a029/Virtual%20Hard%20Disk%20Format%20Spec_10_18_06.doc">specification</a> that allows encapsulation of the hard disk into an individual file for use by the operating system as a <em>virtual disk</em> in all the same ways physical hard disks are used. These virtual disks are capable of hosting native file systems (NTFS, FAT, exFAT, and UDFS) while supporting standard disk and file operations. VHD API support allows management of the virtual disks. Virtual disks created with the VHD API can function as boot disks.</p>
<p>An example of how VHD files are used is the <a href="https://www.microsoft.com/windowsserver2008/en/us/hyperv.aspx">Hyper-V</a> feature in WindowsÂ 7, Windows ServerÂ 2008, Virtual Server, and Windows Virtual PC. These products use the VHD API to contain the Windows operating system image utilized by a virtual machine as its system boot disk.</p>
<p>The Microsoft Windows Software Development Kit (SDK) integrates Native VHD support for working with virtual disks, making it easier for developers and administrators to create, manage, and deploy Windows images in VHD files using either the platform API support or management tools. It is not necessary to install separate applications or implement a VHD format parser to enable these operations. These APIs allow for generic use of virtual disks independent of any other virtualization technologies.</p>
<h2><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Terminology</h2>
<p>The term <em>backing store</em> is used to refer to the physical file that exists on the actual hard disk. The backing store is represented by a <em>VHD image file</em>.</p>
<p>The terms <em>dynamic</em>, <em>expandable</em>, and <em>sparse</em> are often used interchangeably when referring to dynamically expandable virtual disks. For VHD technology, these terms are identical.</p>
<h2><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->VHD System Features Overview</h2>
<p>The following diagram presents an overview of the VHD features and their relationships.</p>
<p><img src="images/vhd.png" alt="vhd block diagram" /></p>
<p>The following is a summary explanation of the previously described features.</p>
<p>User Mode Native Windows APIs:</p>
<ul>
<li>VirtDisk.dll - Common library for VHD management APIs.</li>
</ul>
<p>User Mode Domain-specific Management Wrappers:</p>
<ul>
<li><a href="/windows/desktop/VDS/about-vds">VDS VHD APIs</a> - VDS Object Model wrappers for the VHD Windows APIs.</li>
</ul>
<p>Kernel Mode Drivers:</p>
<ul>
<li>VDrvRoot.sys - Root virtual drive enumerator.</li>
<li>FsDepends.sys - Nested volume dependency management.</li>
<li>Vhdmp.sys - VHD parser and dependency property provider.</li>
</ul>
<p>The SDK documentation in this section covers the user-mode native Windows VHD APIs.</p>
<h2><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Virtual Disk Types</h2>
<p>There are considerations for using virtual disks, and what types of virtual disks are available:</p>
<ul>
<li>
<p><strong>Fixed</strong>â€”The VHD image file is pre-allocated on the backing store for the maximum size requested.</p>
</li>
<li>
<p><strong>Expandable</strong>â€”Also known as &quot;dynamic&quot;, &quot;dynamically expandable&quot;, and &quot;sparse&quot;, the VHD image file uses only as much space on the backing store as needed to store the actual data the virtual disk currently contains. When creating this type of virtual disk, the VHD API does not test for free space on the physical disk based on the maximum size requested, therefore it is possible to successfully create a dynamic virtual disk with a maximum size larger than the available physical disk free space. For more information, see <a href="/windows/win32/api/virtdisk/nf-virtdisk-expandvirtualdisk"><strong>ExpandVirtualDisk</strong></a>.
<strong>Note</strong>Â Â The maximum size of a dynamic virtual disk is 2,040 GB.</p>
<p>Â </p>
</li>
<li>
<p><strong>Differencing</strong>â€”A parent virtual disk is used as the basis of this type, with any subsequent writes written to the virtual disk as differences to the new differencing VHD image file, and the parent VHD image file is not modified. For example, if you have a clean-install system boot operating system virtual disk as a parent and designate the differencing virtual disk as the current virtual disk for the system to use, then the operating system on the parent virtual disk stays in its original state for quick recovery or for quickly creating more boot images based on additional differencing virtual disks. For more information, see <a href="/windows/win32/api/virtdisk/nf-virtdisk-mergevirtualdisk"><strong>MergeVirtualDisk</strong></a>.
<strong>Note</strong>Â Â The maximum size of a differencing virtual disk is 2,040 GB.</p>
<p>Â </p>
</li>
</ul>
<p>All virtual disk types have a minimum size of 3 MB.</p>
<h2><!-- raw HTML omitted --><!-- raw HTML omitted -->Related topics</h2>
<p><a href="/windows/desktop/VDS/about-vds">About VDS</a></p>
<p><a href="vhd-reference.html">VHD Reference</a></p>
<p><a href="https://download.microsoft.com/download/f/f/e/ffef50a5-07dd-4cf8-aaa3-442c0673a029/Virtual%20Hard%20Disk%20Format%20Spec_10_18_06.doc">Virtual Hard Disk Image Format Specification</a></p>
<p>Â </p>
<p>Â </p>
</body>
