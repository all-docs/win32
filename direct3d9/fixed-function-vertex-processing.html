<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Fixed Function Vertex Processing (Direct3D 9)</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: In the fixed function vertex pipeline, processing the vertices in a vertex buffer applies the current transformation matrices for the device.
ms.assetid: a882a5c5-b05e-4659-9040-92d3e2ccd89c
title: Fixed Function Vertex Processing (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Fixed Function Vertex Processing (Direct3D 9)</h1>
<p>In the fixed function vertex pipeline, processing the vertices in a vertex buffer applies the current transformation matrices for the device. Vertex operations such as lighting, generating clip flags, and updating extents can also be applied, optionally. When using fixed function vertex processing, modifying the elements in the destination vertex buffer is controlled by the <a href="other-direct3d-constants.html">D3DPV_DONOTCOPYDATA</a> flag. This flag applies only to fixed function vertex processing. The <a href="/windows/desktop/api"><strong>IDirect3DDevice9</strong></a> interface exposes the <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices"><strong>IDirect3DDevice9::ProcessVertices</strong></a> method to process vertices. You process vertices from a vertex shader to the set of input data streams, generating a single stream of interleaved vertex data to the destination vertex buffer by calling the <strong>IDirect3DDevice9::ProcessVertices</strong> method. The method accepts five parameters that describe the location and quantity of vertices that the method targets, the destination vertex buffer, and the processing options. After the call, the destination buffer contains the processed vertex data.</p>
<p>The first, second, and third parameters, SrcStartIndex, DestIndex, and VertexCount, reflect the index of the first vertex to load, the index within the destination buffer at which the vertices will be placed, and the total number of vertices to process and place in the destination buffer, respectively. The fourth parameter, pDestBuffer should be set to the address of the <a href="/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dvertexbuffer9"><strong>IDirect3DVertexBuffer9</strong></a> interface of the vertex buffer object that will receive the source vertices. The SrcStartIndex parameter specifies the index at which the method should start processing vertices.</p>
<p>The final parameter, Flags, determines special processing options for the method. You can set this parameter to 0 for default vertex processing, or to <a href="other-direct3d-constants.html">D3DPV_DONOTCOPYDATA</a> to optimize processing in some situations. You can also combine the D3DPV_DONOTCOPYDATA value with one or more <a href="d3dlock.html">D3DLOCK</a> values appropriate for the destination buffer. When you set Flags to 0, vertex components of the destination vertex buffer's vertex format that are not affected by the vertex operation are still copied from the vertex shader or set to 0. However, when using D3DPV_DONOTCOPYDATA, <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices"><strong>IDirect3DDevice9::ProcessVertices</strong></a> does not overwrite color and texture coordinate information in the destination buffer unless this data is generated by Direct3D. Diffuse color is generated when lighting is enabled, that is, D3DRS_LIGHTING is set to <strong>TRUE</strong>. Specular color is generated when lighting is enabled and specular is enabled, that is, D3DRS_SPECULARENABLE and D3DRS_LIGHTING are set to <strong>TRUE</strong>. Specular color is also generated when fog is enabled. Texture coordinates are generated when texture transform or texture generation is enabled. <strong>IDirect3DDevice9::ProcessVertices</strong> uses the current render states to determine what vertex processing should be done.</p>
<h2>FVF Usage Settings for Destination Vertex Buffers</h2>
<p>The <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices"><strong>IDirect3DDevice9::ProcessVertices</strong></a> method requires specific settings for the <a href="d3dfvf.html">D3DFVF</a> of the destination vertex buffer. The FVF usage settings must be compatible with the current settings for vertex processing.</p>
<p>For fixed function vertex processing, <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices"><strong>IDirect3DDevice9::ProcessVertices</strong></a> requires the following FVF settings:</p>
<ul>
<li>Position type is always <a href="d3dfvf.html">D3DFVF_XYZRHW</a> ; therefore, D3DFVF_XYZ And D3DFVF_XYZB1 through D3DFVF_XYZB5 Are invalid.</li>
<li>The <a href="d3dfvf.html">D3DFVF_NORMAL</a>, D3DFVF_RESERVED0, and D3DFVF_RESERVED2 flags must not be set.</li>
<li>The <a href="d3dfvf.html">D3DFVF_DIFFUSE</a> flag must be set if an OR operation of the following conditions returns true:
<ul>
<li>Lighting is enabled; that is, D3DRS_LIGHTING is <strong>TRUE</strong>.</li>
<li>Lighting is disabled, diffuse color is present in the input vertex streams, and <a href="other-direct3d-constants.html">D3DPV_DONOTCOPYDATA</a> is not set.</li>
</ul>
</li>
<li>The <a href="d3dfvf.html">D3DFVF_SPECULAR</a> flag must be set if an OR operation of the following conditions returns true:
<ul>
<li>Lighting is enabled and specular color is enabled; that is, D3DRS_SPECULARENABLE is <strong>TRUE</strong>.</li>
<li>Lighting is disabled, specular color is present in the input vertex streams, and <a href="other-direct3d-constants.html">D3DPV_DONOTCOPYDATA</a> is not set.</li>
<li>Vertex fog is enabled; that is, D3DRS_FOGVERTEXMODE is not set to D3DFOG_NONE.</li>
</ul>
</li>
</ul>
<p>In addition, the texture coordinate count must be set in the following manner:</p>
<ul>
<li>If texture transform and texture generation are disabled for all active texture stages, and the <a href="other-direct3d-constants.html">D3DPV_DONOTCOPYDATA</a> is not set, then the number and type of output texture coordinates are required to match those of the input vertex texture coordinates. If D3DPV_DONOTCOPYDATA is set and texture transform and texture generation are disabled, then the output texture coordinates are ignored.</li>
<li>If texture transform or texture generation is enabled for any active texture stages, the output vertex might need to contain more texture coordinate sets than the input vertex. This is due to the proliferation of texture coordinates from those being generated by texture generation or derived by texture transforms. Note that a similar proliferation of texture coordinates occurs during <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawprimitive"><strong>IDirect3DDevice9::DrawPrimitive</strong></a> calls, but is not visible to the application programmer. In this case, Direct3D generates a new set of texture coordinates. The new set of texture coordinates is derived by stepping through the texture stages and analyzing the settings for texture generation, texture transformation, and texture coordinate index to determine if a unique set of texture coordinates is required for that stage. Each time a new set is required it is allocated in increasing order. Note that the maximum, and typical, requirement is one set per stage, although it might be less due to sharing of nontransformed texture coordinates through D3DTSS_TEXCOORDINDEX.</li>
</ul>
<p>Thus, for each texture stage, a new set of texture coordinates is generated if a texture is bound to that stage and any of the following conditions are true:</p>
<ul>
<li>Texture generation is enabled for that stage.</li>
<li>Texture transformation is enabled for that stage.</li>
<li>Nontransformed input texture coordinates are referenced through D3DTSS_TEXCOORDINDEX for the first time.</li>
</ul>
<p>When Direct3D is generating texture coordinates, the application is required to perform the following actions:</p>
<ol>
<li>Use a destination vertex buffer with the appropriate FVF usage.</li>
<li>Reprogram the D3DTSS_TEXCOORDINDEX of the texture stage according to the placement of the postprocessed texture coordinates. Note that the reprogramming of the D3DTSS_TEXCOORDINDEX setting occurs when the processed vertex buffer is used in subsequent <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawprimitive"><strong>IDirect3DDevice9::DrawPrimitive</strong></a> and <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawindexedprimitive"><strong>IDirect3DDevice9::DrawIndexedPrimitive</strong></a> calls.</li>
</ol>
<p>Finally, texture coordinate dimensionality (<a href="d3dfvf.html">D3DFVF_TEX0</a> through D3DFVF_TEX8 ) must be set in the following manner:</p>
<ul>
<li>For each texture coordinate set, if texture transform and texture generation are disabled, then the output texture coordinate dimensionality must match the input. If the texture transform is enabled, then the output dimensionality must match the count defined by the D3DTTFF_COUNT1, D3DTTFF_COUNT2, D3DTTFF_COUNT3, or D3DTTFF_COUNT4 settings. If the texture transform is disabled and texture generation is enabled, then the output dimensionality must match the settings for the texture generation mode; currently all modes generate three float values.</li>
</ul>
<p>When <a href="/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices"><strong>IDirect3DDevice9::ProcessVertices</strong></a> fails due to an incompatible destination vertex buffer FVF code, the expected code is printed to the debug output (debug builds only).</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="vertex-buffers.html">Vertex Buffers</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
