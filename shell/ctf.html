<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>CTF Flags</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Flags that control the calling function's behavior. Used by SHCreateThread and SHCreateThreadWithHandle. In those functions, these values are defined as being of type SHCT_FLAGS.
title: CTF Flags (Shlwapi.h)
ms.topic: reference
ms.date: 05/31/2018
ms.assetid: 66cda866-7a39-4c5a-a795-a4c5c64cbab7
api_name:</p>
<ul>
<li>CTF_INSIST</li>
<li>CTF_THREAD_REF</li>
<li>CTF_PROCESS_REF</li>
<li>CTF_COINIT_STA</li>
<li>CTF_COINIT</li>
<li>CTF_FREELIBANDEXIT</li>
<li>CTF_REF_COUNTED</li>
<li>CTF_WAIT_ALLOWCOM</li>
<li>CTF_UNUSED</li>
<li>CTF_INHERITWOW64</li>
<li>CTF_WAIT_NO_REENTRANCY</li>
<li>CTF_KEYBOARD_LOCALE</li>
<li>CTF_OLEINITIALIZE</li>
<li>CTF_COINIT_MTA</li>
<li>CTF_NOADDREFLIB
api_type:</li>
<li>HeaderDef
api_location:</li>
<li>Shlwapi.h
topic_type:</li>
<li>APIRef</li>
<li>kbSyntax</li>
</ul>
<hr />
<h1>CTF Flags</h1>
<p>Flags that control the calling function's behavior. Used by <a href="/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread"><strong>SHCreateThread</strong></a> and <a href="/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadwithhandle"><strong>SHCreateThreadWithHandle</strong></a>. In those functions, these values are defined as being of type SHCT_FLAGS.</p>
<table>
<thead>
<tr>
<th align="left">Constant/value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_INSIST</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000001<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000001. If the attempt to create the thread with <a href="/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread"><strong>CreateThread</strong></a> fails, setting this flag will cause the function pointed to by <em>pfnThreadProc</em> to be called synchronously from the calling thread. This flag can be used only if <em>pfnCallback</em> is <strong>NULL</strong>.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_THREAD_REF</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000002<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000002. Hold a reference to the creating thread for the duration of the call to the function pointed to by <em>pfnThreadProc</em>. This reference must have been set with <a href="/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref"><strong>SHSetThreadRef</strong></a>.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_PROCESS_REF</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000004<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000004. Hold a reference to the Windows Explorer process for the duration of the call to the function pointed to by <em>pfnThreadProc</em>. This flag is useful for <a href="handlers.html">Shell extension handlers</a>, which might need to keep the Windows Explorer process from closing prematurely. This action is useful during tasks such as working on a background thread or copying files. For more information, see <a href="/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetinstanceexplorer"><strong>SHGetInstanceExplorer</strong></a>.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_COINIT_STA</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000008<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000008. Initialize COM as a Single Threaded Apartment (STA) for the created thread before calling either the optional function pointed to by <em>pfnCallback</em> or the function pointed to by <em>pfnThreadProc</em>. This flag is useful when COM needs to be initialized for a thread. COM will automatically be uninitialized as well.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_COINIT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000008<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">Equivalent to CTF_COINIT_STA.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_FREELIBANDEXIT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000010<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000010. <strong>Internet ExplorerÂ 6 or later.</strong><a href="/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a> will be called on the DLL that contains the <em>pfnThreadProc</em> function to prevent it from being unloaded. After <em>pfnThreadProc</em> returns, the DLL will be freed with <a href="/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary"><strong>FreeLibrary</strong></a>, thereby decrementing the DLL reference count. Pass this flag to prevent the DLL from being unloaded prematurely; for example, by <a href="/windows/win32/api/combaseapi/nf-combaseapi-cofreeunusedlibraries"><strong>CoFreeUnusedLibraries</strong></a>. Note that if this flag is passed, the <em>pfnThreadProc</em> function must reside in a DLL. This flag is implicit in WindowsÂ Vista and later.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_REF_COUNTED</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000020<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000020. <strong>Internet ExplorerÂ 6 or later.</strong> A thread reference will automatically be created for the created thread and set with <a href="/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref"><strong>SHSetThreadRef</strong></a>. After the <em>pfnThreadProc</em> returns, the thread reference is released and messages are sent until the reference count on the thread reference drops to zero, that is, until threads that are dependent on the created thread have released their references.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_WAIT_ALLOWCOM</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000040<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000040. <strong>Internet ExplorerÂ 6 or later.</strong> The calling thread waits and pumps COM and <a href="/windows/win32/api/winuser/nf-winuser-sendmessage"><strong>SendMessage</strong></a> messages. If the synchronous procedure attempts to send a Windows message with <strong>SendMessage</strong> to a window hosted on the calling thread, the message will arrive successfully. If the synchronous procedure attempts to use COM to communicate with an STA object hosted on the calling thread, the function call will successfully reach the intended object. The calling thread is open to re-entrance fragility. While the calling thread can handle the synchronous procedure's use of <strong>SendMessage</strong> and COM, if other threads are using <strong>SendMessage</strong> or COM to communicate to objects hosted on the calling thread, then these might be unexpected messages or function calls which are processed while the synchronous procedure is completing.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_UNUSED</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000080<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000080. <strong>Internet ExplorerÂ 7 or later.</strong> Not used.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_INHERITWOW64</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000100<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000100. <strong>Internet ExplorerÂ 7 or later.</strong> The new thread inherits the Windows-on-Windows 64-bit (WOW64) disable state for the file system redirector.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_WAIT_NO_REENTRANCY</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000200<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000200. <strong>WindowsÂ Vista or later.</strong> The calling thread blocks all other processes while waiting for the synchronous procedure to run on the new thread. If the synchronous procedure attempts to send a Windows message with <a href="/windows/win32/api/winuser/nf-winuser-sendmessage"><strong>SendMessage</strong></a> to a window hosted on the calling thread, this causes the synchronous procedure to deadlock. If the synchronous procedure attempts to use COM to talk to an STA object hosted on the calling thread, this also causes the synchronous procedure to deadlock. The calling thread is protected from all re-entrance concerns by specifying this flag.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_KEYBOARD_LOCALE</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000400<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000400. <strong>WindowsÂ 7 or later.</strong> Use the keyboard locale from the original thread in the new thread that it spawns.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_OLEINITIALIZE</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000800<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00000800. <strong>WindowsÂ 7 or later.</strong> Initialize COM with the single-threaded apartment (STA) model for the created thread.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_COINIT_MTA</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00001000<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00001000. <strong>WindowsÂ 7 and later</strong>. Initialize COM with the multithreaded apartment (MTA) model for the created thread.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td align="left"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>CTF_NOADDREFLIB</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00002000<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td align="left">0x00002000. <strong>WindowsÂ 7 or later.</strong> This flag is essentially the opposite of CTF_FREELIBANDEXIT. This avoids <a href="/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a>/<a href="/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread"><strong>FreeLibraryAndExitThread</strong></a> calls that can result in contention for the loader lock. Use CTF_NOADDREFLIB only when the new thread has means to ensure that the code of the original thread procedure will remain loaded. This value should not be used in the context of COM objects, because COM objects must ensure that the DLL stays loaded (normally, COM unloads the DLLs).<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>If no CTF_WAIT_ flag is specified, the calling thread will wait and send <a href="/windows/win32/api/winuser/nf-winuser-sendmessage"><strong>SendMessage</strong></a> messages. If the synchronous procedure attempts to send a Windows message with <strong>SendMessage</strong> to a window hosted on the calling thread, the message will get to the intended window. If the synchronous procedure attempts to use COM to talk to an STA object hosted on the calling thread, the synchronous procedure will deadlock. The calling thread is open to re-entrance fragility. While the calling thread can handle the synchronous procedure's use of <strong>SendMessage</strong>, if other threads use <strong>SendMessage</strong> to communicate to a window hosted on the calling thread, then these messages might be unexpected. This can cause them to be processed while the synchronous procedure is completing.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ 2000 Professional, WindowsÂ XP, WindowsÂ 7 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>WindowsÂ 2000 Server [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Shlwapi.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>Â </p>
</body>
