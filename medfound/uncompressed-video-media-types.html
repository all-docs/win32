<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Uncompressed Video Media Types</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Uncompressed Video Media Types
ms.assetid: 50bf2947-27ee-4092-9d3a-a1c13ee80e95
title: Uncompressed Video Media Types
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Uncompressed Video Media Types</h1>
<p>This topic describes how to create a media type that describes an uncompressed video format. For more information about media types generally, see <a href="about-media-types.html">About Media Types</a>.</p>
<p>To create a complete uncompressed video type, set the following attributes on the <a href="/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype"><strong>IMFMediaType</strong></a> interface pointer.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="mf-mt-major-type-attribute.html"><strong>MF_MT_MAJOR_TYPE</strong></a></td>
<td>Major type. Set to <strong>MFMediaType_Video</strong>.</td>
</tr>
<tr>
<td><a href="mf-mt-subtype-attribute.html"><strong>MF_MT_SUBTYPE</strong></a></td>
<td>Subtype. See <a href="video-subtype-guids.html">Video Subtype GUIDs</a>.</td>
</tr>
<tr>
<td><a href="mf-mt-default-stride-attribute.html"><strong>MF_MT_DEFAULT_STRIDE</strong></a></td>
<td>Surface stride. The <em>stride</em> is the number of bytes needed to go from one row of pixels to the next. Set this attribute if the stride in bytes is not the same as the video width in bytes. Otherwise, you can omit this attribute.</td>
</tr>
<tr>
<td><a href="mf-mt-frame-rate-attribute.html"><strong>MF_MT_FRAME_RATE</strong></a></td>
<td>Frame rate.</td>
</tr>
<tr>
<td><a href="mf-mt-frame-size-attribute.html"><strong>MF_MT_FRAME_SIZE</strong></a></td>
<td>Frame size.</td>
</tr>
<tr>
<td><a href="mf-mt-interlace-mode-attribute.html"><strong>MF_MT_INTERLACE_MODE</strong></a></td>
<td>Interlacing mode.</td>
</tr>
<tr>
<td><a href="mf-mt-all-samples-independent-attribute.html"><strong>MF_MT_ALL_SAMPLES_INDEPENDENT</strong></a></td>
<td>Specifies whether each sample is independent. Set to <strong>TRUE</strong> for uncompressed formats.</td>
</tr>
<tr>
<td><a href="mf-mt-pixel-aspect-ratio-attribute.html"><strong>MF_MT_PIXEL_ASPECT_RATIO</strong></a></td>
<td>Pixel aspect ratio.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>In addition, set the following attributes if you know the correct values. (Otherwise, omit these attributes.)</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="mf-mt-video-primaries-attribute.html"><strong>MF_MT_VIDEO_PRIMARIES</strong></a></td>
<td>Color primaries.</td>
</tr>
<tr>
<td><a href="mf-mt-transfer-function-attribute.html"><strong>MF_MT_TRANSFER_FUNCTION</strong></a></td>
<td>Transfer function.</td>
</tr>
<tr>
<td><a href="mf-mt-yuv-matrix-attribute.html"><strong>MF_MT_YUV_MATRIX</strong></a></td>
<td>Transfer matrix.</td>
</tr>
<tr>
<td><a href="mf-mt-video-chroma-siting-attribute.html"><strong>MF_MT_VIDEO_CHROMA_SITING</strong></a></td>
<td>Chroma siting.</td>
</tr>
<tr>
<td><a href="mf-mt-video-nominal-range-attribute.html"><strong>MF_MT_VIDEO_NOMINAL_RANGE</strong></a></td>
<td>Nominal range.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>For more information, see <a href="extended-color-information.html">Extended Color Information</a>. For example, if you create a media type that describes a video standard, and the standard defines the chroma siting, add this information to the media type. Doing so helps to preserve color fidelity throughout the pipeline.</p>
<p>The following functions might be useful when creating a video media type.</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfaveragetimeperframetoframerate"><strong>MFAverageTimePerFrameToFrameRate</strong></a></td>
<td>Calculates the frame rate, given the average frame duration.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfcalculateimagesize"><strong>MFCalculateImageSize</strong></a></td>
<td>Calculates the image size for an uncompressed video format.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfframeratetoaveragetimeperframe"><strong>MFFrameRateToAverageTimePerFrame</strong></a></td>
<td>Calculates the average duration of a video frame, given the frame rate.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfgetstrideforbitmapinfoheader"><strong>MFGetStrideForBitmapInfoHeader</strong></a></td>
<td>Returns the minimum surface stride for a video format. For more information, see <a href="image-stride.html">Image Stride</a>.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfinitvideoformat"><strong>MFInitVideoFormat</strong></a></td>
<td>Initializes an <a href="/windows/desktop/api/mfobjects/ns-mfobjects-mfvideoformat"><strong>MFVIDEOFORMAT</strong></a> structure for some standard video formats, such as NTSC television. You can then use the structure to initialize a media type.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfisformatyuv"><strong>MFIsFormatYUV</strong></a></td>
<td>Queries whether a video format is a YUV format.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Examples</h2>
<p>This example shows a function that fills in the most common information for an uncompressed video format. The function returns an <a href="/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype"><strong>IMFMediaType</strong></a> interface pointer. You can then add additional attributes to the media type as needed.</p>
<pre lang="C++"><code>HRESULT CreateUncompressedVideoType(
    DWORD                fccFormat,  // FOURCC or D3DFORMAT value.     
    UINT32               width, 
    UINT32               height,
    MFVideoInterlaceMode interlaceMode,
    const MFRatio&amp;       frameRate,
    const MFRatio&amp;       par,
    IMFMediaType         **ppType
    )
{
    if (ppType == NULL)
    {
        return E_POINTER;
    }

    GUID    subtype = MFVideoFormat_Base;
    LONG    lStride = 0;
    UINT    cbImage = 0;

    IMFMediaType *pType = NULL;

    // Set the subtype GUID from the FOURCC or D3DFORMAT value.
    subtype.Data1 = fccFormat;

    HRESULT hr = MFCreateMediaType(&amp;pType);
    if (FAILED(hr))
    {
        goto done;
    }

    hr = pType-&gt;SetGUID(MF_MT_MAJOR_TYPE, MFMediaType_Video);
    if (FAILED(hr))
    {
        goto done;
    }

    hr = pType-&gt;SetGUID(MF_MT_SUBTYPE, subtype);
    if (FAILED(hr))
    {
        goto done;
    }

    hr = pType-&gt;SetUINT32(MF_MT_INTERLACE_MODE, interlaceMode);
    if (FAILED(hr))
    {
        goto done;
    }

    hr = MFSetAttributeSize(pType, MF_MT_FRAME_SIZE, width, height);
    if (FAILED(hr))
    {
        goto done;
    }

    // Calculate the default stride value.
    hr = pType-&gt;SetUINT32(MF_MT_DEFAULT_STRIDE, UINT32(lStride));
    if (FAILED(hr))
    {
        goto done;
    }

    // Calculate the image size in bytes.
    hr = MFCalculateImageSize(subtype, width, height, &amp;cbImage);
    if (FAILED(hr))
    {
        goto done;
    }

    hr = pType-&gt;SetUINT32(MF_MT_SAMPLE_SIZE, cbImage);
    if (FAILED(hr))
    {
        goto done;
    }

    hr = pType-&gt;SetUINT32(MF_MT_FIXED_SIZE_SAMPLES, TRUE);
    if (FAILED(hr))
    {
        goto done;
    }

    hr = pType-&gt;SetUINT32(MF_MT_ALL_SAMPLES_INDEPENDENT, TRUE);
    if (FAILED(hr))
    {
        goto done;
    }

    // Frame rate
    hr = MFSetAttributeRatio(pType, MF_MT_FRAME_RATE, frameRate.Numerator, 
        frameRate.Denominator);
    if (FAILED(hr))
    {
        goto done;
    }

    // Pixel aspect ratio
    hr = MFSetAttributeRatio(pType, MF_MT_PIXEL_ASPECT_RATIO, par.Numerator, 
        par.Denominator);
    if (FAILED(hr))
    {
        goto done;
    }

    // Return the pointer to the caller.
    *ppType = pType;
    (*ppType)-&gt;AddRef();

done:
    SafeRelease(&amp;pType);
    return hr;
}
</code></pre>
<p>The next example takes an encoded video format as input, and creates a matching uncompressed video type. This type would be suitable to set on an encoder or decoder, for example.</p>
<pre lang="C++"><code>HRESULT ConvertVideoTypeToUncompressedType(
    IMFMediaType *pType,    // Pointer to an encoded video type.
    const GUID&amp; subtype,    // Uncompressed subtype (eg, RGB-32, AYUV)
    IMFMediaType **ppType   // Receives a matching uncompressed video type.
    )
{
    IMFMediaType *pTypeUncomp = NULL;

    HRESULT hr = S_OK;
    GUID majortype = { 0 };
    MFRatio par = { 0 };

    hr = pType-&gt;GetMajorType(&amp;majortype);

    if (majortype != MFMediaType_Video)
    {
        return MF_E_INVALIDMEDIATYPE;
    }

    // Create a new media type and copy over all of the items.
    // This ensures that extended color information is retained.

    if (SUCCEEDED(hr))
    {
        hr = MFCreateMediaType(&amp;pTypeUncomp);
    }

    if (SUCCEEDED(hr))
    {
        hr = pType-&gt;CopyAllItems(pTypeUncomp);
    }

    // Set the subtype.
    if (SUCCEEDED(hr))
    {
        hr = pTypeUncomp-&gt;SetGUID(MF_MT_SUBTYPE, subtype);
    }

    // Uncompressed means all samples are independent.
    if (SUCCEEDED(hr))
    {
        hr = pTypeUncomp-&gt;SetUINT32(MF_MT_ALL_SAMPLES_INDEPENDENT, TRUE);
    }

    // Fix up PAR if not set on the original type.
    if (SUCCEEDED(hr))
    {
        hr = MFGetAttributeRatio(
            pTypeUncomp, 
            MF_MT_PIXEL_ASPECT_RATIO, 
            (UINT32*)&amp;par.Numerator, 
            (UINT32*)&amp;par.Denominator
            );

        // Default to square pixels.
        if (FAILED(hr))
        {
            hr = MFSetAttributeRatio(
                pTypeUncomp, 
                MF_MT_PIXEL_ASPECT_RATIO, 
                1, 1
                );
        }
    }

    if (SUCCEEDED(hr))
    {
        *ppType = pTypeUncomp;
        (*ppType)-&gt;AddRef();
    }

    SafeRelease(&amp;pTypeUncomp);
    return hr;
}
</code></pre>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="extended-color-information.html">Extended Color Information</a></p>
<!-- raw HTML omitted -->
<p><a href="image-stride.html">Image Stride</a></p>
<!-- raw HTML omitted -->
<p><a href="media-types.html">Media Types</a></p>
<!-- raw HTML omitted -->
<p><a href="video-media-types.html">Video Media Types</a></p>
<!-- raw HTML omitted -->
<p><a href="video-subtype-guids.html">Video Subtype GUIDs</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
