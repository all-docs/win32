<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Media Type Conversions</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Media Type Conversions
ms.assetid: 6aee18b8-79b1-47fb-816f-d1c2c77b3a03
title: Media Type Conversions
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Media Type Conversions</h1>
<p>Occasionally it is necessary to convert between Media Foundation media types and the older media type structures from DirectShow or the Windows Media Format SDK.</p>
<h3>From a Format Structure to a Media Foundation Type</h3>
<p>The following functions initialize a Media Foundation media type from a format structure. These functions are also useful if a data stream or a file header contains a format structure. For example, the file header for WAVE audio files contains a <a href="/previous-versions/dd757713(v=vs.85)"><strong>WAVEFORMATEX</strong></a> structure.</p>
<table>
<thead>
<tr>
<th>Structure to Convert</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/windows/win32/api/strmif/ns-strmif-am_media_type"><strong>AM_MEDIA_TYPE</strong></a> (DirectShow)<!-- raw HTML omitted --><a href="/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type"><strong>DMO_MEDIA_TYPE</strong></a> (DirectX Media Objects) <!-- raw HTML omitted --><a href="/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type"><strong>WM_MEDIA_TYPE</strong></a> (Windows Media Format SDK) <!-- raw HTML omitted --> <strong>Note:</strong> These structures are equivalent.<!-- raw HTML omitted --></td>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromammediatype"><strong>MFInitMediaTypeFromAMMediaType</strong></a></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->BITMAPINFOHEADER<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFCreateVideoMediaTypeFromBitMapInfoHeaderEx<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFVIDEOFORMAT<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFInitMediaTypeFromMFVideoFormat<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MPEG1VIDEOINFO<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFInitMediaTypeFromMPEG1VideoInfo<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MPEG2VIDEOINFO<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFInitMediaTypeFromMPEG2VideoInfo<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->VIDEOINFOHEADER2<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFInitMediaTypeFromVideoInfoHeader2<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->VIDEOINFOHEADER<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFInitMediaTypeFromVideoInfoHeader<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->WAVEFORMATEX<!-- raw HTML omitted --><!-- raw HTML omitted --> or <!-- raw HTML omitted --><!-- raw HTML omitted -->WAVEFORMATEXTENSIBLE<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --><!-- raw HTML omitted -->MFInitMediaTypeFromWaveFormatEx<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h3>From a Media Foundation Type to a Format Structure</h3>
<p>The following functions create or initialize a format structure from a Media Foundation media type.</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Target Structure</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/windows/desktop/api/mfobjects/nf-mfobjects-imfmediatype-getrepresentation"><strong>IMFMediaType::GetRepresentation</strong></a></td>
<td><a href="/windows/win32/api/strmif/ns-strmif-am_media_type"><strong>AM_MEDIA_TYPE</strong></a>, <a href="/windows/desktop/api/mfobjects/ns-mfobjects-mfvideoformat"><strong>MFVIDEOFORMAT</strong></a>, <a href="/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader"><strong>VIDEOINFOHEADER</strong></a>, or <a href="/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2"><strong>VIDEOINFOHEADER2</strong></a></td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfcreateammediatypefrommfmediatype"><strong>MFCreateAMMediaTypeFromMFMediaType</strong></a></td>
<td><a href="/windows/win32/api/strmif/ns-strmif-am_media_type"><strong>AM_MEDIA_TYPE</strong></a></td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfcreatemfvideoformatfrommfmediatype"><strong>MFCreateMFVideoFormatFromMFMediaType</strong></a></td>
<td><a href="/windows/desktop/api/mfobjects/ns-mfobjects-mfvideoformat"><strong>MFVIDEOFORMAT</strong></a></td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfcreatewaveformatexfrommfmediatype"><strong>MFCreateWaveFormatExFromMFMediaType</strong></a></td>
<td><a href="/previous-versions/dd757713(v=vs.85)"><strong>WAVEFORMATEX</strong></a> or <a href="/previous-versions/windows/desktop/legacy/dd390971(v=vs.85)"><strong>WAVEFORMATEXTENSIBLE</strong></a></td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfapi/nf-mfapi-mfinitammediatypefrommfmediatype"><strong>MFInitAMMediaTypeFromMFMediaType</strong></a></td>
<td><a href="/windows/win32/api/strmif/ns-strmif-am_media_type"><strong>AM_MEDIA_TYPE</strong></a></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Format Mappings</h2>
<p>The following tables list the Media Foundation attributes that correspond to various format structures. Not all of these attributes can be translated directly. To perform conversions, you should use the functions listed in the previous section; these tables are provided mainly for reference.</p>
<h3>AM_MEDIA_TYPE</h3>
<table>
<thead>
<tr>
<th>Member</th>
<th>Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>bTemporalCompression</strong></td>
<td><a href="mf-mt-all-samples-independent-attribute.html"><strong>MF_MT_ALL_SAMPLES_INDEPENDENT</strong></a></td>
</tr>
<tr>
<td><strong>bFixedSizeSamples</strong></td>
<td><a href="mf-mt-fixed-size-samples-attribute.html"><strong>MF_MT_FIXED_SIZE_SAMPLES</strong></a></td>
</tr>
<tr>
<td><strong>lSampleSize</strong></td>
<td><a href="mf-mt-sample-size-attribute.html"><strong>MF_MT_SAMPLE_SIZE</strong></a></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h3>WAVEFORMATEX, WAVEFORMATEXTENSIBLE</h3>
<table>
<thead>
<tr>
<th>Member</th>
<th>Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>wFormatTag</strong></td>
<td><a href="mf-mt-subtype-attribute.html"><strong>MF_MT_SUBTYPE</strong></a><!-- raw HTML omitted --> If <strong>wFormatTag</strong> is WAVE_FORMAT_EXTENSIBLE, the subtype is found in the <strong>SubFormat</strong> member.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><strong>nChannels</strong></td>
<td><a href="mf-mt-audio-num-channels-attribute.html"><strong>MF_MT_AUDIO_NUM_CHANNELS</strong></a></td>
</tr>
<tr>
<td><strong>nSamplesPerSec</strong></td>
<td><a href="mf-mt-audio-samples-per-second-attribute.html"><strong>MF_MT_AUDIO_SAMPLES_PER_SECOND</strong></a></td>
</tr>
<tr>
<td><strong>nAvgBytesPerSec</strong></td>
<td><a href="mf-mt-audio-avg-bytes-per-second-attribute.html"><strong>MF_MT_AUDIO_AVG_BYTES_PER_SECOND</strong></a></td>
</tr>
<tr>
<td><strong>nBlockAlign</strong></td>
<td><a href="mf-mt-audio-block-alignment-attribute.html"><strong>MF_MT_AUDIO_BLOCK_ALIGNMENT</strong></a></td>
</tr>
<tr>
<td><strong>wBitsPerSample</strong></td>
<td><a href="mf-mt-audio-bits-per-sample-attribute.html"><strong>MF_MT_AUDIO_BITS_PER_SAMPLE</strong></a></td>
</tr>
<tr>
<td><strong>wValidBitsPerSample</strong></td>
<td><a href="mf-mt-audio-valid-bits-per-sample-attribute.html"><strong>MF_MT_AUDIO_VALID_BITS_PER_SAMPLE</strong></a></td>
</tr>
<tr>
<td><strong>wSamplesPerBlock</strong></td>
<td><a href="mf-mt-audio-samples-per-block-attribute.html"><strong>MF_MT_AUDIO_SAMPLES_PER_BLOCK</strong></a></td>
</tr>
<tr>
<td><strong>dwChannelMask</strong></td>
<td><a href="mf-mt-audio-channel-mask-attribute.html"><strong>MF_MT_AUDIO_CHANNEL_MASK</strong></a></td>
</tr>
<tr>
<td><strong>SubFormat</strong></td>
<td><a href="mf-mt-subtype-attribute.html"><strong>MF_MT_SUBTYPE</strong></a></td>
</tr>
<tr>
<td>Extra data</td>
<td><a href="mf-mt-user-data-attribute.html"><strong>MF_MT_USER_DATA</strong></a></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h3>VIDEOINFOHEADER, VIDEOINFOHEADER2</h3>
<table>
<thead>
<tr>
<th>Member</th>
<th>Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>dwBitRate</strong></td>
<td><a href="mf-mt-avg-bitrate-attribute.html"><strong>MF_MT_AVG_BITRATE</strong></a></td>
</tr>
<tr>
<td><strong>dwBitErrorRate</strong></td>
<td><a href="mf-mt-avg-bit-error-rate-attribute.html"><strong>MF_MT_AVG_BIT_ERROR_RATE</strong></a></td>
</tr>
<tr>
<td><strong>AvgTimePerFrame</strong></td>
<td><a href="mf-mt-frame-rate-attribute.html"><strong>MF_MT_FRAME_RATE</strong></a>; use <a href="/windows/desktop/api/mfapi/nf-mfapi-mfaveragetimeperframetoframerate"><strong>MFAverageTimePerFrameToFrameRate</strong></a> to calculate this value.</td>
</tr>
<tr>
<td><strong>dwInterlaceFlags</strong></td>
<td><a href="mf-mt-interlace-mode-attribute.html"><strong>MF_MT_INTERLACE_MODE</strong></a></td>
</tr>
<tr>
<td><strong>dwCopyProtectFlags</strong></td>
<td>No defined equivalent</td>
</tr>
<tr>
<td><strong>dwPictAspectRatioX</strong>, <strong>dwPictAspectRatioY</strong></td>
<td><a href="mf-mt-pixel-aspect-ratio-attribute.html"><strong>MF_MT_PIXEL_ASPECT_RATIO</strong></a>; must convert from picture aspect ratio to picture aspect ratio.</td>
</tr>
<tr>
<td><strong>dwControlFlags</strong></td>
<td><a href="mf-mt-pad-control-flags-attribute.html"><strong>MF_MT_PAD_CONTROL_FLAGS</strong></a>. If the <strong>AMCONTROL_COLORINFO_PRESENT</strong> flag is present, set the extended color attributes described in <a href="extended-color-information.html">Extended Color Information</a>.</td>
</tr>
<tr>
<td><strong>bmiHeader.biWidth</strong>, <strong>bmiHeader.biHeight</strong></td>
<td><a href="mf-mt-frame-size-attribute.html"><strong>MF_MT_FRAME_SIZE</strong></a></td>
</tr>
<tr>
<td><strong>bmiHeader.biBitCount</strong></td>
<td>Implicit in the subtype (<a href="mf-mt-subtype-attribute.html"><strong>MF_MT_SUBTYPE</strong></a>).</td>
</tr>
<tr>
<td><strong>bmiHeader.biCompression</strong></td>
<td>Implicit in the subtype.</td>
</tr>
<tr>
<td><strong>bmiHeader.biSizeImage</strong></td>
<td><a href="mf-mt-sample-size-attribute.html"><strong>MF_MT_SAMPLE_SIZE</strong></a></td>
</tr>
<tr>
<td>Palette information</td>
<td><a href="mf-mt-palette-attribute.html"><strong>MF_MT_PALETTE</strong></a></td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>The following attributes can be inferred from the <a href="/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader"><strong>VIDEOINFOHEADER</strong></a> or <a href="/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2"><strong>VIDEOINFOHEADER2</strong></a> structure but also require some knowledge of the format details. For example, different YUV formats have different stride requirements.</p>
<ul>
<li><a href="mf-mt-default-stride-attribute.html"><strong>MF_MT_DEFAULT_STRIDE</strong></a></li>
<li><a href="mf-mt-minimum-display-aperture-attribute.html"><strong>MF_MT_MINIMUM_DISPLAY_APERTURE</strong></a></li>
<li><a href="mf-mt-pan-scan-aperture-attribute.html"><strong>MF_MT_PAN_SCAN_APERTURE</strong></a></li>
</ul>
<h3>MPEG1VIDEOINFO</h3>
<table>
<thead>
<tr>
<th>Member</th>
<th>Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>dwStartTimeCode</strong></td>
<td><a href="mf-mt-mpeg-start-time-code-attribute.html"><strong>MF_MT_MPEG_START_TIME_CODE</strong></a></td>
</tr>
<tr>
<td><strong>bSequenceHeader</strong></td>
<td><a href="mf-mt-mpeg-sequence-header-attribute.html"><strong>MF_MT_MPEG_SEQUENCE_HEADER</strong></a></td>
</tr>
<tr>
<td><strong>biXPelsPerMeter</strong>, <strong>biYPelsPerMeter</strong></td>
<td><a href="mf-mt-pixel-aspect-ratio-attribute.html"><strong>MF_MT_PIXEL_ASPECT_RATIO</strong></a></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h3>MPEG2VIDEOINFO</h3>
<table>
<thead>
<tr>
<th>Member</th>
<th>Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>dwStartTimeCode</strong></td>
<td><a href="mf-mt-mpeg-start-time-code-attribute.html"><strong>MF_MT_MPEG_START_TIME_CODE</strong></a></td>
</tr>
<tr>
<td><strong>dwSequenceHeader</strong></td>
<td><a href="mf-mt-mpeg-sequence-header-attribute.html"><strong>MF_MT_MPEG_SEQUENCE_HEADER</strong></a></td>
</tr>
<tr>
<td><strong>dwProfile</strong></td>
<td><a href="mf-mt-mpeg2-profile-attribute.html"><strong>MF_MT_MPEG2_PROFILE</strong></a></td>
</tr>
<tr>
<td><strong>dwLevel</strong></td>
<td><a href="mf-mt-mpeg2-level-attribute.html"><strong>MF_MT_MPEG2_LEVEL</strong></a></td>
</tr>
<tr>
<td><strong>dwFlags</strong></td>
<td><a href="mf-mt-mpeg2-flags-attribute.html"><strong>MF_MT_MPEG2_FLAGS</strong></a></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Examples</h2>
<p>The following code fills in a <a href="/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader"><strong>BITMAPINFOHEADER</strong></a> structure from a video media type. Note that this conversions loses some of the format information (interlacing, frame rate, extended color data). However, it might be useful when saving a bitmap from a video frame, for example.</p>
<pre lang="C++"><code>#include &lt;dshow.h&gt;
#include &lt;dvdmedia.h&gt;

// Converts a video type to a BITMAPINFO structure.
// The caller must free the structure by calling CoTaskMemFree.

// Note that this conversion loses some format information, including 
// interlacing, and frame rate.

HRESULT GetBitmapInfoHeaderFromMFMediaType(
    IMFMediaType *pType,            // Pointer to the media type.
    BITMAPINFOHEADER **ppBmih,      // Receives a pointer to the structure. 
    DWORD *pcbSize)                 // Receives the size of the structure.
{
    *ppBmih = NULL;
    *pcbSize = 0;

    GUID majorType = GUID_NULL;
    AM_MEDIA_TYPE *pmt = NULL;
    DWORD cbSize = 0;
    DWORD cbOffset = 0;
    BITMAPINFOHEADER *pBMIH = NULL;

    // Verify that this is a video type.
    HRESULT hr = pType-&gt;GetMajorType(&amp;majorType);
    if (FAILED(hr))
    {
        goto done;
    }

    if (majorType != MFMediaType_Video)
    {
        hr = MF_E_INVALIDMEDIATYPE;
        goto done;
    }

    hr = pType-&gt;GetRepresentation(AM_MEDIA_TYPE_REPRESENTATION, (void**)&amp;pmt);
    if (FAILED(hr))
    {
        goto done;
    }

    if (pmt-&gt;formattype == FORMAT_VideoInfo)
    {
        cbOffset = (FIELD_OFFSET(VIDEOINFOHEADER,bmiHeader));
    }
    else if (pmt-&gt;formattype == FORMAT_VideoInfo2)
    {
        cbOffset = (FIELD_OFFSET(VIDEOINFOHEADER2,bmiHeader));
    }
    else
    {
        hr = MF_E_INVALIDMEDIATYPE; // Unsupported format type.
        goto done;
    }

    if (pmt-&gt;cbFormat - cbOffset &lt; sizeof(BITMAPINFOHEADER))
    {
        hr = E_UNEXPECTED; // Bad format size. 
        goto done;
    }

    cbSize = pmt-&gt;cbFormat - cbOffset;

    pBMIH = (BITMAPINFOHEADER*)CoTaskMemAlloc(cbSize);
    if (pBMIH == NULL)
    {
        hr = E_OUTOFMEMORY;
        goto done;
    }
    
    CopyMemory(pBMIH, pmt-&gt;pbFormat + cbOffset, cbSize);
    
    *ppBmih = pBMIH;
    *pcbSize = cbSize;

done:
    if (pmt)
    {
        pType-&gt;FreeRepresentation(AM_MEDIA_TYPE_REPRESENTATION, pmt);
    }
    return hr;
}
</code></pre>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="media-types.html">Media Types</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
