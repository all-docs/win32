<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Using MFTrace</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: MFTrace is a tool for generating trace logs for Microsoft Media Foundation applications.
ms.assetid: f93060dc-cb64-4623-847d-5d78bca59d50
title: Using MFTrace
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Using MFTrace</h1>
<p>MFTrace is a tool for generating trace logs for Microsoft Media Foundation applications.</p>
<p>MFTrace uses the Detours library to hook into Media Foundation API calls and generate trace logs. MFTrace can also record traces from any component that uses Event Tracing for Windows (ETW) or the software trace preprocessor (WPP) to generate traces. Trace logs can be generated by starting a new process from MFTrace, or by attaching MFTrace to an existing process.</p>
<h2>Usage</h2>
<p><strong>mftrace</strong> [<strong>-a</strong> <em>Process</em>][<strong>-c</strong> <em>ConfigurationFile</em>][<strong>-dc</strong>][<strong>-es</strong>][<strong>-k</strong> <em>KeyWords</em>][<strong>-l</strong> <em>Level</em>][<strong>-o</strong> <em>OutputFile</em>][<strong>-v</strong>][<strong>-?</strong>] [{<em>COMMAND</em>|<em>ETL_FILE</em>}]</p>
<table>
<thead>
<tr>
<th>Command-line arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-a<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Process ID or Process Name<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Attach to a running process.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-c<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Configuration File<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Read settings from the specified configuration file. See <!-- raw HTML omitted -->MFTrace Configuration File<!-- raw HTML omitted -->.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-dc<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Disable tracing for child processes. By default, tracing is enabled for child processes.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-es<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Enable public symbols.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-k<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Keywords<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>A comma-separated list of keywords. See <!-- raw HTML omitted -->MFTrace Keywords<!-- raw HTML omitted -->.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-l<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Level<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>The trace level.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->0: None<!-- raw HTML omitted --><!-- raw HTML omitted -->1: Critical<!-- raw HTML omitted --><!-- raw HTML omitted -->2: Error<!-- raw HTML omitted --><!-- raw HTML omitted -->3: Warning<!-- raw HTML omitted --><!-- raw HTML omitted -->4: Informative<!-- raw HTML omitted --><!-- raw HTML omitted -->5: Verbose<!-- raw HTML omitted --><!-- raw HTML omitted -->16: Debug<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-o<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Output File<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Write the trace output to the specified file. By default, output goes to <!-- raw HTML omitted -->stdout<!-- raw HTML omitted -->.<!-- raw HTML omitted --> If an output file is specified, the file name extension must be one of the following:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->.etl: Event trace log (ETL) file.<!-- raw HTML omitted --><!-- raw HTML omitted -->.log or .txt: Text file.<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-v<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Enable verbose mode.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->-?<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Display usage information.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->COMMAND<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Command-line arguments to create a new process.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ETL_FILE<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>The name of an existing ETL file. If this argument is provided, the ETL file is converted to text output.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Environment Variables</h2>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->TRACE_FORMAT_SEARCH_PATH</p>
<!-- raw HTML omitted -->
<p>To trace components that use the Windows software trace preprocessor (WPP), set this environment variable to the specify the path to the trace message format (TMF) files for the component.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->_NT_SYMBOL_PATH</p>
<!-- raw HTML omitted -->
<p>If symbol lookup is enabled (<strong>-es</strong>), set this environment variable to specify the symbol path.</p>
<!-- raw HTML omitted -->
<h2>Examples</h2>
<p>Create a new process and trace that process:</p>
<pre lang="syntax"><code>mftrace.exe wmplayer.exe Wildlife.wmv
</code></pre>
<p>Attach MFTrace to an existing process:</p>
<pre lang="syntax"><code>mftrace.exe -a wmplayer.exe
mftrace.exe -a 9132
</code></pre>
<p>Send trace output to a text file:</p>
<pre lang="syntax"><code>mftrace.exe -a wmplayer.exe -o trace.txt
</code></pre>
<p>Trace ETW or WPP events:</p>
<pre lang="syntax"><code>mftrace.exe -c config.xml -o trace.txt
mftrace.exe -c config.xml -o trace.etl
</code></pre>
<blockquote>
<p>[!Note]<br />
The first example generates a text file. The second example generates an ETL file.</p>
</blockquote>
<p>Â </p>
<p>Convert an ETL file to a text file:</p>
<pre lang="syntax"><code>mftrace.exe -o trace.txt trace.etl
</code></pre>
<h2>Remarks</h2>
<p>By default, MFTrace generates only Detours traces. To generate ETW or WPP traces, you must provide a configuration file. The configuration file gives the names of the trace providers. For more information, see <a href="mftrace-configuration-file.html">MFTrace Configuration File</a>.</p>
<p>MFTrace can send output to the following destinations:</p>
<ul>
<li><strong>stdout</strong> (the default).</li>
<li>A text file.</li>
<li>A binary ETL file.</li>
</ul>
<p>If you are logging ETW/WPP traces, an ETL file is the most efficient option, because the trace data are saved as binary blobs. After the trace session is complete, you can use MFTrace to convert the ETL file to a text file.</p>
<blockquote>
<p>[!Note]<br />
For Detours tracing, text output is just as efficient as an ETL file. Therefore, if you log only Detours traces (with no ETW/WPP traces), text output is recommended.</p>
</blockquote>
<p>Â </p>
<p>For Detours tracing, you must attach MFTrace to a running process (<strong>-a</strong>) or use MFTrace to create a new process. For ETW/WPP traces, MFTrace listens to any event provider that is listed in the configuration file.</p>
<p>You can filter the trace results by specifying trace keywords, either through the <strong>-k</strong> command-line option, or in the configuration file. The more typical usage, however, is to log all traces and then use a script or <strong>grep</strong> to search for particular string patterns.</p>
<h2>Interpreting the Trace Results</h2>
<p>You can use MFTrace to answer questions about what happens inside your Media Foundation application or component. The following table lists some typical questions. The second column gives the search string that can help answer the question.</p>
<table>
<thead>
<tr>
<th>Question</th>
<th>Search strings</th>
</tr>
</thead>
<tbody>
<tr>
<td>Did an error occur?</td>
<td>&quot;0xc00d&quot;</td>
</tr>
<tr>
<td>Did the topology resolve correctly?</td>
<td>&quot;CTopologyHelpers::Trace&quot;</td>
</tr>
<tr>
<td>Did the Media Session start?</td>
<td>&quot;MESessionStarted&quot;</td>
</tr>
<tr>
<td>Which file was played?</td>
<td>&quot;CMFSourceResolverDetours&quot;</td>
</tr>
<tr>
<td>What are the media types for the source streams?</td>
<td>&quot;New stream&quot;, &quot;MENewStream&quot;, &quot;CMFMediaSourceDetours::TracePD&quot;</td>
</tr>
<tr>
<td>Did the source streams generate samples?</td>
<td>&quot;CMFMediaStreamDetours::HandleEvent&quot;, &quot;MEMediaSample&quot;</td>
</tr>
<tr>
<td>Did playback reach the end of the data?</td>
<td>&quot;MEEndOfStream&quot;, &quot;MEEndOfPresentation&quot;</td>
</tr>
<tr>
<td>Did the format change?</td>
<td>&quot;MEStreamFormatChanged&quot; (media sources), &quot;New format&quot;, &quot;MESessionStreamSinkFormatChanged&quot; (media sinks)</td>
</tr>
<tr>
<td>What objects were created?</td>
<td>&quot;COle32ExportDetours::CoCreateInstance&quot;</td>
</tr>
<tr>
<td>Did the Media Foundation Transforms (MFTs) in the pipeline process any data?</td>
<td>&quot;CMFTransformDetours::ProcessOutput&quot;, &quot;CMFTransformDetours::ProcessInput&quot;</td>
</tr>
<tr>
<td>What states were set on the MFTs?</td>
<td>&quot;CMFTransformDetours::ProcessMessage&quot;</td>
</tr>
<tr>
<td>Did an MFT request input data?</td>
<td>&quot;MF_E_TRANSFORM_NEED_MORE_INPUT&quot; (synchronous MFT), &quot;METransformNeedInput&quot; (asynchronous MFT).</td>
</tr>
<tr>
<td>Did an asynchronous MFT produce output data?</td>
<td>&quot;ProcessOutputs available&quot;</td>
</tr>
<tr>
<td>Did a media sink request samples?</td>
<td>&quot;MEStreamSinkRequestSample&quot;</td>
</tr>
<tr>
<td>Did a media sink receive samples?</td>
<td>&quot;CMFStreamSinkDetours::ProcessSample&quot;</td>
</tr>
<tr>
<td>DirectShow: Which samples were processed?</td>
<td>&quot;sample&quot;, &quot;CMemInputPinDetours&quot;</td>
</tr>
<tr>
<td>DirectShow: What filter graph was used?</td>
<td>&quot;CGraphHelpers::Trace&quot;</td>
</tr>
<tr>
<td>Were there multiple processes?</td>
<td>&quot;CreateProcess&quot; <strong>Note:</strong> Also look for the process identifier, which appears at the start of every trace line.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="mftrace.html">MFTrace</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
