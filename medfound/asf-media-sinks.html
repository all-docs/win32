<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ASF Media Sinks</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: The ASF media sink is the final component in the encoding pipeline that enables an application to write an ASF file.
ms.assetid: 65bb8822-5eb0-46a3-ab9e-c55ae466e982
title: ASF Media Sinks
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>ASF Media Sinks</h1>
<p>The ASF media sink is the final component in the encoding pipeline that enables an application to write an ASF file.</p>
<p>Media Foundation provides two types of ASF media sinks:</p>
<ul>
<li><em>ASF file sink</em> is used to archive ASF media data to a file.</li>
<li><em>ASF streaming sink</em> is used to write ASF content in a byte stream that can be streamed across the network.</li>
</ul>
<p>ASF media sinks contain one or more stream sinks, which represents the data to write for each stream in the output ASF file. For encoding applications that run on WindowsÂ Vista, you must manually configure the encoding topology by creating and configuring the ASF media sink and then adding it to the topology. In WindowsÂ 7, if you are using the fast transcode objects to create the topology, you do not have create the media sink directly and the application does not call any methods on the media sink or any of the stream sinks. The fast transcode objects instantiate the required media sinks and add it to the topology before returning a reference to the caller application. However for fast transcode objects, there are some restrictions that apply depending on the type of encoding.</p>
<ul>
<li><a href="#asf-media-sink-object-model">ASF Media Sink Object Model</a></li>
<li><a href="#asf-file-sink">ASF File Sink</a></li>
<li><a href="#related-topics">Related topics</a></li>
</ul>
<h2>ASF Media Sink Object Model</h2>
<p>ASF media sinks implement the <a href="/windows/desktop/api/mfidl/nn-mfidl-imfmediasink"><strong>IMFMediaSink</strong></a> interface and exposes the following interfaces. An application can get a reference to these interfaces by calling <a href="/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)"><strong>QueryInterface</strong></a> on the ASF media sink it is using for generating output samples.</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/windows/desktop/api/mfidl/nn-mfidl-imfmediasink"><strong>IMFMediaSink</strong></a></td>
<td>Required for all media sinks.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfidl/nn-mfidl-imffinalizablemediasink"><strong>IMFFinalizableMediaSink</strong></a></td>
<td>Implemented by the ASF file sink that writes the generated media content to a file. You can use the methods on this interface to flush data and update the ASF Header Object of the final output file.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink"><strong>IMFClockStateSink</strong></a></td>
<td>Receives state-change notifications from the presentation clock.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo"><strong>IMFASFContentInfo</strong></a></td>
<td>The ASF ContentInfo object is a WMContainer level object that mainly stores ASF Header Object information. This is used to create ASF media sinks.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfidl/nn-mfidl-imfmetadata"><strong>IMFMetadata</strong></a></td>
<td>Used to describe the metadata for the ASF file.</td>
</tr>
<tr>
<td><a href="/windows/desktop/api/mfidl/nn-mfidl-imfmetadataprovider"><strong>IMFMetadataProvider</strong></a></td>
<td>Retrieves a collection of metadata, either for an entire presentation, or for one stream in the presentation.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>ASF File Sink</h2>
<p>The ASF file sink is an implementation of <a href="/windows/desktop/api/mfidl/nn-mfidl-imfmediasink"><strong>IMFMediaSink</strong></a> provided by Media Foundation that an application can use to archive ASF media data to a file.</p>
<p>You need to create, configure, and call methods on the file sink or any of its stream sinks if you are using the pipeline layer objects to write a new ASF file. After configuring the file sink you can then add it to the encoding pipeline.</p>
<p>Here are the general steps for using the ASF file sink:</p>
<ol>
<li>Create the file sink in-process or out-of-process.</li>
<li>Configure the file sink with all the streams, encoding properties, and metadata information.</li>
<li>Associate the file sink with the output topology node either by enumerating the stream sinks or by keeping track of the stream numbers with in the sink.</li>
</ol>
<p>The following topics contain detailed information about working with the ASF file sink:</p>
<ul>
<li><a href="creating-the-asf-file-sink.html">Creating the ASF File Sink</a></li>
<li><a href="adding-stream-information-to-the-asf-file-sink.html">Adding Stream Information to the ASF File Sink</a></li>
<li><a href="setting-properties-in-the-file-sink.html">Setting Properties in the File Sink</a></li>
<li><a href="adding-metadata-to-the-file-sink.html">Adding Metadata to the File Sink</a></li>
<li><a href="the-leaky-bucket-buffer-model.html">The Leaky Bucket Buffer Model</a></li>
</ul>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="pipeline-layer-asf-components.html">Pipeline Layer ASF Components</a></p>
<!-- raw HTML omitted -->
<p><a href="asf-support-in-media-foundation.html">ASF Support in Media Foundation</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
