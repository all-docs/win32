<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Working with DMO Media Buffers</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Working with DMO Media Buffers
ms.assetid: 6d0c51b8-0d79-4f04-8e90-0cea4f3b1427
title: Working with DMO Media Buffers
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Working with DMO Media Buffers</h1>
<p>Input data is passed to the codec DMOs using media buffers. A media buffer is an object that implements the <a href="/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediabuffer"><strong>IMediaBuffer</strong></a> interface. You can implement a class for this purpose or, if you are using the Windows Media Format SDK in your application, you can use the buffer objects that are defined in that SDK.</p>
<p>If you implement your own buffer class, be careful about how the buffer memory is handled. When you pass an input sample, the DMO keeps a reference to the buffer until it is finished with the sample. You can immediately release your reference to the <a href="/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediabuffer"><strong>IMediaBuffer</strong></a> interface, but you have no way of knowing when the codec no longer needs its reference. To be certain that the memory is freed when the object deletes itself, you should implement your class so that it allocates and frees the memory for the buffer internally.</p>
<p>Because the DMOs keep references to buffers for an unknown period of time, it is not a trivial matter to use a limited pool of buffers. The simplest solution is to allocate a new buffer for each sample, although doing so is inefficient.</p>
<p>A better solution is to implement an object to manage a pool of buffers. To do this, write code in the <strong>Release</strong> method of your <a href="/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediabuffer"><strong>IMediaBuffer</strong></a> implementation that calls a method of your buffer manager (instead of deleting itself) when the reference count drops to zero. The buffer manager can then maintain a list of pointers to allocated buffer objects. Create a method in your buffer manager to check the list of free buffers and return a pointer so that your application can access buffers when needed. This method should create new buffers as needed and add them to the list.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="workingwithcodecdmos.html">Working with Codec DMOs</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
