<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SO_KEEPALIVE socket option</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Is designed to allow an application to enable keep-alive packets for a socket connection.
ms.assetid: d6da7761-7a09-4c91-9737-550590a773b3
title: SO_KEEPALIVE socket option (Ws2def.h)
ms.topic: reference
ms.date: 05/31/2018</h2>
<h1>SO_KEEPALIVE socket option</h1>
<p>The <strong>SO_KEEPALIVE</strong> socket option is designed to allow an application to enable keep-alive packets for a socket connection.</p>
<p>To query the status of this socket option, call the <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function. To set this option, call the <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function with the following parameters.</p>
<h2>Socket option value</h2>
<p>The constant that represents this socket option is 0x0008.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>int setsockopt(
  (SOCKET) s,      // descriptor identifying a socket 
  (int) SOL_SOCKET,   // level
  (int) SO_KEEPALIVE, // optname
  (char *) optval, // input buffer,
  (int) optlen  // size of input buffer
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>s</em> [in]</p>
<!-- raw HTML omitted -->
<p>A descriptor identifying the socket.</p>
<!-- raw HTML omitted -->
<p><em>level</em> [in]</p>
<!-- raw HTML omitted -->
<p>The level at which the option is defined. Use <strong>SOL_SOCKET</strong> for this operation.</p>
<!-- raw HTML omitted -->
<p><em>optname</em> [in]</p>
<!-- raw HTML omitted -->
<p>The socket option for which the value is to be set. Use <strong>SO_KEEPALIVE</strong> for this operation.</p>
<!-- raw HTML omitted -->
<p><em>optval</em> [out]</p>
<!-- raw HTML omitted -->
<p>A pointer to the buffer containing the value for the option to set. This parameter should point to buffer equal to or larger than the size of a <strong>DWORD</strong> value.</p>
<p>This value is treated as a boolean value with 0 used to indicate <strong>FALSE</strong> (disabled) and a nonzero value to indicate <strong>TRUE</strong> (enabled).</p>
<!-- raw HTML omitted -->
<p><em>optlen</em> [in]</p>
<!-- raw HTML omitted -->
<p>The size, in bytes, of the <em>optval</em> buffer. This size must be equal to or larger than the size of a <strong>DWORD</strong> value.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the operation completes successfully, <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> returns zero.</p>
<p>If the operation fails, a value of SOCKET_ERROR is returned and a specific error code can be retrieved by calling <a href="/windows/desktop/api/winsock/nf-winsock-wsagetlasterror"><strong>WSAGetLastError</strong></a>.</p>
<table>
<thead>
<tr>
<th>Error code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSANOTINITIALISED</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A successful <a href="/windows/desktop/api/winsock/nf-winsock-wsastartup"><strong>WSAStartup</strong></a> call must occur before using this function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENETDOWN</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The network subsystem has failed.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEFAULT</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>One of the <em>optval</em> or the <em>optlen</em> parameters point to memory that is not in a valid part of the user address space. This error is also returned if the value pointed to by the <em>optlen</em> parameter is less than the size of a <strong>DWORD</strong> value.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEINPROGRESS</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A blocking Windows Sockets 1.1 call is in progress, or the service provider is still processing a callback function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEINVAL</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>level</em> parameter is unknown or invalid. On WindowsÂ Vista and later, this error is also returned if the socket was in a transitional state.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENOPROTOOPT</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The option is unknown or unsupported by the indicated protocol family. This error is returned if the socket descriptor passed in the <em>s</em> parameter was for a datagram socket.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENOTSOCK</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The descriptor is not a socket.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Remarks</h2>
<p>The <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function called with the <strong>SO_KEEPALIVE</strong> socket option allows an application to retrieve the current state of the keepalive option, although this feature is not normally used. If an application needs to enable keepalive packets on a socket, it justs calls the <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function to enable the option.</p>
<p>The <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function called with the <strong>SO_KEEPALIVE</strong> socket option allows an application to enable keep-alive packets for a socket connection. The <strong>SO_KEEPALIVE</strong> option for a socket is disabled (set to <strong>FALSE</strong>) by default.</p>
<p>When this socket option is enabled, the TCP stack sends keep-alive packets when no data or acknowledgement packets have been received for the connection within an interval. For more information on the keep-alive option, see section 4.2.3.6 on the <em>Requirements for Internet Hostsâ€”Communication Layers</em> specified in RFC 1122 available at the <a href="https://www.ietf.org/rfc/rfc1122.txt">IETF website</a>. (This resource may only be available in English.)</p>
<p>The <strong>SO_KEEPALIVE</strong> socket option is valid only for protocols that support the notion of keep-alive (connection-oriented protocols). For TCP, the default keep-alive timeout is 2 hours and the keep-alive interval is 1 second. The default number of keep-alive probes varies based on the version of Windows.</p>
<p>The <a href="/windows/win32/winsock/sio-keepalive-vals"><strong>SIO_KEEPALIVE_VALS</strong></a> control code can be used to enable or disable keep-alive, and adjust the timeout and interval, for a single connection. If keep-alive is enabled with <strong>SO_KEEPALIVE</strong>, then the default TCP settings are used for keep-alive timeout and interval unless these values have been changed using <strong>SIO_KEEPALIVE_VALS</strong>.</p>
<p>The default system-wide value of the keep-alive timeout is controllable through the <a href="/previous-versions/windows/it-pro/windows-server-2003/cc782936(v=ws.10)">KeepAliveTime</a> registry setting which takes a value in milliseconds. The default system-wide value of the keep-alive interval is controllable through the <a href="/previous-versions/windows/it-pro/windows-server-2003/cc758083(v=ws.10)">KeepAliveInterval</a> registry setting which takes a value in milliseconds.</p>
<p>On WindowsÂ Vista and later, the number of keep-alive probes (data retransmissions) is set to 10 and cannot be changed.</p>
<p>On Windows ServerÂ 2003, WindowsÂ XP, and WindowsÂ 2000, the default setting for number of keep-alive probes is 5. The number of keep-alive probes is controllable through the <a href="/previous-versions/windows/it-pro/windows-server-2003/cc780586(v=ws.10)">TcpMaxDataRetransmissions</a> and <a href="/previous-versions/windows/it-pro/windows-server-2003/cc775408(v=ws.10)">PPTPTcpMaxDataRetransmissions</a> registry settings. The number of keep-alive probes is set to the larger of the two registry key values. If this number is 0, then keep-alive probes will not be sent. If this number is above 255, then it is adjusted to 255.</p>
<p>On WindowsÂ Vista and later, the <strong>SO_KEEPALIVE</strong> socket option can only be set using the <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function when the socket is in a well-known state not a transitional state. For TCP, the <strong>SO_KEEPALIVE</strong> socket option should be set either before the connect function (<a href="/windows/desktop/api/Winsock2/nf-winsock2-connect"><strong>connect</strong></a>, <a href="/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex"><strong>ConnectEx</strong></a>, <a href="/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect"><strong>WSAConnect</strong></a>, <a href="/windows/desktop/api/Winsock2/nf-winsock2-wsaconnectbylist"><strong>WSAConnectByList</strong></a>, or <a href="/windows/desktop/api/Winsock2/nf-winsock2-wsaconnectbynamea"><strong>WSAConnectByName</strong></a>) is called, or after the connection request is actually completed. If the connect function was called asynchronously, then this requires waiting for the connection completion before trying to set the <strong>SO_KEEPALIVE</strong> socket option. If an application attempts to set the <strong>SO_KEEPALIVE</strong> socket option when a connection request is still in process, the <strong>setsockopt</strong> function will fail and return <a href="windows-sockets-error-codes-2.html">WSAEINVAL</a>.</p>
<p>On Windows ServerÂ 2003, WindowsÂ XP, and WindowsÂ 2000, the <strong>SO_KEEPALIVE</strong> socket option can be set using the <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function when the socket is a transitional state (a connection request is still in progress) as well as a well-known state.</p>
<p>Note that the <em>Ws2def.h</em> header file is automatically included in <em>Winsock2.h</em>, and should never be used directly.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ 2000 Professional [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>WindowsÂ 2000 Server [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Ws2def.h (include Winsock2.h)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/previous-versions/windows/it-pro/windows-server-2003/cc782936(v=ws.10)">KeepAliveTime</a></p>
<!-- raw HTML omitted -->
<p><a href="/previous-versions/windows/it-pro/windows-server-2003/cc758083(v=ws.10)">KeepAliveInterval</a></p>
<!-- raw HTML omitted -->
<p><a href="/previous-versions/windows/it-pro/windows-server-2003/cc775408(v=ws.10)">PPTPTcpMaxDataRetransmissions</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Winsock2/nf-winsock2-socket"><strong>socket</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/winsock/sio-keepalive-vals"><strong>SIO_KEEPALIVE_VALS</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/previous-versions/windows/it-pro/windows-server-2003/cc780586(v=ws.10)">TcpMaxDataRetransmissions</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/winsock/nf-winsock-wsagetlasterror"><strong>WSAGetLastError</strong></a></p>
<!-- raw HTML omitted -->
</body>
