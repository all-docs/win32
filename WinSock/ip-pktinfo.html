<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IP_PKTINFO socket option</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Allows an application to enable or disable the return of packet information by the WSARecvMsg function on an IPv4 socket.
ms.assetid: C6246899-0220-4F88-B43B-CED1B1FF7DC3
title: IP_PKTINFO socket option (Ws2ipdef.h)
ms.topic: reference
ms.date: 05/31/2018</h2>
<h1>IP_PKTINFO socket option</h1>
<p>The IP_PKTINFO socket option allows an application to enable or disable the return of packet information by the <a href="/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg"><strong>LPFN_WSARECVMSG (WSARecvMsg)</strong></a> function on an IPv4 socket..</p>
<p>To query the status of this socket option, call the <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function. To set this option, call the <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function with the following parameters.</p>
<h2>Socket option value</h2>
<p>The constant that represents this socket option is 19.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>int getsockopt(
  (SOCKET) s,      // descriptor identifying a socket 
  (int) IPPROTO_IP,   // level
  (int) IP_PKTINFO, // optname
  (char *) optval, // output buffer,
  (int) optlen,  // size of output buffer
);
</code></pre>
<pre lang="C++"><code>int setsockopt(
  (SOCKET) s,      // descriptor identifying a socket 
  (int) IPPROTO_IP,   // level
  (int) IP_PKTINFO, // optname
  (char *) optval, // input buffer,
  (int) optlen,  // size of input buffer
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>s</em> [in]</p>
<!-- raw HTML omitted -->
<p>A descriptor identifying the socket.</p>
<!-- raw HTML omitted -->
<p><em>level</em> [in]</p>
<!-- raw HTML omitted -->
<p>The level at which the option is defined. Use <strong>IPPROTO_IP</strong> for this operation.</p>
<!-- raw HTML omitted -->
<p><em>optname</em> [in]</p>
<!-- raw HTML omitted -->
<p>The socket option for which to get or set the value. Use IP_PKTINFO for this operation.</p>
<!-- raw HTML omitted -->
<p><em>optval</em> [out]</p>
<!-- raw HTML omitted -->
<p>A pointer to the buffer containing the value for the option to set. This parameter should point to buffer equal to or larger than the size of a <strong>DWORD</strong> value.</p>
<p>This value is treated as a boolean value with 0 used to indicate <strong>FALSE</strong> (disabled) and a nonzero value to indicate <strong>TRUE</strong> (enabled).</p>
<!-- raw HTML omitted -->
<p><em>optlen</em> [in, out]</p>
<!-- raw HTML omitted -->
<p>A pointer to the size, in bytes, of the <em>optval</em> buffer. This size must be equal to or larger than the size of a <strong>DWORD</strong> value.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the operation completes successfully, the <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> or <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function returns zero.</p>
<p>If the operation fails, a value of SOCKET_ERROR is returned and a specific error code can be retrieved by calling <a href="/windows/desktop/api/winsock/nf-winsock-wsagetlasterror"><strong>WSAGetLastError</strong></a>.</p>
<table>
<thead>
<tr>
<th>Error code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSANOTINITIALISED</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A successful <a href="/windows/desktop/api/winsock/nf-winsock-wsastartup"><strong>WSAStartup</strong></a> call must occur before using this function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENETDOWN</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The network subsystem has failed.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEFAULT</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>One of the <em>optval</em> or the <em>optlen</em> parameters point to memory that is not in a valid part of the user address space. This error is also returned if the value pointed to by the <em>optlen</em> parameter is less than the size of a <strong>DWORD</strong> value.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEINPROGRESS</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A blocking Windows Sockets 1.1 call is in progress, or the service provider is still processing a callback function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEINVAL</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>An invalid argument was supplied. This error is returned if the <em>level</em> parameter is unknown or invalid. On WindowsÂ Vista and later, this error is also returned if the socket was in a transitional state.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENOPROTOOPT</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The option is unknown or unsupported by the indicated protocol family. This error is returned if the <em>type</em> parameter for the socket descriptor passed in the <em>s</em> parameter was not <strong>SOCK_DGRAM</strong> or <strong>SOCK_RAW</strong>. <!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENOTSOCK</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The descriptor is not a socket.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Remarks</h2>
<p>The <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function called with the IP_PKTINFO socket option allows an application to determine if packet information is to be returned by the <a href="/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg"><strong>LPFN_WSARECVMSG (WSARecvMsg)</strong></a>function for an IPv4 socket.</p>
<p>The <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function called with the IP_PKTINFO socket option allows an application to enable or disable the return of packet information by the <a href="/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg"><strong>LPFN_WSARECVMSG (WSARecvMsg)</strong></a> function. The IP_PKTINFO option for a socket is disabled (set to <strong>FALSE</strong>) by default.</p>
<p>When this socket option is enabled on an IPv4 socket of type <strong>SOCK_DGRAM</strong> or <strong>SOCK_RAW</strong>, the <a href="/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg"><strong>LPFN_WSARECVMSG (WSARecvMsg)</strong></a> function returns packet information in the <a href="/windows/desktop/api/Ws2def/ns-ws2def-wsamsg"><strong>WSAMSG</strong></a> structure pointed to by the <em>lpMsg</em> parameter. One of the control data objects in the returned <strong>WSAMSG</strong> structure will contain an <a href="/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-in_pktinfo"><strong>in_pktinfo</strong></a> structure used to store received packet address information.</p>
<p>For datagrams received by the <a href="/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg"><strong>LPFN_WSARECVMSG (WSARecvMsg)</strong></a> function over IPv4, the <strong>Control</strong> member of the <a href="/windows/desktop/api/Ws2def/ns-ws2def-wsamsg"><strong>WSAMSG</strong></a> structure received will contain a <a href="/windows/desktop/api/ws2def/ns-ws2def-wsabuf"><strong>WSABUF</strong></a> structure that contains a <strong>WSACMSGHDR</strong> structure. The <strong>cmsg_level</strong> member of this <strong>WSACMSGHDR</strong> structure would contain <strong>IPPROTO_IP</strong>, the <strong>cmsg_type</strong> member of this structure would contain <strong>IP_PKTINFO</strong>, and the <strong>cmsg_data</strong> member would contain an <a href="/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-in_pktinfo"><strong>in_pktinfo</strong></a> structure used to store received IPv4 packet address information. The IPv4 address in the <strong>in_pktinfo</strong> structure is the IPv4 address from which the packet was received.</p>
<p>For a dual-stack datagram socket, if an application requires the <a href="/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg"><strong>LPFN_WSARECVMSG (WSARecvMsg)</strong></a> function to return packet information in a <a href="/windows/desktop/api/Ws2def/ns-ws2def-wsamsg"><strong>WSAMSG</strong></a> structure for datagrams received over IPv4, then IP_PKTINFO socket option must be set to true on the socket. If only the <a href="ipv6-pktinfo.html">IPV6_PKTINFO</a> option is set to true on the socket, packet information will be provided for datagrams received over IPv6 but may not be provided for datagrams received over IPv4.</p>
<p>If an application tries to set the IP_PKTINFO socket option on a dual-stack datagram socket and IPv4 is disabled on the system, then the <a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a> function will fail and <a href="/windows/desktop/api/winsock/nf-winsock-wsagetlasterror"><strong>WSAGetLastError</strong></a> will return with an error of <a href="windows-sockets-error-codes-2.html">WSAEINVAL</a>. This same error is also returned by the <strong>setsockopt</strong> function as a result of other errors. If an application tries to set an IPPROTO_IP level socket option on a dual-stack socket and it fails with <a href="windows-sockets-error-codes-2.html">WSAEINVAL</a>, then the application should determine if IPv4 is disabled on the local computer. One method that can be used to detect if IPv4 is enabled or disabled is to call the <a href="/windows/desktop/api/Winsock2/nf-winsock2-socket"><strong>socket</strong></a> function with the <em>af</em> parameter set to AF_INET to try and create an IPv4 socket. If the <strong>socket</strong> function fails and <strong>WSAGetLastError</strong> returns an error of <a href="windows-sockets-error-codes-2.html">WSAEAFNOSUPPORT</a>, then it means IPv4 is not enabled. In this case, a <strong>setsockopt</strong> function failure when attempting to set the IP_PKTINFO socket option can be ignored by the application. Otherwise a failure when attempting to set the IP_PKTINFO socket option should be treated as an unexpected error.</p>
<p>Note that the <em>Ws2ipdef.h</em> header file is automatically included in <em>Ws2tcpip.h</em>, and should never be used directly.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ XP [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows ServerÂ 2003 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Ws2ipdef.h (include Ws2tcpip.h)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="dual-stack-sockets.html">Dual-Stack Sockets</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-in_pktinfo"><strong>in_pktinfo</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="ipproto-ip-socket-options.html"><strong>IPPROTO_IP Socket Options</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="ipv6-pktinfo.html">IPV6_PKTINFO</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/winsock/nf-winsock-setsockopt"><strong>setsockopt</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Winsock2/nf-winsock2-socket"><strong>socket</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Ws2def/ns-ws2def-wsamsg"><strong>WSAMSG</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg"><strong>LPFN_WSARECVMSG (WSARecvMsg)</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
