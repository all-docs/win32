<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SO_BSP_STATE socket option</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Returns the local address, local port, remote address, remote port, socket type, and protocol used by a socket.
ms.assetid: 2628f47e-3e73-4e02-91b8-ba4cb0800864
title: SO_BSP_STATE socket option (Ws2def.h)
ms.topic: reference
ms.date: 05/31/2018</h2>
<h1>SO_BSP_STATE socket option</h1>
<p>The <strong>SO_BSP_STATE</strong> socket option returns the local address, local port, remote address, remote port, socket type, and protocol used by a socket.</p>
<p>To perform this operation, call the <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function with the following parameters.</p>
<h2>Socket option value</h2>
<p>The constant that represents this socket option is 0x1009.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>int getsockopt(
  (SOCKET) s,      // descriptor identifying a socket 
  (int) SOL_SOCKET,   // level
  (int) SO_BSP_STATE, // optname
  (char *) optval,         // output buffer,
  (int) *optlen,       // size of output buffer
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>s</em> [in]</p>
<!-- raw HTML omitted -->
<p>A descriptor identifying the socket.</p>
<!-- raw HTML omitted -->
<p><em>level</em> [in]</p>
<!-- raw HTML omitted -->
<p>The level at which the option is defined. Use <strong>SOL_SOCKET</strong> for this operation.</p>
<!-- raw HTML omitted -->
<p><em>optname</em> [in]</p>
<!-- raw HTML omitted -->
<p>The socket option for which the value is to be retrieved. Use <strong>SO_BSP_STATE</strong> for this operation.</p>
<!-- raw HTML omitted -->
<p><em>optval</em> [out]</p>
<!-- raw HTML omitted -->
<p>A pointer to the buffer in which the value for the requested option is to be returned. This parameter should point to buffer equal to or larger than the size of a <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure.</p>
<!-- raw HTML omitted -->
<p><em>optlen</em> [in, out]</p>
<!-- raw HTML omitted -->
<p>A pointer to the size, in bytes, of the <em>optval</em> buffer. This size must be equal to or larger than the size of a <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the operation completes successfully, <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> returns zero.</p>
<p>If the operation fails, a value of SOCKET_ERROR is returned and a specific error code can be retrieved by calling <a href="/windows/desktop/api/winsock/nf-winsock-wsagetlasterror"><strong>WSAGetLastError</strong></a>.</p>
<table>
<thead>
<tr>
<th>Error code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSANOTINITIALISED</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A successful <a href="/windows/desktop/api/winsock/nf-winsock-wsastartup"><strong>WSAStartup</strong></a> call must occur before using this function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENETDOWN</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The network subsystem has failed.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEFAULT</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>One of the <em>optval</em> or the <em>optlen</em> parameters point to memory that is not in a valid part of the user address space. This error is also returned if the value pointed to by the <em>optlen</em> parameter is less than the size of a <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEINPROGRESS</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A blocking Windows Sockets 1.1 call is in progress, or the service provider is still processing a callback function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAEINVAL</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The <em>level</em> parameter is unknown or invalid.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENOPROTOOPT</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The option is unknown or unsupported by the indicated protocol family.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="windows-sockets-error-codes-2.html">WSAENOTSOCK</a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The descriptor is not a socket.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Remarks</h2>
<p>The <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function called with the <strong>SO_BSP_STATE</strong> socket option retrieves the local address, local port, remote address, remote port, socket type, and protocol used by a socket. The <strong>SO_BSP_STATE</strong> socket option works with IPv6 or IPv4 sockets (the <strong>AF_INET6</strong> and <strong>AF_INET</strong> address families).</p>
<p>If the <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function is successful, the information is returned in a <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure in the buffer pointed to by the <em>optval</em> parameter. The integer pointed to by <em>optlen</em> should originally contain the size of this buffer; on return, it will be set to the length, in bytes, of the value returned in the <em>optval</em> parameter.</p>
<p>The <strong>iSocketType</strong> and <strong>iProtocol</strong> members in the returned <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure are filled in for the socket descriptor in the <em>s</em> parameter.</p>
<p>If the socket is in a connected or bound state, then the <strong>LocalAddr</strong> member of the returned <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure will be set to a <a href="sockaddr-2.html">SOCKADDR</a> structure representing the local address and port. If the socket is in a connected state, then the <strong>RemoteAddr</strong> member of the returned <strong>CSADDR_INFO</strong> structure will be set to a SOCKADDR structure representing the remote address and port.</p>
<p>If the socket is not in a connected or bound state, then the <strong>LocalAddr</strong> member of the returned <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure is returned with a <strong>NULL</strong> pointer in the <strong>lpSockaddr</strong> member and the <strong>iSockaddrLength</strong> member set to zero. If the socket is not in a bound state, then the <strong>RemoteAddr</strong> member of the returned <strong>CSADDR_INFO</strong> structure is returned with a <strong>NULL</strong> pointer in the <strong>lpSockaddr</strong> member and the <strong>iSockaddrLength</strong> member set to zero.</p>
<p>If the <a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a> function fails, the <em>optval</em> and <em>optlen</em> parameters are left unchanged and the <em>optval</em> parameter does not point to a returned <a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a> structure.</p>
<p>Note that the <em>Ws2def.h</em> header file is automatically included in <em>Winsock2.h</em>, and should never be used directly.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ Vista [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows ServerÂ 2008 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Ws2def.h (include Winsock2.h)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/winsock/nf-winsock-getsockopt"><strong>getsockopt</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/ws2def/ns-ws2def-csaddr_info"><strong>CSADDR_INFO</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="sockaddr-2.html">SOCKADDR</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
