<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Creating, Signing, and Storing a CTL</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Create a signed certificate trust list (CTL) and save it to a certificate store.
ms.assetid: 82d75d60-2343-413c-ba53-ccee02d1ad41
title: Creating, Signing, and Storing a CTL
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Creating, Signing, and Storing a CTL</h1>
<p>The following procedures create a signed <a href="../secgloss/c-gly.html"><em>certificate trust list</em></a> (CTL) and save it to a <a href="../secgloss/c-gly.html"><em>certificate store</em></a>.</p>
<p><strong>To create and sign a CTL</strong></p>
<ol>
<li>Create an array of items to be stored in the <a href="../secgloss/c-gly.html"><em>CTL</em></a>. In the case of trusted certificates, this must be the SHA1 or MD5 hashes of the trusted certificates.</li>
<li>Initialize a <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-ctl_info"><strong>CTL_INFO</strong></a> structure that includes the array of items just created.</li>
<li>Initialize a <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signed_encode_info"><strong>CMSG_SIGNED_ENCODE_INFO</strong></a> structure.</li>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgencodeandsignctl"><strong>CryptMsgEncodeAndSignCTL</strong></a>. This function call returns a pointer to a signed, encoded CTL (in PKCS #7 format) that contains the list of items created in step 1.</li>
</ol>
<p><strong>To add a CTL to a certificate store</strong></p>
<ol>
<li>Get a pointer to a signed and encoded CTL.</li>
<li>Open the target certificate store with a call to <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-certopenstore"><strong>CertOpenStore</strong></a>.</li>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-certaddencodedctltostore"><strong>CertAddEncodedCTLToStore</strong></a>.</li>
</ol>
<p>Â </p>
<p>Â </p>
</body>
