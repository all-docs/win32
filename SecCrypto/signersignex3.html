<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SignerSignEx3 function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Signs and time stamps the specified file to allow multiple nested signatures.
ms.assetid: b400f937-fbef-4350-b024-43bb3cc063de
title: SignerSignEx3 function
ms.topic: reference
ms.date: 11/15/2022
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>SignerSignEx3
api_type:</li>
<li>DllExport
api_location:</li>
<li>Mssign32.dll</li>
</ul>
<hr />
<h1>SignerSignEx3 function</h1>
<p>The <strong>SignerSignEx3</strong> function signs and time stamps the specified file, allowing multiple nested signatures.</p>
<blockquote>
<p>[!NOTE]
This function has no associated header file or import library. To call this function, you must create a user-defined header file and use the <a href="/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a> and <a href="/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress"><strong>GetProcAddress</strong></a> functions to dynamically link to Mssign32.dll.</p>
</blockquote>
<h2>Syntax</h2>
<pre lang="C++"><code>HRESULT WINAPI SignerSignEx3(
  _In_       DWORD                  dwFlags,
  _In_       SIGNER_SUBJECT_INFO    *pSubjectInfo,
  _In_       SIGNER_CERT            *pSignerCert,
  _In_       SIGNER_SIGNATURE_INFO  *pSignatureInfo,
  _In_opt_   SIGNER_PROVIDER_INFO   *pProviderInfo,
  _In_opt_   DWORD                  dwTimestampFlags,
  _In_opt_   PCSTR                  pszTimestampAlgorithmOid,
  _In_opt_   PCWSTR                 pwszHttpTimeStamp,
  _In_opt_   PCRYPT_ATTRIBUTES      psRequest,
  _In_opt_   PVOID                  pSipData,
  _Out_      SIGNER_CONTEXT         **ppSignerContext,
  _In_opt_   PCERT_STRONG_SIGN_PARA pCryptoPolicy,
  _In_opt_   SIGNER_DIGEST_SIGN_INFO  *pDigestSignInfo,
  _Reserved_ PVOID                  pReserved
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>dwFlags</em> [in]</p>
<!-- raw HTML omitted -->
<p>Modifies the behavior of this function.</p>
<p>If the file to be signed is a portable executable (PE) file, this can be zero or a combination of one or more of the following values.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SPC_EXC_PE_PAGE_HASHES_FLAG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x10<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Exclude page hashes when creating SIP indirect data for the PE file. This flag takes precedence over the <strong>SPC_INC_PE_PAGE_HASHES_FLAG</strong> flag.<!-- raw HTML omitted --> If neither the <strong>SPC_EXC_PE_PAGE_HASHES_FLAG</strong> or the <strong>SPC_INC_PE_PAGE_HASHES_FLAG</strong> flag is specified, the value set with the <a href="/windows/desktop/api/Wintrust/nf-wintrust-wintrustsetdefaultincludepepagehashes"><strong>WintrustSetDefaultIncludePEPageHashes</strong></a> function is used for this setting. The default for this setting is to exclude page hashes when creating SIP indirect data for PE files.<!-- raw HTML omitted --> This value is defined in the Mssip.h header file.<!-- raw HTML omitted --> <strong>Windows Server 2003 and Windows XP:</strong> This value is not supported.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SPC_INC_PE_IMPORT_ADDR_TABLE_FLAG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x20<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>This value is not supported.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SPC_INC_PE_DEBUG_INFO_FLAG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x40<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>This value is not supported.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SPC_INC_PE_RESOURCES_FLAG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x80<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>This value is not supported.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SPC_INC_PE_PAGE_HASHES_FLAG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x100<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Include page hashes when creating SIP indirect data for the PE file.<!-- raw HTML omitted --> <strong>Windows Server 2003 and Windows XP:</strong> This value is not supported.<!-- raw HTML omitted --> This value is defined in the Mssip.h header file.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SPC_DIGEST_SIGN_FLAG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x800<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Digest signing will be done.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SIG_APPEND</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x1000<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The signature will be nested. If you set this flag before any signature has been added, the generated signature will be added as the outer signature. If you do not set this flag, the generated signature replaces the outer signature, deleting all inner signatures.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SPC_DIGEST_SIGN_EX_FLAG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x4000<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Digest signing will be done. The callerâ€™s digest signing function will select and return the code signing certificate which performed the signing operation.</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p><em>pSubjectInfo</em> [in]</p>
<!-- raw HTML omitted -->
<p>Pointer to a <a href="signer-subject-info.html"><strong>SIGNER_SUBJECT_INFO</strong></a> structure that specifies the subject to sign.</p>
<!-- raw HTML omitted -->
<p><em>pSignerCert</em> [in]</p>
<!-- raw HTML omitted -->
<p>Pointer to a <a href="signer-cert.html"><strong>SIGNER_CERT</strong></a> structure that specifies the certificate to use to create the digital signature.</p>
<!-- raw HTML omitted -->
<p><em>pSignatureInfo</em> [in]</p>
<!-- raw HTML omitted -->
<p>A pointer to a <a href="signer-signature-info.html"><strong>SIGNER_SIGNATURE_INFO</strong></a> structure that contains information about the digital signature.</p>
<!-- raw HTML omitted -->
<p><em>pProviderInfo</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Pointer to a <a href="signer-provider-info.html"><strong>SIGNER_PROVIDER_INFO</strong></a> structure that specifies the <a href="../secgloss/c-gly.html"><em>cryptographic service provider</em></a> (CSP) and private key information used to create the digital signature.</p>
<p>If the value of this parameter is <strong>NULL</strong>, the <em>pSignerCert</em> parameter must specify a certificate that is associated with a CSP.</p>
<!-- raw HTML omitted -->
<p><em>dwTimestampFlags</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Flags that will be passed to <a href="signertimestampex3.html"><strong>SignerTimeStampEx3</strong></a> if the <em>pwszHttpTimeStamp</em> parameter is not <strong>NULL</strong>. This can be one of the following values.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SIGNER_TIMESTAMP_AUTHENTICODE</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Default value. Specifies an Authenticode timestamp.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>SIGNER_TIMESTAMP_RFC3161</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Specifies an RFC 3161 timestamp.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>This parameter is ignored if the <em>pwszHttpTimeStamp</em> parameter is <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><em>pszTimestampAlgorithmOid</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Object identifier of the algorithm to be used for creating an RFC 3161 timestamp. This parameter is ignored for Authenticode time stamps.</p>
<!-- raw HTML omitted -->
<p><em>pwszHttpTimeStamp</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>URL of the time stamp server.</p>
<!-- raw HTML omitted -->
<p><em>psRequest</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Pointer to an array of <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_attribute"><strong>CRYPT_ATTRIBUTE</strong></a> structures that are added to a sign request. This parameter is ignored if the <em>pwszHttpTimeStamp</em> parameter does not contain a valid value or is <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><em>pSipData</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>A 32-bit value that is passed as additional data to SIP functions. The format and content of this is defined by the SIP provider.</p>
<!-- raw HTML omitted -->
<p><em>ppSignerContext</em> [out]</p>
<!-- raw HTML omitted -->
<p>The address of a pointer to the <a href="signer-context.html"><strong>SIGNER_CONTEXT</strong></a> structure that contains the signed <a href="../secgloss/b-gly.html"><em>BLOB</em></a>. When you have finished using the <strong>SIGNER_CONTEXT</strong> structure, free the <strong>SIGNER_CONTEXT</strong> structure by calling the <a href="signerfreesignercontext.html"><strong>SignerFreeSignerContext</strong></a> function.</p>
<!-- raw HTML omitted -->
<p><em>pCryptoPolicy</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>If present, a pointer to a <a href="/windows/win32/api/Wincrypt/ns-wincrypt-cert_strong_sign_para"><strong>CERT_STRONG_SIGN_PARA</strong></a> structure that contains the parameters used to check for strong signatures. If either a certificate or its chain does not pass, the file is not altered in any way. If a URL is passed in to specify a Time Stamping Authority (TSA), this policy is also applied to the time stamp.</p>
<!-- raw HTML omitted -->
<p><em>pDigestSignInfo</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>If present, a pointer to a <a href="signer-digest-sign-info.html"><strong>SIGNER_DIGEST_SIGN_INFO</strong></a> structure that contains information regarding digest signing.</p>
<!-- raw HTML omitted -->
<p><em>pReserved</em></p>
<!-- raw HTML omitted -->
<p>Reserved. This value must be <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the function succeeds, the function returns S_OK.</p>
<p>If the function fails, it returns an <strong>HRESULT</strong> value that indicates the error. Possible error codes returned by this function include, but are not limited to, the following. For a list of common error codes, see <a href="common-hresult-values.html">Common HRESULT Values</a>.</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>E_INVALIDARG</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>If you set the <em>dwTimestampFlags</em> parameter to <strong>SIGNER_TIMESTAMP_AUTHENTICODE</strong>, you cannot set the <em>dwFlags</em> parameter to <strong>SIG_APPEND</strong>.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows 10 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2016 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Mssign32.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="signersign.html"><strong>SignerSign</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="signersignex.html"><strong>SignerSignEx</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="signerfreesignercontext.html"><strong>SignerFreeSignerContext</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="signer-digest-sign-info.html"><strong>SIGNER_DIGEST_SIGN_INFO</strong></a></p>
<!-- raw HTML omitted -->
</body>
