<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Countersigning a Message</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Explains how to countersign a message by using CryptMsgCountersign.
ms.assetid: e1969b43-f50e-4c7d-a7e5-b22db4e05be2
title: Countersigning a Message
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Countersigning a Message</h1>
<p><strong>To countersign a signed message by using CryptMsgCountersign</strong></p>
<ol>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode"><strong>CryptMsgOpenToDecode</strong></a> to get a handle to the signed message.</li>
<li>Initialize a <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signer_encode_info"><strong>CMSG_SIGNER_ENCODE_INFO</strong></a> structure for the countersigner.</li>
<li>Add the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signer_encode_info"><strong>CMSG_SIGNER_ENCODE_INFO</strong></a> structure to an array of countersigners (only one countersigner is currently supported).</li>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcountersign"><strong>CryptMsgCountersign</strong></a> to add the countersignature or countersignatures.</li>
</ol>
<p>If all of the function calls succeed, the original message now has a <a href="../secgloss/c-gly.html"><em>countersignature</em></a> included as an unauthenticated attribute.</p>
<p><strong>To countersign a signed message by using CryptMsgCountersignEncoded</strong></p>
<ol>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode"><strong>CryptMsgOpenToDecode</strong></a> to get a handle to the signed message.</li>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam"><strong>CryptMsgGetParam</strong></a> to retrieve the encoded signer information of the signed message.</li>
<li>Initialize a <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signer_encode_info"><strong>CMSG_SIGNER_ENCODE_INFO</strong></a> structure for the countersigner.</li>
<li>Add the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_signer_encode_info"><strong>CMSG_SIGNER_ENCODE_INFO</strong></a> structure to an array of countersigners (only one countersigner is currently supported).</li>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcountersignencoded"><strong>CryptMsgCountersignEncoded</strong></a> to create the encoded countersignature attribute.</li>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol"><strong>CryptMsgControl</strong></a> to add the countersignature attribute to the original message as an unauthenticated attribute.</li>
</ol>
<p>If all of the function calls succeed, a <a href="../secgloss/c-gly.html"><em>countersignature</em></a> attribute is added to the original message.</p>
<p>Â </p>
<p>Â </p>
</body>
