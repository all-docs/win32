<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>RSA/Schannel Keys</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: How to generate, retrieve, and export RSA/Schannel keys.
ms.assetid: 3069232f-d016-4973-ae39-89b0e2a03cd7
title: RSA/Schannel Keys
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>RSA/Schannel Keys</h1>
<h2>Generating and Retrieving RSA/Schannel Keys</h2>
<p><a href="../secgloss/r-gly.html"><em>RSA</em></a>/<a href="../secgloss/s-gly.html"><em>Schannel</em></a> keys can be generated by calling the <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey"><strong>CryptGenKey</strong></a> function. The call to <strong>CryptGenKey</strong> requires an AT_KEYEXCHANGE algorithm identifier passed in the <em>Algid</em> parameter.</p>
<p><strong>To generate an RSA/Schannel public/private key pair</strong></p>
<ol>
<li>Call the <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta"><strong>CryptAcquireContext</strong></a> function to get a handle to the <a href="microsoft-rsa-schannel-cryptographic-provider.html">Microsoft RSA/Schannel Cryptographic Provider</a>.</li>
<li>Call the <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey"><strong>CryptGenKey</strong></a> function to generate the keys. AT_KEYEXCHANGE must be passed in for the <em>Algid</em> parameter, and the upper 16 bits of the <em>dwFlags</em> parameter must be set to the desired key size (512 bits). An <a href="hcryptkey.html"><strong>HCRYPTKEY</strong></a> structure handle is returned in the <em>hKey</em> parameter.</li>
</ol>
<p><strong>To retrieve a pointer to previously generated RSA/Schannel user keys</strong></p>
<ol>
<li>Call the <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta"><strong>CryptAcquireContext</strong></a> function to get a handle to the <a href="microsoft-rsa-schannel-cryptographic-provider.html">Microsoft RSA/Schannel Cryptographic Provider</a>.</li>
<li>Call the <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgetuserkey"><strong>CryptGetUserKey</strong></a> function, with the <em>dwKeySpec</em> parameter set to AT_KEYEXCHANGE.</li>
</ol>
<h2>Exporting RSA/Schannel Keys</h2>
<p><a href="../secgloss/m-gly.html"><em>Master keys</em></a> can be exported into simple key BLOB structures. This should be implemented the same way as the export of normal <a href="../secgloss/r-gly.html"><em>RC4</em></a> or <a href="../secgloss/d-gly.html"><em>Data Encryption Standard</em></a> (DES) <a href="../secgloss/b-gly.html"><em>bulk encryption keys</em></a>, as described in <a href="https://www.bing.com/search?q=Simple+Key+BLOB">Simple Key BLOB</a>. The <strong>aiKeyAlg</strong> member of the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-publickeystruc"><strong>PUBLICKEYSTRUC</strong></a> structure is set to the algorithm identifier of the master key (CALG_PCT1_MASTER, CALG_SSL2_MASTER, CALG_SSL3_MASTER, or CALG_TLS1_MASTER).</p>
<p>If the <a href="https://www.bing.com/search?q=**CPExportKey**"><strong>CPExportKey</strong></a> function is exporting an SSL2 master key and the CRYPT_SSL2_FALLBACK flag is set, then, to help prevent version rollback attacks, set the first eight bytes of the encryption block <a href="../secgloss/p-gly.html"><em>padding</em></a> to 0x03 rather than to random data.</p>
<p>If the <strong>CRYPT_DESTROYKEY</strong> constant is specified in the <em>dwFlags</em> parameter of the <a href="https://www.bing.com/search?q=**CPExportKey**"><strong>CPExportKey</strong></a> function, the CSP destroys the key or key handle after exporting the key. This flag is intended for use only with <a href="../secgloss/o-gly.html"><em>opaque BLOBs</em></a>.</p>
<p>Â </p>
<p>Â </p>
</body>
