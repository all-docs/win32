<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Decrypting Data</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Presents the steps to decrypt an encrypted message.
ms.assetid: 6af7dd28-325e-431a-9cdb-109d93af6302
title: Decrypting Data
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Decrypting Data</h1>
<p>This section presents the steps to decrypt an encrypted message.</p>
<p><strong>To decrypt an encrypted message</strong></p>
<ol>
<li>Get a pointer to the digitally enveloped message.</li>
<li>Open a certificate store.</li>
<li>From the message, retrieve the recipient identifier (My ID).</li>
<li>Use the recipient identifier to retrieve the certificate.</li>
<li>Get the private key for the certificate.</li>
<li>Use the private key to decrypt the symmetric (session) key.</li>
<li>Retrieve the encryption algorithm from the message.</li>
<li>Using the decrypted session key and the encryption algorithm, decrypt the data.</li>
</ol>
<p><a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptdecryptmessage"><strong>CryptDecryptMessage</strong></a> does all of the tasks for decrypting a message; however, initialization of structures and other data is still necessary.</p>
<p><strong>To decrypt data using CryptDecryptMessage</strong></p>
<ol>
<li>Get a pointer to the encrypted BLOB.</li>
<li>Open a certificate store.</li>
<li>Create a certificate store array.</li>
<li>Initialize the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_decrypt_message_para"><strong>CRYPT_DECRYPT_MESSAGE_PARA</strong></a> structure.</li>
<li>Call <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptdecryptmessage"><strong>CryptDecryptMessage</strong></a> to decrypt the data contained in the message.</li>
</ol>
<p><a href="example-c-program-using-cryptencryptmessage-and-cryptdecryptmessage.html">Example C Program: Using CryptEncryptMessage and CryptDecryptMessage</a> implements the procedure just presented. Comments show which code elements accomplish each step in the procedure. For details about the function, see <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptdecryptmessage"><strong>CryptDecryptMessage</strong></a>, and for details about the data structure, see <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_decrypt_message_para"><strong>CRYPT_DECRYPT_MESSAGE_PARA</strong></a>.</p>
<p>Â </p>
<p>Â </p>
</body>
