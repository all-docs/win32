<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Procedure for Signing Data</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Shows the relationship between those function parameters that point to structures or arrays and their initialized data.
ms.assetid: 89caf4d3-727f-472b-9a09-e81b4ff4d127
title: Procedure for Signing Data
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Procedure for Signing Data</h1>
<p>A single function, <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage"><strong>CryptSignMessage</strong></a>, performs all of the tasks listed in <a href="creating-a-signed-message.html">Creating a Signed Message</a>. However, initialization of structures and other data is still necessary. The following illustration shows the relationship between those function parameters that point to structures or arrays and their initialized data. The illustration shows only the function parameters and structure members that are derived from other structures or functions. The rest of the parameters are straightforward initializations.</p>
<p><img src="images/crypsign.png" alt="initialization map for a call to cryptsignmessage" /></p>
<p><strong>To sign data using CryptSignMessage</strong></p>
<ol>
<li>Get a pointer to the data that is to be signed.</li>
<li>Assign the pointer to the data to index zero of a &quot;data to be signed&quot; array.</li>
<li>Get a handle to the cryptographic provider.</li>
<li>Open a <a href="../secgloss/c-gly.html"><em>certificate store</em></a> that contains the signer's certificate.</li>
<li>Get an address to the signer's certificate.</li>
<li>Assign the address of the certificate to the zero index of the <em>MsgCert</em> array.</li>
<li>Assign the addresses of any other certificates to be included with the message to the <em>MsgCert</em> array.</li>
<li>Initialize the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier"><strong>CRYPT_ALGORITHM_IDENTIFIER</strong></a> structure, initializing the <strong>pszObjId</strong> member to the desired hash algorithm and the other members as appropriate.</li>
<li>Initialize the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para"><strong>CRYPT_SIGN_MESSAGE_PARA</strong></a> structure, initializing the <strong>pSigningCert</strong> member to the address of the signer's certificate, the <strong>MsgCert</strong> array member to the address of the signer's and other's certificates, the <strong>HashAlgorithm</strong> member to the address of the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier"><strong>CRYPT_ALGORITHM_IDENTIFIER</strong></a> structure, and the other members as appropriate.</li>
<li>Call the <a href="/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage"><strong>CryptSignMessage</strong></a> function, passing the <a href="/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para"><strong>CRYPT_SIGN_MESSAGE_PARA</strong></a> structure for the <em>pSignPara</em> parameter, the address of the &quot;data to be signed&quot; array for the <em>rgpbToBeSigned</em> parameter, an address for the <em>pbSignedBlob</em> output parameter, and values for the other parameters as appropriate.</li>
</ol>
<p>Â </p>
<p>Â </p>
</body>
