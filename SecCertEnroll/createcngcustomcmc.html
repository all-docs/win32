<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>createCNGCustomCMC</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Creates a CMC request object from an inner nested PKCS #10 request.
ms.assetid: 8a0dc078-22ca-4bff-9cc0-46823912d3da
title: createCNGCustomCMC
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>createCNGCustomCMC</h1>
<p>The createCNGCustomCMC sample creates a CMC request object from an inner nested PKCS #10 request. The inner request is created by using an asymmetric <a href="/windows/desktop/SecGloss/p-gly"><em>private key</em></a>. The private key is created by using the Cryptography API: Next Generation (CNG) cryptographic provider and the algorithm specified on the command line. Custom options such as export policy and key protection level are also set on the private key.</p>
<h2>Location</h2>
<p>When you install the Microsoft Windows Software Development Kit (SDK), the sample is installed, by default, in the <em>%ProgramFiles%</em>\Microsoft SDKs\Windows\v7.0\Samples\Security\X509 Certificate Enrollment\VC\createCNGCustomCMC folder.</p>
<h2>Discussion</h2>
<p>The createCNGCustomCMC sample:</p>
<ol>
<li>Processes the following command line arguments:
<ul>
<li>The name of a CNG <a href="/windows/desktop/SecGloss/c-gly"><em>cryptographic service provider</em></a> (CSP).</li>
<li>The name of the algorithm used to generate an asymmetric private key.</li>
<li>The name of the algorithm used to <a href="/windows/desktop/SecGloss/h-gly"><em>hash</em></a> the <a href="/windows/desktop/SecGloss/c-gly"><em>certificate request</em></a>.</li>
<li>An output file in which to save the certificate request.</li>
<li>An optional string (AlternateSignature) which, if present, specifies that a discrete rather than a combined signature algorithm be used. For more information, see the <a href="/windows/desktop/api/CertEnroll/nf-certenroll-ix509certificaterequest-get_alternatesignaturealgorithm"><strong>AlternateSignatureAlgorithm</strong></a> property.</li>
</ul>
</li>
<li>Creates an <a href="/windows/desktop/api/CertEnroll/nn-certenroll-ix509privatekey"><strong>IX509PrivateKey</strong></a> object and sets the following properties:
<ul>
<li><a href="/windows/desktop/api/CertEnroll/nf-certenroll-ix509privatekey-get_legacycsp"><strong>LegacyCsp</strong></a></li>
<li><a href="/windows/desktop/api/CertEnroll/nf-certenroll-ix509privatekey-get_providername"><strong>ProviderName</strong></a></li>
<li><a href="/windows/desktop/api/CertEnroll/nf-certenroll-ix509privatekey-get_algorithm"><strong>Algorithm</strong></a></li>
<li><a href="/windows/desktop/api/CertEnroll/nf-certenroll-ix509privatekey-get_keyprotection"><strong>KeyProtection</strong></a></li>
<li><a href="/windows/desktop/api/CertEnroll/nf-certenroll-ix509privatekey-get_exportpolicy"><strong>ExportPolicy</strong></a></li>
</ul>
</li>
<li>Creates an asymmetric private key.</li>
<li>Creates an <a href="/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestpkcs10"><strong>IX509CertificateRequestPkcs10</strong></a> object and initializes it by using the private key.</li>
<li>Creates an <a href="/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestcmc"><strong>IX509CertificateRequestCmc</strong></a> object and initializes it by using the PKCS #10 request object created in step 4.</li>
<li>Sets the alternate signature algorithm flag to <strong>VARIANT_TRUE</strong> or <strong>VARIANT_FALSE</strong> depending on whether an alternate signature string is specified on the command line. For more information, see <a href="/windows/desktop/api/CertEnroll/nf-certenroll-ix509certificaterequest-get_alternatesignaturealgorithm"><strong>AlternateSignatureAlgorithm</strong></a>.</li>
<li>Creates a <a href="/windows/desktop/SecGloss/h-gly"><em>hashing algorithm</em></a> <a href="/windows/desktop/SecGloss/o-gly"><em>object identifier</em></a> (OID) from the algorithm name specified on the command line and sets the OID on the CMC request object.</li>
<li>Signs the certificate request and encodes it by using <a href="/windows/desktop/SecGloss/d-gly"><em>Distinguished Encoding Rules</em></a> (DER).</li>
<li>Retrieves a string that contains the encoded CMC certificate request and saves it to a file. The EncodeToFileW function is defined in EnrollCommon.cpp.</li>
</ol>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="cmc-request.html">CMC Request</a></p>
<!-- raw HTML omitted -->
<p><a href="pkcs--10-request.html">PKCS #10 Request</a></p>
<!-- raw HTML omitted -->
<p><a href="using-the-included-samples.html">Using the Included Samples</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/CertEnroll/nn-certenroll-ix509privatekey"><strong>IX509PrivateKey</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
