<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Change method of the Win32_Service class (Mbnapi.h) - TerminalService</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Change method of the Win32_Service class (Mbnapi.h) (TerminalService)
description: Modifies a Win32_TerminalService.
ms.assetid: 19E43A80-47C9-4C5A-8E73-723F206AA7C0
ms.tgt_platform: multiple
keywords:</p>
<ul>
<li>Change method Remote Desktop Services</li>
<li>Change method Remote Desktop Services , Win32_Service class</li>
<li>Win32_Service class Remote Desktop Services , Change method
topic_type:</li>
<li>apiref
api_name:</li>
<li>Win32_Service.Change
api_location:</li>
<li>TSCfgWmi.dll
api_type:</li>
<li>COM
ms.topic: reference
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1>Change method of the Win32_Service class (Mbnapi.h) - TerminalService</h1>
<p>The <strong>Change</strong> <a href="/windows/desktop/WmiSdk/retrieving-a-class">WMI class</a> method modifies a <a href="win32-terminalservice.html"><strong>Win32_TerminalService</strong></a>.</p>
<p>This topic uses Managed Object Format (MOF) syntax. For more information about using this method, see <a href="/windows/desktop/WmiSdk/calling-a-method">Calling a Method</a>.</p>
<h2>Syntax</h2>
<pre lang="mof"><code>uint32 Change(
  [in] string  DisplayName,
  [in] string  PathName,
  [in] uint32  ServiceType,
  [in] uint32  ErrorControl,
  [in] string  StartMode,
  [in] boolean DesktopInteract,
  [in] string  StartName,
  [in] string  StartPassword,
  [in] string  LoadOrderGroup,
  [in] string  LoadOrderGroupDependencies,
  [in] string  ServiceDependencies
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>DisplayName</em> [in]</p>
<!-- raw HTML omitted -->
<p>The display name of the service. This string has a maximum length of 256 characters. The name is case-preserved in the service control manager. <em>DisplayName</em> comparisons are always case-insensitive.</p>
<p>Constraints: Accepts the same value as the <strong>Name</strong> property.</p>
<p>Example, &quot;Atdisk&quot;.</p>
<!-- raw HTML omitted -->
<p><em>PathName</em> [in]</p>
<!-- raw HTML omitted -->
<p>The fully qualified path to the executable file that implements the service, for example, &quot;\SystemRoot\System32\drivers\afd.sys&quot;.</p>
<!-- raw HTML omitted -->
<p><em>ServiceType</em> [in]</p>
<!-- raw HTML omitted -->
<p>The type of services provided to processes that call them.</p>
<!-- raw HTML omitted -->
<p>1 (0x1)</p>
<!-- raw HTML omitted -->
<p>Kernel Driver</p>
<!-- raw HTML omitted -->
<p>2 (0x2)</p>
<!-- raw HTML omitted -->
<p>File System Driver</p>
<!-- raw HTML omitted -->
<p>4 (0x4)</p>
<!-- raw HTML omitted -->
<p>Adapter</p>
<!-- raw HTML omitted -->
<p>8 (0x8)</p>
<!-- raw HTML omitted -->
<p>Recognizer Driver</p>
<!-- raw HTML omitted -->
<p>16 (0x10)</p>
<!-- raw HTML omitted -->
<p>Own Process</p>
<!-- raw HTML omitted -->
<p>32 (0x20)</p>
<!-- raw HTML omitted -->
<p>Share Process</p>
<!-- raw HTML omitted -->
<p>256 (0x100)</p>
<!-- raw HTML omitted -->
<p>Interactive Process</p>
<!-- raw HTML omitted -->
<p><em>ErrorControl</em> [in]</p>
<!-- raw HTML omitted -->
<p>Severity of the error if this service fails to start during startup. The value indicates the action taken by the startup program if failure occurs. All errors are logged by the system.</p>
<!-- raw HTML omitted -->
<p>0</p>
<!-- raw HTML omitted -->
<p><strong>Ignore</strong>. Startup continues. No notification is given to the user that the service failed.</p>
<!-- raw HTML omitted -->
<p>1</p>
<!-- raw HTML omitted -->
<p><strong>Normal.</strong> Startup continues. Before the user logs on, the user receives the notification, &quot;At least one service or device failed during startup.&quot;</p>
<!-- raw HTML omitted -->
<p>2</p>
<!-- raw HTML omitted -->
<p><strong>Severe.</strong> Computer attempts to restart with last-known good configuration. If the service fails again, startup continues and notification is given to the user.</p>
<!-- raw HTML omitted -->
<p>3</p>
<!-- raw HTML omitted -->
<p><strong>Critical.</strong> Computer attempts to restart with last-known good configuration. If the service fails again, startup stops.</p>
<!-- raw HTML omitted -->
<p><em>StartMode</em> [in]</p>
<!-- raw HTML omitted -->
<p>Start mode of the Windows base service. For more information, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>Boot</strong></p>
<!-- raw HTML omitted -->
<p>Device driver started by the operating system loader.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>System</strong></p>
<!-- raw HTML omitted -->
<p>Device driver started by the operating system initialization process. This value is valid only for driver services.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>Automatic</strong></p>
<!-- raw HTML omitted -->
<p>Service is started automatically by the service control manager during system startup. Autostart services start before a user logs on to the computer and run even if no user logs on to the computer.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>Manual</strong></p>
<!-- raw HTML omitted -->
<p>Service to be started by the service control manager when a process calls the <a href="win32-terminalservice-startservice.html"><strong>StartService</strong></a> method. Although manual services must be specifically started by a user (or by a script), they continue to run even if the user logs off. Manual services are often referred to as on-demand services.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>Disabled</strong></p>
<!-- raw HTML omitted -->
<p>Service that can no longer be started. To start a disabled service, you must first change the startup option to either Auto or Manual.</p>
<!-- raw HTML omitted -->
<p><em>DesktopInteract</em> [in]</p>
<!-- raw HTML omitted -->
<p>If <strong>True</strong>, the service can create or communicate with a window on the desktop.</p>
<!-- raw HTML omitted -->
<p><em>StartName</em> [in]</p>
<!-- raw HTML omitted -->
<p>Account name the service runs under. Depending on the service type, the account name may be in the form of DomainName\Username or .\Username. The service process will be logged using one of these two forms when it runs. If the account belongs to the built-in domain, .\Username can be specified. If <strong>NULL</strong> is specified, the service will be logged on as the LocalSystem account. For kernel or system-level drivers, <em>StartName</em> contains the driver object name (that is, \FileSystem\Rdr or \Driver\Xns) that the input and output (I/O) system uses to load the device driver. If <strong>NULL</strong> is specified, the driver runs with a default object name created by the I/O system based on the service name, for example, &quot;DWDOM\Admin&quot;.</p>
<p>You also can use the User Principal Name (UPN) format to specify the <strong>StartName</strong>, for example, <em>Username@DomainName</em>.</p>
<!-- raw HTML omitted -->
<p><em>StartPassword</em> [in]</p>
<!-- raw HTML omitted -->
<p>Password to the account name specified by the <em>StartName</em> parameter. Specify <strong>NULL</strong> if you are not changing the password. Specify an empty string if the service has no password.</p>
<blockquote>
<p>[!Note]<br />
When changing a service from a local system to a network, or from a network to a local system, <em>StartPassword</em> must be an empty string (&quot;&quot;) and not <strong>NULL</strong>.</p>
</blockquote>
<!-- raw HTML omitted -->
<p><em>LoadOrderGroup</em> [in]</p>
<!-- raw HTML omitted -->
<p>Group name that it is associated with. Load order groups are contained in the system registry, and determine the sequence in which services are loaded into the operating system. If the pointer is <strong>NULL</strong>, or if it points to an empty string, the service does not belong to a group. For more information, see the Remarks section.</p>
<p>Dependencies between groups should be listed in the <em>LoadOrderGroupDependencies</em> parameter. Services in the load-ordering group list are started first, followed by services in groups not in the load-ordering group list, followed by services that do not belong to a group. The system registry has a list of load ordering groups located at:</p>
<p><strong>HKEY_LOCAL_MACHINE</strong>\<strong>System</strong>\<strong>CurrentControlSet</strong>\<strong>Control</strong>\<strong>ServiceGroupOrder</strong></p>
<!-- raw HTML omitted -->
<p><em>LoadOrderGroupDependencies</em> [in]</p>
<!-- raw HTML omitted -->
<p>List of load-ordering groups that must start before this service starts. The array is doubly <strong>null</strong>-terminated. If the pointer is <strong>NULL</strong>, or if it points to an empty string, the service has no dependencies. Group names must be prefixed by the <strong>SC_GROUP_IDENTIFIER</strong> (defined in the Winsvc.h file) character to differentiate them from service names because services and service groups share the same namespace. Dependency on a group means that this service can run if at least one member of the group is running after an attempt to start all of the members of the group.</p>
<!-- raw HTML omitted -->
<p><em>ServiceDependencies</em> [in]</p>
<!-- raw HTML omitted -->
<p>List that contains the names of services that must start before this service starts. The array is doubly <strong>NULL</strong>-terminated. If the pointer is <strong>NULL</strong>, or if it points to an empty string, the service has no dependencies. Dependency on a service indicates that this service can run only if the service it depends on is running.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>Returns one of the values listed in the following list, or any other value to indicate an error. For additional error codes, see <a href="/windows/desktop/WmiSdk/wmi-error-constants"><strong>WMI Error Constants</strong></a> or <a href="/windows/desktop/api/wbemdisp/ne-wbemdisp-wbemerrorenum"><strong>WbemErrorEnum</strong></a>. For general <strong>HRESULT</strong> values, see <a href="/windows/desktop/Debug/system-error-codes">System Error Codes</a>.</p>
<!-- raw HTML omitted -->
<p><strong>0</strong></p>
<!-- raw HTML omitted -->
<p>The request was accepted.</p>
<!-- raw HTML omitted -->
<p><strong>1</strong></p>
<!-- raw HTML omitted -->
<p>The request is not supported.</p>
<!-- raw HTML omitted -->
<p><strong>2</strong></p>
<!-- raw HTML omitted -->
<p>The user did not have the necessary access.</p>
<!-- raw HTML omitted -->
<p><strong>3</strong></p>
<!-- raw HTML omitted -->
<p>The service cannot be stopped because other services that are running are dependent on it.</p>
<!-- raw HTML omitted -->
<p><strong>4</strong></p>
<!-- raw HTML omitted -->
<p>The requested control code is not valid, or it is unacceptable to the service.</p>
<!-- raw HTML omitted -->
<p><strong>5</strong></p>
<!-- raw HTML omitted -->
<p>The requested control code cannot be sent to the service because the state of the service (<a href="/windows/desktop/CIMWin32Prov/win32-baseservice"><strong>Win32_BaseService</strong></a>.<strong>State</strong> property) is equal to 0, 1, or 2.</p>
<!-- raw HTML omitted -->
<p><strong>6</strong></p>
<!-- raw HTML omitted -->
<p>The service has not been started.</p>
<!-- raw HTML omitted -->
<p><strong>7</strong></p>
<!-- raw HTML omitted -->
<p>The service did not respond to the start request in a timely fashion.</p>
<!-- raw HTML omitted -->
<p><strong>8</strong></p>
<!-- raw HTML omitted -->
<p>Unknown failure when starting the service.</p>
<!-- raw HTML omitted -->
<p><strong>9</strong></p>
<!-- raw HTML omitted -->
<p>The directory path to the service executable file was not found.</p>
<!-- raw HTML omitted -->
<p><strong>10</strong></p>
<!-- raw HTML omitted -->
<p>The service is already running.</p>
<!-- raw HTML omitted -->
<p><strong>11</strong></p>
<!-- raw HTML omitted -->
<p>The database to add a new service is locked.</p>
<!-- raw HTML omitted -->
<p><strong>12</strong></p>
<!-- raw HTML omitted -->
<p>A dependency this service relies on has been removed from the system.</p>
<!-- raw HTML omitted -->
<p><strong>13</strong></p>
<!-- raw HTML omitted -->
<p>The service failed to find the service needed from a dependent service.</p>
<!-- raw HTML omitted -->
<p><strong>14</strong></p>
<!-- raw HTML omitted -->
<p>The service has been disabled from the system.</p>
<!-- raw HTML omitted -->
<p><strong>15</strong></p>
<!-- raw HTML omitted -->
<p>The service does not have the correct authentication to run on the system.</p>
<!-- raw HTML omitted -->
<p><strong>16</strong></p>
<!-- raw HTML omitted -->
<p>This service is being removed from the system.</p>
<!-- raw HTML omitted -->
<p><strong>17</strong></p>
<!-- raw HTML omitted -->
<p>The service has no execution thread.</p>
<!-- raw HTML omitted -->
<p><strong>18</strong></p>
<!-- raw HTML omitted -->
<p>The service has circular dependencies when it starts.</p>
<!-- raw HTML omitted -->
<p><strong>19</strong></p>
<!-- raw HTML omitted -->
<p>A service is running under the same name.</p>
<!-- raw HTML omitted -->
<p><strong>20</strong></p>
<!-- raw HTML omitted -->
<p>The service name has invalid characters.</p>
<!-- raw HTML omitted -->
<p><strong>21</strong></p>
<!-- raw HTML omitted -->
<p>Invalid parameters have been passed to the service.</p>
<!-- raw HTML omitted -->
<p><strong>22</strong></p>
<!-- raw HTML omitted -->
<p>The account under which this service runs is either invalid or lacks the permissions to run the service.</p>
<!-- raw HTML omitted -->
<p><strong>23</strong></p>
<!-- raw HTML omitted -->
<p>The service exists in the database of services available from the system.</p>
<!-- raw HTML omitted -->
<p><strong>24</strong></p>
<!-- raw HTML omitted -->
<p>The service is currently paused in the system.</p>
<!-- raw HTML omitted -->
<h2>Remarks</h2>
<p>When a computer starts, all the autostart services also start. On occasion, one of these services might fail to start along with the computer. When a service fails during system startup, the computer takes action based on the value of the service error control code.</p>
<p>most services are installed using the Normal error control code. A few of the exceptions, which are installed using the Ignore error code, include:</p>
<ul>
<li>File Replication Service</li>
<li>Smart Card</li>
<li>Secondary Logon</li>
<li>WMI</li>
</ul>
<p>For the services installed using the Ignore error code, no notification is given to the user that the service has failed. If you prefer on-screen notification that a service could not start, you can use WMI to change the error control code. Error control codes apply only to computer startup; error control codes are not used if you stop and then attempt to restart a service after the computer is running.</p>
<p>On occasion, you might need to change the account under which a given service runs. For example, you might run a service under an administrative account. Because this can create a security vulnerability, you might switch the service to an account with fewer privileges. Alternatively, you might have services running under an account that is about to be deleted, or you might want to ensure that, on all your servers, certain services run under certain accounts. You can use the <strong>Change</strong> method of the <a href="win32-terminalservice.html"><strong>Win32_TerminalService</strong></a> class to configure services to run under a specified user account. When selecting an account, keep in mind the following:</p>
<ul>
<li>
<p>The account being used as a service account must have the right to log on as a service. This right can be granted by using Group Policy.</p>
</li>
<li>
<p>The account being used as a service account should not be a member of a local, domain, or enterprise Administrators group.</p>
</li>
<li>
<p>Each instance of a service should run under a unique user account. This provides additional security, and enables the auditing of individual service instances.</p>
</li>
<li>
<p>If the service is interactive, then the service must run under the LocalSystem account.</p>
<p>LocalSystem is required because only one window station (WinSta0) can be visible and interactive at a time. If a service runs under an account other than LocalSystem, it runs in the Service-0x03e7$\Default window station, which is an invisible window. Services running in this window station cannot receive input or display output.</p>
</li>
</ul>
<p>When you assign an account to a service, the SCM requires the correct password for that account before it makes the assignment. If you supply an incorrect password, the SCM rejects the account. If you configure a service account using the LocalSystem, LocalService, or NetworkService account, you do not need to supply an account password because these accounts do not have passwords.</p>
<p>The SCM stores the account password in the services database. After the password is assigned, however, the SCM does not ensure that the password stored in the services database and the password assigned to the user account in Active Directory continue to match. Consequently, a situation similar to the following could occur:</p>
<ul>
<li>.You configure a service to run under a particular user account.</li>
<li>The service starts up under that account by using the current account password.</li>
<li>You change the password for the user account.</li>
<li>The service continues to run. However, if the service stops, you cannot restart it because the SCM continues to use the old, invalid password. Changing the password in Active Directory does not change the password stored in the services database.</li>
</ul>
<p>If you run services under regular user accounts, you need to update those service passwords each time the user account password changes. This can be particularly time-consuming if you are not sure which services are running under that account or which computers have services running under that account. Fortunately, you can use WMI to check the service accounts on all your computers and, if necessary, change the service account password.</p>
<p>The <a href="/windows/desktop/CIMWin32Prov/win32-loadordergroup"><strong>Win32_LoadOrderGroup</strong></a> parameter represents a group of system services that define execution dependencies. The services must be initiated in the order specified by the Load Order Group because the services depend on each other. These dependent services require the presence of the antecedent services to function correctly.</p>
<p>To change a service from a network service to a local system the <em>StartName</em> and <em>StartPassword</em> parameters should have the following values:</p>
<pre lang="C++"><code>StartName = &quot;LocalSystem&quot;
StartPassword = &quot;&quot; // - empty string, not NULL
</code></pre>
<p>To change a service from a local system service to a network the <em>StartName</em> and <em>StartPassword</em> parameters should have the following values:</p>
<pre lang="C++"><code>StartName = &quot;NT AUTHORITY\NetworkService&quot;
StartPassword = &quot;&quot; // - empty string, not NULL
</code></pre>
<h2>Examples</h2>
<p>The following VBScript changes the service account for services from running under a specified user account to LocalSystem.</p>
<pre lang="VB"><code>strComputer = &quot;.&quot;
Set objWMIService = GetObject(&quot;winmgmts:&quot; _
 &amp; &quot;{impersonationLevel=impersonate}!\\&quot; &amp; strComputer &amp; &quot;\root\cimv2&quot;)
Set colServiceList = objWMIService.ExecQuery _
 (&quot;SELECT * FROM Win32_Service WHERE StartName = '.\\NetSvc'&quot;)
For Each objService in colServices
 errServiceChange = objService.Change _
 ( , , , , , , &quot;.\LocalSystem&quot; , &quot;&quot;)
Next
</code></pre>
<p>The following VBScript changes the service account password for all scripts running under Netsvc</p>
<pre lang="VB"><code>strComputer = &quot;.&quot;
Set objWMIService = GetObject(&quot;winmgmts:&quot; _
 &amp; &quot;{impersonationLevel=impersonate}!\\&quot; &amp; strComputer &amp; &quot;\root\cimv2&quot;)
Set colServiceList = objWMIService.ExecQuery _
 (&quot;SELECT * FROM Win32_Service WHERE StartName = '.\\NetSvc'&quot;)
For Each objservice in colServiceList
 errReturn = objService.Change( , , , , , , , &quot;password&quot;)
Next
</code></pre>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows Vista<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2008<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Namespace<!-- raw HTML omitted --></td>
<td>Root\CIMv2\TerminalServices<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Mbnapi.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>MOF<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->TSCfgWmi.mof<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->TSCfgWmi.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/CIMWin32Prov/win32-service"><strong>Win32_Service</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/CIMWin32Prov/operating-system-classes">Operating System Classes</a></p>
<!-- raw HTML omitted -->
<p><a href="win32-terminalservice.html"><strong>Win32_TerminalService</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/WmiSdk/wmi-tasks--services">WMI Tasks: Services</a></p>
<!-- raw HTML omitted -->
</body>
