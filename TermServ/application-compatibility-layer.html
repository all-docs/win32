<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Application compatibility layer</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: Application compatibility layer
description: To run legacy applications in a Remote Desktop Services environment you can use the Remote Desktop Services Application Compatibility layer.
ms.assetid: 6e61ed45-4fcb-4aee-b8cc-638a9b87ce00
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Application compatibility layer</h1>
<p>To run legacy applications in a Remote Desktop Services environment you can use the Remote Desktop Services Application Compatibility layer. When the Remote Desktop Session Host (RDÂ Session Host) server loads an application that is not Remote Desktop Services aware, it also loads a DLL that contains compatibility code. To use the Remote Desktop Services Application Compatibility layer, you can set the NOT TSAWARE flag when compiling an application.</p>
<p>If your application is Remote Desktop Services aware, you can avoid the overhead of loading this extra DLL and running the compatibility code.</p>
<p>To indicate that your application is Remote Desktop Services aware, set the <strong>IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE</strong> flag in the optional header. If you are using the linker that ships with Microsoft Visual C++, you can use the <strong>TSAWARE</strong> linker option to set this flag. The <strong>DUMPBIN</strong> tool that ships with Microsoft Visual C++ provides the <em>/HEADERS</em> option to determine the state of the <strong>TSAWARE</strong> flag. For more information about using the <strong>DUMPBIN</strong> tool, see <a href="/cpp/build/reference/dumpbin-reference">DUMPBIN Reference</a>.</p>
<p>Be careful when you use the <strong>TSAWARE</strong> flag because it enables your application to bypass any Remote Desktop Services compatibility optimizations. The <strong>TSAWARE</strong> flag should only be used if you are certain that your application is designed for the Remote Desktop Services environment. If your application meets the following criteria, you can safely use the <strong>IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE</strong> flag.</p>
<ul>
<li>The application does not use .ini files.</li>
<li>The application does not write to <strong>HKEY_CURRENT_USER</strong> during setup. For more information, see <a href="storing-user-specific-information.html">Storing User-Specific Information</a>.</li>
<li>The application does not run as a system service (that is, LUID=System).</li>
<li>The application does not expect exclusive access to the Windows or other system directories. This means that the application does not store per user temporary or configuration data in the Windows or other system directories.</li>
<li>The application does not write to the <strong>HKEY Local Machine</strong> registry hive for user specific data or configuration.</li>
<li>The application follows other Remote Desktop Services compatibility guidelines mentioned in this document.</li>
</ul>
<p>Â </p>
<p>Â </p>
</body>
