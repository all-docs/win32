<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PNRP and WSALookupServiceNext</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: PNRP uses the WSALookupServiceNext function to match queries specified in a previous call to WSALookupServiceBegin.
ms.assetid: b3e1abf4-ff59-481d-b96e-f8916a47cd52
title: PNRP and WSALookupServiceNext
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>PNRP and WSALookupServiceNext</h1>
<p>PNRP uses the <a href="winsock-nsp-reference-links.html"><strong>WSALookupServiceNext</strong></a> function to match queries specified in a previous call to <strong>WSALookupServiceBegin</strong>. The results of the <strong>WSALookupServiceNext</strong> function are determined by settings in the <strong>WSAQUERYSET</strong> structure passed in the initial <strong>WSALookupServiceBegin</strong> function call. This function is used to perform the following two functions:</p>
<ul>
<li>Resolving a peer name to a list of addresses</li>
<li>Enumerating network clouds</li>
</ul>
<p>By using <a href="winsock-nsp-reference-links.html"><strong>WSANSPIoctl</strong></a>, the lookup service can be used asynchronously. For information about using the lookup service functions asynchronously, see <a href="pnrp-and-wsanspioctl.html">PNRP and WSANSPIoctl</a>.</p>
<p>The <a href="winsock-nsp-reference-links.html"><strong>WSALookupServiceNext</strong></a> function blocks even if <strong>WSANSPIoctl</strong> is called. Before calling <strong>WSALookupServiceNext</strong>, an application must wait until it receives a notificationâ€”if blocking is an issue.</p>
<h2>Resolving a Peer Name to a List of Addresses</h2>
<p>When resolving a peer name to a list of addresses, the <a href="pnrp-and-wsaqueryset.html"><strong>LPWSAQUERYSET</strong></a> structure returned in the <em>lpqsResults</em> parameter contains the following values:</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwSize</strong></p>
<!-- raw HTML omitted -->
<p>Returns the size of the structure.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszServiceInstanceName</strong></p>
<!-- raw HTML omitted -->
<p>Returns a peer nameâ€”if <strong>LUP_RETURN_NAME</strong>, <strong>LUP_RETURN_ALL</strong>, or <strong>NULL</strong> are specified.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpServiceClassID</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>SVCID_PNRPNAME</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpVersion</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszComment</strong></p>
<!-- raw HTML omitted -->
<p>Returns a commentâ€”if <strong>LUP_RETURN_COMMENT</strong>, <strong>LUP_RETURN_ALL</strong>, or <strong>NULL</strong> are specified.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwNameSpace</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NS_PNRPNAME</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpNSProviderID</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NS_PROVIDER_PNRPNAME</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszContext</strong></p>
<!-- raw HTML omitted -->
<p>Returns the cloud name if <strong>LUP_RETURN_NAME</strong>, <strong>LUP_RETURN_ALL</strong>, or <strong>NULL</strong> are specified.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwNumberOfProtocols</strong></p>
<!-- raw HTML omitted -->
<p>Returns zero (0).</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszQueryString</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwNumberOfCsAddrs</strong></p>
<!-- raw HTML omitted -->
<p>Returns the number of entries in the CSADDR_INFO array if <strong>LUP_RETURN_ADDR</strong>, <strong>LUP_RETURN_ALL</strong>, or <strong>NULL</strong> are specified. This value and the information in <strong>lpcsaBuffer</strong> are the key bits of information returned in this structure.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpcsaBuffer</strong></p>
<!-- raw HTML omitted -->
<p>Returns a pointer to an array of CSADDR_INFO structures if <strong>LUP_RETURN_ADDR</strong>, <strong>LUP_RETURN_ALL</strong>, or <strong>NULL</strong> are specified. This buffer and the value in <strong>dwNumberOfCsAddrs</strong> are the key information bits returned in this structure.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwOutputFlags</strong></p>
<!-- raw HTML omitted -->
<p>Returns zero (0).</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpBlob</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<h2>Enumerating Network Clouds</h2>
<p>When enumerating clouds, the <a href="pnrp-and-wsaqueryset.html"><strong>LPWSAQUERYSET</strong></a> structure returned in the <em>lpqsResults</em> parameter contains the following values:</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwSize</strong></p>
<!-- raw HTML omitted -->
<p>Returns the size of the structure.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszServiceInstanceName</strong></p>
<!-- raw HTML omitted -->
<p>Returns a cloud nameâ€”if <strong>LUP_RETURN_NAME</strong>, <strong>LUP_RETURN_ALL</strong>, or <strong>NULL</strong> are specified.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpServiceClassID</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>SVCID_PNRPCLOUD</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpVersion</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszComment</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwNameSpace</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NS_PNRPCLOUD</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpNSProviderID</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NS_PROVIDER_PNRPCLOUD</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszContext</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwNumberOfProtocols</strong></p>
<!-- raw HTML omitted -->
<p>Returns zero (0).</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpszQueryString</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwNumberOfCsAddrs</strong></p>
<!-- raw HTML omitted -->
<p>Returns zero (0).</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpcsaBuffer</strong></p>
<!-- raw HTML omitted -->
<p>Returns <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwOutputFlags</strong></p>
<!-- raw HTML omitted -->
<p>Returns zero (0).</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>lpBlob</strong></p>
<!-- raw HTML omitted -->
<p>Returns a pointer to a <a href="winsock-nsp-reference-links.html"><strong>BLOB</strong></a> structure that points to a <a href="/windows/desktop/api/Pnrpns/ns-pnrpns-pnrpcloudinfo"><strong>PNRPCLOUDINFO</strong></a> structureâ€”if <strong>LUP_RETURN_BLOB</strong>, <strong>LUP_RETURN_ALL</strong>, or <strong>NULL</strong> are specified.</p>
<!-- raw HTML omitted -->
<h2>PNRPCLOUDINFO Structure</h2>
<p>When enumerating cloud names, the following values are returned in the <a href="/windows/desktop/api/Pnrpns/ns-pnrpns-pnrpcloudinfo"><strong>PNRPCLOUDINFO</strong></a> structure:</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>dwSize</strong></p>
<!-- raw HTML omitted -->
<p>The size of this structure.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>Cloud</strong></p>
<!-- raw HTML omitted -->
<p>The actual cloud value.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>enCloudState</strong></p>
<!-- raw HTML omitted -->
<p>The current state of a cloud. <a href="/windows/desktop/api/Pnrpdef/ne-pnrpdef-pnrp_cloud_state"><strong>PNRP_CLOUD_STATE</strong></a> specifies the valid values.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>enCloudFlags</strong></p>
<!-- raw HTML omitted -->
<p>Indicates that a cloud name is valid on a network, or only valid on a current computer. <a href="/windows/desktop/api/Pnrpdef/ne-pnrpdef-pnrp_cloud_flags"><strong>PNRP_CLOUD_FLAGS</strong></a> specifies the valid values. Some cloud names are valid on any computer on the same network. Other cloud names are valid only on a current computer, and may be valid only for a period of time.</p>
<ul>
<li>If <strong>enCloudFlags</strong> is set to <strong>PNRP_CLOUD_NAME_LOCAL,</strong> the name is only valid locally.</li>
<li>If <strong>enCloudFlags</strong> is not set, then the cloud name can be transferred to other computers.</li>
</ul>
<!-- raw HTML omitted -->
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="pnrp-and-blob.html">PNRP and BLOB</a></p>
<!-- raw HTML omitted -->
<p><a href="pnrp-and-wsalookupserviceend.html">PNRP and WSALookupServiceEnd</a></p>
<!-- raw HTML omitted -->
<p><a href="pnrp-and-wsanspioctl.html">PNRP and WSANSPIoctl</a></p>
<!-- raw HTML omitted -->
<p><a href="pnrp-and-wsaqueryset.html">PNRP and WSAQUERYSET</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Pnrpns/ns-pnrpns-pnrpcloudinfo"><strong>PNRPCLOUDINFO</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Pnrpns/ns-pnrpns-pnrpinfo_v1"><strong>PNRPINFO</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="pnrp-nsp-error-codes.html">PNRP NSP Error Codes</a></p>
<!-- raw HTML omitted -->
<p><a href="winsock-nsp-reference-links.html"><strong>WSALookupServiceBegin</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
