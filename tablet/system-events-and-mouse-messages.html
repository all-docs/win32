<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>System Events and Mouse Messages</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Your application incorporates optimal design and usage of the tablet pen by sending both Microsoft Windows mouse messages and system events.
ms.assetid: ccd45b68-f037-43da-a7d0-1df9439afd11
title: System Events and Mouse Messages
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>System Events and Mouse Messages</h1>
<p>Your application incorporates optimal design and usage of the tablet pen by sending both Microsoft Windows mouse messages and system events. Applications receive both sets of events for each pen movement or action. The application then chooses the appropriate event to use based on the context of the action. Windows mouse messages work well for pointing and selecting activities, and you should use them for activities that involve interaction with user interface (UI) elements. Pen events work well for real-time ink application, pen actions, and handwriting.</p>
<blockquote>
<p>[!Note]<br />
Both pen events and mouse messages are sent to an application, regardless of whether the pen or the mouse is used.</p>
</blockquote>
<h2>Distinguishing Pen Input from Mouse and Touch</h2>
<p>When your application receives a mouse message (such as WM_LBUTTONDOWN), it may call the <a href="/windows/win32/api/winuser/nf-winuser-getmessageextrainfo"><strong>GetMessageExtraInfo</strong></a> function to evaluate whether the message originated from a pen or a mouse device.</p>
<p>The value returned from <a href="/windows/win32/api/winuser/nf-winuser-getmessageextrainfo"><strong>GetMessageExtraInfo</strong></a> needs to be mask-checked against 0xFFFFFF00, and then compared with 0xFF515700. The following definitions may make this clearer:</p>
<pre lang="C++"><code>#define MI_WP_SIGNATURE 0xFF515700
#define SIGNATURE_MASK 0xFFFFFF00
#define IsPenEvent(dw) (((dw) &amp; SIGNATURE_MASK) == MI_WP_SIGNATURE
</code></pre>
<p>If the comparison is true, then this mouse message was generated by a Tablet PC pen or touch screen. In all other cases, you can assume that this message was generated by a mouse device.</p>
<p>The lower 8 bits returned from <a href="/windows/win32/api/winuser/nf-winuser-getmessageextrainfo"><strong>GetMessageExtraInfo</strong></a> are variable. Of those bits, 7 (the lower 7, masked by 0x7F) are used to represent the cursor ID, zero for the mouse or a variable value for the pen ID. Additionally, in Windows Vista, the eighth bit, masked by 0x80, is used to differentiate touch input from pen input (0 = pen, 1 = touch).</p>
<p>See <a href="/windows/win32/input_pointerdevice/pointer-device-stack-portal">Pointer Device Input</a> and <a href="/windows/win32/wintouch/windows-touch-portal">Touch Input</a> for more info.</p>
<h2>Supported System Gestures</h2>
<p>The following table lists system gestures currently included in Windows XP Tablet PC Edition, details the corresponding pen actions and system events, and shows how they relate to traditional mouse actions.</p>
<table>
<thead>
<tr>
<th>Pen gesture</th>
<th>Mouse action</th>
<th>Pen gesture description</th>
<th>Event messages</th>
<th>Mouse messages</th>
<th>Behaviors in Windows-based applications</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tap<!-- raw HTML omitted --></td>
<td>Left-click<!-- raw HTML omitted --></td>
<td>Tap the screen once with the pen.<!-- raw HTML omitted --></td>
<td>ISG_TAP sent when pen is lifted.<!-- raw HTML omitted --></td>
<td>WM_LBUTTONDOWN and WM_LBUTTONUP sent when pen lifted.<!-- raw HTML omitted --></td>
<td>Choose command from menu or toolbar, take action if command chosen, set insertion point (IP), show selection feedback.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Double-tap<!-- raw HTML omitted --></td>
<td>Double-click<!-- raw HTML omitted --></td>
<td>Tap screen twice in quick succession.<!-- raw HTML omitted --></td>
<td>ISG_DOUBLETAP sent on second tap (down). ISG_TAP event sent on the first tap.<!-- raw HTML omitted --></td>
<td>WM_LBUTTONDBLCLK sent on second tap (down). WM_LBUTTONDOWN and WM_LBUTTONUP sent on first tap (up) as for a single tap.<!-- raw HTML omitted --></td>
<td>Select word, open file or folder.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Press and hold<!-- raw HTML omitted --></td>
<td>Right-click<!-- raw HTML omitted --></td>
<td>Tap the screen and hold until a mouse icon appears, and then lift the pen to display a shortcut menu. An application could choose to perform an action different from showing a right-click menu when the pen is lifted.<!-- raw HTML omitted --></td>
<td>ISG_HOLDENTER sent when the pen has been down long enough. ISG_RIGHTTAP sent when pen is lifted and right-click occurs.<!-- raw HTML omitted --></td>
<td>WM_RBUTTONDOWN and WM_RBUTTONUP sent when right click occurs (when pen is lifted).<!-- raw HTML omitted --></td>
<td>Show shortcut menu.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Hold-through<!-- raw HTML omitted --></td>
<td>Left-click<!-- raw HTML omitted --></td>
<td>Tap the screen and hold until the mouse icon appears and disappears. Users are likely to do this when they accident-tally press and hold and want to revert to just tap.<!-- raw HTML omitted --></td>
<td>ISG_TAP sent when pen is lifted.<!-- raw HTML omitted --></td>
<td>WM_LBUTTONDOWN and WM_LBUTTONUP sent when pen is lifted.<!-- raw HTML omitted --></td>
<td>Left-click for a long time. No mouse equivalent exists. This is a fallback for when a user performs press-and-hold for a long time. The event reverts to being a tap.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Drag<!-- raw HTML omitted --></td>
<td>Left-drag<!-- raw HTML omitted --></td>
<td>Tap the screen to select the object that is to be moved, and then drag after the object is selected.<!-- raw HTML omitted --></td>
<td>ISG_DRAG sent when drag starts.<!-- raw HTML omitted --></td>
<td>WM_LBUTTONDOWN sent when drag starts, followed by a series of mouse move messages, and followed by a WM_LBUTTONUP event.<!-- raw HTML omitted --></td>
<td>Drag-select, as in Microsoft Word when starting with an IP; select multiple words; drag, as when dragging an object in Windows; scrolling.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Press and hold followed by a drag<!-- raw HTML omitted --></td>
<td>Right-drag<!-- raw HTML omitted --></td>
<td>Tap the screen to select the object that is to be moved. Hold until the mouse icon appears, and then drag to move the object. Lift the pen to display a shortcut menu.<!-- raw HTML omitted --></td>
<td>ISG_HOLDENTER sent when pen has been down for some time. ISG_RIGHTDRAG sent when drag starts.<!-- raw HTML omitted --></td>
<td>WM_RBUTTONDOWN sent when drag starts, followed by a series of mouse move messages, followed by a WM_RBUTTONUP event.<!-- raw HTML omitted --></td>
<td>Drag, as when dragging an object or selection followed by a context menu.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Pen hover<!-- raw HTML omitted --></td>
<td>Mouse hover<!-- raw HTML omitted --></td>
<td>Hold the pen steady at a small distance from the screen.<!-- raw HTML omitted --></td>
<td>ISG_HOVERENTER event sent initially. When hover interval is completed, ISG_HOVERLEAVEis sent.<!-- raw HTML omitted --></td>
<td>No mouse message equivalent.<!-- raw HTML omitted --></td>
<td>Show ToolTip, roll-over effects, and other mouse hover behaviors.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>In-air shake<!-- raw HTML omitted --></td>
<td>Show <strong>Tablet PC Input Panel</strong>. No mouse equivalent.<!-- raw HTML omitted --></td>
<td>Move the pen quickly from side to side, holding the tip above, but within range of, the screen.<!-- raw HTML omitted --></td>
<td>Event is not passed to the application.<!-- raw HTML omitted --></td>
<td>No mouse message equivalent.<!-- raw HTML omitted --></td>
<td>New, specific to Tablet PC.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Specifying Stylus and Touch Interactions</h2>
<p>By default, your window will receive all system gesture events and use the default interaction model. Some pieces of this model may interfere with your application, so you may disable them selectively by responding to the <a href="wm-tablet-querysystemgesturestatus-message.html"><strong>WM_TABLET_QUERYSYSTEMGESTURESTATUS Message</strong></a> in your WndProc.</p>
<p>Â </p>
<p>Â </p>
</body>
