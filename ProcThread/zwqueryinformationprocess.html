<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ZwQueryInformationProcess function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Retrieves information about the specified process.
ms.assetid: c36c023f-7f9a-4ba5-a41f-f2f755a24eb6
title: ZwQueryInformationProcess function
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>ZwQueryInformationProcess
api_type:</li>
<li>DllExport
api_location:</li>
<li>Ntdll.dll</li>
<li>ntoskrnl.exe</li>
</ul>
<hr />
<h1>ZwQueryInformationProcess function</h1>
<p>[<strong>ZwQueryInformationProcess</strong> may be altered or unavailable in future versions of Windows. Applications should use the alternate functions listed in this topic.]</p>
<p>Retrieves information about the specified process.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>NTSTATUS WINAPI ZwQueryInformationProcess(
  _In_Â Â Â Â Â Â HANDLE Â Â Â Â Â Â Â Â Â Â ProcessHandle,
  _In_Â Â Â Â Â Â PROCESSINFOCLASS ProcessInformationClass,
  _Out_Â Â Â Â Â PVOID Â Â Â Â Â Â Â Â Â Â Â ProcessInformation,
  _In_Â Â Â Â Â Â ULONG Â Â Â Â Â Â Â Â Â Â Â ProcessInformationLength,
  _Out_opt_Â PULONG Â Â Â Â Â Â Â Â Â Â ReturnLength
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>ProcessHandle</em> [in]</p>
<!-- raw HTML omitted -->
<p>A handle to the process for which information is to be retrieved.</p>
<!-- raw HTML omitted -->
<p><em>ProcessInformationClass</em> [in]</p>
<!-- raw HTML omitted -->
<p>The type of process information to be retrieved. This parameter can be one of the following values from the <strong>PROCESSINFOCLASS</strong> enumeration.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProcessBasicInformation<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->0<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Retrieves a pointer to a PEB structure that can be used to determine whether the specified process is being debugged, and a unique value used by the system to identify the specified process. <!-- raw HTML omitted --> It is best to use the <!-- raw HTML omitted --><!-- raw HTML omitted -->CheckRemoteDebuggerPresent<!-- raw HTML omitted --><!-- raw HTML omitted --> and <!-- raw HTML omitted --><!-- raw HTML omitted -->GetProcessId<!-- raw HTML omitted --><!-- raw HTML omitted --> functions to obtain this information.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProcessDebugPort<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->7<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Retrieves a <!-- raw HTML omitted -->DWORD_PTR<!-- raw HTML omitted --> value that is the port number of the debugger for the process. A nonzero value indicates that the process is being run under the control of a ring 3 debugger.<!-- raw HTML omitted --> It is best to use the <!-- raw HTML omitted --><!-- raw HTML omitted -->CheckRemoteDebuggerPresent<!-- raw HTML omitted --><!-- raw HTML omitted --> or <!-- raw HTML omitted --><!-- raw HTML omitted -->IsDebuggerPresent<!-- raw HTML omitted --><!-- raw HTML omitted --> function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProcessWow64Information<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->26<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Determines whether the process is running in the WOW64 environment (WOW64 is the x86 emulator that allows Win32-based applications to run on 64-bit Windows).<!-- raw HTML omitted --> It is best to use the <!-- raw HTML omitted --><!-- raw HTML omitted -->IsWow64Process<!-- raw HTML omitted --><!-- raw HTML omitted --> function to obtain this information.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProcessImageFileName<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->27<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Retrieves a <!-- raw HTML omitted -->UNICODE_STRING<!-- raw HTML omitted --> value containing the name of the image file for the process.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><strong>ProcessBreakOnTermination</strong><!-- raw HTML omitted -->29<!-- raw HTML omitted --></td>
<td>Retrieves a <strong>ULONG</strong> value indicating whether the process is considered critical.<!-- raw HTML omitted --> <strong>Note:</strong> This value can be used starting in WindowsÂ XP with SP3. Starting in WindowsÂ 8.1, <a href="/windows/desktop/api/processthreadsapi/nf-processthreadsapi-isprocesscritical"><strong>IsProcessCritical</strong></a> should be used instead.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProcessProtectionInformation<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->61<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>Retrieves a BYTE value indicating the type of protected process and the protected process signer.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<p><em>ProcessInformation</em> [out]</p>
<!-- raw HTML omitted -->
<p>A pointer to a buffer supplied by the calling application into which the function writes the requested information. The size of the information written varies depending on the value of the <em>ProcessInformationClass</em> parameter:</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->PROCESS_BASIC_INFORMATION</p>
<!-- raw HTML omitted -->
<p>When the <em>ProcessInformationClass</em> parameter is <strong>ProcessBasicInformation</strong>, the buffer pointed to by the <em>ProcessInformation</em> parameter should be large enough to hold a single <strong>PROCESS_BASIC_INFORMATION</strong> structure having the following layout:</p>
<pre lang="syntax"><code>typedef struct _PROCESS_BASIC_INFORMATION {
    NTSTATUS ExitStatus;
    PPEB PebBaseAddress;
    ULONG_PTR AffinityMask;
    KPRIORITY BasePriority;
    ULONG_PTR UniqueProcessId;
    ULONG_PTR InheritedFromUniqueProcessId;
} PROCESS_BASIC_INFORMATION;
</code></pre>
<table>
<thead>
<tr>
<th>Field</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ExitStatus</strong></td>
<td>Contains the same value that <a href="/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess"><strong>GetExitCodeProcess</strong></a> would return. However the use of <strong>GetExitCodeProcess</strong> is preferable for clarity and safety.</td>
</tr>
<tr>
<td><strong>PebBaseAddress</strong></td>
<td>Points to a <a href="/windows/desktop/api/Winternl/ns-winternl-peb"><strong>PEB</strong></a> structure.</td>
</tr>
<tr>
<td><strong>AffinityMask</strong></td>
<td>Can be cast to a <strong>DWORD</strong> and contains the same value that <a href="/windows/win32/api/winbase/nf-winbase-getprocessaffinitymask"><strong>GetProcessAffinityMask</strong></a> would return for the <code>lpProcessAffinityMask</code> parameter.</td>
</tr>
<tr>
<td><strong>BasePriority</strong></td>
<td>Contains the process priority as described in <a href="/windows/win32/procthread/scheduling-priorities#base-priority">Scheduling Priorities</a>.</td>
</tr>
<tr>
<td><strong>UniqueProcessId</strong></td>
<td>Can be cast to a <strong>DWORD</strong> and contains a unique identifier for this process. It is best to use the <a href="/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocessid"><strong>GetProcessId</strong></a> function to retrieve this information.</td>
</tr>
<tr>
<td><strong>InheritedFromUniqueProcessId</strong></td>
<td>Can be cast to a <strong>DWORD</strong> and contains a unique identifier for the parent process.</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ULONG_PTR</p>
<!-- raw HTML omitted -->
<p>When the <em>ProcessInformationClass</em> parameter is <strong>ProcessWow64Information</strong>, the buffer pointed to by the <em>ProcessInformation</em> parameter should be large enough to hold a <strong>ULONG_PTR</strong>. If this value is nonzero, the process is running in a WOW64 environment; otherwise, if the value is equal to zero, the process is not running in a WOW64 environment.</p>
<p>It is best to use the <a href="/windows/win32/api/wow64apiset/nf-wow64apiset-iswow64process"><strong>IsWow64Process</strong></a> function to determine whether a process is running in the WOW64 environment.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->UNICODE_STRING</p>
<!-- raw HTML omitted -->
<p>When the <em>ProcessInformationClass</em> parameter is <strong>ProcessImageFileName</strong>, the buffer pointed to by the <em>ProcessInformation</em> parameter should be large enough to hold a <strong>UNICODE_STRING</strong> structure as well as the string itself. The string stored in the <strong>Buffer</strong> member is the name of the image file.</p>
<p>If the buffer is too small, the function fails with the STATUS_INFO_LENGTH_MISMATCH error code and the <em>ReturnLength</em> parameter is set to the required buffer size.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->PS_PROTECTION</p>
<!-- raw HTML omitted -->
<p>When the <em>ProcessInformationClass</em> parameter is <strong>ProcessProtectionInformation</strong>, the buffer pointed to by the <em>ProcessInformation</em> parameter should be large enough to hold a single <strong>PS_PROTECTION</strong> structure having the following layout:</p>
<pre lang="syntax"><code>typedef struct _PS_PROTECTION {
    union {
        UCHAR Level;
        struct {
            UCHAR Type   : 3;
            UCHAR Audit  : 1;                  // Reserved
            UCHAR Signer : 4;
        };
    };
} PS_PROTECTION, *PPS_PROTECTION;
</code></pre>
<p>The first 3 bits contain the type of protected process:</p>
<pre lang="syntax"><code>typedef enum _PS_PROTECTED_TYPE {
    PsProtectedTypeNone = 0,
    PsProtectedTypeProtectedLight = 1,
    PsProtectedTypeProtected = 2
} PS_PROTECTED_TYPE, *PPS_PROTECTED_TYPE;
</code></pre>
<p>The top 4 bits contain the protected process signer:</p>
<pre lang="syntax"><code>typedef enum _PS_PROTECTED_SIGNER {
    PsProtectedSignerNone = 0,
    PsProtectedSignerAuthenticode,
    PsProtectedSignerCodeGen,
    PsProtectedSignerAntimalware,
    PsProtectedSignerLsa,
    PsProtectedSignerWindows,
    PsProtectedSignerWinTcb,
    PsProtectedSignerWinSystem,
    PsProtectedSignerApp,
    PsProtectedSignerMax
} PS_PROTECTED_SIGNER, *PPS_PROTECTED_SIGNER;
</code></pre>
<!-- raw HTML omitted -->
<p><em>ProcessInformationLength</em> [in]</p>
<!-- raw HTML omitted -->
<p>The size of the buffer pointed to by the <em>ProcessInformation</em> parameter, in bytes.</p>
<!-- raw HTML omitted -->
<p><em>ReturnLength</em> [out, optional]</p>
<!-- raw HTML omitted -->
<p>A pointer to a variable in which the function returns the size of the requested information. If the function was successful, this is the size of the information written to the buffer pointed to by the <em>ProcessInformation</em> parameter, but if the buffer was too small, this is the minimum size of buffer needed to receive the information successfully.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>Returns an NTSTATUS success or error code.</p>
<p>The forms and significance of NTSTATUS error codes are listed in the Ntstatus.h header file available in the DDK, and are described in the DDK documentation under Kernel-Mode Driver Architecture / Design Guide / Driver Programming Techniques / Logging Errors.</p>
<h2>Remarks</h2>
<p>The <strong>ZwQueryInformationProcess</strong> function and the structures that it returns are internal to the operating system and subject to change from one release of Windows to another. To maintain the compatibility of your application, it is better to use public functions mentioned in the description of the <em>ProcessInformationClass</em> parameter instead.</p>
<p>If you do use <strong>ZwQueryInformationProcess</strong>, access the function through <a href="../dlls/using-run-time-dynamic-linking.html">run-time dynamic linking</a>. This gives your code an opportunity to respond gracefully if the function has been changed or removed from the operating system. Signature changes, however, may not be detectable.</p>
<p>This function has no associated import library. You must use the <a href="/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a> and <a href="/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress"><strong>GetProcAddress</strong></a> functions to dynamically link to Ntdll.dll.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ XP [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows ServerÂ 2003 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Ntdll.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/debugapi/nf-debugapi-checkremotedebuggerpresent"><strong>CheckRemoteDebuggerPresent</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocessid"><strong>GetProcessId</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/debugapi/nf-debugapi-isdebuggerpresent"><strong>IsDebuggerPresent</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/wow64apiset/nf-wow64apiset-iswow64process"><strong>IsWow64Process</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
