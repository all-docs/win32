<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Thread Local Storage</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: With thread local storage (TLS), you can provide unique data for each thread that the process can access using a global index. One thread allocates the index, which can be used by the other threads to retrieve the unique data associated with the index.
ms.assetid: 40df7410-64d6-4edd-8009-d9c3d2aca920
title: Thread Local Storage
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Thread Local Storage</h1>
<p>All threads of a process share its virtual address space. The local variables of a function are unique to each thread that runs the function. However, the static and global variables are shared by all threads in the process. With <em>thread local storage</em> (TLS), you can provide unique data for each thread that the process can access using a global index. One thread allocates the index, which can be used by the other threads to retrieve the unique data associated with the index.</p>
<p>The constant TLS_MINIMUM_AVAILABLE defines the minimum number of TLS indexes available in each process. This minimum is guaranteed to be at least 64 for all systems. The maximum number of indexes per process is 1,088.</p>
<p>When the threads are created, the system allocates an array of <strong>LPVOID</strong> values for TLS, which are initialized to NULL. Before an index can be used, it must be allocated by one of the threads. Each thread stores its data for a TLS index in a <em>TLS slot</em> in the array. If the data associated with an index will fit in an <strong>LPVOID</strong> value, you can store the data directly in the TLS slot. However, if you are using a large number of indexes in this way, it is better to allocate separate storage, consolidate the data, and minimize the number of TLS slots in use.</p>
<p>The following diagram illustrates how TLS works. For a code example illustrating the use of thread local storage, see <a href="using-thread-local-storage.html">Using Thread Local Storage</a>.</p>
<p><img src="images/tls.png" alt="Diagram that shows how the T L S process works." /></p>
<p>The process has two threads, Thread 1 and Thread 2. It allocates two indexes for use with TLS, gdwTlsIndex1 and gdwTlsIndex2. Each thread allocates two memory blocks (one for each index) in which to store the data, and stores the pointers to these memory blocks in the corresponding TLS slots. To access the data associated with an index, the thread retrieves the pointer to the memory block from the TLS slot and stores it in the lpvData local variable.</p>
<p>It is ideal to use TLS in a dynamic-link library (DLL). For an example, see <a href="../dlls/using-thread-local-storage-in-a-dynamic-link-library.html">Using Thread Local Storage in a Dynamic Link Library</a>.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="/cpp/parallel/thread-local-storage-tls">Thread Local Storage (Visual C++)</a></p>
<!-- raw HTML omitted -->
<p><a href="using-thread-local-storage.html">Using Thread Local Storage</a></p>
<!-- raw HTML omitted -->
<p><a href="../dlls/using-thread-local-storage-in-a-dynamic-link-library.html">Using Thread Local Storage in a Dynamic Link Library</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
