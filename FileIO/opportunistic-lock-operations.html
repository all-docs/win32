<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Opportunistic Lock Operations</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: If an application requests opportunistic locks, all files for which it requests locks must be opened for overlapped (asynchronous) input and output by using the CreateFile function with the FILE_FLAG_OVERLAPPED flag.
ms.assetid: 1595c03e-9f6d-456c-8164-fafba06bbd79
title: Opportunistic Lock Operations
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Opportunistic Lock Operations</h1>
<p>If an application requests opportunistic locks, all files for which it requests locks must be opened for overlapped (asynchronous) input and output by using the <a href="/windows/desktop/api/FileAPI/nf-fileapi-createfilea"><strong>CreateFile</strong></a> function with the <strong>FILE_FLAG_OVERLAPPED</strong> flag. After the files are opened for overlapped operation, you can use the <a href="/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> function with one of the following control codes to work with those files' opportunistic locks:</p>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_opbatch_ack_close_pending"><strong>FSCTL_OPBATCH_ACK_CLOSE_PENDING</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_oplock_break_ack_no_2"><strong>FSCTL_OPLOCK_BREAK_ACK_NO_2</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_oplock_break_acknowledge"><strong>FSCTL_OPLOCK_BREAK_ACKNOWLEDGE</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_oplock_break_notify"><strong>FSCTL_OPLOCK_BREAK_NOTIFY</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_request_batch_oplock"><strong>FSCTL_REQUEST_BATCH_OPLOCK</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_request_filter_oplock"><strong>FSCTL_REQUEST_FILTER_OPLOCK</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_request_oplock"><strong>FSCTL_REQUEST_OPLOCK</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_request_oplock_level_1"><strong>FSCTL_REQUEST_OPLOCK_LEVEL_1</strong></a><br />
<a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_request_oplock_level_2"><strong>FSCTL_REQUEST_OPLOCK_LEVEL_2</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
