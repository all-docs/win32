<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Cloaking (Component Services)</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: There are two ingredients in determining the behavior of impersonation the authority the client explicitly grants the server through an impersonation level and the servers ability to mask its own identity when making calls on the clients behalf.
ms.assetid: b34264ff-eb6a-4b99-8c0e-ab6b969a7fb1
title: Cloaking (Component Services)
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Cloaking (Component Services)</h1>
<p>There are two ingredients in determining the behavior of impersonation: the authority the client explicitly grants the server through an impersonation level and the server's ability to mask its own identity when making calls on the client's behalf. This latter capability is known as <em>cloaking</em>. Cloaking has to do with the security identity under which the server makes calls.</p>
<p>When the server impersonates the client, it has direct access to the client's security credentials. In a very local sense, the server thread takes on the identity of the client. But when the server makes calls outside of its process, the client identity will not necessarily be projected as the identity under which the call is made.</p>
<p>When cloaking is enabled, calls made by the server impersonating the client can be made under the client's identity. When cloaking is disabled, calls by the server will be made under the server's identity.</p>
<p>Moreover, there are two forms of cloaking, <em>static cloaking</em> and <em>dynamic cloaking</em>, which can be described as follows:</p>
<ul>
<li>Impersonation with static cloaking. The original client identity (realized as the server thread token) can be presented once to a downstream server on a call using <a href="/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket"><strong>CoSetProxyBlanket</strong></a>, setting the original client identity once on the proxy, and that thread token will be used on subsequent method calls.</li>
<li>Impersonation with dynamic cloaking. The original client identity is discovered as the server thread token on each method call to the downstream server. In effect, the identity that is presented can be determined dynamically. The overhead required to do this can be considerably more expensive.</li>
</ul>
<p>For COM+ applications, the default configuration is for dynamic cloaking capability. This can be changed programmatically and administratively. While dynamic cloaking can have performance overhead, it provides the flexibility that is usually required by circumstances that necessitate using impersonation in the first place.</p>
<p>For more detail regarding cloaking and precise descriptions of possible behaviors, see <a href="/windows/desktop/com/cloaking">Cloaking</a> in the COM documentation.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="client-impersonation-and-delegation.html">Client Impersonation and Delegation</a></p>
<!-- raw HTML omitted -->
<p><a href="client-side-requirements-for-impersonation.html">Client-Side Requirements for Impersonation</a></p>
<!-- raw HTML omitted -->
<p><a href="server-side-requirements-for-impersonation.html">Server-Side Requirements for Impersonation</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
