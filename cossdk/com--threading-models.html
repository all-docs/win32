<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>COM+ Threading Models</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: COM+ threading models are designed around an object collection called an apartment. An apartment is a collection of contexts contained in a process.
ms.assetid: c73fb4c5-20ae-4873-afd2-4f40eb47bade
title: COM+ Threading Models
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>COM+ Threading Models</h1>
<p>COM+ threading models are designed around an object collection called an apartment. An apartment is a collection of contexts contained in a process, as shown in the following illustration.</p>
<p><img src="images/6b86fe3b-262a-483a-a418-67d60f9a5d68.png" alt="Diagram that shows a collection of contexts in an activity, within an apartment, within a process." /></p>
<p>Calls within an apartment are direct, while calls across apartments (out-of-process) are indirect and require proxy and stub code. Apartments allow for objects with different synchronization and reentrancy properties and have two categories: single-threaded and multithreaded. Objects in a single-threaded apartment (STA) execute on the particular thread in which they were created. STAs allow only one method to execute at a time. They are designed for user interfaces and rely on the Microsoft Windows message queue to process incoming calls.</p>
<p>Objects in a multithreaded apartment (MTA) execute on any thread and allow any number of methods to occur simultaneously. MTAs support reentrance implicitly.</p>
<p>COM+ classes are marked with a <strong>ThreadingModel</strong> property that allows COM+ to create the object in the proper apartment. To determine which apartment an object is created in, <a href="/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance"><strong>CoCreateInstance</strong></a> uses the <strong>ThreadingModel</strong> property.</p>
<p>Threads must call <a href="/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex"><strong>CoInitializeEx</strong></a> before they can use COM+. This creates them inside the correct apartment and context. The main thread apartment is determined to be the first STA called by <strong>CoInitializeEx</strong>. This is usually associated with the main thread of a process. <strong>CoInitializeEx</strong> indicates the type of apartment required by the thread by setting the following flags:</p>
<ul>
<li><strong>COINIT_MULTITHREADED</strong>â€”Locates the thread in the single multithreaded apartment.</li>
<li><strong>COINIT_APARTMENTTHREADED</strong>â€”Places the thread into a new STA.</li>
</ul>
<p>The following topics in this section provide more information about using threading models and apartments in COM+:</p>
<ul>
<li><a href="threading-model-attribute.html">Threading Model Attribute</a></li>
<li><a href="neutral-apartments.html">Neutral Apartments</a></li>
</ul>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/com/processes--threads--and-apartments">Processes, Threads, and Apartments</a></p>
<!-- raw HTML omitted -->
<p><a href="components.html"><strong>ThreadingModel</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
