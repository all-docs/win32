<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Building An ICE</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: If you are unable to find the Internal Consistency Evaluators you need among the existing ICE custom actions listed in the ICE Reference, you will need to prepare your own ICE to validate your package.
ms.assetid: d9ff43ee-8e7a-4132-ac2f-232dc24606d8
title: Building An ICE
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Building An ICE</h1>
<p>If you are unable to find the <a href="internal-consistency-evaluators-ices.html">Internal Consistency Evaluators</a> you need among the existing ICE custom actions listed in the <a href="ice-reference.html">ICE Reference</a>, you will need to prepare your own ICE to validate your package.</p>
<p>When authoring ICE custom actions you should do the following:</p>
<ul>
<li>Base the ICEs only on custom actions of types listed in the table shown.</li>
<li>Call <a href="/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage"><strong>MsiProcessMessage</strong></a> and post an INSTALLMESSAGE_USER type of message. When authoring your ICE messages follow the message format in the <a href="ice-message-guidelines.html">ICE Message Guidelines</a>.</li>
<li>Write your ICE such that it captures any API errors and always returns ERROR_SUCCESS. This is necessary to allow subsequent custom actions to run following the failure of an ICE.</li>
</ul>
<p>ICE custom actions are limited to the following custom action types.</p>
<table>
<thead>
<tr>
<th>Custom action type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="custom-action-type-1.html">Custom Action Type 1</a></td>
<td>DLL in binary stream</td>
</tr>
<tr>
<td><a href="custom-action-type-2.html">Custom Action Type 2</a></td>
<td>EXE in binary stream</td>
</tr>
<tr>
<td><a href="custom-action-type-5.html">Custom Action Type 5</a></td>
<td>JScript in binary stream</td>
</tr>
<tr>
<td><a href="custom-action-type-6.html">Custom Action Type 6</a></td>
<td>VBScript in binary stream</td>
</tr>
<tr>
<td><a href="custom-action-type-37.html">Custom Action Type 37</a></td>
<td>JScript code as string</td>
</tr>
<tr>
<td><a href="custom-action-type-38.html">Custom Action Type 38</a></td>
<td>VBScript code as string</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>When authoring an ICE custom action, do not do the following:</p>
<ul>
<li>Do not assume that the handle to the engine that the ICE receives is an installation instance of the installer database. If it is not an installation instance, certain properties are not defined, the source and target directories are not resolved, and current feature states are not defined.</li>
<li>Do not rely on the prior execution, or non-execution, of any installer action, custom action, or another ICE. Because a prior ICE may have created temporary columns in any table, authors should reference columns by name whenever possible. ICEs should cleanup any temporary columns or tables before they exit.</li>
<li>Do not assume that authors have access to an image of the source directory of the database.</li>
<li>Do not assume that changes made to the database do not persist.</li>
</ul>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="sample-ice-in-c-.html">Sample ICE in C++</a></p>
<!-- raw HTML omitted -->
<p><a href="sample-ice-in-vbscript.html">Sample ICE in VBScript</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
