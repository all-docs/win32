<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Patch Uninstall Custom Actions</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: You can use the Custom Action Patch Uninstall option to specify that the installer run the custom action only when a patch is uninstalled.
ms.assetid: c741aa40-ba4c-459e-936a-19c002620c30
title: Patch Uninstall Custom Actions
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Patch Uninstall Custom Actions</h1>
<p>You can use the <a href="custom-action-patch-uninstall-option.html">Custom Action Patch Uninstall option</a> to specify that the installer run the custom action only when a patch is uninstalled.</p>
<p><strong>Windows Installer 4.5 and later:</strong> You can use the <a href="custom-action-patch-uninstall-option.html">Custom Action Patch Uninstall Option</a> to specify that the installer only run the custom action when a patch is uninstalled.</p>
<p>**<a href="not-supported-in-windows-installer-4-0.html">Windows Installer 4.0 and earlier</a>:Â Â **</p>
<p>The <a href="custom-action-patch-uninstall-option.html">Custom Action Patch Uninstall option</a> is not available. There is no method for marking a <a href="custom-actions.html">custom action</a> within a patch package to be run when the patch is uninstalled because the installer does not apply the patch packages being uninstalled.</p>
<p>To have a <a href="custom-actions.html">custom action</a> run when a particular patch is uninstalled, the custom action must either be present in the original application or be in a patch for the product that is always applied.</p>
<p>Developers can use the <a href="msipatchremovallist.html"><strong>MsiPatchRemovalList</strong></a> property to author a Windows Installer package or patch that performs <a href="custom-actions.html">custom actions</a> on the removal of a patch. The custom action can be authored into the original installation package, a patch that has already been applied to the package, or a patch that is not an <a href="uninstallable-patches.html">uninstallable patch</a>. The custom action can be conditionalized on the <strong>MsiPatchRemovalList</strong> property in the sequence tables. See <a href="using-properties-in-conditional-statements.html">Using Properties in Conditional Statements</a> for more information about conditionalizing actions.</p>
<p>The custom action can obtain the GUIDs of patches being removed from the value of the <a href="msipatchremovallist.html"><strong>MsiPatchRemovalList</strong></a> property. The custom action can determine whether the installation state of the patch is applied, obsolete, or superseded by calling the <a href="/windows/desktop/api/Msi/nf-msi-msigetpatchinfoexa"><strong>MsiGetPatchInfoEx</strong></a> or the <a href="patch-patchproperty.html"><strong>PatchProperty</strong></a> property of the <a href="patch-object.html">Patch object</a>.</p>
<p>If the custom action requires special metadata from the patch, the patch should contain a custom action that writes the metadata to a registry or file location when the patch is applied. The custom action in the original application or a patch that is always applied can obtain the information needed to remove the patch's changes.</p>
<p>Patches making changes that are difficult to undo correctly should not be marked as <a href="uninstallable-patches.html">uninstallable patches</a>.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="sequencing-patches.html">Patch Sequencing</a></p>
<!-- raw HTML omitted -->
<p><a href="removing-patches.html">Removing Patches</a></p>
<!-- raw HTML omitted -->
<p><a href="uninstallable-patches.html">Uninstallable Patches</a></p>
<!-- raw HTML omitted -->
<p><a href="uninstalling-patches.html">Uninstalling Patches</a></p>
<!-- raw HTML omitted -->
<p><a href="msipatchremove.html"><strong>MSIPATCHREMOVE</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Msi/nf-msi-msienumproductsexa"><strong>MsiEnumapplicationsEx</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Msi/nf-msi-msigetpatchinfoexa"><strong>MsiGetPatchInfoEx</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Msi/nf-msi-msiremovepatchesa"><strong>MsiRemovePatches</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
