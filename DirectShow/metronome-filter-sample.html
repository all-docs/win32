<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Metronome Filter Sample</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Metronome Filter Sample
ms.assetid: bb279898-875a-4ce4-ac69-6c58f640fbbd
title: Metronome Filter Sample
ms.topic: article
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</h2>
<h1>Metronome Filter Sample</h1>
<p>[The feature associated with this page, <a href="/windows/win32/directshow/directshow">DirectShow</a>, is a legacy feature. It has been superseded by <a href="/uwp/api/Windows.Media.Playback.MediaPlayer">MediaPlayer</a>, <a href="/windows/win32/api/mfmediaengine/nn-mfmediaengine-imfmediaengine">IMFMediaEngine</a>, and <a href="/windows/win32/medfound/audio-video-capture-in-media-foundation">Audio/Video Capture in Media Foundation</a>. Those features have been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>MediaPlayer</strong>, <strong>IMFMediaEngine</strong> and <strong>Audio/Video Capture in Media Foundation</strong> instead of <strong>DirectShow</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<h2>Description</h2>
<p>This sample filter shows how to implement a reference clock. The filter uses your default microphone input to listen for audio spikes (such as clicks, hand claps, or coughs), which it uses to determine a clock rate.</p>
<h2>Usage</h2>
<p>Build the sample project and copy the filter DLL (Metronom.ax) to your Windows system directory. Run the Metronom.reg file to register the DLL.</p>
<p>To use the filter:</p>
<ol>
<li>Build a filter graph in GraphEdit that renders a video stream.</li>
<li>Delete any rendered audio streams.</li>
<li>Add the Metronome filter to the graph. It appears in the DirectShow Filters category.</li>
<li>Run the graph. The video will begin playing at normal speed.</li>
<li>Clap your hands or use a metronome to set a new speed.</li>
</ol>
<h2>Programming Notes</h2>
<p>This filter works only for video. The audio renderer is not capable of synchronizing to radically different clock rates.</p>
<p>If you clap 92 times per minute (once every ~652 ms), the video will play at the normal rate. You can change this default by changing the value of the constant <code>BPM</code> in Metronom.cpp.</p>
<p>If you stop clapping for a period of time and then start clapping again, you must start again at approximately the same speed, or the filter will ignore it. Also, the video playback rate is limited by the CPU speed. If you exceed the limit for any length of time, the filter will stop responding to rate changes. If this happens, stop the graph and restart.</p>
<p>If you implement your own clock, the most important rules is that reference clocks must not go backward. That is, they must never report a time value less than the previous time value.</p>
<h2>Downloading the Sample</h2>
<p>To download the DirectShow SDK samples, install the latest version of the <a href="https://msdn.microsoft.com/windowsvista/bb980924.aspx">Windows SDK</a>.</p>
<p>This sample is installed under the following path: <em>[SDK Root]</em>\Samples\Multimedia\DirectShow\Filters\Metronome.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="cbasereferenceclock.html"><strong>CBaseReferenceClock Class</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="directshow-samples.html">DirectShow Samples</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
