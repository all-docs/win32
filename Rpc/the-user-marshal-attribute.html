<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>The user_marshal Attribute</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: The user_marshal Attribute
description: The \ user_marshal\ attribute is an ACF-type attribute similar in syntax to \ represent_as\ .
ms.assetid: 5a381b44-e271-4713-954f-a55840a92bb7
keywords:</p>
<ul>
<li>Remote Procedure Call RPC , attributes, user_marshal</li>
<li>user_marshal
ms.topic: article
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1>The user_marshal Attribute</h1>
<p>The [ <a href="/windows/desktop/Midl/user-marshal">user_marshal</a>] attribute is an ACF-type attribute similar in syntax to [ <a href="/windows/desktop/Midl/represent-as">represent_as</a>]. As with the IDL attribute, [ <a href="/windows/desktop/Midl/wire-marshal">wire_marshal</a>], it offers a more efficient way to marshal data across a network. As an ACF attribute, <strong>[user_marshal]</strong> lets you marshal custom data types that are unknown to MIDL. Each application-specific type has a corresponding transmittable type that defines the wire representation.</p>
<p>Your application-specific type can be a simple, composite, or pointer type. The main restriction is that the type instance must have a fixed, well-defined memory size. If the size of your type instance needs to change, use a pointer field rather than a conformant array. Alternatively, you can define a pointer to the changeable type.</p>
<p>As with the <strong>[wire_marshal]</strong> attribute, you supply routines for the sizing, marshaling, unmarshaling, and freeing passes. The following table describes the four user-supplied routine names. The &lt;type&gt; is the userm-<em>type</em> specified in the <strong>[user_marshal]</strong> type definition.</p>
<table>
<thead>
<tr>
<th>Routine</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="the-type-usersize-function.html">&lt;type&gt;_UserSize</a></td>
<td>Sizes the RPC data buffer before marshaling on the client or server side.</td>
</tr>
<tr>
<td><a href="the-type-usermarshal-function.html">&lt;type&gt;_UserMarshal</a></td>
<td>Marshals the data on the client or server side.</td>
</tr>
<tr>
<td><a href="the-type-userunmarshal-function.html">&lt;type&gt;_UserUnmarshal</a></td>
<td>Unmarshals the data on the client or server side.</td>
</tr>
<tr>
<td><a href="the-type-userfree-function.html">&lt;type&gt;_UserFree</a></td>
<td>Frees the data on the server side.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>These user-supplied routines are provided by either the client or the server application, based on the directional attributes.</p>
<p>If the parameter is [ <a href="/windows/desktop/Midl/in">in</a>] only, the client transmits to the server. The client needs the <strong>&lt;type&gt;_UserSize</strong> and <strong>&lt;type&gt;_UserMarshal</strong> functions. The server needs the <strong>&lt;type&gt;_UserUnmarshal</strong> and <strong>&lt;type&gt;_UserFree</strong> functions.</p>
<p>For an [ <a href="/windows/desktop/Midl/out-idl">out</a>]-only parameter, the server transmits to the client. The server needs the <strong>&lt;type&gt;_UserSize</strong> and <strong>&lt;type&gt;_UserMarshal</strong> functions, while the client needs the <strong>&lt;type&gt;_UserMarshal</strong> function.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="the-wire-marshal-attribute.html">The wire_marshal Attribute</a></p>
<!-- raw HTML omitted -->
<p><a href="marshaling-rules-for-user-marshal-and-wire-marshal.html">Marshaling Rules for user marshal and wire_marshal</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/Midl/user-marshal">user_marshal</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/Midl/wire-marshal">wire_marshal</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Rpcndr/nf-rpcndr-ndrgetusermarshalinfo"><strong>NdrGetUserMarshalInfo</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
