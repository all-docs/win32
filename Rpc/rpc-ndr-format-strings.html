<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>RPC NDR Format Strings</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: RPC NDR Format Strings
description: Remote Procedure Call (RPC) NDR format strings.
ms.assetid: 9c83a039-49d3-491d-8110-29d1548730de
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>RPC NDR Format Strings</h1>
<h2>NDR Engine: 32-bit Interpreter</h2>
<p>This document describes the format string descriptors, sometimes referred to as MOPs, for the 32-bit NDR engine. This section describes changes associated with the evolution from the <a href="/windows/desktop/Midl/-oi"><strong>â€“Oi</strong></a> interpreter to the <strong>â€“Oif</strong> interpreter layer, as well as additions related to pipes and asynchronous support.</p>
<p>This document describes current Microsoft Interface Definition Language (MIDL) technology from the engine perspective, and the current NDR engine.</p>
<h2>Overview</h2>
<p>The NDR engine is the marshaling engine of the Remote Procedure Call (RPC) and DCOM components. It handles all stub-related issues of a remote call. As a process, NDR marshaling is driven by the C code from MIDL-generated stubs, a MIDL JIT-type generator, or by stubs generated by other tools or written manually. In turn, the NDR engine drives the underlying run time (DCOM or RPC) that communicates with specific transports.</p>
<p>The original goal of the design had been to provide a tool for effective marshaling for arbitrary data, based on information provided by the MIDL compiler. The format strings described in this documentâ€”and indeed all information generated by the compiler for NDR engine consumptionâ€”have always been considered an internal interface between the compiler and the engine. Similarly, interfaces available to the engine to handle run-time issues are also mostly internal (some exceptions exist on the RPC run-time side, and some DCOM interfaces used by the engine are external).</p>
<p>Two typical approaches to marshaling have always been inline and data-driven (interpreted) technology. MIDL supports both through its <a href="/windows/desktop/Midl/-os"><strong>â€“Os</strong></a> and <a href="/windows/desktop/Midl/-oi"><strong>â€“Oi*</strong></a> switches in its C-generated stubs. In addition, MIDL can generate the TLB libraries used by the oleautomation package. Accordingly, one perspective of the engine's internals is that it consists of two parts.</p>
<p>The first is a set of routines that handle sizing, marshaling, and so on, corresponding to typical data type objects like a structure or an array. These routines are fine-tuned for performance; for example, they typically attempt to block-copy data wherever possible. This part is often referred to as the core NDR engine.</p>
<p>The second part consists of an interpreter and its related pieces. The interpreter uses routines from the core NDR engine, as if from an internal library, in order to execute a remote call with all its arguments marshaled and unmarshaled, as appropriate.</p>
<p>The core NDR engine is used in a similar manner whether used from inline stubs or from the interpreter. All core engine routines depend on the state passed in by a stub message structure. The structure is set up appropriately by the inline stub or by the interpreter. Over the years the core engine had been used in a different context; currently the interpreter is actually a set of several distinct interpreter loops. These are related to the old and new (<a href="/windows/desktop/Midl/-oi"><strong>â€“Oi</strong></a> versus <strong>â€“Oif</strong>) interpreters, as well as to loops related to data serialization (pickling), RPC async support and DCOM async support (RPC and DCOM have different asynchronous programming models).</p>
<p>Beyond the addition of new features, an important aspect of the NDR engine evolution is a general shift in the approach to interpreters. NDR version1.1 began as part of a new MIDL 2.0 approach to marshaling, with the inline stubs being preferred for performance considerations. With the most recent version of NDR, <a href="/windows/desktop/Midl/-oi"><strong>â€“Oif</strong></a> has become the most widely used mode of the compiler, almost to the exclusion of inline stubs.</p>
<p>RPC NDR Engine format string descriptors are described in more detail in the following topics:</p>
<ul>
<li><a href="format-strings.html">Format Strings</a></li>
<li><a href="procedure-format-strings.html">Procedure Format Strings</a></li>
<li><a href="procedure-header-descriptor.html">Procedure Header Descriptor</a></li>
<li><a href="handles.html">Handles</a></li>
<li><a href="the-header.html">The Header</a></li>
<li><a href="parameter-descriptors.html">Parameter Descriptors</a></li>
<li><a href="type-format-strings.html">Type Format Strings</a></li>
</ul>
<p>Â </p>
<p>Â </p>
</body>
