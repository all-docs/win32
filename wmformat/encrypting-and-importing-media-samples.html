<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Encrypting and Importing Media Samples</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Encrypting and Importing Media Samples
description: Encrypting and Importing Media Samples
ms.assetid: f9784c9a-c672-432d-a3ad-eb2ed73ac523
keywords:</p>
<ul>
<li>Windows Media Format SDK,DRM import</li>
<li>Windows Media Format SDK,import</li>
<li>Windows Media Format SDK,encrypting media samples</li>
<li>digital rights management (DRM),import</li>
<li>DRM (digital rights management),import</li>
<li>digital rights management (DRM),encrypting media samples</li>
<li>DRM (digital rights management),encrypting media samples</li>
<li>DRM Client Extended APIs,import</li>
<li>Client Extended APIs,import</li>
<li>DRM Client Extended APIs,encrypting media samples</li>
<li>Client Extended APIs,encrypting media samples
ms.topic: article
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</li>
</ul>
<hr />
<h1>Encrypting and Importing Media Samples</h1>
<p>[The feature associated with this page, <a href="/windows/win32/wmformat/windows-media-format-11-sdk">Windows Media Format 11 SDK</a>, is a legacy feature. It has been superseded by <a href="/windows/win32/medfound/source-reader">Source Reader</a> and <a href="/windows/win32/medfound/sink-writer">Sink Writer</a>. <strong>Source Reader</strong> and <strong>Sink Writer</strong> have been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>Source Reader</strong> and <strong>Sink Writer</strong> instead of <strong>Windows Media Format 11 SDK</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<p>For each media sample that you encrypt using Windows Media DRM, you must generate a salt value that is strictly bigger than the previous one (monotonically increasing). Use the new salt value to create a transitory encryption key by applying the SHA-1 encryption algorithm to the initialization vector concatenated with the salt value.</p>
<p>Next, encrypt the sample according to the RC4 algorithm using the generated transitory key. Before the sample is passed to the SDK, your application must associate the salt value with the sample by setting an extension attribute.</p>
<p>Here are the steps for encrypting media samples:</p>
<ol>
<li>Call the <strong>QueryInterface</strong> method of the sample object to get the <a href="/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer3"><strong>INSSBuffer3</strong></a> interface.</li>
<li>Increment the salt value.</li>
<li>Encrypt the sample using an RC1 encryption algorithm. For the encryption you create a key by concatenating the initialization vector and the salt value.</li>
<li>Provide the salt value to the SDK by calling <a href="/previous-versions/windows/desktop/api/Wmsbuffer/nf-wmsbuffer-inssbuffer3-setproperty"><strong>INSSBuffer::SetProperty</strong></a>.</li>
</ol>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="drm-import.html"><strong>DRM Import</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="media-sample-encryption-example.html"><strong>Media Sample Encryption Example</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
