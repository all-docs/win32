<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IWMDRMLicenseQuery::QueryLicenseState method</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: IWMDRMLicenseQuery QueryLicenseState method (Wmdrmsdk.h)
description: The QueryLicenseState method queries the local license store for license information that applies to a Key ID for one or more specific rights.
ms.assetid: 17f40c56-2266-4c94-9e95-a33a92ddef74
keywords:</p>
<ul>
<li>QueryLicenseState method windows Media Format</li>
<li>QueryLicenseState method windows Media Format , IWMDRMLicenseQuery interface</li>
<li>IWMDRMLicenseQuery interface windows Media Format , QueryLicenseState method
topic_type:</li>
<li>apiref
api_name:</li>
<li>IWMDRMLicenseQuery.QueryLicenseState
api_location:</li>
<li>Wmdrmsdk.lib</li>
<li>Wmdrmsdk.dll
api_type:</li>
<li>COM
ms.topic: reference
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</li>
</ul>
<hr />
<h1>IWMDRMLicenseQuery::QueryLicenseState method</h1>
<p>[The feature associated with this page, <a href="/windows/win32/wmformat/windows-media-format-11-sdk">Windows Media Format 11 SDK</a>, is a legacy feature. It has been superseded by <a href="/windows/win32/medfound/source-reader">Source Reader</a> and <a href="/windows/win32/medfound/sink-writer">Sink Writer</a>. <strong>Source Reader</strong> and <strong>Sink Writer</strong> have been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>Source Reader</strong> and <strong>Sink Writer</strong> instead of <strong>Windows Media Format 11 SDK</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<p>The <strong>QueryLicenseState</strong> method queries the local license store for license information that applies to a Key ID for one or more specific rights.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>HRESULT QueryLicenseState(
  [in]  BSTR                   bstrKID,
  [in]  DWORD                  cActionsToQuery,
  [in]  BSTR                   rgbstrActionsToQuery[],
  [out] DRM_LICENSE_STATE_DATA rgResultStateData[]
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>bstrKID</em> [in]</p>
<!-- raw HTML omitted -->
<p>Key ID for which to query. Only licenses that apply to this Key ID will be evaluated.</p>
<!-- raw HTML omitted -->
<p><em>cActionsToQuery</em> [in]</p>
<!-- raw HTML omitted -->
<p>The number of actions for which to query. This value must be set to the number of elements in the arrays passed for the <em>rgbstrActionsToQuery</em> and <em>rgResultStateData</em> parameters.</p>
<!-- raw HTML omitted -->
<p><em>rgbstrActionsToQuery[]</em> [in]</p>
<!-- raw HTML omitted -->
<p>Array of one or more rights for which to query. This array must contain as many elements as specified by <em>cActionsToQuery</em>. Each element must be set to one of the following constants.</p>
<table>
<thead>
<tr>
<th>Constant</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>g_wszWMDRM_LicenseState_Backup</td>
<td>Include to query for the details about the right to back up and restore the license.</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_CollaborativePlay</td>
<td>Include to query for the details about the right to share the content with a group of users as part of a collaborative playback scenario.</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_Copy</td>
<td>Include to query for the details about the right to copy the content to external devices or media.</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_CopyToCD</td>
<td>Include to query for the details about the right to copy the content to CD.</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_CopyToNonSDMIDevice</td>
<td>Include to query for the details about the right to copy the content to a device that does not support the secure digital media initiative (SDMI).</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_CopyToSDMIDevice</td>
<td>Include to query for the details about the right to copy the content to a device that supports the SDMI.</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_CreateThumbnailImage</td>
<td>Include to query for the details about the right to create a thumbnail image from the content.</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_Playback</td>
<td>Include to query for the details about the right to play the content.</td>
</tr>
<tr>
<td>g_wszWMDRM_LicenseState_PlaylistBurn</td>
<td>Include to query for the details about the right to copy the content to CD as part of a playlist.</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p><em>rgResultStateData[]</em> [out]</p>
<!-- raw HTML omitted -->
<p>Array of one or more <a href="drmdrm-license-state-data.html"><strong>DRM_LICENSE_STATE_DATA</strong></a> structures that receive the license state information that applies to the right in the corresponding element of the <em>rgbstrActionsToQuery</em> parameter.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>The method returns an <strong>HRESULT</strong>. Possible values include, but are not limited to, those in the following table.</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>S_OK</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The method succeeded.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>All licenses that apply to the specified Key ID will be searched and evaluated. The results are aggregated, so each <strong>DRM_LICENSE_STATE_DATA</strong> structure may contain information from multiple licenses.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wmdrmsdk.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wmdrmsdk.lib<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="iwmdrmlicensequery.html"><strong>IWMDRMLicenseQuery Interface</strong></a></p>
<!-- raw HTML omitted -->
</body>
