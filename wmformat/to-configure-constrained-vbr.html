<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>To Configure Constrained VBR</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: To Configure Constrained VBR
description: To Configure Constrained VBR
ms.assetid: a39e7628-0211-48ad-94e5-5003203f30be
keywords:</p>
<ul>
<li>streams,configuring VBR streams</li>
<li>streams,variable bit rate (VBR)</li>
<li>variable bit rate (VBR),streams</li>
<li>VBR (variable bit rate),streams</li>
<li>streams,configuring constrained VBR</li>
<li>variable bit rate (VBR),configuring constrained</li>
<li>VBR (variable bit rate),configuring constrained</li>
<li>profiles,configuring constrained VBR
ms.topic: article
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</li>
</ul>
<hr />
<h1>To Configure Constrained VBR</h1>
<p>[The feature associated with this page, <a href="/windows/win32/wmformat/windows-media-format-11-sdk">Windows Media Format 11 SDK</a>, is a legacy feature. It has been superseded by <a href="/windows/win32/medfound/source-reader">Source Reader</a> and <a href="/windows/win32/medfound/sink-writer">Sink Writer</a>. <strong>Source Reader</strong> and <strong>Sink Writer</strong> have been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>Source Reader</strong> and <strong>Sink Writer</strong> instead of <strong>Windows Media Format 11 SDK</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<p>You can use constrained variable bit rate (VBR) encoding on a stream to specify an average bit rate that will be maintained in the encoded content. You also specify the maximum bit rate of the stream and the maximum required buffer window.</p>
<p>You cannot know what the average bit rate will be for a constrained VBR stream before encoding, but you can use a rough estimate. As a general rule, the maximum bit rate you specify will end up being two to three times the average bit rate.</p>
<p>Constrained VBR must be used in conjunction with two-pass encoding. Two-pass encoding is not set in the profile. You must configure the writer to perform a preprocessing pass before writing the stream. For more information about using two-pass encoding, see <a href="using-two-pass-encoding.html">Using Two-Pass Encoding</a>.</p>
<p>To configure a stream in a profile to use constrained VBR encoding, perform the following steps.</p>
<ol>
<li>Create a profile manager object by calling the <a href="/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreateprofilemanager"><strong>WMCreateProfileManager</strong></a> function.</li>
<li>Open an existing profile to which you want to add VBR support. For more information about opening profiles, see <a href="working-with-profiles.html">Working with Profiles</a>.</li>
<li>Get a stream configuration object for the stream you want to use by calling either <a href="/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmprofile-getstream"><strong>IWMProfile::GetStream</strong></a> or <a href="/previous-versions/windows/desktop/api/wmsdkidl/nf-wmsdkidl-iwmprofile-getstreambynumber"><strong>IWMProfile::GetStreamByNumber</strong></a>.</li>
<li>Get a pointer to the <a href="/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault"><strong>IWMPropertyVault</strong></a> interface of the stream configuration object by calling <strong>IWMStreamConfig::QueryInterface</strong>.</li>
<li>Enable VBR encoding for the stream by calling <a href="/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmpropertyvault-setproperty"><strong>IWMPropertyVault::SetProperty</strong></a> for the <strong>g_wszVBREnabled</strong> property.</li>
<li>Use calls to <strong>IWMPropertyVault::SetProperty</strong> to set the desired maximum values for the <strong>g_wszVBRBitrateMax</strong> and <strong>g_wszVBRBufferWindowMax</strong> properties.</li>
<li>Save the changes made to the stream by calling <a href="/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmprofile-reconfigstream"><strong>IWMProfile::ReconfigStream</strong></a>.</li>
<li>Save the profile, or pass it to the writer object.</li>
<li>Configure the writer to perform a preprocessing pass.</li>
</ol>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="configuring-vbr-streams.html"><strong>Configuring VBR Streams</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
