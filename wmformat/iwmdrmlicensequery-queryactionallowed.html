<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IWMDRMLicenseQuery::QueryActionAllowed method</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: IWMDRMLicenseQuery QueryActionAllowed method (Wmdrmsdk.h)
description: The QueryActionAllowed method performs a query on the local license store to retrieve the license status for one or more DRM actions that apply to a specified Key ID.
ms.assetid: 814c2850-c036-4c44-a64e-861e88f16fb1
keywords:</p>
<ul>
<li>QueryActionAllowed method windows Media Format</li>
<li>QueryActionAllowed method windows Media Format , IWMDRMLicenseQuery interface</li>
<li>IWMDRMLicenseQuery interface windows Media Format , QueryActionAllowed method
topic_type:</li>
<li>apiref
api_name:</li>
<li>IWMDRMLicenseQuery.QueryActionAllowed
api_location:</li>
<li>Wmdrmsdk.lib</li>
<li>Wmdrmsdk.dll
api_type:</li>
<li>COM
ms.topic: reference
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</li>
</ul>
<hr />
<h1>IWMDRMLicenseQuery::QueryActionAllowed method</h1>
<p>[The feature associated with this page, <a href="/windows/win32/wmformat/windows-media-format-11-sdk">Windows Media Format 11 SDK</a>, is a legacy feature. It has been superseded by <a href="/windows/win32/medfound/source-reader">Source Reader</a> and <a href="/windows/win32/medfound/sink-writer">Sink Writer</a>. <strong>Source Reader</strong> and <strong>Sink Writer</strong> have been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>Source Reader</strong> and <strong>Sink Writer</strong> instead of <strong>Windows Media Format 11 SDK</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<p>The <strong>QueryActionAllowed</strong> method performs a query on the local license store to retrieve the license status for one or more DRM actions that apply to a specified Key ID.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>HRESULT QueryActionAllowed(
  [in]  BSTR  bstrKID,
  [in]  BSTR  bstrMinReqIndivVersion,
  [in]  DWORD cActionsToQuery,
  [in]  BSTR  rgbstrActionsToQuery[],
  [out] DWORD rgdwQueryResult[]
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>bstrKID</em> [in]</p>
<!-- raw HTML omitted -->
<p>Key ID for which to query. Only licenses that apply to this Key ID will be evaluated.</p>
<!-- raw HTML omitted -->
<p><em>bstrMinReqIndivVersion</em> [in]</p>
<!-- raw HTML omitted -->
<p>The minimum security version specified in the header of the ASF file. This parameter is optional. Pass <strong>NULL</strong> to perform the query without this information.</p>
<!-- raw HTML omitted -->
<p><em>cActionsToQuery</em> [in]</p>
<!-- raw HTML omitted -->
<p>The number of actions for which to query. This value must be set to the number of elements in the arrays passed for the <em>rgbstrActionsToQuery</em> and <em>rgdwQueryResult</em> parameters.</p>
<!-- raw HTML omitted -->
<p><em>rgbstrActionsToQuery[]</em> [in]</p>
<!-- raw HTML omitted -->
<p>Array of one or more rights for which to query. This array must contain as many elements as specified by <em>cActionsToQuery</em>. Each element must be set to one of the following constants:</p>
<table>
<thead>
<tr>
<th>Constant</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>g_wszWMDRM_ActionAllowed_Playback</td>
<td>Include to query for the right to play the content.</td>
</tr>
<tr>
<td>g_wszWMDRM_ActionAllowed_Copy</td>
<td>Include to query for the right to copy the content to external devices or media.</td>
</tr>
<tr>
<td>g_wszWMDRM_ActionAllowed_PlaylistBurn</td>
<td>Include to query for the right to copy the content to CD as part of a playlist.</td>
</tr>
<tr>
<td>g_wszWMDRM_ActionAllowed_CreateThumbnailImage</td>
<td>Include to query for the right to create a thumbnail image from the content.</td>
</tr>
<tr>
<td>g_wszWMDRM_ActionAllowed_CopyToCD</td>
<td>Include to query for the right to copy the content to CD.</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p><em>rgdwQueryResult[]</em> [out]</p>
<!-- raw HTML omitted -->
<p>Array of one or more DWORD variables that receive the results of the query for the rights specified by <em>rgbstrActionsToQuery</em>. If an action is allowed, the corresponding element is set to zero. If an action is not allowed, the element is set to one or more values of the <a href="drm-action-allowed-query-results.html"><strong>DRM_ACTION_ALLOWED_QUERY_RESULTS</strong></a> enumeration combined by using the bitwise OR operation. This array must contain as many elements as specified by <em>cActionsToQuery</em>.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>The method returns an <strong>HRESULT</strong>. Possible values include, but are not limited to, those in the following table.</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>S_OK</strong><!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The method succeeded.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>When querying for play and copy rights, you will get more accurate results by first setting environmental parameters. Use the <a href="iwmdrmlicensequery-setactionallowedqueryparams.html"><strong>SetActionAllowedQueryParams</strong></a> method to set the environmental parameters. The results of queries for the burn right are unaffected by the environmental parameters; you can safely use the defaults.</p>
<p>The results returned by the <strong>QueryActionAllowed</strong> method are aggregated from zero or more licenses in the local license store. The method may not search all of the licenses that apply to the Key ID if it encounters an enabled result.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wmdrmsdk.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wmdrmsdk.lib<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="iwmdrmlicensequery.html"><strong>IWMDRMLicenseQuery Interface</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="querying-for-simple-rights-information.html"><strong>Querying for Simple Rights Information</strong></a></p>
<!-- raw HTML omitted -->
</body>
