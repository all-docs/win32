<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>RtlSetImageMitigationPolicy</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: RtlSetImageMitigationPolicy
description: Sets the specified mitigation policy for specified image.
ms.keywords: RtlSetImageMitigationPolicy
topic_type:</p>
<ul>
<li>apiref
api_name:</li>
<li>RtlSetImageMitigationPolicy
api_location:</li>
<li>ntdll.dll
api_type:</li>
<li>DllExport
ms.topic: reference
ms.date: 03/12/2024</li>
</ul>
<hr />
<h1>RtlSetImageMitigationPolicy</h1>
<p>Sets the specified mitigation policy for the specified image.</p>
<pre lang="C++"><code>NTSYSAPI NTSTATUS NTAPI RtlSetImageMitigationPolicy(
    _In_opt_ PCWSTR ImagePathName,
    _In_ IMAGE_MITIGATION_POLICY MitigationPolicy,
    _In_ ULONG Flags,
    _In_reads_bytes_opt_(BufferSize) PVOID Buffer,
    _In_ ULONG BufferSize
    )
</code></pre>
<h2>Parameters</h2>
<h3>ImagePathName</h3>
<p>The name of the image on which mitigation policy is set. If <em>ImagePathName</em> is NULL, the system mitigation policy is being set.</p>
<h3>MitigationPolicy</h3>
<p>The mitigation policy that is to be set. This parameter supports the following enumeration values:</p>
<table>
<thead>
<tr>
<th>Field name</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ImageUserShadowStackPolicy</td>
<td>15</td>
<td>The policy regarding user-mode, hardware-enforced, stack protection for the process. The <a href="/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessmitigationpolicy">SetProcessMitigationPolicy</a> function sets the policy flags for user-mode, hardware-enforced, stack protection when a <a href="/windows/win32/api/winnt/ns-winnt-process_mitigation_user_shadow_stack_policy">PROCESS_MITIGATION_USER_SHADOW_STACK_POLICY</a> structure is provided.</td>
</tr>
</tbody>
</table>
<h3>Flags</h3>
<p>Flags that control the behavior of the set operation. Supported flags for this parameter include:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MITIGATION_POLICY_FLAG_RESET_VALUE</td>
<td>0x0</td>
<td>Resets the policy value to the default for the system</td>
</tr>
<tr>
<td>MITIGATION_POLICY_FLAG_USE_AUDIT_POLICY</td>
<td>0x8</td>
<td>Used to get/set the audit policy for the given mitigation</td>
</tr>
</tbody>
</table>
<h3>Buffer</h3>
<p>A pointer to the buffer that holds the policy data.</p>
<h3>BufferSize</h3>
<p>The length in bytes of the buffer provided in <em>Buffer</em>.</p>
<h2>Return value</h2>
<p>Returns an  NTSTATUS success or error code.</p>
<h2>Remarks</h2>
<p>This API is not defined in a Windows SDK header file and must be manually declared. The API is exported from ntdll.dll.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client</td>
<td>WindowsÂ 10, version 1709</td>
</tr>
<tr>
<td>DLL</td>
<td>Ntdll.dll</td>
</tr>
</tbody>
</table>
<h2>See also</h2>
</body>
