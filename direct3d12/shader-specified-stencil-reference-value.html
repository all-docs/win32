<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Shader Specified Stencil Reference Value (Direct3D 12 Graphics)</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: Shader Specified Stencil Reference Value (Direct3D 12 Graphics)
description: Learn about Stencil Reference Value in Direct3D 12 Graphics. Enabling pixel shaders to use Stencil Reference Value enables fine control over stencil operations.
ms.assetid: F58B1930-F12E-4FA4-A15C-A3C2B8705033
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Shader Specified Stencil Reference Value (Direct3D 12 Graphics)</h1>
<p>Enabling pixel shaders to output the Stencil Reference Value, rather than using the API-specified one, enables a very fine granular control over stencil operations.</p>
<p>The Stencil Reference Value is normally specified by the <a href="/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-omsetstencilref"><strong>ID3D12GraphicsCommandList::OMSetStencilRef</strong></a> method. This method sets the stencil reference value on a per-draw granularity. However, this value can be overwritten by the pixel shader.</p>
<p>This D3D12 (and D3D11.3) feature enables developers to read and use the Stencil Reference Value (<em>SV_StencilRef</em>) that is output from a pixel shader, enabling a per-pixel or per-sample granularity.</p>
<p>The shader specified value replaces the API-specified reference value for that invocation, which means the change affects both the stencil test, and when the stencil operation D3D12_STENCIL_OP_REPLACE (one member of <a href="/windows/desktop/api/d3d12/ne-d3d12-d3d12_stencil_op"><strong>D3D12_STENCIL_OP</strong></a>) is used to write the reference value to the stencil buffer.</p>
<p>This feature is optional in both D3D12 and D3D11.3. To test for its support, check the <em>PSSpecifiedStencilRefSupported</em> boolean field of <a href="/windows/desktop/api/d3d12/ns-d3d12-d3d12_feature_data_d3d12_options"><strong>D3D12_FEATURE_DATA_D3D12_OPTIONS</strong></a> using <a href="/windows/desktop/api/d3d12/nf-d3d12-id3d12device-checkfeaturesupport"><strong>CheckFeatureSupport</strong></a>.</p>
<p>Here is an example of the use of <em>SV_StencilRef</em> in a pixel shader:</p>
<pre lang="syntax"><code>uint main2(float4 c : COORD) : SV_StencilRef
{
    return uint(c.x);
}
</code></pre>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="rendering.html">Rendering</a></p>
<!-- raw HTML omitted -->
<p><a href="resource-binding-in-hlsl.html">Resource Binding in HLSL</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/direct3dhlsl/shader-model-5-1">Shader Model 5.1</a></p>
<!-- raw HTML omitted -->
<p><a href="specifying-root-signatures-in-hlsl.html">Specifying Root Signatures in HLSL</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
