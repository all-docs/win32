<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Open and Save As dialog boxes</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: Open and Save As dialog boxes
description: Learn to display custom Open and Save As dialog boxes in your legacy Windows app
ms.assetid: 5676ca9d-daca-40bf-8881-def2ff841c58
ms.topic: article
ms.date: 01/10/2022
ms.custom: project-verbatim</h2>
<h1>Open and Save As dialog boxes</h1>
<blockquote>
<p>[!NOTE]
The <a href="/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea"><strong>GetOpenFileName</strong></a> function is demonstrated in the <a href="https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse">File is in use sample</a>.</p>
</blockquote>
<p>[Starting with WindowsÂ Vista, the <strong>Open</strong> and <strong>Save As</strong> common dialog boxes have been superseded by the <a href="../shell/common-file-dialog.html">Common Item Dialog</a>. We recommended that you use the Common Item Dialog API instead of these dialog boxes from the Common Dialog Box Library.]</p>
<p>The <strong>Open</strong> dialog box lets the user specify the drive, directory, and the name of a file or set of files to open. You create and display an <strong>Open</strong> dialog box by initializing an <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure and passing the structure to the <a href="/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea"><strong>GetOpenFileName</strong></a> function.</p>
<p>The <strong>Save As</strong> dialog box lets the user specify the drive, directory, and name of a file to save. You create and display a <strong>Save As</strong> dialog box by initializing an <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure and passing the structure to the <a href="/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea"><strong>GetSaveFileName</strong></a> function.</p>
<p>Explorer-style <strong>Open</strong> and <strong>Save As</strong> dialog boxes provide user-interface features that are similar to the Windows Explorer. However, the system continues to support old-style <strong>Open</strong> and <strong>Save As</strong> dialog boxes for applications that must be consistent with the old-style user interface.</p>
<p>In addition to the difference in appearance, the Explorer-style and old-style dialog boxes differ in their use of custom templates and hook procedures for customizing the dialog boxes. However, the Explorer-style and old-style dialog boxes have the same behavior for most basic operations, such as specifying a file name filter, validating the user's input, and getting the file name specified by the user. For more information about the Explorer-style and old-style dialog boxes, see <a href="#open-and-save-as-dialog-box-customization">Open and Save As Dialog Box Customization</a>.</p>
<p>The following illustration shows a typical Explorer-style <strong>Open</strong> dialog box.</p>
<p><img src="images/opendialogboxxp.png" alt="open file dialog box" /></p>
<p>The following illustration shows a typical Explorer-style <strong>Save As</strong> dialog box.</p>
<p><img src="images/saveasdialogboxxp.png" alt="save file dialog box" /></p>
<p>If the user specifies a file name and clicks the <strong>OK</strong> button, <a href="/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea"><strong>GetOpenFileName</strong></a> or <a href="/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea"><strong>GetSaveFileName</strong></a> returns <strong>TRUE</strong>. The buffer pointed to by the <strong>lpstrFile</strong> member of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure contains the full path and file name specified by the user.</p>
<p>If the user cancels the <strong>Open</strong> or <strong>Save As</strong> dialog box or an error occurs, the function returns <strong>FALSE</strong>. To determine the cause of the error, call the <a href="/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror"><strong>CommDlgExtendedError</strong></a> function to retrieve the extended error value. If the <strong>lpstrFile</strong> buffer is too small to receive the full name, <strong>CommDlgExtendedError</strong> returns <strong>FNERR_BUFFERTOOSMALL</strong> and the first 2 bytes of the buffer pointed to by the <strong>lpstrFile</strong> member are set to an integer value specifying the size required to receive the full name.</p>
<p>The following topics are discussed in this section.</p>
<ul>
<li><a href="#file-names-and-directories">File Names and Directories</a></li>
<li><a href="#filters">Filters</a></li>
<li><a href="#file-and-directory-validation">File and Directory Validation</a></li>
<li><a href="#open-and-save-as-dialog-box-customization">Open and Save As Dialog Box Customization</a></li>
<li><a href="#explorer-style-hook-procedures">Explorer-Style Hook Procedures</a></li>
<li><a href="#explorer-style-custom-templates">Explorer-Style Custom Templates</a></li>
<li><a href="#explorer-style-control-identifiers">Explorer-Style Control Identifiers</a></li>
<li><a href="#customizing-old-style-dialog-boxes">Customizing Old-Style Dialog Boxes</a></li>
</ul>
<h2>File Names and Directories</h2>
<p>The information in this section applies to both Explorer-style and old-style <strong>Open</strong> and <strong>Save As</strong> dialog boxes.</p>
<p>Before calling the <a href="/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea"><strong>GetOpenFileName</strong></a> or <a href="/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea"><strong>GetSaveFileName</strong></a> functions, the <strong>lpstrFile</strong> member of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure must point to the buffer to receive the file name. The <strong>nMaxFile</strong> member must specify the size, in characters, of the <strong>lpstrFile</strong> buffer. For an ANSI function this is the number of bytes, but for a Unicode function this is the number of characters.</p>
<p>If the user specifies a file name and clicks the <strong>OK</strong> button, the dialog box copies the selected drive, directory, and file name to the <strong>lpstrFile</strong> buffer. The function also sets the <strong>nFileOffset</strong> and <strong>nFileExtension</strong> members to the offsets, in characters, from the start of the buffer to the file name and to the file name extension, respectively.</p>
<p>To retrieve just the file name and extension, set the <strong>lpstrFileTitle</strong> member to point to a buffer and set the <strong>nMaxFileTitle</strong> member to the size, in characters, of the buffer. Alternatively, you can pass the <strong>lpstrFile</strong> buffer in a call to the <a href="/windows/desktop/api/Commdlg/nf-commdlg-getfiletitlea"><strong>GetFileTitle</strong></a> function to get the display name of the selected file. Note, however, that the file name that <strong>GetFileTitle</strong> returns includes an extension only if that is the user's preference for displaying file names.</p>
<p>The dialog box uses the current directory for the calling process as the initial directory from which to display files and directories. Use the <a href="/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory"><strong>GetCurrentDirectory</strong></a> and <a href="/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory"><strong>SetCurrentDirectory</strong></a> functions to get and change the current directory of a process. To specify a different initial directory without changing your current directory, use the <strong>lpstrInitialDir</strong> member to specify the name of a directory. The dialog box automatically changes your current directory when the user selects a different drive or directory. To prevent the dialog box from changing your current directory, set the <strong>OFN_NOCHANGEDIR</strong> flag. This flag does not prevent the user from changing directories to find a file.</p>
<p>To specify a default file name extension, use the <strong>lpstrDefExt</strong> member. If the user specifies a file name that does not have an extension, the dialog box adds your default extension. If you specify a default extension and the user specifies a file name with a different extension, the dialog box sets the <strong>OFN_EXTENSIONDIFFERENT</strong> flag.</p>
<p>To let the user select more than one file from a directory, set the <strong>OFN_ALLOWMULTISELECT</strong> flag. For compatibility with older applications, the default multiple selection dialog box uses the old-style user interface. To display an Explorer-style multiple selection dialog box, you must also set the <strong>OFN_EXPLORER</strong> flag.</p>
<p>If the user selects more than one file, the buffer pointed to by the <strong>lpstrFile</strong> member returns the path to the current directory followed by the file names of the selected files. The <strong>nFileOffset</strong> member is the offset to the first file name, and the <strong>nFileExtension</strong> member is not used. The following table describes the difference between Explorer-style and old-style dialog boxes in returning multiple file names.</p>
<table>
<thead>
<tr>
<th>Dialog box style</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Explorer-style dialog boxes</td>
<td>The directory and file name strings are <strong>NULL</strong> separated, with an extra <strong>NULL</strong> character after the last file name. This format enables the Explorer-style dialog boxes to return long file names that include spaces.</td>
</tr>
<tr>
<td>Old-style dialog boxes</td>
<td>The directory and file name strings are separated by spaces. For file names with spaces, the function uses short file names.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>You can use the <a href="/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea"><strong>FindFirstFile</strong></a> function to convert between long and short file names.</p>
<p>If you specify <strong>OFN_ALLOWMULTISELECT</strong> and the user selects only one file, the <strong>lpstrFile</strong> string does not have a separator between the path and file name.</p>
<h2>Filters</h2>
<p>The information in this section applies to both Explorer-style and old style <strong>Open</strong> and <strong>Save As</strong> dialog boxes.</p>
<p>You can provide file name filters to assist the user in limiting the file names that the dialog box displays. A file name filter consists of a pair of null-terminated strings, a description and a pattern, one concatenated to the other. The dialog box displays the description to let the user pick which filter to use; and it uses the pattern to select the files to display.</p>
<p>To specify the filters, set the <strong>lpstrFilter</strong> member of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure to point to a buffer that contains an array of filter string pairs. The last string in the array must be followed by an extra null character.</p>
<p>A pattern string can be a combination of valid file name characters and the asterisk (*). The asterisk is a wildcard that represents any combination of valid file name characters. The dialog box displays only those files that match the pattern. To specify multiple patterns for the same description, you must use a semicolon (;) to separate the patterns. Note that space characters in the pattern string can produce unexpected results.</p>
<p>The following code fragment specifies two filters. The filter with the &quot;Source&quot; description has two patterns. If the user selects this filter, the dialog box displays only files that have the .C and .CXX extensions. Note, in the C programming language, a string enclosed in double quotes is null-terminated.</p>
<pre><code>OPENFILENAME ofn;       // common dialog box structure

ofn.lpstrFilter = &quot;Source\0*.C;*.CXX\0All\0*.*\0&quot;
ofn.nFilterIndex = 1;
</code></pre>
<p>The <strong>nFilterIndex</strong> member of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure specifies an index that indicates which filter the dialog box initially uses. The first filter in the buffer has index 1, the second 2, and so on. If the user changes the filter while using the dialog box, the <strong>nFilterIndex</strong> member is set to the index of the selected filter on return.</p>
<p>You can create a custom filter by setting the <strong>lpstrCustomFilter</strong> member to the address of a buffer that contains a single filter, and by setting the <strong>nMaxCustFilter</strong> member to the size of the buffer, in characters or bytes. The dialog box always places the custom filter at the beginning of the list of filters and, on return, always updates the pattern part of the filter with the pattern from the filter selected by the user.</p>
<p>For Explorer-style dialog boxes, the default extension may change if the user selects a different filter. If the user selects a filter whose first pattern is of the form *.<em>xxx</em> (that is, the extension does not include a wildcard character), the dialog box uses <em>xxx</em> as the default extension. This occurs only if you specified a default extension in the <strong>lpstrDefExt</strong> member of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure. For example, if the user selects the &quot;Source\0*.C;*.CXX\0&quot; filter, the default extension changes to &quot;C&quot;. However, if you had defined the filter as &quot;Source\0*.C*\0&quot;, the default extension would not change because the extension includes a wildcard.</p>
<p>The <a href="cdn-includeitem.html"><strong>CDN_INCLUDEITEM</strong></a> notification message provides another way to filter the names that the dialog box displays. To use this message, provide an <a href="/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc"><strong>OFNHookProc</strong></a> hook procedure and specify the <strong>OFN_ENABLEINCLUDENOTIFY</strong> flag in the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure when you create the dialog box. Each time the user opens a folder, the dialog box sends a <strong>CDN_INCLUDEITEM</strong> notification to your hook procedure for each item in the newly opened folder. The return value of the hook procedure indicates whether the dialog box should display the item in the folder's item list.</p>
<h2>File and Directory Validation</h2>
<p>Except as noted, the information in this section applies to both Explorer-style and old-style <strong>Open</strong> and <strong>Save As</strong> dialog boxes.</p>
<p>The dialog box automatically validates file names typed by the user to ensure that the names contain only valid characters. To override the file name character validation, set the <strong>OFN_NOVALIDATE</strong> flag.</p>
<p>To force the dialog box to verify that the user specified the name of an existing file, set the <strong>OFN_FILEMUSTEXIST</strong> flag. To force verification that the specified path exists, set the <strong>OFN_PATHMUSTEXIST</strong> flag. If you set the <strong>OFN_CREATEPROMPT</strong> flag, the dialog box prompts the user for permission to create a nonexistent file. If this flag is set and the user chooses to create a new file, the dialog box closes, and the function returns the specified name. Otherwise, the dialog box remains open.</p>
<p>When using the <strong>Save As</strong> dialog box, you can direct the dialog box to prompt the user for permission to overwrite an existing file by setting the <strong>OFN_OVERWRITEPROMPT</strong> flag.</p>
<p>By default, the dialog box creates a zero-length test file to determine whether a new file can be created in the selected directory. To prevent the creation of this test file, set the <strong>OFN_NOTESTFILECREATE</strong> flag.</p>
<p>If you enable a hook procedure, the dialog box notifies your hook procedure when a network sharing violation occurs for the file name specified by the user. If you set the <strong>OFN_EXPLORER</strong> flag, the dialog box sends the <a href="cdn-shareviolation.html"><strong>CDN_SHAREVIOLATION</strong></a> message to the hook procedure. If you do not set <strong>OFN_EXPLORER</strong>, the dialog box sends the <a href="sharevistring.html"><strong>SHAREVISTRING</strong></a> registered message to the hook procedure. To prevent the dialog box from sending any notifications for sharing violations, set the <strong>OFN_SHAREAWARE</strong> flag.</p>
<p>If the user selects the read-only check box, the dialog box sets the <strong>OFN_READONLY</strong> flag on return. To hide the <strong>Open As Read Only</strong> check box, set the <strong>OFN_HIDEREADONLY</strong> flag. To prevent the dialog box from returning names of existing files that have the read-only attribute, set the <strong>OFN_NOREADONLYRETURN</strong> flag.</p>
<p>To prevent the dialog box from dereferencing link files, set the <strong>OFN_NODEREFERENCELINKS</strong> value. In this case, the dialog box returns the name of the link file rather than the name of the file referenced by the link file.</p>
<h2>Open and Save As Dialog Box Customization</h2>
<p>You can customize an <strong>Open</strong> or <strong>Save As</strong> dialog box by providing a hook procedure, a custom template, or both. However, the Explorer-style and old-style versions of the dialog boxes differ in their use of custom templates and hook procedures.</p>
<p>For information about customizing an Explorer-style dialog box, see <a href="#explorer-style-hook-procedures">Explorer-Style Hook Procedures</a>, <a href="#explorer-style-custom-templates">Explorer-Style Custom Templates</a>, and <a href="#explorer-style-control-identifiers">Explorer-Style Control Identifiers</a>. For information about customizing an old-style dialog box, see <a href="#customizing-old-style-dialog-boxes">Customizing Old-Style Dialog Boxes</a>.</p>
<p>The following table summarizes the differences between the two styles.</p>
<table>
<thead>
<tr>
<th>Customization</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Explorer-style Hook procedure</td>
<td>The hook procedure receives notification messages sent from the common dialog box and messages for any additional controls that you defined by specifying a child dialog template. The hook procedure does not receive messages for the standard controls of the default dialog box.</td>
</tr>
<tr>
<td>Explorer-style Custom template</td>
<td>The system uses the custom template to create a child dialog box. The template can define additional controls, and can specify the location of the cluster of standard controls. The custom template does not replace the default template.</td>
</tr>
<tr>
<td>Old-style Hook procedure</td>
<td>The hook procedure receives all messages sent to the dialog box, including messages for the standard controls and any custom controls. The hook procedure also receives registered messages sent from the common dialog box.</td>
</tr>
<tr>
<td>Old-style Custom template</td>
<td>The custom template replaces the default template. Create the custom template by modifying the default template specified in the Fileopen.dlg file.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>The default title for both Explorer-style and old-style dialog boxes is either &quot;<strong>Open</strong>&quot; or &quot;<strong>Save As</strong>.&quot; To change the title, specify the new title in the <strong>lpstrTitle</strong> member of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure.</p>
<p>A user's <strong>HKEY_CURRENT_USER</strong> registry hive can contain values that customize the contents of the Explorer-style <strong>Open</strong> and <strong>Save As</strong> dialog boxes. These registry entries affect only the dialog boxes displayed for the user associated with the registry hive.</p>
<p>To hide features of Explorer-style <strong>Open</strong> and <strong>Save As</strong> dialog boxes, an administrator can set the values in the following table under this subkey:</p>
<pre><code>HKEY_CURRENT_USER
Â Â Â Software
Â Â Â Â Â Â Microsoft
Â Â Â Â Â Â Â Â Â Windows
Â Â Â Â Â Â Â Â Â Â Â Â CurrentVersion
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Policies
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Comdlg32
</code></pre>
<table>
<thead>
<tr>
<th>Value name</th>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>NoPlacesBar</strong></td>
<td>1</td>
<td>Hides the places bar.</td>
</tr>
<tr>
<td><strong>NoFileMRU</strong></td>
<td>1</td>
<td>Hides the Most Recently Used (MRU) list.</td>
</tr>
<tr>
<td><strong>NoBackButton</strong></td>
<td>1</td>
<td>Hides the <strong>Back</strong> button.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>The contents of the <strong>Places</strong> bar are determined by the contents of the following subkey:</p>
<pre><code>HKEY_CURRENT_USER
Â Â Â Software
Â Â Â Â Â Â Microsoft
Â Â Â Â Â Â Â Â Â Windows
Â Â Â Â Â Â Â Â Â Â Â Â CurrentVersion
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Policies
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Comdlg32
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Placesbar
</code></pre>
<p>Currently, there can only be five entries under this key, and the value/name index is zero-based. The names for the entries should be Place0, Place1, Place2,Place3, and Place4. The values of the entries can be <strong>REG_DWORD</strong>, <strong>REG_SZ</strong>, or <strong>REG_EXPAND_SZ</strong> values that identify locations to include in the places bar.</p>
<table>
<thead>
<tr>
<th>Value type</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>REG_DWORD</strong></td>
<td>A CSIDL value that identifies a folder. For a list of CSIDL values, see <a href="../shell/csidl.html"><strong>CSIDL values</strong></a>.</td>
</tr>
<tr>
<td><strong>REG_SZ</strong> or <strong>REG_EXPAND_SZ</strong></td>
<td>A null-terminated string that specifies a valid path.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Explorer-Style Hook Procedures</h2>
<p>You can customize an Explorer-style <strong>Open</strong> or <strong>Save As</strong> dialog box by providing a hook procedure, a custom template, or both. If you provide a hook procedure for an Explorer-style dialog box, the system creates a dialog box that is a child of the default dialog box. The hook procedure acts as the dialog procedure for the child dialog box. This child dialog box is based on the custom template, or on a default template if none is provided. For more information, see <a href="#explorer-style-custom-templates">Explorer-Style Custom Templates</a>.</p>
<p>To enable a hook procedure for an Explorer-style <strong>Open</strong> or <strong>Save As</strong> dialog box, use the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure when you create the dialog box. Set the <strong>OFN_ENABLEHOOK</strong> and <strong>OFN_EXPLORER</strong> flags in the <strong>Flags</strong> member and specify the address of an <a href="/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc"><strong>OFNHookProc</strong></a> hook procedure in the <strong>lpfnHook</strong> member. If you provide a hook procedure and omit the <strong>OFN_EXPLORER</strong> flag, you must use an <a href="/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)"><strong>OFNHookProcOldStyle</strong></a> hook procedure and you will get the old-style user-interface. For more information, see <a href="#customizing-old-style-dialog-boxes">Customizing Old-Style Dialog Boxes</a>.</p>
<p>An Explorer-style hook procedure receives a variety of messages while the dialog box is open. These include the following:</p>
<ul>
<li>The <a href="wm-initdialog.html"><strong>WM_INITDIALOG</strong></a> message and other standard dialog box messages such as the <a href="wm-ctlcolordlg.html"><strong>WM_CTLCOLORDLG</strong></a> control color message.</li>
<li>A set of <a href="../controls/wm-notify.html"><strong>WM_NOTIFY</strong></a> notification messages indicating actions taken by the user or other dialog box events.</li>
<li>Messages for any additional controls that you defined by specifying a child dialog template.</li>
</ul>
<p>In addition, there is a set of messages that you can send to an Explorer-style dialog box to get information or to control the behavior and appearance of the dialog box.</p>
<p>If you provide a hook procedure for an Explorer-style dialog box, the default dialog box procedure creates a child dialog box when the default dialog procedure is processing its <a href="wm-initdialog.html"><strong>WM_INITDIALOG</strong></a> message. The hook procedure acts as the dialog procedure for the child dialog box. At this time, the hook procedure receives its own <strong>WM_INITDIALOG</strong> message with the <em>lParam</em> parameter set to the address of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure used to initialize the dialog box. After the child dialog finishes processing its own <strong>WM_INITDIALOG</strong> message, the default dialog procedure moves the standard controls, if necessary, to make room for any additional controls of the child dialog box. The default dialog procedure then sends the <a href="cdn-initdone.html"><strong>CDN_INITDONE</strong></a> notification message to the hook procedure.</p>
<p>The hook procedure receives <a href="../controls/wm-notify.html"><strong>WM_NOTIFY</strong></a> notification messages indicating actions taken by the user in the dialog box. You can use some of these messages to control the behavior of the dialog box. For example, the hook procedure receives the <a href="cdn-fileok.html"><strong>CDN_FILEOK</strong></a> message when the user chooses a file name and clicks the <strong>OK</strong> button. In response to this message, the hook procedure can use the <a href="/windows/desktop/api/winuser/nf-winuser-setwindowlonga"><strong>SetWindowLong</strong></a> function to reject the selected name and force the dialog box to remain open.</p>
<p>The <em>lParam</em> parameter for each <a href="../controls/wm-notify.html"><strong>WM_NOTIFY</strong></a> message is a pointer to an <a href="/windows/desktop/api/Commdlg/ns-commdlg-ofnotifya"><strong>OFNOTIFY</strong></a> or <a href="/windows/desktop/api/Commdlg/ns-commdlg-ofnotifyexa"><strong>OFNOTIFYEX</strong></a> structure that defines the action. The <strong>code</strong> member in the header of this structure contains one of the following notification messages.</p>
<table>
<thead>
<tr>
<th>Message</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="cdn-fileok.html"><strong>CDN_FILEOK</strong></a></td>
<td>The user clicked the <strong>OK</strong> button; the dialog box is about to close.</td>
</tr>
<tr>
<td><a href="cdn-folderchange.html"><strong>CDN_FOLDERCHANGE</strong></a></td>
<td>The user opened a new folder or directory.</td>
</tr>
<tr>
<td><a href="cdn-help.html"><strong>CDN_HELP</strong></a></td>
<td>The user clicked the <strong>Help</strong> button.</td>
</tr>
<tr>
<td><a href="cdn-includeitem.html"><strong>CDN_INCLUDEITEM</strong></a></td>
<td>Determines whether an item should be displayed. When the user opens a new folder or directory, the system sends this notification for each item in the folder or directory. The system sends this notification only if the <strong>OFN_ENABLEINCLUDENOTIFY</strong> flag was set.</td>
</tr>
<tr>
<td><a href="cdn-initdone.html"><strong>CDN_INITDONE</strong></a></td>
<td>The system has finished initializing the dialog box, and the dialog box has finished processing the <a href="wm-initdialog.html"><strong>WM_INITDIALOG</strong></a> message. Also, the system has finished arranging controls in the common dialog box to make room for the controls of the child dialog box (if any).</td>
</tr>
<tr>
<td><a href="cdn-selchange.html"><strong>CDN_SELCHANGE</strong></a></td>
<td>The user selected a new file or folder from the file list.</td>
</tr>
<tr>
<td><a href="cdn-shareviolation.html"><strong>CDN_SHAREVIOLATION</strong></a></td>
<td>The common dialog box encountered a sharing violation on the file about to be returned.</td>
</tr>
<tr>
<td><a href="cdn-typechange.html"><strong>CDN_TYPECHANGE</strong></a></td>
<td>The user selected a new file type from the list of file types.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>These <a href="../controls/wm-notify.html"><strong>WM_NOTIFY</strong></a> messages supersede the <a href="fileokstring.html"><strong>FILEOKSTRING</strong></a>, <a href="lbselchstring.html"><strong>LBSELCHSTRING</strong></a>, <a href="sharevistring.html"><strong>SHAREVISTRING</strong></a>, and <a href="helpmsgstring.html"><strong>HELPMSGSTRING</strong></a> registered messages used by previous versions of the <strong>Open</strong> and <strong>Save As</strong> dialog boxes. However, the hook procedure also receives the superseded message after the <strong>WM_NOTIFY</strong> message if the <strong>WM_NOTIFY</strong> processing does not use <a href="/windows/desktop/api/winuser/nf-winuser-setwindowlonga"><strong>SetWindowLong</strong></a> to set a nonzero <strong>DWL_MSGRESULT</strong> value.</p>
<p>To retrieve information about the status of the dialog box or to control the behavior and appearance of the dialog box, the hook procedure can send the following messages to the dialog box.</p>
<table>
<thead>
<tr>
<th>Message</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="cdm-getfilepath.html"><strong>CDM_GETFILEPATH</strong></a></td>
<td>Retrieves the path and file name of the selected file.</td>
</tr>
<tr>
<td><a href="cdm-getfolderidlist.html"><strong>CDM_GETFOLDERIDLIST</strong></a></td>
<td>Retrieves the item identifier list corresponding to the current folder that the dialog box has open. For more information about item identifier lists, see <a href="/windows/desktop/shell/namespace-intro">Introduction to the Shell Namespace</a>.</td>
</tr>
<tr>
<td><a href="cdm-getfolderpath.html"><strong>CDM_GETFOLDERPATH</strong></a></td>
<td>Retrieves the path of the current folder or directory for the dialog box.</td>
</tr>
<tr>
<td><a href="cdm-getspec.html"><strong>CDM_GETSPEC</strong></a></td>
<td>Retrieves the file name (not including the path) of the file currently selected in the dialog box.</td>
</tr>
<tr>
<td><a href="cdm-hidecontrol.html"><strong>CDM_HIDECONTROL</strong></a></td>
<td>Hides the specified control.</td>
</tr>
<tr>
<td><a href="cdm-setcontroltext.html"><strong>CDM_SETCONTROLTEXT</strong></a></td>
<td>Sets the text in the specified control.</td>
</tr>
<tr>
<td><a href="cdm-setdefext.html"><strong>CDM_SETDEFEXT</strong></a></td>
<td>Sets the default file name extension for the dialog box.</td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Explorer-Style Custom Templates</h2>
<p>To define additional controls for an Explorer-style <strong>Open</strong> or <strong>Save As</strong> dialog box, use the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure to specify a template for a child dialog box that contains the additional controls. If your child dialog template is a resource in an application or dynamic-link library, set the <strong>OFN_ENABLETEMPLATE</strong> flag in the <strong>Flags</strong> member and use the <strong>hInstance</strong> and <strong>lpTemplateName</strong> members of the structure to identify the module and resource name. If the template is already in memory, set the <strong>OFN_ENABLETEMPLATEHANDLE</strong> flag and use the <strong>hInstance</strong> member to identify the memory object that contains the template. When providing a child dialog template for an Explorer-style dialog box, you must also set the <strong>OFN_EXPLORER</strong> flag; otherwise, the system assumes you are providing a replacement template for an old-style dialog box. Typically, if you provide additional controls, you must also provide an <a href="#explorer-style-hook-procedures">Explorer-style hook procedure</a> to process messages for the new controls.</p>
<p>You can create your child dialog box template as you do any other template, except that you must specify the <strong>WS_CHILD</strong> and <strong>WS_CLIPSIBLINGS</strong> styles and should specify the <strong>DS_3DLOOK</strong> and <strong>DS_CONTROL</strong> styles. The system requires the <strong>WS_CHILD</strong> style because your template defines a child dialog of the default <strong>Open</strong> or <strong>Save As</strong> dialog box. The <strong>WS_CLIPSIBLINGS</strong> style ensures that the child dialog box does not paint over any of the controls in the default dialog box. The <strong>DS_3DLOOK</strong> style makes sure that the appearance of the controls in the child dialog box is consistent with the controls in the default dialog box. The <strong>DS_CONTROL</strong> style makes sure that the user can use the TAB and other navigation keys to move between all controls, default or custom, in the customized dialog box.</p>
<p>To make room for the new controls, the system expands the default dialog box by the width and height of the custom dialog box. By default, all controls from the custom dialog box are positioned below the controls in the default dialog box. However, you can override this default positioning by including a static text control in your custom dialog box template and assigning it the control identifier value of <strong>stc32</strong>. (This value is defined in the Dlgs.h header file.) In this case, the system uses the control as the point of reference for determining where to position the new controls. All new controls above and to the left of the <strong>stc32</strong> control are positioned the same amount above and to the left of the controls in the default dialog box. New controls below and to the right of the <strong>stc32</strong> control are positioned below and to the right of the default controls. In general, each new control is positioned so that it has the same position relative to the default controls as it had to the <strong>stc32</strong> control. To make room for these new controls, the system adds space to the left, right, bottom, and top of the default dialog box as needed.</p>
<p>The system requires the hook procedure to process all messages intended for the custom dialog box and therefore sends the same window messages to the hook procedure as to any other dialog box procedure. For example, the hook procedure receives <a href="/windows/desktop/menurc/wm-command"><strong>WM_COMMAND</strong></a> messages when the user clicks on button controls in the custom dialog box. The hook procedure is responsible for initializing these controls and retrieving values from the controls when the dialog box is closed. Note that when the hook procedure receives the <a href="wm-initdialog.html"><strong>WM_INITDIALOG</strong></a> message, the system has not yet moved the controls to their final positions.</p>
<p>The default dialog box procedure handles messages for all the controls in the default dialog box, but the hook procedure receives the notification messages for user actions on these controls as described in <a href="#explorer-style-hook-procedures">Explorer-Style Hook Procedures</a>.</p>
<h2>Explorer-Style Control Identifiers</h2>
<p>The Windows Software Development Kit (SDK) provides the default dialog box template for the old-style dialog boxes, but does not include the default template for the Explorer-style dialog boxes. This is because the Explorer-style dialog boxes allow you to add your own controls but do not support modifying the template for the standard controls. However, in some cases, you may need to know the control identifiers used in the default templates. For example, the <a href="cdm-hidecontrol.html"><strong>CDM_HIDECONTROL</strong></a> and <a href="cdm-setcontroltext.html"><strong>CDM_SETCONTROLTEXT</strong></a> messages require a control identifier.</p>
<p>The following table shows the identifiers of the standard controls in the Explorer-style <strong>Open</strong> and <strong>Save As</strong> dialog boxes. The identifiers are constants defined in Dlgs.h and Winuser.h.</p>
<table>
<thead>
<tr>
<th>Control identifier</th>
<th>Control description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>chx1</strong></td>
<td>The read-only check box</td>
</tr>
<tr>
<td><strong>cmb1</strong></td>
<td>Drop-down combo box that displays the list of file type filters</td>
</tr>
<tr>
<td><strong>stc2</strong></td>
<td>Label for the <strong>cmb1</strong> combo box</td>
</tr>
<tr>
<td><strong>cmb2</strong></td>
<td>Drop-down combo box that displays the current drive or folder, and that allows the user to select a drive or folder to open</td>
</tr>
<tr>
<td><strong>stc4</strong></td>
<td>Label for the <strong>cmb2</strong> combo box</td>
</tr>
<tr>
<td><strong>cmb13</strong></td>
<td>Drop-down combo box that displays the name of the current file, allows the user to type the name of a file to open, and select a file that has been opened or saved recently. This is for earlier Explorer-compatible applications without hook or dialog template. Compare with <strong>edt1</strong>.</td>
</tr>
<tr>
<td><strong>edt1</strong></td>
<td>Edit control that displays the name of the current file, or allows the user to type the name of the file to open. Compare with <strong>cmb13</strong>.</td>
</tr>
<tr>
<td><strong>stc3</strong></td>
<td>Label for the <strong>cmb13</strong> combo box and the edt1 edit control</td>
</tr>
<tr>
<td><strong>lst1</strong></td>
<td>List box that displays the contents of the current drive or folder</td>
</tr>
<tr>
<td><strong>stc1</strong></td>
<td>Label for the <strong>lst1</strong> list box</td>
</tr>
<tr>
<td><strong>IDOK</strong></td>
<td>The <strong>OK</strong> command button (push button)</td>
</tr>
<tr>
<td><strong>IDCANCEL</strong></td>
<td>The <strong>Cancel</strong> command button (push button)</td>
</tr>
<tr>
<td><strong>pshHelp</strong></td>
<td>The <strong>Help</strong> command button (push button)</td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Customizing Old-Style Dialog Boxes</h2>
<p>You can customize an old-style <strong>Open</strong> or <strong>Save As</strong> dialog box by providing an <a href="/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)"><em>OFNHookProcOldStyle</em></a> hook procedure that receives messages or notifications intended for the default dialog box procedure. You can also provide a custom template to use in place of the default template. The hook procedures and templates used with the old-style dialog boxes are similar to those used with the other common dialog boxes. For more information, see <a href="customizing-common-dialog-boxes.html">Hook Procedures for Common Dialog Boxes</a> and <a href="customizing-common-dialog-boxes.html">Custom Templates</a>.</p>
<p>To enable a hook procedure for an old-style <strong>Open</strong> or <strong>Save As</strong> dialog box, use the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure when you create the dialog box. Set the <strong>OFN_ENABLEHOOK</strong> flag in the <strong>Flags</strong> member and specify the address of an <a href="/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)"><em>OFNHookProcOldStyle</em></a> hook procedure in the <strong>lpfnHook</strong> member. The dialog box procedure sends a <a href="wm-initdialog.html"><strong>WM_INITDIALOG</strong></a> message to the hook procedure with the <em>Param</em> parameter set to the address of the <strong>OPENFILENAME</strong> structure used to initialize the dialog box.</p>
<p>You can use the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure to specify a custom template for the <strong>Open</strong> or <strong>Save As</strong> dialog box to use in place of the default template. If your custom template is a resource in an application or dynamic-link library, set the <strong>OFN_ENABLETEMPLATE</strong> flag in the <strong>Flags</strong> member and use the <strong>hInstance</strong> and <strong>lpTemplateName</strong> members of the structure to identify the module and resource name. If your custom template is already in memory, set the <strong>OFN_ENABLETEMPLATEHANDLE</strong> flag and use the <strong>hInstance</strong> member to identify the memory object that contains the template. Create the custom template by modifying the default template specified in the Fileopen.dlg file. The control identifiers used in the default Find and Replace dialog templates are defined in the Dlgs.h file.</p>
<p>By default, the <a href="/windows/desktop/api/Commdlg/nf-commdlg-getopenfilenamea"><strong>GetOpenFileName</strong></a> and <a href="/windows/desktop/api/Commdlg/nf-commdlg-getsavefilenamea"><strong>GetSaveFileName</strong></a> functions display the Explorer-style dialog boxes. If you want to display an old-style dialog box, you must provide an <a href="/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)"><strong>OFNHookProcOldStyle</strong></a> hook procedure and ensure that the <strong>OFN_EXPLORER</strong> flag is not set in the <strong>Flags</strong> member of the <a href="/windows/win32/api/commdlg/ns-commdlg-openfilenamea"><strong>OPENFILENAME</strong></a> structure.</p>
<p>If you set the <strong>OFN_EXPLORER</strong> flag, the system treats a hook procedure or custom template as an Explorer-style customization. For information about customizing an Explorer-style dialog box, see <a href="#explorer-style-custom-templates">Explorer-Style Custom Templates</a>.</p>
<h2>See also</h2>
<ul>
<li><a href="https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/shell/appplatform/fileisinuse">File is in use sample</a></li>
</ul>
</body>
