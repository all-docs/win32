<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Shader Specified Stencil Reference Value (Direct3D 11 Graphics)</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: Shader Specified Stencil Reference Value (Direct3D 11 Graphics)
description: Learn about Stencil Reference Value in Direct3D 11 Graphics. Enabling pixel shaders to use Stencil Reference Value enables fine control over stencil operations.
ms.assetid: 6E336623-9746-4872-ADC1-C5489F53D7AE
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Shader Specified Stencil Reference Value (Direct3D 11 Graphics)</h1>
<p>Enabling pixel shaders to output the Stencil Reference Value, rather than using the API-specified one, enables a very fine granular control over stencil operations.</p>
<p>The shader specified value replaces the API-specified <em>Stencil Reference Value</em> for that invocation, which means the change affects both the stencil test, and when stencil op D3D11_STENCIL_OP_REPLACE (one member of <a href="/windows/desktop/api/D3D11/ne-d3d11-d3d11_stencil_op"><strong>D3D11_STENCIL_OP</strong></a>) is used to write the reference value to the stencil buffer.</p>
<p>In earlier versions of D3D11, the Stencil Reference Value can only be specified by the <a href="/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-omsetdepthstencilstate"><strong>ID3D11DeviceContext::OMSetDepthStencilState</strong></a> method. This means that this value can only be defined on a per-draw granularity. This D3D11.3 feature enables developers to read and use the Stencil Reference Value (<code>SV_StencilRef</code>) that is output from a pixel shader, meaning that it can be specified on a per-pixel or per-sample granularity.</p>
<p>This feature is optional in D3D11.3. To test for its support, check the <code>PSSpecifiedStencilRefSupported</code> boolean field of <a href="/windows/desktop/api/D3D11/ns-d3d11-d3d11_feature_data_d3d11_options2"><strong>D3D11_FEATURE_DATA_D3D11_OPTIONS2</strong></a> using <a href="/windows/desktop/api/D3D11/nf-d3d11-id3d11device-checkfeaturesupport"><strong>ID3D11Device::CheckFeatureSupport</strong></a></p>
<p>Here is an example of the use of <code>SV_StencilRef</code> in a pixel shader:</p>
<pre lang="syntax"><code>uint main2(float4 c : COORD) : SV_StencilRef
{
    return uint(c.x);
}
</code></pre>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="direct3d-11-3-features.html">Direct3D 11.3 Features</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/direct3dhlsl/shader-model-5-1">Shader Model 5.1</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
