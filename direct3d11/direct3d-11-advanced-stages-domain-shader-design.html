<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>How To: Design a Domain Shader</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: How To Design a Domain Shader
description: This topics shows how to design a domain shader.
ms.assetid: 329d4eb9-8886-401d-8fb4-39e06886998f
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>How To: Design a Domain Shader</h1>
<p>A domain shader is the third of three stages that work together to implement <a href="direct3d-11-advanced-stages-tessellation.html">tessellation</a>. The domain shader generates the surface geometry from the transformed control points from a hull shader and the UV coordinates. This topics shows how to design a domain shader.</p>
<p>A domain shader is invoked once for each point generated by the fixed function tessellator. The inputs are the UV[W] coordinates of the point on the patch, as well as all of the output data from the hull shader including control points and patch constants. The output is a vertex defined in whatever way is desired. If the output is being sent to the pixel shader, the output must include a position (denoted with a SV_Position semantic).</p>
<p><strong>To design a domain shader</strong></p>
<ol>
<li>
<p>Define the domain attribute.</p>
<pre><code>[domain(&quot;quad&quot;)]
</code></pre>
<p>The domain is defined for a quad patch.</p>
</li>
<li>
<p>Declare the location on the hull with the <a href="/windows/desktop/direct3dhlsl/sv-domainlocation">domain location</a> system value.</p>
<ul>
<li>For a quad patch, use a float2.</li>
<li>For a tri patch, use a float3 (for barycentric coordinates)</li>
<li>For an isoline, use a float2.</li>
</ul>
<p>Therefore, the domain location for a quad patch looks like this:</p>
<pre><code>float2 UV : SV_DomainLocation
</code></pre>
</li>
<li>
<p>Define the other inputs.</p>
<p>The other inputs come from the hull shader and are user defined. This includes the input control points for patch, of which there can be between 1 and 32 points, and input patch constant data.</p>
<p>The control points are user defined, usually with a structure such as this one (defined in <a href="direct3d-11-advanced-stages-hull-shader-design.html">How To: Design a Hull Shader</a>):</p>
<pre><code>const OutputPatch&lt;BEZIER_CONTROL_POINT, 16&gt; bezpatch
</code></pre>
<p>The patch constant data is also user defined, and might look like this one (defined in <a href="direct3d-11-advanced-stages-hull-shader-design.html">How To: Design a Hull Shader</a>):</p>
<pre><code>HS_CONSTANT_DATA_OUTPUT input
</code></pre>
</li>
<li>
<p>Add user-defined code to compute the outputs; this makes up the body of the domain shader.</p>
<p>This structure contains user-defined domain shader outputs.</p>
<pre><code>struct DS_OUTPUT
{
    float3 vNormal    : NORMAL;
    float2 vUV        : TEXCOORD;
    float3 vTangent   : TANGENT;
    float3 vBiTangent : BITANGENT;
    
    float4 vPosition  : SV_POSITION;
};
</code></pre>
<p>The function takes each input UV (from the tessellator) and evaluates the Bezier patch at this position.</p>
<pre><code>[domain(&quot;quad&quot;)]
DS_OUTPUT BezierEvalDS( HS_CONSTANT_DATA_OUTPUT input, 
                        float2 UV : SV_DomainLocation,
                        const OutputPatch&lt;BEZIER_CONTROL_POINT, 16&gt; bezpatch )
{
    DS_OUTPUT Output;

    // Insert code to compute the output here.

    return Output;    
}
</code></pre>
<p>The function is invoked once for each point generated by the fixed function tessellator. Since this example uses a quad patch, the input domain location (<a href="/windows/desktop/direct3dhlsl/sv-domainlocation">SV_DomainLocation</a>) is a float2 (UV); a tri patch would have a float3 input location (UVW barycentric coordinates), and an isoline would have a float2 input domain location.</p>
<p>The other inputs for the function come from the hull shader directly. In this example it is 16 control points each one being a <strong>BEZIER_CONTROL_POINT</strong>, as well as patch constant data (<strong>HS_CONSTANT_DATA_OUTPUT</strong>). The output is a vertex containing any data desired - <strong>DS_OUTPUT</strong> in this example.</p>
</li>
</ol>
<p>After designing a domain shader, see <a href="direct3d-11-advanced-stages-domain-shader-create.html">How To: Create a Domain Shader</a>.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="how-to-use-direct3d-11.html">How to Use Direct3D 11</a></p>
<!-- raw HTML omitted -->
<p><a href="direct3d-11-advanced-stages-tessellation.html">Tessellation Overview</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
