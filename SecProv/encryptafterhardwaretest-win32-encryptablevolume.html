<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>EncryptAfterHardwareTest method of the Win32_EncryptableVolume class</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Begins encryption of a fully decrypted operating system volume after a hardware test.
ms.assetid: 216c96bb-7737-4421-8b16-1ce295342266
title: EncryptAfterHardwareTest method of the Win32_EncryptableVolume class
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>Win32_EncryptableVolume.EncryptAfterHardwareTest
api_type:</li>
<li>COM
api_location:</li>
<li>Root\CIMV2\Security\MicrosoftVolumeEncryption</li>
</ul>
<hr />
<h1>EncryptAfterHardwareTest method of the Win32_EncryptableVolume class</h1>
<p>The <strong>EncryptAfterHardwareTest</strong> method of the <a href="win32-encryptablevolume.html"><strong>Win32_EncryptableVolume</strong></a> class begins encryption of a fully decrypted operating system volume after a hardware test. A reboot is required to perform this hardware test. Use this method instead of the <a href="encrypt-win32-encryptablevolume.html"><strong>Encrypt</strong></a> method to check that BitLocker will work as expected.</p>
<blockquote>
<p>[!Note]<br />
If the hard drive is hardware encrypted, this method does not encrypt data. Instead, it sets the band status to unlocked from &quot;perpetually unlocked&quot;. If the band is locked, unlocked or is read-only, the drive is considered to be encrypted.</p>
</blockquote>
<p>Â </p>
<h2>Syntax</h2>
<pre lang="mof"><code>uint32 EncryptAfterHardwareTest(
  [in, optional]Â uint32 EncryptionMethod,
  [in, optional]Â uint32 EncryptionFlags
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>EncryptionMethod</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Type: <strong>uint32</strong></p>
<p>Specifies the encryption algorithm and key size used to encrypt the volume. Leave this parameter blank to use the default value of zero. If the volume is partially or fully encrypted, the value of this parameter must be 0 or match the volume's existing encryption method. If the corresponding Group Policy setting has been enabled with a valid value, the value of this parameter must be 0 or match the Group Policy setting.</p>
<p>If the corresponding Group Policy setting is invalid, the default of AES 128 with diffuser is used.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>Unspecified</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Use the current Group Policy setting, if available and valid, or the default encryption method otherwise.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->1<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>AES 128 WITH DIFFUSER<!-- raw HTML omitted --> Encrypt the volume by using the Advanced Encryption Standard (AES) algorithm enhanced with a diffuser layer and by using an AES key size of 128 bits.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->2<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>AES 256 WITH DIFFUSER<!-- raw HTML omitted --> Encrypt the volume by using the Advanced Encryption Standard (AES) algorithm enhanced with a diffuser layer and by using an AES key size of 256 bits.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>AES_128</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->3<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Encrypt the volume by using the Advanced Encryption Standard (AES) algorithm and by using an AES key size of 128 bits.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>AES_256</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->4<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Encrypt the volume by using the Advanced Encryption Standard (AES) algorithm and by using an AES key size of 256 bits.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<p><em>EncryptionFlags</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Type: <strong>uint32</strong></p>
<p>Flags that describe the encryption behavior.</p>
<p><strong>WindowsÂ 7, Windows ServerÂ 2008Â R2, WindowsÂ Vista Enterprise and Windows ServerÂ 2008:</strong> This parameter is not available.</p>
<p>A combination of 32 bits with the following bits currently defined.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000001<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Perform volume encryption in data-only encryption mode when starting new encryption process. If encryption has been paused or stopped, calling the <a href="encrypt-win32-encryptablevolume.html"><strong>Encrypt</strong></a> method effectively resumes conversion and the value of this bit is ignored. This bit only has effect when either the <strong>Encrypt</strong> or <strong>EncryptAfterHardwareTest</strong> methods start encryption from the fully decrypted state, decryption in progress state, or decryption paused state. If this bit is zero, meaning that it is not set, when starting new encryption process, then full mode conversion will be performed.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00000002<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Perform on-demand wipe of the volume free space. Calling the <a href="encrypt-win32-encryptablevolume.html"><strong>Encrypt</strong></a> method with this bit set is only allowed when volume is not currently converting or wiping and is in an &quot;encrypted&quot; state.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00010000 <!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Perform the requested operation synchronously. The call will block until requested operation has completed or was interrupted. This flag is only supported with the <a href="encrypt-win32-encryptablevolume.html"><strong>Encrypt</strong></a> method. This flag can be specified when <strong>Encrypt</strong> is called to resume stopped or interrupted encryption or wiping or when either encryption or wiping is in progress. This allows the caller to resume synchronously waiting until the process is completed or interrupted.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>Type: <strong>uint32</strong></p>
<p>This method returns one of the following codes or another error code if it fails.</p>
<p>This method returns immediately. If the volume is already fully encrypted and no other errors are returned, this method returns zero.</p>
<table>
<thead>
<tr>
<th>Return code/value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->S_OK<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->0 (0x0)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>The method was successful.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->E_INVALIDARG<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2147942487 (0x80070057)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>The <!-- raw HTML omitted -->EncryptionMethod<!-- raw HTML omitted --> parameter is provided but is not within the known range or does not match the current Group Policy setting.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->FVE_E_CANNOT_ENCRYPT_NO_KEY<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2150694958 (0x8031002E)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>No encryption key exists for the volume.<!-- raw HTML omitted --> Either disable key protectors by using the <!-- raw HTML omitted --><!-- raw HTML omitted -->DisableKeyProtectors<!-- raw HTML omitted --><!-- raw HTML omitted --> method, or use one of the following methods to specify key protectors for the volume:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithExternalKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithNumericalPassword<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPM<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndPIN<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndPINAndStartupKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndStartupKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->FVE_E_CLUSTERING_NOT_SUPPORTED<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2150694942 (0x8031001E)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>The volume cannot be encrypted because this computer is configured to be part of a server cluster.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->FVE_E_NO_PROTECTORS_TO_TEST<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2150694971 (0x8031003B)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>No key protectors of the type &quot;TPM&quot;, &quot;TPM And PIN&quot;, &quot;TPM And PIN And Startup Key&quot;, &quot;TPM And Startup Key&quot;, or &quot;External Key&quot; can be found. The hardware test only involves the previous key protectors.<!-- raw HTML omitted --> If you still want to run a hardware test, you must use one of the following methods to specify key protectors for the volume:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithExternalKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithNumericalPassword<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPM<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndPIN<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndPINAndStartupKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndStartupKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->FVE_E_NOT_DECRYPTED<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2150694969 (0x80310039)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>The volume is partially or fully encrypted.<!-- raw HTML omitted --> The hardware test applies before encryption occurs. If you still want to run the test, first use the <!-- raw HTML omitted --><!-- raw HTML omitted -->Decrypt<!-- raw HTML omitted --><!-- raw HTML omitted --> method and then use one of the following methods to add key protectors:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithExternalKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithNumericalPassword<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPM<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndPIN<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithTPMAndStartupKey<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->FVE_E_NOT_OS_VOLUME<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2150694952 (0x80310028)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>The volume is a data volume.<!-- raw HTML omitted --> The hardware test applies only to volumes that can start the operating system. Run this method on the currently started operating system volume.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->FVE_E_POLICY_PASSWORD_REQUIRED<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->2150694956 (0x8031002C)<!-- raw HTML omitted --><!-- raw HTML omitted --></td>
<td>No key protectors of the type &quot;Numerical Password&quot; are specified. The Group Policy requires a backup of recovery information to Active Directory Domain Services. To add at least one key protector of that type, use the <!-- raw HTML omitted --><!-- raw HTML omitted -->ProtectKeyWithNumericalPassword<!-- raw HTML omitted --><!-- raw HTML omitted --> method.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Remarks</h2>
<p>When you use this method without the second optional parameter (according to the WindowsÂ 7 and WindowsÂ Vista Enterprise definition), the method will always initiate full mode conversion in order to keep backward compatible behavior. This way the security expectation of existing applications and scripts will not be broken with the addition of the second optional parameter in WindowsÂ 8 and Windows ServerÂ 2012.</p>
<p>Unlike the <a href="encrypt-win32-encryptablevolume.html"><strong>Encrypt</strong></a> method, this method does the following:</p>
<ul>
<li>Tests whether the TPM will be able to unlock the volume, if a TPM-related key protector exists.</li>
<li>Tests whether the computer can read a USB flash drive that contains an external key file during start, if the volume will be unlocked by an external key (including a startup key).</li>
<li>Requires a computer restart to run the hardware test.</li>
<li>Begins encryption only if the hardware test succeeds.</li>
<li>Cannot be used on a data volume, on a partially or fully encrypted volume, or to resume encryption.</li>
</ul>
<p>Before running this method, use the following methods to create the related key protectors:</p>
<ul>
<li><a href="protectkeywithexternalkey-win32-encryptablevolume.html"><strong>ProtectKeyWithExternalKey</strong></a></li>
<li><a href="protectkeywithtpm-win32-encryptablevolume.html"><strong>ProtectKeyWithTPM</strong></a></li>
<li><a href="protectkeywithtpmandpin-win32-encryptablevolume.html"><strong>ProtectKeyWithTPMAndPIN</strong></a></li>
<li><a href="protectkeywithtpmandpinandstartupkey-win32-encryptablevolume.html"><strong>ProtectKeyWithTPMAndPINAndStartupKey</strong></a></li>
<li><a href="protectkeywithtpmandstartupkey-win32-encryptablevolume.html"><strong>ProtectKeyWithTPMAndStartupKey</strong></a></li>
</ul>
<p>After running this method, take these additional steps:</p>
<ol>
<li>Insert into the computer a USB flash drive that contains an external key file. This step applies only if the volume has a key protector of type &quot;External Key&quot; or &quot;TPM And Startup Key&quot;.</li>
<li>Restart the computer.</li>
</ol>
<p>On computer restart, the hardware test runs automatically.</p>
<p>Encryption begins if the hardware test succeeds. Otherwise, attempt to resolve any hardware failures. Run <a href="gethardwareteststatus-win32-encryptablevolume.html"><strong>GetHardwareTestStatus</strong></a> after restarting the computer to get test results.</p>
<p>Managed Object Format (MOF) files contain the definitions for Windows Management Instrumentation (WMI) classes. MOF files are not installed as part of the Windows SDK. They are installed on the server when you add the associated role by using the Server Manager. For more information about MOF files, see <a href="../wmisdk/managed-object-format--mof-.html">Managed Object Format (MOF)</a>.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ Vista Enterprise, WindowsÂ Vista Ultimate [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows ServerÂ 2008 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Namespace<!-- raw HTML omitted --></td>
<td>Root\CIMV2\Security\MicrosoftVolumeEncryption<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>MOF<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Win32_encryptablevolume.mof<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="win32-encryptablevolume.html"><strong>Win32_EncryptableVolume</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
