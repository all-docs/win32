<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ProtectKeyWithCertificateFile method of the Win32_EncryptableVolume class</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: ProtectKeyWithCertificateFile method of the Win32_EncryptableVolume class - Validates the Enhanced Key Usage (EKU) object identifier (OID) of the provided certificate.
ms.assetid: cc716524-f976-4d75-84f3-693e277030e6
title: ProtectKeyWithCertificateFile method of the Win32_EncryptableVolume class
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>Win32_EncryptableVolume.ProtectKeyWithCertificateFile
api_type:</li>
<li>COM
api_location:</li>
<li>Root\CIMV2\Security\MicrosoftVolumeEncryption</li>
</ul>
<hr />
<h1>ProtectKeyWithCertificateFile method of the Win32_EncryptableVolume class</h1>
<p>The <strong>ProtectKeyWithCertificateFile</strong> method of the <a href="win32-encryptablevolume.html"><strong>Win32_EncryptableVolume</strong></a> class validates the Enhanced Key Usage (EKU) <a href="../secgloss/o-gly.html"><em>object identifier</em></a> (OID) of the provided certificate.</p>
<h2>Syntax</h2>
<pre lang="mof"><code>uint32 ProtectKeyWithCertificateFile(
  [in, optional]Â string FriendlyName,
  [in]Â Â Â Â Â Â Â Â Â Â Â string FileName,
  [out]Â Â Â Â Â Â Â Â Â Â string VolumeKeyProtectorID
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>FriendlyName</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Type: <strong>string</strong></p>
<p>A string that specifies a user-assigned string identifier for this key protector. If this parameter is not specified, the <em>FriendlyName</em> parameter is created by using the Subject Name in the certificate.</p>
<!-- raw HTML omitted -->
<p><em>FileName</em> [in]</p>
<!-- raw HTML omitted -->
<p>Type: <strong>string</strong></p>
<p>A string that specifies the location and name of the .cer file used to enable BitLocker. An encryption certificate must be exported in .cer format (<a href="../secgloss/d-gly.html"><em>Distinguished Encoding Rules</em></a> (DER)-encoded binary <a href="../secgloss/x-gly.html"><em>X.509</em></a> or Base-64 encoded X.509). The encryption certificate may be generated from Microsoft PKI, third-party PKI, or self-signed.</p>
<!-- raw HTML omitted -->
<p><em>VolumeKeyProtectorID</em> [out]</p>
<!-- raw HTML omitted -->
<p>Type: <strong>string</strong></p>
<p>A string that uniquely identifies the created key protector that can be used to manage this key protector.</p>
<p>If the drive supports hardware encryption and BitLocker has not taken band ownership, the ID string is set to &quot;BitLocker&quot; and the key protector is written to per band metadata.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>Type: <strong>uint32</strong></p>
<p>This method returns one of the following codes or another error code if it fails.</p>
<table>
<thead>
<tr>
<th>Return code/value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>S_OK</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0 (0x0)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The method was successful.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>FVE_E_NON_BITLOCKER_OID</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->2150695022 (0x8031006E)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The EKU attribute of the specified certificate does not permit it to be used for BitLocker Drive Encryption. BitLocker does not require that a certificate have an EKU attribute, but if one is configured, it must be set to an OID that matches the OID configured for BitLocker.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>FVE_E_POLICY_USER_CERTIFICATE_NOT_ALLOWED</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->2150695026 (0x80310072)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Group Policy does not permit user certificates, such as smart cards, to be used with BitLocker.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>FVE_E_POLICY_USER_CERT_MUST_BE_HW</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->2150695028 (0x80310074)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Group Policy requires that you supply a smart card to use BitLocker.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>FVE_E_POLICY_PROHIBITS_SELFSIGNED</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->2150695046 (0x80310086)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Group Policy does not permit the use of self-signed certificates.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>ERROR_FILE_NOT_FOUND</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0000000002 (0x2)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The system cannot find the specified file.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Remarks</h2>
<p>If the OID does not match the one associated with the service controller in the registry, this method fails. This prevents the user from setting data recovery agent (DRA) protectors manually on the volume. DRAs are only to be set by the service.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ 7 Enterprise, WindowsÂ 7 Ultimate [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows ServerÂ 2008Â R2 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Namespace<!-- raw HTML omitted --></td>
<td>Root\CIMV2\Security\MicrosoftVolumeEncryption<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>MOF<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Win32_encryptablevolume.mof<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="win32-encryptablevolume.html"><strong>Win32_EncryptableVolume</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
