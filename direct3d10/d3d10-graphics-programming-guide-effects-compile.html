<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Compile an Effect (Direct3D 10)</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Once an effect has been authored, the first step is to compile the code to check for syntax problems.
ms.assetid: b8d8a0b7-b520-44e4-8691-6eb46202c092
title: Compile an Effect (Direct3D 10)
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Compile an Effect (Direct3D 10)</h1>
<p>Once an effect has been authored, the first step is to compile the code to check for syntax problems. This is done by calling one of the compile APIs (like D3DX10CompileEffectFromFile, D3DX10CompileEffectFromResource, D3DX10CompileEffectFromMemory). These API's invoke the effect compiler fxc.exe which is the compiler used to compile HLSL code. This is why the syntax for code in an effect looks very much like HLSL code (there are a few exceptions that will be handled later). By the way, the effect compiler/hlsl compiler (fxc.exe) is in the SDK in the utilities folder so that you can compile your shaders (or effects) offline if you choose. See the documentation for running the compiler from the command line.</p>
<ul>
<li><a href="#includes">Includes</a></li>
<li><a href="#macros">Macros</a></li>
<li><a href="#hlsl-shader-flags">HLSL Shader Flags</a></li>
<li><a href="#fx-flags">FX Flags</a></li>
<li><a href="#checking-errors">Checking Errors</a></li>
<li><a href="#related-topics">Related topics</a></li>
</ul>
<p>Here's an example of compiling an effect file (from the BasicHLSL10 sample).</p>
<pre><code>WCHAR str[MAX_PATH];
DXUTFindDXSDKMediaFileCch( str, MAX_PATH, L&quot;BasicHLSL10.fx&quot; );

hr = D3DX10CompileEffectFromFile( str, NULL, NULL, &quot;fx_4_0&quot;, 
    D3D10_SHADER_ENABLE_STRICTNESS, 0, pd3dDevice, NULL, NULL, 
    &amp;l_pBlob_Effect, &amp;l_pBlob_Errors, NULL );
</code></pre>
<h2>Includes</h2>
<p>One parameter is an include interface. Generate one of these if you want to include a customized behavior when reading an include file. This custom behavior is executed each time an effect (that uses the include pointer) is created or when an effect (that uses the include pointer) is compiled. To implement customized include behavior, derive a class from the Include interface. This provides your class two methods: Open and Close. Implement the custom behavior in the Open and Close methods.</p>
<h2>Macros</h2>
<p>Effect compilation can also take a pointer to macros that are defined elsewhere. For example, suppose you were to modify the effect in BasicHLSL10, to use two macros: zero and one. The effect code that uses the two macros is shown here.</p>
<pre><code>if( bAnimate )
    vAnimatedPos += float4(vNormal, zero) *  
        (sin(g_fTime+5.5)+0.5)*5;
        
    Output.Diffuse.a = one;         
</code></pre>
<p>Here is the declaration for the two macros.</p>
<pre><code>D3D_SHADER_MACRO Shader_Macros[3] = { &quot;zero&quot;, &quot;0&quot;, &quot;one&quot;, &quot;1.0f&quot;, NULL, NULL };
</code></pre>
<p>The macros are a NULL terminated array of macros; where each macro is defined with a <a href="/windows/win32/api/d3dcommon/ns-d3dcommon-d3d_shader_macro"><strong>D3D_SHADER_MACRO</strong></a> struct.</p>
<p>Lastly, modify the compile effect call to take a pointer to the macros.</p>
<pre><code>D3DX10CreateEffectFromFile( str, Shader_Macros, NULL, 
    D3D10_SHADER_ENABLE_STRICTNESS, 0, pd3dDevice, NULL, NULL, 
    &amp;g_pEffect10, NULL );
</code></pre>
<h2>HLSL Shader Flags</h2>
<p>Shader flags specify shader constraints to the HLSL compiler. These flags impact the code generated by the shader compiler including:</p>
<ul>
<li>Size considerations: optimize the code.</li>
<li>Debug considerations: including debug information, preventing flow control.</li>
<li>Hardware considerations: the compile target and whether or not a shader can run on legacy hardware.</li>
</ul>
<p>In general, these flags can be logically combined, assuming you have not specified two conflicting characteristics. For a listing of the flags see <a href="d3d10-graphics-reference-effect-constants.html">Effect Constants (Direct3D 10)</a>.</p>
<h2>FX Flags</h2>
<p>These flags used when creating an effect to define either compilation behavior or runtime effect behavior. For a listing of the flags see <a href="d3d10-graphics-reference-effect-constants.html">Effect Constants (Direct3D 10)</a>.</p>
<h2>Checking Errors</h2>
<p>If during compilation, an error occurs, the API returns an interface which contains the errors returned from the effect compiler. This interface is called ID3D10Blob. It is not directly readable, however, by returning a pointer to the buffer that contains the data (which is a string), you can see any compilation errors.</p>
<p>In this example, an error was introduced into the BasicHLSL.fx effect by copying the first variable declaration twice.</p>
<pre><code>//-------------------------------------------------------------------
// Global variables
//-------------------------------------------------------------------
float4 g_MaterialAmbientColor;      // Material's ambient color

// Declare the same variable twice
float4 g_MaterialAmbientColor;      // Material's ambient color
</code></pre>
<p>This error caused the compiler to return the following error, as shown in the following screen shot of the watch window in Microsoft Visual Studio.</p>
<p><img src="images/effect-compile-errors-2.jpg" alt="screen shot of the visual studio watch window" /></p>
<p>Since the error is returned in a LPVOID pointer, cast it to a character string in the watch window.</p>
<p>Here is the code used to return the error from the failed compile.</p>
<pre><code>// Read the D3DX effect file
WCHAR str[MAX_PATH];
ID3D10Blob* l_pBlob_Effect = NULL;
ID3D10Blob* l_pBlob_Errors = NULL;
hr = DXUTFindDXSDKMediaFileCch( str, MAX_PATH, L&quot;BasicHLSL10.fx&quot; );
hr = D3DX10CompileEffectFromFile( str, NULL, NULL, 
    D3D10_SHADER_ENABLE_STRICTNESS, 0, NULL, 
    &amp;l_pBlob_Effect, &amp;l_pBlob_Errors );

LPVOID l_pError = NULL;
if( l_pBlob_Errors )
{
    l_pError = l_pBlob_Errors-&gt;GetBufferPointer();
    // then cast to a char* to see it in the locals window
}
</code></pre>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="d3d10-graphics-programming-guide-effects-render.html">Rendering an Effect (Direct3D 10)</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
