<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>STGM Constants</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: STGM Constants (ObjBase.h)
description: Flags that indicate conditions for creating and deleting the object and access modes for the object.
ms.assetid: 15a35da9-332a-46e1-9190-500c95e26f59
topic_type:</p>
<ul>
<li>apiref
api_name:</li>
<li>STGM_READ</li>
<li>STGM_WRITE</li>
<li>STGM_READWRITE</li>
<li>STGM_SHARE_DENY_NONE</li>
<li>STGM_SHARE_DENY_READ</li>
<li>STGM_SHARE_DENY_WRITE</li>
<li>STGM_SHARE_EXCLUSIVE</li>
<li>STGM_PRIORITY</li>
<li>STGM_CREATE</li>
<li>STGM_CONVERT</li>
<li>STGM_FAILIFTHERE</li>
<li>STGM_DIRECT</li>
<li>STGM_TRANSACTED</li>
<li>STGM_NOSCRATCH</li>
<li>STGM_NOSNAPSHOT</li>
<li>STGM_SIMPLE</li>
<li>STGM_DIRECT_SWMR</li>
<li>STGM_DELETEONRELEASE
api_location:</li>
<li>ObjBase.h
api_type:</li>
<li>HeaderDef
ms.topic: reference
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1>STGM Constants</h1>
<p>The STGM constants are flags that indicate conditions for creating and deleting the object and access modes for the object. The STGM constants are included in the <a href="/windows/desktop/api/Objidl/nn-objidl-istorage"><strong>IStorage</strong></a>, <a href="/windows/desktop/api/Objidl/nn-objidl-istream"><strong>IStream</strong></a>, and <a href="/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage"><strong>IPropertySetStorage</strong></a> interfaces and in the <a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile"><strong>StgCreateDocfile</strong></a>, <a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex"><strong>StgCreateStorageEx</strong></a>, <a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfileonilockbytes"><strong>StgCreateDocfileOnILockBytes</strong></a>, <a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage"><strong>StgOpenStorage</strong></a>, and <a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex"><strong>StgOpenStorageEx</strong></a> functions.</p>
<p>These elements are often combined using an <strong>OR</strong>operator. They are interpreted in groups as listed in the following table. It is not valid to use more than one element from a single group.</p>
<p>Use a flag from the creation group when creating an object, such as with <a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex"><strong>StgCreateStorageEx</strong></a> or <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-createstream"><strong>IStorage::CreateStream</strong></a>.</p>
<p>For more information about transactioning, see the Remarks section.</p>
<table>
<thead>
<tr>
<th>Group</th>
<th>Flag</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access</td>
<td><strong>STGM_READ</strong></td>
<td>0x00000000L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_WRITE</strong></td>
<td>0x00000001L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_READWRITE</strong></td>
<td>0x00000002L</td>
</tr>
<tr>
<td>Sharing</td>
<td><strong>STGM_SHARE_DENY_NONE</strong></td>
<td>0x00000040L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_SHARE_DENY_READ</strong></td>
<td>0x00000030L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_SHARE_DENY_WRITE</strong></td>
<td>0x00000020L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_SHARE_EXCLUSIVE</strong></td>
<td>0x00000010L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_PRIORITY</strong></td>
<td>0x00040000L</td>
</tr>
<tr>
<td>Creation</td>
<td><strong>STGM_CREATE</strong></td>
<td>0x00001000L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_CONVERT</strong></td>
<td>0x00020000L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_FAILIFTHERE</strong></td>
<td>0x00000000L</td>
</tr>
<tr>
<td>Transactioning</td>
<td><strong>STGM_DIRECT</strong></td>
<td>0x00000000L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_TRANSACTED</strong></td>
<td>0x00010000L</td>
</tr>
<tr>
<td>Transactioning Performance</td>
<td><strong>STGM_NOSCRATCH</strong></td>
<td>0x00100000L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_NOSNAPSHOT</strong></td>
<td>0x00200000L</td>
</tr>
<tr>
<td>Direct SWMR and Simple</td>
<td><strong>STGM_SIMPLE</strong></td>
<td>0x08000000L</td>
</tr>
<tr>
<td></td>
<td><strong>STGM_DIRECT_SWMR</strong></td>
<td>0x00400000L</td>
</tr>
<tr>
<td>Delete On Release</td>
<td><strong>STGM_DELETEONRELEASE</strong></td>
<td>0x04000000L</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_READ</strong></p>
<!-- raw HTML omitted -->
<p>0x00000000L</p>
<!-- raw HTML omitted -->
<p>Indicates that the object is read-only, meaning that modifications cannot be made. For example, if a stream object is opened with <strong>STGM_READ</strong>, the <a href="/windows/desktop/api/Objidl/nf-objidl-isequentialstream-read"><strong>ISequentialStream::Read</strong></a> method may be called, but the <a href="/windows/desktop/api/Objidl/nf-objidl-isequentialstream-write"><strong>ISequentialStream::Write</strong></a> method may not. Similarly, if a storage object opened with <strong>STGM_READ</strong>, the <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-openstream"><strong>IStorage::OpenStream</strong></a> and <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-openstorage"><strong>IStorage::OpenStorage</strong></a> methods may be called, but the <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-createstream"><strong>IStorage::CreateStream</strong></a> and <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-createstorage"><strong>IStorage::CreateStorage</strong></a> methods may not.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_WRITE</strong></p>
<!-- raw HTML omitted -->
<p>0x00000001L</p>
<!-- raw HTML omitted -->
<p>Enables you to save changes to the object, but does not permit access to its data. The provided implementations of the <a href="/windows/desktop/api/Propidl/nn-propidl-ipropertystorage"><strong>IPropertyStorage</strong></a> and <a href="/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage"><strong>IPropertySetStorage</strong></a> interfaces do not support this write-only mode.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_READWRITE</strong></p>
<!-- raw HTML omitted -->
<p>0x00000002L</p>
<!-- raw HTML omitted -->
<p>Enables access and modification of object data. For example, if a stream object is created or opened in this mode, it is possible to call both <a href="/windows/desktop/api/Objidl/nn-objidl-istream"><strong>IStream::Read</strong></a> and <strong>IStream::Write</strong>. Be aware that this constant is not a simple binary <strong>OR</strong> operation of the <strong>STGM_WRITE</strong> and <strong>STGM_READ</strong> elements.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_SHARE_DENY_NONE</strong></p>
<!-- raw HTML omitted -->
<p>0x00000040L</p>
<!-- raw HTML omitted -->
<p>Specifies that subsequent openings of the object are not denied read or write access. If no flag from the sharing group is specified, this flag is assumed.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_SHARE_DENY_READ</strong></p>
<!-- raw HTML omitted -->
<p>0x00000030L</p>
<!-- raw HTML omitted -->
<p>Prevents others from subsequently opening the object in <strong>STGM_READ</strong> mode. It is typically used on a root storage object.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_SHARE_DENY_WRITE</strong></p>
<!-- raw HTML omitted -->
<p>0x00000020L</p>
<!-- raw HTML omitted -->
<p>Prevents others from subsequently opening the object for <strong>STGM_WRITE</strong> or <strong>STGM_READWRITE</strong> access. In transacted mode, sharing of <strong>STGM_SHARE_DENY_WRITE</strong> or <strong>STGM_SHARE_EXCLUSIVE</strong> can significantly improve performance because they do not require snapshots. For more information about transactioning, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_SHARE_EXCLUSIVE</strong></p>
<!-- raw HTML omitted -->
<p>0x00000010L</p>
<!-- raw HTML omitted -->
<p>Prevents others from subsequently opening the object in any mode. Be aware that this value is not a simple bitwise <strong>OR</strong> operation of the <strong>STGM_SHARE_DENY_READ</strong> and <strong>STGM_SHARE_DENY_WRITE</strong> values. In transacted mode, sharing of <strong>STGM_SHARE_DENY_WRITE</strong> or <strong>STGM_SHARE_EXCLUSIVE</strong> can significantly improve performance because they do not require snapshots. For more information about transactioning, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_PRIORITY</strong></p>
<!-- raw HTML omitted -->
<p>0x00040000L</p>
<!-- raw HTML omitted -->
<p>Opens the storage object with exclusive access to the most recently committed version. Thus, other users cannot commit changes to the object while you have it open in priority mode. You gain performance benefits for copy operations, but you prevent others from committing changes. Limit the time that objects are open in priority mode. You must specify <strong>STGM_DIRECT</strong> and <strong>STGM_READ</strong> with priority mode, and you cannot specify <strong>STGM_DELETEONRELEASE</strong>. <strong>STGM_DELETEONRELEASE</strong> is only valid when creating a root object, such as with <a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex"><strong>StgCreateStorageEx</strong></a>. It is not valid when opening an existing root object, such as with <a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex"><strong>StgOpenStorageEx</strong></a>. It is also not valid when creating or opening a subelement, such as with <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-openstorage"><strong>IStorage::OpenStorage</strong></a>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_CREATE</strong></p>
<!-- raw HTML omitted -->
<p>0x00001000L</p>
<!-- raw HTML omitted -->
<p>Indicates that an existing storage object or stream should be removed before the new object replaces it. A new object is created when this flag is specified only if the existing object has been successfully removed.</p>
<p>This flag is used when attempting to create:</p>
<ul>
<li>A storage object on a disk, but a file of that name exists.</li>
<li>An object inside a storage object, but an object with the specified name exists.</li>
<li>A byte array object, but one with the specified name exists.</li>
</ul>
<p>This flag cannot be used with open operations, such as <a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex"><strong>StgOpenStorageEx</strong></a> or <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-openstream"><strong>IStorage::OpenStream</strong></a>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_CONVERT</strong></p>
<!-- raw HTML omitted -->
<p>0x00020000L</p>
<!-- raw HTML omitted -->
<p>Creates the new object while preserving existing data in a stream named &quot;Contents&quot;. In the case of a storage object or a byte array, the old data is formatted into a stream regardless of whether the existing file or byte array currently contains a layered storage object. This flag can only be used when creating a root storage object. It cannot be used within a storage object; for example, in <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-createstream"><strong>IStorage::CreateStream</strong></a>. It is also not valid to use this flag and the <strong>STGM_DELETEONRELEASE</strong> flag simultaneously.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_FAILIFTHERE</strong></p>
<!-- raw HTML omitted -->
<p>0x00000000L</p>
<!-- raw HTML omitted -->
<p>Causes the create operation to fail if an existing object with the specified name exists. In this case, <strong>STG_E_FILEALREADYEXISTS</strong> is returned. This is the default creation mode; that is, if no other create flag is specified, <strong>STGM_FAILIFTHERE</strong> is implied.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_DIRECT</strong></p>
<!-- raw HTML omitted -->
<p>0x00000000L</p>
<!-- raw HTML omitted -->
<p>Indicates that, in direct mode, each change to a storage or stream element is written as it occurs. This is the default if neither <strong>STGM_DIRECT</strong> nor <strong>STGM_TRANSACTED</strong> is specified.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_TRANSACTED</strong></p>
<!-- raw HTML omitted -->
<p>0x00010000L</p>
<!-- raw HTML omitted -->
<p>Indicates that, in transacted mode, changes are buffered and written only if an explicit commit operation is called. To ignore the changes, call the <a href="/windows/desktop/api/Objidl/nf-objidl-istream-revert"><strong>Revert</strong></a> method in the <a href="/windows/desktop/api/Objidl/nn-objidl-istream"><strong>IStream</strong></a>, <a href="/windows/desktop/api/Objidl/nn-objidl-istorage"><strong>IStorage</strong></a>, or <a href="/windows/desktop/api/Propidl/nn-propidl-ipropertystorage"><strong>IPropertyStorage</strong></a> interface. The COM compound file implementation of <strong>IStorage</strong> does not support transacted streams, which means that streams can be opened only in direct mode, and you cannot revert changes to them, however transacted storages are supported. The compound file, stand-alone, and NTFS file system implementations of <a href="/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage"><strong>IPropertySetStorage</strong></a> similarly do not support transacted, simple property sets because these property sets are stored in streams. However, transactioning of nonsimple property sets, which can be created by specifying the <strong>PROPSETFLAG_NONSIMPLE</strong> flag in the <em>grfFlags</em> parameter of <a href="/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create"><strong>IPropertySetStorage::Create</strong></a>, are supported.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_NOSCRATCH</strong></p>
<!-- raw HTML omitted -->
<p>0x00100000L</p>
<!-- raw HTML omitted -->
<p>Indicates that, in transacted mode, a temporary scratch file is usually used to save modifications until the <strong>Commit</strong> method is called. Specifying <strong>STGM_NOSCRATCH</strong> permits the unused portion of the original file to be used as work space instead of creating a new file for that purpose. This does not affect the data in the original file, and in certain cases can result in improved performance. It is not valid to specify this flag without also specifying <strong>STGM_TRANSACTED</strong>, and this flag may only be used in a root open. For more information about NoScratch mode, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_NOSNAPSHOT</strong></p>
<!-- raw HTML omitted -->
<p>0x00200000L</p>
<!-- raw HTML omitted -->
<p>This flag is used when opening a storage object with <strong>STGM_TRANSACTED</strong> and without <strong>STGM_SHARE_EXCLUSIVE</strong> or <strong>STGM_SHARE_DENY_WRITE</strong>. In this case, specifying <strong>STGM_NOSNAPSHOT</strong> prevents the system-provided implementation from creating a snapshot copy of the file. Instead, changes to the file are written to the end of the file. Unused space is not reclaimed unless consolidation is performed during the commit, and there is only one current writer on the file. When the file is opened in no snapshot mode, another open operation cannot be performed without specifying <strong>STGM_NOSNAPSHOT</strong>. This flag may only be used in a root open operation. For more information about NoSnapshot mode, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_SIMPLE</strong></p>
<!-- raw HTML omitted -->
<p>0x08000000L</p>
<!-- raw HTML omitted -->
<p>Provides a faster implementation of a compound file in a limited, but frequently used, case. For more information, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_DIRECT_SWMR</strong></p>
<!-- raw HTML omitted -->
<p>0x00400000L</p>
<!-- raw HTML omitted -->
<p>Supports direct mode for single-writer, multireader file operations. For more information, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>STGM_DELETEONRELEASE</strong></p>
<!-- raw HTML omitted -->
<p>0x04000000L</p>
<!-- raw HTML omitted -->
<p>Indicates that the underlying file is to be automatically destroyed when the root storage object is released. This feature is most useful for creating temporary files. This flag can only be used when creating a root object, such as with <a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex"><strong>StgCreateStorageEx</strong></a>. It is not valid when opening a root object, such as with <a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex"><strong>StgOpenStorageEx</strong></a>, or when creating or opening a subelement, such as with <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-createstream"><strong>IStorage::CreateStream</strong></a>. It is also not valid to use this flag and the STGM_CONVERT flag simultaneously.</p>
<!-- raw HTML omitted -->
<h2>Remarks</h2>
<p>You can combine these flags, but you can only choose one flag from each group of related flags. Typically one flag from each of the access and sharing groups must be specified for all functions and methods which use these constants. Flags from other groups are optional.</p>
<h3>Transacted Mode</h3>
<p>When the <strong>STGM_DIRECT</strong>flag is specified, only one of the following combination of flags may be specified from the access and sharing groups.</p>
<pre lang="syntax"><code>    STGM_READ      | STGM_SHARE_DENY_WRITE
</code></pre>
<pre lang="syntax"><code>    STGM_READWRITE | STGM_SHARE_EXCLUSIVE
</code></pre>
<pre lang="syntax"><code>    STGM_READ      | STGM_PRIORITY
</code></pre>
<p>Be aware that direct mode is implied by the absence of <strong>STGM_TRANSACTED</strong>. That is, if neither <strong>STGM_DIRECT</strong> nor <strong>STGM_TRANSACTED</strong> is specified, <strong>STGM_DIRECT</strong> is assumed.</p>
<p>When the <strong>STGM_TRANSACTED</strong> flag is specified, objects are created or opened in transacted mode. In this mode, changes to an object do not persist until they are committed. For example, changes to a transacted storage object are not persisted until the <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-commit"><strong>IStorage::Commit</strong></a> method is called. Changes to such a storage object will be lost if the storage object is released (final release) before the <strong>Commit</strong> method is called, or if the <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-revert"><strong>IStorage::Revert</strong></a> method is called.</p>
<p>When an object is created or opened in transacted mode, the implementation must keep both the original data and updates to this data, so that updates can be reverted if necessary. This is typically performed by writing changes to a scratch area until they are committed, or by creating a copy, called a snapshot, of the most recently committed data.</p>
<p>When a root storage object is opened in transacted mode, the location and behavior of the scratch data and the snapshot copies can be controlled to optimize performance with the <strong>STGM_NOSCRATCH</strong> and <strong>STGM_NOSNAPSHOT</strong> flags. (A root storage object is obtained from, for example, the <a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex"><strong>StgOpenStorageEx</strong></a> function; a storage object obtained from the <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-openstorage"><strong>IStorage::OpenStorage</strong></a> method is a substorage object.) Typically, the scratch data and snapshots are stored in temporary files, separate from the storage.</p>
<p>The effect of these flags depends on the number of readers and/or writers accessing the root storage.</p>
<p>In the &quot;single-writer&quot; case, a transacted mode storage object is opened for write access and there can be no other access to the file. That is, the file is opened with <strong>STGM_TRANSACTED</strong>, access of <strong>STGM_WRITE</strong> or <strong>STGM_READWRITE</strong>, and sharing of <strong>STGM_SHARE_EXCLUSIVE</strong>. In this case, changes to the storage object are written to the scratch area. When those changes are committed, they are copied to the original storage. Therefore, if no changes are actually made to the storage object, there will be no unnecessary data transfer.</p>
<p>In the &quot;multiple-writer&quot; case, a transacted storage object is opened for write access, but is shared in such asway as to allow other writers. That is, the storage object is opened with <strong>STGM_TRANSACTED</strong>, access of <strong>STGM_WRITE</strong> or <strong>STGM_READWRITE</strong>, and sharing of <strong>STGM_SHARE_DENY_READ</strong>. If sharing of <strong>STGM_SHARE_DENY_NONE</strong> is specified instead, then the case is &quot;multiple-writer, multiple-reader&quot;. In these cases, a snapshot of the original data will be made during the open operation. Therefore, even if no changes are actually made to the storage and/or it is not actually opened by another writer simultaneously, data transfer is still necessary during the open. As a result the best open-time performance can be obtained by opening the storage object in <strong>STGM_SHARE_DENY_WRITE</strong> or <strong>STGM_SHARE_EXCLUSIVE</strong> modes. For more information about how changes are committed when there are multiple writers, see <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-commit"><strong>IStorage::Commit</strong></a>.</p>
<p>In the &quot;single-writer, multiple-reader&quot; case, a transacted storage object is opened for write access, but is shared with readers. That is, the storage object is opened by the writer with <strong>STGM_TRANSACTED</strong>, access of <strong>STGM_READWRITE</strong> or <strong>STGM_WRITE</strong>, and sharing of <strong>STGM_SHARE_DENY_WRITE</strong>. The storage is opened by readers with <strong>STGM_TRANSACTED</strong>, access of <strong>STGM_READ</strong>, and sharing of <strong>STGM_SHARE_DENY_NONE</strong>. In this case the writer uses the scratch area to store uncommitted changes. As in the cases above, the reader incurs an open-time performance penalty while a snapshot copy of the data is created.</p>
<p>Typically, the scratch area is a temporary file, separate from the original data. When changes are committed to the original file, the data must be transferred from the temporary file. To avoid this data transfer, the <strong>STGM_NOSCRATCH</strong>flag may be specified. When this flag is specified, portions of the storage object file are used for the scratch area, rather than a separate temporary file. As a result, committing changes can be performed quickly, because little data transfer is required. The disadvantage is that the storage file can become larger than it would otherwise be, because it must be grown to be large enough for both the original data and the scratch area. To consolidate the data and remove this unnecessary area, reopen the root storage in transacted mode, but without setting the <strong>STGM_NOSCRATCH</strong> flag. Then, call <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-commit"><strong>IStorage::Commit</strong></a> with the <strong>STGC_CONSOLIDATE</strong> flag set.</p>
<p>The snapshot area, like the scratch area, is also, typically, a temporary file, and this too can be affected with a STGM flag. By specifying the <strong>STGM_NOSNAPSHOT</strong> flag, a separate temporary snapshot file is not created. Instead, the original data is never modified, even if there are one or more writers per object. When changes are committed, they are added to the file, but the original data remains intact. This mode increases efficiency because it reduces run time by eliminating the requirement of creating a snapshot during the open operation. However, using this mode may result in a very large storage file because data in the file can never be overwritten. This is no limit to the size of files opened in NoSnapshot mode.</p>
<h3>Direct Single-Writer, Multiple-Reader Mode</h3>
<p>As described, it is possible to have a single writer and multiple readers of a storage object, if that object is opened in transacted mode. It is also possible to achieve the single-writer, multireader case in direct mode, by specifying the <strong>STGM_DIRECT_SWMR</strong> flag.</p>
<p>In <strong>STGM_DIRECT_SWMR</strong> mode, it is possible for one caller to open an object for read/write access, while other callers simultaneously have the file open for read-only access. It is not valid to use this flag in combination with the <strong>STGM_TRANSACTED</strong> flag. In this mode, the writer opens the object with the following flags:</p>
<p><strong>STGM_DIRECT_SWMR</strong> | <strong>STGM_READWRITE</strong> | <strong>STGM_SHARE_DENYWRITE</strong></p>
<p>and each of the readers opens the object with these flags:</p>
<p><strong>STGM_DIRECT_SWMR</strong> | <strong>STGM_READ</strong> | <strong>STGM_SHARE_DENY_NONE</strong></p>
<p>In this mode, to modify the storage object, the writer must get exclusive access to the object. This is possible when all the readers have closed it. The writer uses the <a href="/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock"><strong>IDirectWriterLock</strong></a> interface to obtain this exclusive access.</p>
<h3>Simple Mode</h3>
<p>Simple mode (<strong>STGM_SIMPLE</strong>) is useful for applications that perform complete save operations. It is efficient, but has the following constraints:</p>
<ul>
<li>No support exists for substorages.</li>
<li>The storage object, and stream objects obtained from it, cannot be marshaled.</li>
<li>Each stream has a minimum size. If fewer than the minimum bytes are written into a stream when the stream is released, the stream is extended to the minimum size. For example, the minimum size for a particular <a href="/windows/desktop/api/Objidl/nn-objidl-istream"><strong>IStream</strong></a> implementation is 4 KB. A stream is created and 1 KB is written to it. At the final release of that <strong>IStream</strong>, the stream size will be automatically extended to 4 KB. Subsequently, opening the stream and calling the <a href="/windows/desktop/api/Objidl/nf-objidl-istream-stat"><strong>IStream::Stat</strong></a> method will show a size of 4 KB.</li>
<li>Not all methods of <a href="/windows/desktop/api/Objidl/nn-objidl-istorage"><strong>IStorage</strong></a> or <a href="/windows/desktop/api/Objidl/nn-objidl-istream"><strong>IStream</strong></a> will be supported by the implementation. For more information, see <a href="istorage-compound-file-implementation.html">IStorage - Compound File Implementation</a>, and <a href="istream-compound-file-implementation.html">IStream - Compound File Implementation</a>.</li>
</ul>
<p><a href="/windows/desktop/Midl/marshaling-ole-data-types">Marshaling</a> is the process of packaging, unpackaging, and sending interface method parameters across thread or process boundaries within a Remote Procedure Call (RPC). For more information, see <a href="../com/marshaling-details.html">Marshaling Details</a> and <a href="../com/interface-marshaling.html">Interface Marshaling</a>.</p>
<p>When a storage object is obtained by a Create operation in simple mode:</p>
<ul>
<li>Stream elements can be created, but not opened.</li>
<li>When a stream element is created by calling <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-createstream"><strong>IStorage::CreateStream</strong></a>, it is not possible to create another stream until that stream object is released.</li>
<li>After all streams are written, call <a href="/windows/desktop/api/Objidl/nf-objidl-istorage-commit"><strong>IStorage::Commit</strong></a> to flush the changes.</li>
</ul>
<p>When a storage object is obtained by an Open operation in simple mode:</p>
<ul>
<li>It is possible to open only one stream element at a time.</li>
<li>It is not possible to change the size of a stream by calling the <a href="/windows/desktop/api/Objidl/nf-objidl-istream-setsize"><strong>IStream::SetSize</strong></a> method or by seeking or writing beyond the end of the stream. However, because all streams are of a minimum size, it is possible to use the stream up to that size, even if less data was originally written to it. To determine the size of a stream, use the <a href="/windows/desktop/api/Objidl/nf-objidl-istream-stat"><strong>IStream::Stat</strong></a> method.</li>
</ul>
<p>Be aware that, if a storage element is modified by a storage object that is not in simple mode, it will not be possible, again, to open that storage element in simple mode.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows 2000 Professional [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows 2000 Server [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->ObjBase.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Objidl/nf-objidl-isequentialstream-read"><strong>ISequentialStream::Read</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/Objidl/nn-objidl-istorage"><strong>IStorage</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile"><strong>StgCreateDocfile</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfileonilockbytes"><strong>StgCreateDocfileOnILockBytes</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex"><strong>StgCreateStorageEx</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage"><strong>StgOpenStorage</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex"><strong>StgOpenStorageEx</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageonilockbytes"><strong>StgOpenStorageOnILockBytes</strong></a></p>
<!-- raw HTML omitted -->
</body>
