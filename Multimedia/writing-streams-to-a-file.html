<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Writing Streams to a File</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Writing Streams to a File
description: Writing Streams to a File
ms.assetid: a3766f8c-aaa6-4fc5-a306-54aee71018f1
keywords:</p>
<ul>
<li>AVIFileCreateStream function
ms.topic: article
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</li>
</ul>
<hr />
<h1>Writing Streams to a File</h1>
<p>[The feature associated with this page, <a href="/windows/win32/multimedia/avifile-functions-and-macros">AVIFile Functions and Macros</a>, is a legacy feature. It has been superseded by <a href="/windows/win32/medfound/source-reader">Source Reader</a>. <strong>Source Reader</strong> has been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>Source Reader</strong> instead of <strong>AVIFile Functions and Macros</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<p>You can also create a file containing data streams by writing a new data stream to a file.</p>
<p>You can create a new stream in a new or existing file by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avifilecreatestream"><strong>AVIFileCreateStream</strong></a> function. This function defines a new stream according to the characteristics described in an <a href="/windows/desktop/api/Vfw/ns-vfw-avistreaminfoa"><strong>AVISTREAMINFO</strong></a> structure, creates a stream interface for the new stream, increments the reference count of the stream, and returns the address of the stream-interface pointer.</p>
<p>Before you write the content of the stream, you must specify the stream format. You can set the stream format by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamsetformat"><strong>AVIStreamSetFormat</strong></a> function. When setting the format of a video stream, you must supply this function with a <a href="/windows/win32/api/wingdi/ns-wingdi-bitmapinfo"><strong>BITMAPINFO</strong></a> structure containing the appropriate information. When setting the format of an audio stream, you must supply a <a href="/windows/win32/api/mmreg/ns-mmreg-waveformat"><strong>WAVEFORMAT</strong></a> or <a href="/windows/win32/api/mmeapi/ns-mmeapi-waveformatex"><strong>WAVEFORMATEX</strong></a> structure containing the appropriate information. The information you need to supply to the function for other stream types depends on the stream type and the stream handler.</p>
<p>You can write the multimedia content in a stream by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamwrite"><strong>AVIStreamWrite</strong></a> function. This function copies raw data from an application-supplied buffer into the specified stream. The default AVI file handler appends information to the end of a stream. The default WAVE handler can write waveform-audio data within a stream as well as at the end of a stream.</p>
<p>You can write supplementary information about the file or stream that is not included in the <a href="/windows/desktop/api/Vfw/nf-vfw-avifilecreatestream"><strong>AVIFileCreateStream</strong></a> or <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamsetformat"><strong>AVIStreamSetFormat</strong></a> function by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avifilewritedata"><strong>AVIFileWriteData</strong></a> and <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamwritedata"><strong>AVIStreamWriteData</strong></a> functions. You can record data that is applicable to the entire file, such as copyright information and modification history, by using <strong>AVIFileWriteData</strong>. You can record stream-specific information, such as compression and decompression settings, by using <strong>AVIStreamWriteData</strong>. The supplementary information is stored in separate chunks within the file.</p>
<p>You can close the stream after you finish writing to the new stream by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamrelease"><strong>AVIStreamRelease</strong></a> function. This function clears buffers used in recording the stream data, and it completes and closes any incomplete data chunks in the file.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="stream-operations.html">Stream Operations</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
