<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Opening and Closing Files</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Opening and Closing Files
description: Opening and Closing Files
ms.assetid: 72655d33-f685-4205-a982-f7cd20c59f22
keywords:</p>
<ul>
<li>AVIFileOpen function</li>
<li>AVIFileRelease function
ms.topic: article
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</li>
</ul>
<hr />
<h1>Opening and Closing Files</h1>
<p>[The feature associated with this page, <a href="/windows/win32/multimedia/avifile-functions-and-macros">AVIFile Functions and Macros</a>, is a legacy feature. It has been superseded by <a href="/windows/win32/medfound/source-reader">Source Reader</a>. <strong>Source Reader</strong> has been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>Source Reader</strong> instead of <strong>AVIFile Functions and Macros</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<p>An application must open an AVI file before reading or writing. To open an AVI file, use the <a href="/windows/desktop/api/Vfw/nf-vfw-avifileopen"><strong>AVIFileOpen</strong></a> function. <strong>AVIFileOpen</strong> returns the address of an AVI file interface that contains the handle of the open file and increments the reference count of the file.</p>
<p>The <strong>AVIFileOpen</strong> function supports the OF flags used with the <a href="/windows/win32/api/winbase/nf-winbase-openfile">OpenFile</a> function. If an application writes to an existing file, it must include the OF_WRITE flag in <strong>AVIFileOpen</strong>. Similarly, if your application creates and writes to a new file, you must include the OF_CREATE and OF_WRITE flags in <strong>AVIFileOpen</strong>.</p>
<p>When you open a file using <strong>AVIFileOpen</strong>, you can use a default file handler or you can specify a custom file handler to read and write to the file and its data streams. In either case, AVIFile searches the registry for the correct file handler to use. You must ensure custom file handlers are in the registry before an application can access them.</p>
<p>You can increment the reference count of a file by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avifileaddref"><strong>AVIFileAddRef</strong></a> function. For example, you might want to do this when passing a handle of the file interface to another application, or when you want to keep a file open while using a function that would normally close the file.</p>
<p>You can close a file by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avifilerelease"><strong>AVIFileRelease</strong></a> function. The <strong>AVIFileRelease</strong> function decrements the reference count of an AVI file, saves changes made to the file, and when the reference count reaches zero, closes the file. Your applications should balance the reference count by including a call to <strong>AVIFileRelease</strong> for each use of <a href="/windows/desktop/api/Vfw/nf-vfw-avifileopen"><strong>AVIFileOpen</strong></a> and <strong>AVIFileAddRef</strong>.</p>
<blockquote>
<p>[!NOTE]
An application can open a file with one or more program threads. However, for the best possible performance, only one thread should access the file at any one time.</p>
</blockquote>
</body>
