<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Opening and Closing Streams</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Opening and Closing Streams
description: Opening and Closing Streams
ms.assetid: 7dcaccbe-63d8-410a-ae00-16ce9e252ad0
keywords:</p>
<ul>
<li>AVIFileGetStream function</li>
<li>AVIStreamRelease function
ms.topic: article
ms.date: 4/26/2023
ms.custom: UpdateFrequency5</li>
</ul>
<hr />
<h1>Opening and Closing Streams</h1>
<p>[The feature associated with this page, <a href="/windows/win32/multimedia/avifile-functions-and-macros">AVIFile Functions and Macros</a>, is a legacy feature. It has been superseded by <a href="/windows/win32/medfound/source-reader">Source Reader</a>. <strong>Source Reader</strong> has been optimized for Windows 10 and Windows 11. Microsoft strongly recommends that new code use <strong>Source Reader</strong> instead of <strong>AVIFile Functions and Macros</strong>, when possible. Microsoft suggests that existing code that uses the legacy APIs be rewritten to use the new APIs if possible.]</p>
<p>Opening data streams is similar to opening files. You can open a stream by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avifilegetstream"><strong>AVIFileGetStream</strong></a> function. This function creates a stream interface, places a handle of the stream in the interface, and returns a pointer to the interface. <strong>AVIFileGetStream</strong> also maintains a reference count of the applications that have opened a stream, but not of those that have closed it.</p>
<p>If you want to access a single stream in a file, you can open the file and the stream by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamopenfromfilea"><strong>AVIStreamOpenFromFile</strong></a> function. This function combines the operations and function arguments of the <a href="/windows/desktop/api/Vfw/nf-vfw-avifileopen"><strong>AVIFileOpen</strong></a> and <strong>AVIFileGetStream</strong> functions.</p>
<p>To access more than one stream in a file, use <strong>AVIFileOpen</strong> once followed by multiple calls to <strong>AVIFileGetStream</strong>.</p>
<p>You can increment the reference count of a stream by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamaddref"><strong>AVIStreamAddRef</strong></a> function to keep a stream open when using a function that would normally close the stream.</p>
<p>You can close a stream by using the <a href="/windows/desktop/api/Vfw/nf-vfw-avistreamrelease"><strong>AVIStreamRelease</strong></a> function. This function decrements the reference count of the stream and closes it when the reference count reaches zero. Your applications should balance the reference count by including a call to <strong>AVIStreamRelease</strong> for each use of the <a href="/windows/desktop/api/Vfw/nf-vfw-avifilegetstream"><strong>AVIFileGetStream</strong></a>, <a href="/windows/desktop/api/Vfw/nf-vfw-avifilecreatestream"><strong>AVIFileCreateStream</strong></a>, <strong>AVIStreamAddRef</strong>, or <strong>AVIStreamOpenFromFile</strong> function. When you release a stream that has been opened by using <strong>AVIStreamOpenFromFile</strong>, AVIFile closes the file containing the stream. If your application releases a file that has open data streams, AVIFile will not close the streams until all of the streams are released.</p>
<p>Â </p>
<p>Â </p>
</body>
