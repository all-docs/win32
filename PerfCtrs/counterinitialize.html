<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>CounterInitialize function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Registers the provider and initializes the counter sets.
ms.assetid: edcf8df3-0f6d-4849-b41d-270509499b8e
title: CounterInitialize function
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>CounterInitialize
api_type:</li>
<li>NA
api_location:</li>
</ul>
<hr />
<h1>CounterInitialize function</h1>
<p>Registers the provider and initializes the counter sets.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>ULONG WINAPI CounterInitialize(void);
</code></pre>
<h2>Parameters</h2>
<p>This function has no parameters.</p>
<h2>Return value</h2>
<p>Returns ERROR_SUCCESS on success; otherwise, a standard Win32 error code.</p>
<h2>Remarks</h2>
<p>Your provider calls this function. The function includes calls to the <a href="/windows/desktop/api/Perflib/nf-perflib-perfstartprovider"><strong>PerfStartProvider</strong></a> function and the <a href="/windows/desktop/api/Perflib/nf-perflib-perfsetcountersetinfo"><strong>PerfSetCounterSetInfo</strong></a> function.</p>
<p>The <a href="ctrpp.html"><strong>CTRPP</strong></a> tool generates this inline function when you specify the <strong>-o</strong> argument. The function's name include a <em>prefix</em> string if you specify the <strong>-prefix</strong> argument.</p>
<p>If you specify the <strong>-MemoryRoutines</strong> or <strong>-NotificationCallback</strong> arguments (or specify the <strong>callback</strong> attribute for the <a href="/windows/desktop/PerfCtrs/performance-counters-provider--counters--element"><strong>provider</strong></a> element), the <strong>CounterInitialize</strong> signature changes to the following:</p>
<pre lang="syntax"><code>ULONG WINAPI CounterInitialize(
    __in_opt PERFLIBREQUEST NotificationCallback,
    __in_opt PERF_MEM_ALLOC MemoryAllocationFunction,
    __in_opt PERF_MEM_FREE MemoryFreeFunction,
    __inout_opt PVOID MemoryFunctionContext
);
</code></pre>
<p>where,</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->NotificationCallback</p>
<!-- raw HTML omitted -->
<p>The name of your <a href="/windows/desktop/api/Perflib/nc-perflib-perflibrequest"><em>ControlCallback</em></a> callback function that you implement to receive notification of consumer requests (for example, requests to add or remove counters from the query). Set to <strong>NULL</strong> if you do not implement the <em>ControlCallback</em> callback function.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->MemoryAllocationFunction</p>
<!-- raw HTML omitted -->
<p>The name of your <a href="/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc"><em>AllocateMemory</em></a> callback function that PERFLIB calls to allocate memory. Set to <strong>NULL</strong> if you did not specify the <strong>-MemoryRoutines</strong> argument.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->MemoryFreeFunction</p>
<!-- raw HTML omitted -->
<p>The name of your <a href="/windows/desktop/api/Perflib/nc-perflib-perf_mem_free"><em>FreeMemory</em></a> callback function that PERFLIB calls to free the memory allocated using the <a href="/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc"><em>AllocateMemory</em></a> function. Set to <strong>NULL</strong> if <em>MemoryAllocationFunction</em> is <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->MemoryFunctionContext</p>
<!-- raw HTML omitted -->
<p>Context information to pass to your memory allocation and free routines. Can be <strong>NULL</strong>.</p>
<!-- raw HTML omitted -->
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows 7 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2008 R2 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
</body>
