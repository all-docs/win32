<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Performance Counters Functions</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Use the following functions to consume and provide performance data.
ms.assetid: a2c97b8b-b1b1-4dd8-8f23-edffaa74d028
title: Performance Counters Functions
ms.topic: article
ms.date: 08/17/2020</h2>
<h1>Performance Counters Functions</h1>
<p>Use the following functions to consume and provide performance data.</p>
<h2>Consumer functions</h2>
<h3>Performance Data Helper (PDH) functions</h3>
<p>Use the Performance Data Helper (PDH) functions to consume performance data from both V1 and V2 performance data providers.</p>
<blockquote>
<p>[!Note]
Windows OneCore apps cannot use the PDH functions. If you are writing Windows OneCore apps, use <a href="using-the-perflib-functions-to-consume-counter-data.html">PerfLib V2 Consumer functions</a>.</p>
</blockquote>
<ul>
<li><a href="/windows/desktop/api/Pdh/nc-pdh-counterpathcallback"><em>CounterPathCallBack</em></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera"><strong>PdhAddCounter</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhaddenglishcountera"><strong>PdhAddEnglishCounter</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea"><strong>PdhBindInputDataSource</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersa"><strong>PdhBrowseCounters</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersha"><strong>PdhBrowseCountersH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhcalculatecounterfromrawvalue"><strong>PdhCalculateCounterFromRawValue</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhcloselog"><strong>PdhCloseLog</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhclosequery"><strong>PdhCloseQuery</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata"><strong>PdhCollectQueryData</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydataex"><strong>PdhCollectQueryDataEx</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydatawithtime"><strong>PdhCollectQueryDataWithTime</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics"><strong>PdhComputeCounterStatistics</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhconnectmachinea"><strong>PdhConnectMachine</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhenumlogsetnamesa"><strong>PdhEnumLogSetNames</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhenummachinesa"><strong>PdhEnumMachines</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhenummachinesha"><strong>PdhEnumMachinesH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa"><strong>PdhEnumObjectItems</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsha"><strong>PdhEnumObjectItemsH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa"><strong>PdhEnumObjects</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsha"><strong>PdhEnumObjectsH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhexpandcounterpatha"><strong>PdhExpandCounterPath</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha"><strong>PdhExpandWildCardPath</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpathha"><strong>PdhExpandWildCardPathH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhformatfromrawvalue"><strong>PdhFormatFromRawValue</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetcounterinfoa"><strong>PdhGetCounterInfo</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetcountertimebase"><strong>PdhGetCounterTimeBase</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea"><strong>PdhGetDataSourceTimeRange</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangeh"><strong>PdhGetDataSourceTimeRangeH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetdefaultperfcountera"><strong>PdhGetDefaultPerfCounter</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetdefaultperfcounterha"><strong>PdhGetDefaultPerfCounterH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetdefaultperfobjecta"><strong>PdhGetDefaultPerfObject</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetdefaultperfobjectha"><strong>PdhGetDefaultPerfObjectH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetdllversion"><strong>PdhGetDllVersion</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcounterarraya"><strong>PdhGetFormattedCounterArray</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue"><strong>PdhGetFormattedCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetlogfilesize"><strong>PdhGetLogFileSize</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcounterarraya"><strong>PdhGetRawCounterArray</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcountervalue"><strong>PdhGetRawCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhisrealtimequery"><strong>PdhIsRealTimeQuery</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhlookupperfindexbynamea"><strong>PdhLookupPerfIndexByName</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhlookupperfnamebyindexa"><strong>PdhLookupPerfNameByIndex</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhmakecounterpatha"><strong>PdhMakeCounterPath</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhopenloga"><strong>PdhOpenLog</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya"><strong>PdhOpenQuery</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh"><strong>PdhOpenQueryH</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhparsecounterpatha"><strong>PdhParseCounterPath</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhparseinstancenamea"><strong>PdhParseInstanceName</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhreadrawlogrecord"><strong>PdhReadRawLogRecord</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhremovecounter"><strong>PdhRemoveCounter</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhselectdatasourcea"><strong>PdhSelectDataSource</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhsetcounterscalefactor"><strong>PdhSetCounterScaleFactor</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhsetdefaultrealtimedatasource"><strong>PdhSetDefaultRealTimeDataSource</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhsetquerytimerange"><strong>PdhSetQueryTimeRange</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga"><strong>PdhUpdateLog</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhupdatelogfilecatalog"><strong>PdhUpdateLogFileCatalog</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhvalidatepatha"><strong>PdhValidatePath</strong></a></li>
<li><a href="/windows/desktop/api/Pdh/nf-pdh-pdhvalidatepathexa"><strong>PdhValidatePathEx</strong></a></li>
</ul>
<h3>PerfLib V2 Consumer functions</h3>
<p>Use the PerfLib V2 Consumer functions to consume performance data from V2 performance data providers if you cannot use the Performance Data Helper (PDH) functions. These functions might be used when writing OneCore applications to collect V2 countersets or when you need to collect specific V2 countersets with minimal dependencies and overhead.</p>
<blockquote>
<p>[!TIP]
The PerfLib V2 Consumer functions are harder to use than the Performance Data Helper (PDH) functions and only support collecting data from V2 providers. The PDH functions should be preferred for most applications.</p>
</blockquote>
<ul>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfaddcounters"><strong>PerfAddCounters</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfclosequeryhandle"><strong>PerfCloseQueryHandle</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfdeletecounters"><strong>PerfDeleteCounters</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfenumeratecounterset"><strong>PerfEnumerateCounterSet</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfenumeratecountersetinstances"><strong>PerfEnumerateCounterSetInstances</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfopenqueryhandle"><strong>PerfOpenQueryHandle</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfquerycounterdata"><strong>PerfQueryCounterData</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfquerycounterinfo"><strong>PerfQueryCounterInfo</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfquerycountersetregistrationinfo"><strong>PerfQueryCounterSetRegistrationInfo</strong></a></li>
</ul>
<h2>Provider functions</h2>
<h3>PerfLib V2 Provider functions</h3>
<p><a href="providing-counter-data-using-version-2-0.html">V2 performance data providers</a> use the following functions:</p>
<ul>
<li><a href="/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc"><em>AllocateMemory</em></a></li>
<li><a href="/windows/desktop/api/Perflib/nc-perflib-perflibrequest"><em>ControlCallback</em></a></li>
<li><a href="countercleanup.html"><strong>CounterCleanup</strong></a></li>
<li><a href="counterinitialize.html"><strong>CounterInitialize</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nc-perflib-perf_mem_free"><em>FreeMemory</em></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfcreateinstance"><strong>PerfCreateInstance</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfdecrementulongcountervalue"><strong>PerfDecrementULongCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfdecrementulonglongcountervalue"><strong>PerfDecrementULongLongCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfdeleteinstance"><strong>PerfDeleteInstance</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfincrementulongcountervalue"><strong>PerfIncrementULongCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfincrementulonglongcountervalue"><strong>PerfIncrementULongLongCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfqueryinstance"><strong>PerfQueryInstance</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfsetcountersetinfo"><strong>PerfSetCounterSetInfo</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfsetulongcountervalue"><strong>PerfSetULongCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfsetulonglongcountervalue"><strong>PerfSetULongLongCounterValue</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfsetcounterrefvalue"><strong>PerfSetCounterRefValue</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfstartprovider"><strong>PerfStartProvider</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfstartproviderex"><strong>PerfStartProviderEx</strong></a></li>
<li><a href="/windows/desktop/api/Perflib/nf-perflib-perfstopprovider"><strong>PerfStopProvider</strong></a></li>
</ul>
<blockquote>
<p>[!Note]
To install and uninstall V2 providers, use the <strong>lodctr</strong> and <strong>unlodctr</strong> tools. The <strong>LoadPerfCounterTextStrings</strong> and <strong>UnloadPerfCounterTextStrings</strong> functions cannot be used to install and uninstall V2 providers.</p>
</blockquote>
<h3>Performance DLL functions</h3>
<p><a href="providing-counter-data-using-a-performance-dll.html">V1 performance data providers</a> implement a DLL that provides the following functions:</p>
<ul>
<li><a href="/windows/win32/api/winperf/nc-winperf-pm_close_proc"><em>ClosePerformanceData</em></a></li>
<li><a href="/windows/win32/api/winperf/nc-winperf-pm_collect_proc"><em>CollectPerformanceData</em></a></li>
<li><a href="/previous-versions/windows/desktop/legacy/aa372200(v=vs.85)"><em>OpenPerformanceData</em></a></li>
</ul>
<blockquote>
<p>[!Note]
Due to significant performance and reliability issues, V1 performance data providers are deprecated. Although you still can use a performance extension DLL to provide counter data, you are encouraged to <a href="providing-counter-data-using-version-2-0.html">create a V2 provider</a> instead. You also are encouraged to replace existing V1 providers with V2 providers.</p>
</blockquote>
<p>V1 providers can be installed and uninstalled using the <strong>lodctr</strong> and <strong>unlodctr</strong> tools or by calling the following functions:</p>
<ul>
<li><a href="/windows/desktop/api/Loadperf/nf-loadperf-loadperfcountertextstringsa"><strong>LoadPerfCounterTextStrings</strong></a></li>
<li><a href="/windows/desktop/api/Loadperf/nf-loadperf-unloadperfcountertextstringsa"><strong>UnloadPerfCounterTextStrings</strong></a></li>
</ul>
</body>
