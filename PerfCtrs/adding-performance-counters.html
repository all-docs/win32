<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Adding Performance Counters</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Performance counters specific to your application can help you tune performance while you develop and debug the application.
ms.assetid: 016386f6-4675-409e-8446-599e4ff96109
title: Adding Performance Counters
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Adding Performance Counters</h1>
<blockquote>
<p>[!IMPORTANT]
Due to significant performance and reliability limitations, the method for providing performance counter data that this topic describes may be altered or unavailable in the future. Instead, Microsoft recommends that you use the method described in <a href="providing-counter-data-using-version-2-0.html">Providing Counter Data Using Version 2.0</a> for creating new performance counters, and that you migrate existing performance counters to use that method as well.</p>
</blockquote>
<p>Performance counters specific to your application can help you tune performance while you develop and debug the application. After your application is complete and installed on target systems, the counters can help system administrators adjust configurable settings for your application.</p>
<h2>Adding a performance object and its counters</h2>
<ol>
<li>Design the object types and counters for the application. For details, see <a href="object-and-counter-design.html">Object and Counter Design</a>.</li>
<li>Create an initialization (.ini) file containing the names and descriptions of the performance objects and counters that you provide. For details, see <a href="adding-counter-names-and-descriptions-to-the-registry.html">Adding Counter Names and Descriptions to the Registry</a>.</li>
<li>Create a header (.h) file containing the relative offsets at which the counter objects and counters will be installed in the registry. For details, see <a href="adding-counter-names-and-descriptions-to-the-registry.html">Adding Counter Names and Descriptions to the Registry</a>.</li>
<li>Set up the necessary performance monitoring entries in the registry. This includes the following steps.
<ol>
<li>Create a registry key in the <strong>Services</strong> key for the application. If you do not have such a node, create it under the following registry key: <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services</code>. For details, see <a href="creating-the-applications-performance-key.html">Creating the Application's Performance Key</a>.</li>
<li>Use the <strong>lodctr</strong> utility with the .ini and .h files to install the information in the registry. This utility succeeds only if a performance key exists in the <strong>Services</strong> key for the application. For details, see <a href="adding-counter-names-and-descriptions-to-the-registry.html">Adding Counter Names and Descriptions to the Registry</a>.</li>
</ol>
</li>
<li>Create a performance DLL containing a set of exported functions that provide the queried counter data to the consumer. For details, see <a href="creating-a-performance-extension-dll.html">Creating a Performance Extension DLL</a>.</li>
<li>Modify the application's setup file to automate adding information to the registry (as described in step 4) and copy your performance DLL to your application's directory at setup.</li>
</ol>
<p>For information about additional registry entries, see <a href="creating-other-registry-entries.html">Creating Other Registry Entries</a>.</p>
</body>
