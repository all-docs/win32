<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Dealing with #defines in IDL Files</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Dealing with  defines in IDL Files
description: This page describes why symbols defined with a \ define disappear from the MIDL compiler generated H files, and what can be done about it. This explanation applies to any files processed by MIDL, such as \ .idl, \ .acf, \ .h files.
ms.assetid: 148dabda-96cc-4f7c-abc7-4bf78ac166ea
keywords:</p>
<ul>
<li>MIDL compiler MIDL , dealing with defines</li>
<li>defines MIDL
ms.topic: article
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1>Dealing with #defines in IDL Files</h1>
<p>This page describes why symbols defined with a <strong>#define</strong> disappear from the MIDL compiler generated H files, and what can be done about it. This explanation applies to any files processed by MIDL, such as *.idl, *.acf, *.h files.</p>
<p>The disappearance of <strong>#define</strong> symbols is a result of MIDL delegating the preprocessing of input files to a preprocessor. By default, the preprocessor is a C/C++ preprocessor from the build environment. After preprocessing, the input stream MIDL receives has only #line preprocessor directives. In particular, the preprocessor unrolls all macro definitions in input files, and therefore, MIDL cannot detect their presence. Consequently, when MIDL replicates type definitions from an input file to the generated H file, the #defines are not replicated. Therefore, do not use #defines directly in IDL files if they are to be used later from the generated H file.</p>
<p>The following four workarounds are recommended:</p>
<ul>
<li>Use the <a href="const.html"><strong>const</strong></a> declaration specification.</li>
<li>Use separate header files that are imported or included in the IDL file, and later included in the C-source code.</li>
<li>Use enumeration constants in the IDL file.</li>
<li>Use <a href="cpp-quote.html"><strong>cpp_quote</strong></a> to reproduce <strong>#define</strong> in the generated header file.</li>
</ul>
<p>You can reproduce manifest constants using the <strong>IDL constant-declaration syntax</strong>. Note that the <a href="const.html"><strong>const</strong></a> in the IDL constant-declaration is different from C/C++ <strong>const</strong> semantics, and simply introduces a named constant for an IDL compilation. For example:</p>
<pre lang="syntax"><code>const short ARRSIZE = 10
</code></pre>
<p>This example specifies that <strong>ARRSIZE</strong> is a constant with a value of 10. Named constants can be used in IDL array declarators and other places where a C programmer would use a manifest defines. In addition, this syntax results in the following line being generated in the header file:</p>
<pre lang="syntax"><code>#define ARRSIZE 10
</code></pre>
<p>Another way to handle **#**define statements is to package them in a separate header file, either into a file devoted to **#**define statements or into a file that contains only type definitions. A file that contains only preprocessor directives may be safely included both by the IDL file and the C-source files. Although the directives will not be available in the header file generated by the MIDL compiler, the C-source program can include the separate header file. In a similar fashion, a header file with **#**define statements and regular type definitions can be imported from your IDL file. This approach encapsulates the **#**define and typedef statements by using them in an H file such that the **#**define symbols are not used in the importing IDL file directly. Importing a header or IDL file to another IDL file prevents the typedef statements from being replicated to the H file generated by MIDL (which is in contrast to **#**include statements). This approach allows the original header file to be safely referenced from the C code along the generated H file without having a problem with duplicated definitions.</p>
<p>Use of enumeration constants in the IDL file is also effective. These constants can be used in constant expressions in IDL, for example, in array declarators. Enumeration constants are not removed during the early phases of MIDL compilation by the C-compiler preprocessor, so enumeration constants are available in the header file generated by the MIDL compiler. Consider the following statement:</p>
<pre lang="syntax"><code>typedef enum midlworkaround { MAXSTRINGCOUNT = 300 };
</code></pre>
<p>This statement will not be removed during MIDL compilation by the C preprocessor and the typedef will be replicated to the generated H file. The constant MAXSTRINGCOUNT is available to C-source programs that include the header file generated by the MIDL compiler.</p>
<p>Finally, the <a href="cpp-quote.html"><strong>cpp_quote</strong></a> directive of MIDL can be used to write out an arbitrary string directly into the generated H file. For example, to get the manifest constant used previously on this page with <strong>cpp_quote</strong>, the following statement can be used:</p>
<pre lang="syntax"><code>cpp_quote (&quot;#define ARRSIZE 10&quot;)
</code></pre>
<p>This statement results in the following line being generated in the header file:</p>
<pre lang="syntax"><code>#define ARRSIZE 10
</code></pre>
<p>Â </p>
<p>Â </p>
</body>
