<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Receiving Events in a Service</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: A service that is a console application can register a console control handler to receive notification when a user logs off.
ms.assetid: 86ace8b8-c1cb-4646-bc92-86bd578a82c5
title: Receiving Events in a Service
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Receiving Events in a Service</h1>
<p>A service that is a console application can register a <a href="/windows/console/console-control-handlers">console control handler</a> to receive notification when a user logs off. However, there is no console event sent when an interactive user logs on. For information on receiving notification when a user logs on, see <a href="/windows/desktop/SecAuthN/creating-a-winlogon-notification-package">Creating a Winlogon Notification Package</a>.</p>
<p>The system broadcasts device change events to all services. These events can be received by a service in a window procedure or in its service control handler. To specify which events your service should receive, use the <a href="/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa"><strong>RegisterDeviceNotification</strong></a> function.</p>
<p>Be sure to handle Plug and Play device events as quickly as possible. Otherwise, the system may become unresponsive. If your event handler is to perform an operation that may block execution (such as I/O), it is best to start another thread to perform the operation asynchronously.</p>
<p>When a service calls <a href="/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa"><strong>RegisterDeviceNotification</strong></a>, the service also specifies either a window handle or a service status handle. If a service specifies a window handle, the window procedure receives the notification events. If a service specifies its service status handle, its service control handler receives the notification events. For more information, see <a href="/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex"><strong>HandlerEx</strong></a>.</p>
<p>Device notification handles returned by <a href="/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa"><strong>RegisterDeviceNotification</strong></a> must be closed by calling the <a href="/windows/desktop/api/winuser/nf-winuser-unregisterdevicenotification"><strong>UnregisterDeviceNotification</strong></a> function when they are no longer needed.</p>
<p>Â </p>
<p>Â </p>
</body>
