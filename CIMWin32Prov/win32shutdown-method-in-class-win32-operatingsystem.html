<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Win32Shutdown method of the Win32_OperatingSystem class</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: The Win32Shutdown &amp;#8194; WMI class method provides the full set of shutdown options supported by Win32 operating systems. These include logoff, shutdown, reboot, and forcing a logoff, shutdown, or reboot.
ms.assetid: 7108570a-81ba-46d5-8b05-de6194f93f18
ms.tgt_platform: multiple
title: Win32Shutdown method of the Win32_OperatingSystem class
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>Win32_OperatingSystem.Win32Shutdown
api_type:</li>
<li>COM
api_location:</li>
<li>CIMWin32.dll</li>
</ul>
<hr />
<h1>Win32Shutdown method of the Win32_OperatingSystem class</h1>
<p>The <strong>Win32Shutdown</strong> â€‚ <a href="../wmisdk/retrieving-a-class.html">WMI class</a> method provides the full set of shutdown options supported by Win32 operating systems. These include logoff, shutdown, reboot, and forcing a logoff, shutdown, or reboot.</p>
<p>This topic uses Managed Object Format (MOF) syntax. For more information about using this method, see <a href="../wmisdk/calling-a-method.html">Calling a Method</a>.</p>
<h2>Syntax</h2>
<pre lang="mof"><code>uint32 Win32Shutdown(
  [in]Â sint32 Flags,
  [in]Â sint32 Reserved = 
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>Flags</em> [in]</p>
<!-- raw HTML omitted -->
<p>Bitmapped set of flags to shut the computer down. To force a command, add the Force flag (4) to the command value. Using Force in conjunction with Shutdown or Reboot on a remote computer immediately shuts down everything (including WMI, COM, and so on), or reboots the remote computer. This results in an indeterminate return value.</p>
<!-- raw HTML omitted -->
<p>0 (0x0)</p>
<!-- raw HTML omitted -->
<p><strong>Log Off</strong> - Logs the user off the computer. Logging off stops all processes associated with the security context of the process that called the exit function, logs the current user off the system, and displays the logon dialog box.</p>
<!-- raw HTML omitted -->
<p>4 (0x4)</p>
<!-- raw HTML omitted -->
<p><strong>Forced Log Off (0 + 4)</strong> - Logs the user off the computer immediately and does not notify applications that the logon session is ending. This can result in a loss of data.</p>
<!-- raw HTML omitted -->
<p>1 (0x1)</p>
<!-- raw HTML omitted -->
<p><strong>Shutdown</strong> - Shuts down the computer to a point where it is safe to turn off the power. (All file buffers are flushed to disk, and all running processes are stopped.) Users see the message, <code>It is now safe to turn off your computer.</code></p>
<p>During shutdown the system sends a message to each running application. The applications perform any cleanup while processing the message and return True to indicate that they can be terminated.</p>
<!-- raw HTML omitted -->
<p>5 (0x5)</p>
<!-- raw HTML omitted -->
<p><strong>Forced Shutdown (1 + 4)</strong> - Shuts down the computer to a point where it is safe to turn off the power. (All file buffers are flushed to disk, and all running processes are stopped.) Users see the message,<code> It is now safe to turn off your computer.</code></p>
<p>When the forced shutdown approach is used, all services, including WMI, are shut down immediately. Because of this, you will not be able to receive a return value if you are running the script against a remote computer.</p>
<!-- raw HTML omitted -->
<p>2 (0x2)</p>
<!-- raw HTML omitted -->
<p><strong>Reboot</strong> - Shuts down and then restarts the computer.</p>
<!-- raw HTML omitted -->
<p>6 (0x6)</p>
<!-- raw HTML omitted -->
<p><strong>Forced Reboot (2 + 4)</strong> - Shuts down and then restarts the computer.</p>
<p>When the forced reboot approach is used, all services, including WMI, are shut down immediately. Because of this, you will not be able to receive a return value if you are running the script against a remote computer.</p>
<!-- raw HTML omitted -->
<p>8 (0x8)</p>
<!-- raw HTML omitted -->
<p><strong>Power Off</strong> - Shuts down the computer and turns off the power (if supported by the computer in question).</p>
<!-- raw HTML omitted -->
<p>12 (0xC)</p>
<!-- raw HTML omitted -->
<p><strong>Forced Power Off (8 + 4)</strong> - Shuts down the computer and turns off the power (if supported by the computer in question).</p>
<p>When the forced power off approach is used, all services, including WMI, are shut down immediately. Because of this, you will not be able to receive a return value if you are running the script against a remote computer.</p>
<!-- raw HTML omitted -->
<p><em>Reserved</em> [in]</p>
<!-- raw HTML omitted -->
<p>A means to extend <strong>Win32Shutdown</strong>. Currently, the <em>Reserved</em> parameter is ignored.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>Returns zero (0) to indicate success. Any other number indicates an error. For error codes, see <a href="../wmisdk/wmi-error-constants.html"><strong>WMI Error Constants</strong></a> or <a href="/windows/win32/api/wbemdisp/ne-wbemdisp-wbemerrorenum"><strong>WbemErrorEnum</strong></a>. For general <strong>HRESULT</strong> values, see <a href="../debug/system-error-codes.html">System Error Codes</a>.</p>
<!-- raw HTML omitted -->
<p><strong>Success</strong> (0)</p>
<!-- raw HTML omitted -->
<p><strong>Other</strong> (1â€“4294967295)</p>
<!-- raw HTML omitted -->
<h2>Remarks</h2>
<p>For more efficient management of computers in an organization, administrators need the ability to remotely shut down or restart a computer, or to remotely log off a user. The ability to carry out these tasks allows administrators to install software, reconfigure computer settings, remove computers from the network, and perform other tasks without having to manually shut down or restart each computer.</p>
<p>For example, to perform a network upgrade, you might need to shut down all the computers running on a particular network segment. To force a Group Policy upgrade, you need to log users off their computers. If a computer virus is present anywhere in your organization, you might want to shut down as many computers as possible, before the virus has an opportunity to spread. The ability to shut down and restart computers and to log off users programmatically instead of manually can be an enormous time-saver.</p>
<p>The calling process must have the <strong>SE_SHUTDOWN_NAME</strong> privilege.</p>
<p>The <a href="win32shutdowntracker-method-in-class-win32-operatingsystem.html"><strong>Win32ShutdownTracker</strong></a> method provides the same set of shutdown options supported by the <strong>Win32Shutdown</strong> method in <a href="win32-operatingsystem.html"><strong>Win32_OperatingSystem</strong></a> but it also allows you to specify comments, a reason for shutdown, or a timeout.</p>
<p>The Win32Shutdown method does not have a parameter for locking a workstation, leaving the user logged on. However, workstations can be locked from the command line by using the following command:</p>
<p><code>% windir %\System32\rundll32.exe user32.dll,LockWorkStation</code></p>
<h2>Examples</h2>
<p>The following PowerShell example uses the Win32Shutdown method to shut down the specified computer.</p>
<pre lang="PowerShell"><code>$computername= &quot;.&quot;
$win32OS = get-wmiobject win32_operatingsystem -computername $computername
$win32OS.psbase.Scope.Options.EnablePrivileges = $true
$win32OS.win32shutdown(8)
</code></pre>
<p>The following PowerShell code sample uses the EnableAllPrivileges from get-wmiobject cmdlet to achieve the proper priviliges.</p>
<pre lang="PowerShell"><code>$win32OS = get-wmiobject win32_operatingsystem -computername $computername -EnableAllPrivileges
$win32OS.win32shutdown(8)
</code></pre>
<p>The following VB.NET sample code uses the Shutdown method to reboot or log off a system.</p>
<pre lang="VB"><code>Dim

testResult AsSingle

Dim WMIServiceObject, ComputerObject AsObject 

'Now get some privileges 

WMIServiceObject = GetObject(
&quot;Winmgmts:{impersonationLevel=impersonate,(Debug,Shutdown)}&quot;)
ForEach ComputerObject In WMIServiceObject.InstancesOf(&quot;Win32_OperatingSystem&quot;) 
    testResult = ComputerObject.Win32Shutdown(2 + 4, 0) 
    'reboot
    'testResult = ComputerObject.Win32Shutdown(0, 0) 'logoff 
    ' testResult = ComputerObject.Win32Shutdown(8 + 4, 0) 'shutdown 

If testResult &lt;&gt; 0 Then 

MsgBox(&quot;Sorry, an error has occurred while trying to perform selected operation&quot;) 

Else 

'Operation selected in statement above if condition would be carried out 

EndIf 

Next
</code></pre>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>WindowsÂ Vista<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows ServerÂ 2008<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Namespace<!-- raw HTML omitted --></td>
<td>Root\CIMV2<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>MOF<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->CIMWin32.mof<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->CIMWin32.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="./operating-system-classes.html">Operating System Classes</a></p>
<!-- raw HTML omitted -->
<p><a href="win32-operatingsystem.html"><strong>Win32_OperatingSystem</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="win32shutdowntracker-method-in-class-win32-operatingsystem.html"><strong>Win32ShutdownTracker</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="../wmisdk/wmi-tasks--desktop-management.html">WMI Tasks: Desktop Management</a></p>
<!-- raw HTML omitted -->
<p><a href="../wmisdk/executing-privileged-operations-using-vbscript.html">Executing Privileged Operations Using VBScript</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
