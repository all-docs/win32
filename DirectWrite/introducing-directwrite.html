<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Introducing DirectWrite</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Introducing DirectWrite
description: People communicate with text all the time in their daily lives.
ms.assetid: ec7cc4a3-b925-48dc-920f-fd293b4c69f0
keywords:</p>
<ul>
<li>DirectWrite,about</li>
<li>DirectWrite,typographic features</li>
<li>typography</li>
<li>DirectWrite,international text</li>
<li>DirectWrite,OpenType fonts</li>
<li>OpenType fonts</li>
<li>DirectWrite,ClearType</li>
<li>ClearType</li>
<li>DirectWrite,API overview</li>
<li>DirectWrite,IDWriteFontFace</li>
<li>IDWriteFontFace</li>
<li>DirectWrite,text rendering</li>
<li>DirectWrite,rendering modes</li>
<li>DirectWrite,GDI interoperation</li>
<li>DirectWrite,interoperability</li>
<li>interoperability,DirectWrite</li>
<li>interoperability,Graphics Device Interface (GDI)</li>
<li>Graphics Device Interface (GDI)</li>
<li>GDI (Graphics Device Interface)
ms.topic: article
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1>Introducing DirectWrite</h1>
<p>People communicate with text all the time in their daily lives. It is the primary way for people to consume an increasing volume of information. In the past, it used to be through printed content, primarily documents, newspapers, books, and so on. Increasingly, it is online content on their Windows PC. A typical Windows user spends a lot of time reading from their computer screen. They might be surfing the Web, scanning e-mail, composing a report, filling in a spreadsheet, or writing software, but what they're really doing is reading. Even though text and fonts permeate nearly every part of the user experience in Windows, for most users, reading on the screen is not as enjoyable as reading printed output.</p>
<p>For Windows application developers, writing text-handling code is a challenge because of the increased requirements for better readability, sophisticated formatting and layout control, and support for the multiple languages the application must display. Even the most basic text-handling system must allow for text input, layout, display, editing, and copying and pasting. Windows users commonly expect even more than these basic features, requiring even simple editors to support multiple fonts, various paragraph styles, embedded images, spell checking, and other features. Modern UI design is also no longer confined to single format, plain text, but needs to present a better experience with rich fonts and text layouts.</p>
<p>This is an introduction to how <a href="direct-write-portal.html">DirectWrite</a> enables Windows applications to enhance the text experience for UI and documents.</p>
<h2>Improving the Text Experience</h2>
<p>Modern Windows applications have sophisticated requirements for text in their UI and documents. These include better readability, support for a large variety of languages and scripts, and superior rendering performance. In addition, most existing applications require a way to carry forward existing investments in the WindowsWin32 code base.</p>
<p><a href="direct-write-portal.html">DirectWrite</a> provides the following three features that enable Windows application developers to improve the text experience within their applications: independence from the rendering system, high-quality typography, and multiple layers of functionality.</p>
<h2>Rendering-System Independence</h2>
<p><a href="direct-write-portal.html">DirectWrite</a> is independent of any particular graphics technology. Applications are free to use the rendering technology best suited to their needs. This gives applications the flexibility to continue rendering some parts of their application through GDI and other parts through Direct3D or <a href="../direct2d/direct2d-portal.html">Direct2D</a>. In fact, an application could choose to render DirectWrite through a proprietary rendering stack.</p>
<h2>High-Quality Typography</h2>
<p><a href="direct-write-portal.html">DirectWrite</a> takes advantage of the advances in <a href="../intl/opentype-font-format.html">OpenType</a> Font technology to enable high quality typography within a Windows application. The DirectWrite font system provides services for dealing with font enumeration, font fallback, and font caching, which are all needed by applications for handling fonts.</p>
<p>The <a href="../intl/opentype-font-format.html">OpenType</a> support provided by <a href="direct-write-portal.html">DirectWrite</a> enables developers to add to their applications advanced typographic features and support for international text.</p>
<h2>Support for Advanced Typographic Features</h2>
<p><a href="direct-write-portal.html">DirectWrite</a> enables application developers to unlock the features of OpenType fonts that they couldn't use in WinForms or GDI. The DirectWrite <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetypography"><strong>IDWriteTypography</strong></a> object exposes many of the advanced features of OpenType fonts, such as stylistic alternates and swashes. The Microsoft Windows Software Development Kit (SDK) provides a set of sample <a href="../intl/opentype-font-format.html">OpenType</a> fonts that are designed with rich features, such as the Pericles and Pescadero fonts. For more details on OpenType features, see <a href="/previous-versions/dotnet/netframework-3.0/ms745109(v=vs.85)">OpenType Font Features</a>.</p>
<h2>Support for International Text</h2>
<p><a href="direct-write-portal.html">DirectWrite</a> uses <a href="../intl/opentype-font-format.html">OpenType</a> fonts to enable broad support for international text. Unicode features such as surrogates, BIDI, line breaking, and UVS are supported. Language-guided script itemization, number substitution, and glyph shaping ensure that text in any script has the correct layout and rendering.</p>
<p>The following scripts are currently supported:</p>
<blockquote>
<p>[!Note]<br />
For scripts marked with an *, there are no default system fonts. Applications must install fonts that support these scripts.</p>
</blockquote>
<p>Â </p>
<ul>
<li>Arabic</li>
<li>Armenian</li>
<li>Bengala</li>
<li>Bopomofo</li>
<li>Braille*</li>
<li>Canadian aboriginal syllabics</li>
<li>Cherokee</li>
<li>Chinese (Simplified &amp; Traditional)</li>
<li>Cyrillic</li>
<li>Coptic*</li>
<li>Devanagari</li>
<li>Ethiopic</li>
<li>Georgian</li>
<li>Glagolitic*</li>
<li>Greek</li>
<li>Gujarati</li>
<li>Gurmukhi</li>
<li>Hebrew</li>
<li>Japanese</li>
<li>Kannada</li>
<li>Khmer</li>
<li>Korean</li>
<li>Lao</li>
<li>Latin</li>
<li>Malayalam</li>
<li>Mongolian</li>
<li>Myanmar</li>
<li>New Tai Lue</li>
<li>Ogham*</li>
<li>Odia</li>
<li>'Phags-pa</li>
<li>Runic*</li>
<li>Sinhala</li>
<li>Syriac</li>
<li>Tai Le</li>
<li>Tamil</li>
<li>Telugu</li>
<li>Thaana</li>
<li>Thai</li>
<li>Tibetan</li>
<li>Yi</li>
</ul>
<h2>Multiple Layers of Functionality</h2>
<p><a href="direct-write-portal.html">DirectWrite</a> provides factored layers of functionality, with each layer interacting seamlessly with the next. The API design gives application developers the freedom and flexibility to adopt individual layers depending on their needs and schedule. The following diagram shows the relationship between these layers.</p>
<p><img src="images/intro-01.png" alt="diagram of directwrite layers and how they communicate with an application or ui framework and the graphics api" /></p>
<p>The text layout API provides the highest level functionality available from <a href="direct-write-portal.html">DirectWrite</a>. It provides services for the application to measure, display, and interact with richly formatted text strings. This text API can be used in applications that currently use Win32's DrawText to build a modern UI with richly formatted text.</p>
<p>Text-intensive applications that implement their own layout engine may use the next layer down: the script processor. The script processor breaks down a chunk of text into script blocks and handles the mapping between Unicode representations to the appropriate glyph representation in the font so the text of the script can be correctly displayed in the correct language. The layout system used by the text layout API layer is built upon the font and script processing system.</p>
<p>The glyph-rendering layer is the lowest layer of functionality and provides glyph-rendering functionality for applications that implement their own text layout engine. The glyph rendering layer is also useful for applications that implement a custom renderer to modify the glyph-drawing behavior through the callback function in the <a href="direct-write-portal.html">DirectWrite</a> text-formatting API.</p>
<p>The <a href="direct-write-portal.html">DirectWrite</a> font system is available to all the DirectWrite functional layers and enables an application to access font and glyph information. It is designed to handle common font technologies and data formats. The DirectWrite font model follows the common typographic practice of supporting any number of weights, styles, and stretches in the same font family. This model, the same model followed by WPF and CSS, specifies that fonts differing only in weight (bold, light, and so on), style (upright, italic, or oblique) or stretch (narrow, condensed, wide, and so on) are considered to be members of a single font family.</p>
<h3>Improved Text Rendering with ClearType</h3>
<p>Improving readability on the screen is a key requirement for all Windows applications. The evidence from research in cognitive psychology indicates that we need to be able to recognize every letter accurately and that even spacing between letters is critical for fast processing. Letters and words that are not symmetrical are perceived as ugly and degrade the reading experience. Kevin Larson, Microsoft Advanced Reading Technologies group, wrote an article on the subject that was published in Spectrum IEEE. The article is called &quot;The Technology of Text&quot;.</p>
<p>Text in <a href="direct-write-portal.html">DirectWrite</a> is rendered using Microsoft ClearType, which enhances the clarity and readability of text. ClearType takes advantage of the fact that modern LCD displays have RGB stripes for each pixel that can be controlled individually. DirectWrite uses the latest enhancements to ClearType, first included with WindowsÂ Vista with Windows Presentation Foundation, that enables it to evaluate not just the individual letters but also the spacing between letters. Before these ClearType enhancements, text with a &quot;reading&quot; size of 10 or 12 points was difficult to display: we could place either 1 pixel in between letters, which was often too little, or 2 pixels, which was often too much. Using the extra resolution in the subpixels provides us with fractional spacing, which improves the evenness and symmetry of the entire page.</p>
<p>The following two illustration show how glyphs may begin on any sub-pixel boundary when sub-pixel positioning is used.</p>
<p>The following illustration is rendered using the GDI version of the ClearType renderer, which did not employ sub-pixel positioning.</p>
<p><img src="images/intro-03.png" alt="illustration of &quot;technology&quot; rendered without sub-pixel positioning" /></p>
<p>The following illustration is rendered using the <a href="direct-write-portal.html">DirectWrite</a> version of the ClearType renderer, which uses sub-pixel positioning.</p>
<p><img src="images/intro-04.png" alt="illustration of &quot;technology&quot; rendered with sub-pixel positioning" /></p>
<p>Note that the spacing between the letters h and n is more even in the second image and the letter o is spaced further from the letter n, more even with the letter l. Also note how the stems on the letters l are more natural looking.</p>
<p>The subpixel ClearType positioning offers the most accurate spacing of characters on screen, especially at small sizes where the difference between a sub-pixel and a whole pixel represents a significant proportion of glyph width. It enables text to be measured in ideal resolution space and rendered at its natural position at the LCD color stripe, with subpixel granularity. Text measured and rendered using this technology is, by definition, resolution-independent, meaning that the exact same layout of text is achieved across the range of various display resolutions.</p>
<p>Unlike either type of GDI ClearType rendering, sub-pixel ClearType offers the most accurate width of characters.</p>
<p>The Text String API adopts sub-pixel text rendering by default, which means it measures text at its ideal resolution independent of the current display resolution, and produces the glyph positioning result based on the truly scaled glyph advance widths and positioning offsets.</p>
<p>For large-sized text, <a href="direct-write-portal.html">DirectWrite</a> also enables anti-aliasing along the y-axis to make the edges smoother and render letters as the font designer intended. The following illustration shows y-direction anti-aliasing.</p>
<p><img src="images/intro-05.png" alt="illustration of &quot;cleartype&quot; rendered as gdi text and as directwrite text with y-direction antialiasing" /></p>
<p>Although <a href="direct-write-portal.html">DirectWrite</a> text is positioned and rendered using sub-pixel ClearType by default, other rendering options are available. Many existing applications use GDI to render most of their UI, and some applications use system editing controls that continue to use GDI for text rendering. When adding DirectWrite text to these applications, it may be necessary to sacrifice the reading experience improvements provided by sub-pixel ClearType so that text has a consistent appearance across the application.</p>
<p>To meet these requirements, <a href="direct-write-portal.html">DirectWrite</a> also supports the following rendering options:</p>
<ul>
<li>Sub-pixel ClearType (default).</li>
<li>Sub-pixel ClearType with anti-aliasing in both horizontal and vertical dimensions.</li>
<li>Aliased text.</li>
<li>GDI natural-width (used by Microsoft Word Reading View, for example).</li>
<li>GDI compatible-width (including East Asian embedded bitmap).</li>
</ul>
<p>Each of these rendering modes can be fine-tuned through the DirectWrite API and through the new WindowsÂ 7 inbox ClearType tuner.</p>
<blockquote>
<p>[!Note]<br />
Starting with WindowsÂ 8, you should use greyscale text antialiasing in most cases. See the next section for more information.</p>
</blockquote>
<p>Â </p>
<h3>Support for Natural Layout</h3>
<p>Natural layout is resolution-independent, so the spacing of characters doesn't change as you zoom in or out, or depending on the DPI of the display. A secondary advantage is that spacing is true to the design of the font. Natural layout is made possible by DirectWrite's support for natural rendering, which means individual glyphs can be positioned to a fraction of a pixel.</p>
<p>While natural layout is the default, some applications need to render text with the same spacing and appearance as GDI. For such applications, DirectWrite provides GDI classic and GDI natural measuring modes and corresponding rendering modes.</p>
<p>Any of the above rendering modes can be combined with either of the two antialiasing modes: ClearType or grayscale. ClearType antialiasing simulations a higher resolution by individually manipulating the red, green, and blue color values of each pixel. Grayscale antialiasing computes only one coverage (or alpha) value for each pixel. ClearType is the default, but grayscale antialiasing is recommended for Windows Store apps because it is faster and is compatible with standard antialiasing, while still being highly readable.</p>
<h2>API Overview</h2>
<p>The <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefactory"><strong>IDWriteFactory</strong></a> interface is the starting point for using DirectWrite functionality. The factory is the root object that creates a set of objects that can be used together.</p>
<p>The formatting and layout operation is a prerequisite to the operations, as text needs to be properly formatted and laid out to a specified set of constraints before it can be drawn or hit-tested. Two key objects that you can create with an <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefactory"><strong>IDWriteFactory</strong></a> for this purpose are <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextformat"><strong>IDWriteTextFormat</strong></a> and <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout"><strong>IDWriteTextLayout</strong></a>. An <strong>IDWriteTextFormat</strong> object represents the formatting information for a paragraph of text. The <a href="/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createtextlayout"><strong>IDWriteFactory::CreateTextLayout</strong></a> function takes the input string, the associated constraints such as the dimension of the space to be filled, and the <strong>IDWriteTextFormat</strong> object, and puts the fully analyzed and formatted result into <strong>IDWriteTextLayout</strong> to use in subsequent operations.</p>
<p>The application can then render the text using the <a href="/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout"><strong>DrawTextLayout</strong></a> function provided by <a href="../direct2d/direct2d-portal.html">Direct2D</a> or by implementing a callback function that can use GDI, Direct2D, or other graphics systems to render the glyphs. For a single format text, the <a href="/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)"><strong>DrawText</strong></a> function on Direct2D provides a simpler way to draw text without having to first create a <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout"><strong>IDWriteTextLayout</strong></a> object.</p>
<h2>Formatting and Drawing &quot;Hello World&quot; Using DirectWrite</h2>
<p>The following code example shows how an application can format a single paragraph using <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextformat"><strong>IDWriteTextFormat</strong></a> and draw it using the <a href="../direct2d/direct2d-portal.html">Direct2D</a><a href="/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)"><strong>DrawText</strong></a> function.</p>
<pre lang="C++"><code>HRESULT DemoApp::DrawHelloWorld(
    ID2D1HwndRenderTarget* pIRenderTarget
    )
{
    HRESULT hr = S_OK;
    ID2D1SolidColorBrush* pIRedBrush = NULL;
    IDWriteTextFormat* pITextFormat = NULL;
    IDWriteFactory* pIDWriteFactory = NULL;

    if (SUCCEEDED(hr))
    {
        hr = DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED,
                __uuidof(IDWriteFactory),
                reinterpret_cast&lt;IUnknown**&gt;(&amp;pIDWriteFactory));
    }

    if(SUCCEEDED(hr))
    {
        hr = pIDWriteFactory-&gt;CreateTextFormat(
            L&quot;Arial&quot;, 
            NULL,
            DWRITE_FONT_WEIGHT_NORMAL, 
            DWRITE_FONT_STYLE_NORMAL, 
            DWRITE_FONT_STRETCH_NORMAL, 
            10.0f * 96.0f/72.0f, 
            L&quot;en-US&quot;, 
            &amp;pITextFormat
        );
    }

    if(SUCCEEDED(hr))
    {
        hr = pIRenderTarget-&gt;CreateSolidColorBrush(
            D2D1:: ColorF(D2D1::ColorF::Red),
            &amp;pIRedBrush
        );
    }
    
   D2D1_RECT_F layoutRect = D2D1::RectF(0.f, 0.f, 100.f, 100.f);

    // Actually draw the text at the origin.
    if(SUCCEEDED(hr))
    {
        pIRenderTarget-&gt;DrawText(
            L&quot;Hello World&quot;,
            wcslen(L&quot;Hello World&quot;),
            pITextFormat,
            layoutRect, 
            pIRedBrush
        );
    }

    // Clean up.
    SafeRelease(&amp;pIRedBrush);
    SafeRelease(&amp;pITextFormat);
    SafeRelease(&amp;pIDWriteFactory);

    return hr;
}
</code></pre>
<h2>Accessing the Font System</h2>
<p>In addition to specifying a font family name for the text string by using the <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextformat"><strong>IDWriteTextFormat</strong></a> interface in the example above, <a href="direct-write-portal.html">DirectWrite</a> provides applications more control over font selection through font enumeration and the ability to create custom font collection based on embedded document fonts.</p>
<p>The <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection"><strong>IDWriteFontCollection</strong></a> object is a collection of font families. DirectWrite provides access to the set of fonts installed on the system through a special font collection called the system font collection. This is obtained by calling the <a href="/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection"><strong>GetSystemFontCollection</strong></a> method of the <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefactory"><strong>IDWriteFactory</strong></a> object. An application can also create a custom font collection from a set of fonts enumerated by an application-defined callback, that is, private fonts installed by an application, or fonts embedded in a document.</p>
<p>The application can then call <a href="/windows/win32/api/dwrite/nf-dwrite-idwritefont-getfontfamily"><strong>GetFontFamily</strong></a> to get to a specific FontFamily object within the collection, and then call <a href="/windows/win32/api/dwrite/nf-dwrite-idwritefontfamily-getfirstmatchingfont"><strong>IDWriteFontFamily::GetFirstMatchingFont</strong></a> to get to a specific <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefont"><strong>IDWriteFont</strong></a> object. The <strong>IDWriteFont</strong> object represents a font in a font collection and exposes properties and a few basic font metrics.</p>
<p>The <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefontface"><strong>IDWriteFontFace</strong></a> is another object that represents a font and exposes a full set of metrics on a font. The <strong>IDWriteFontFace</strong> can be created directly from a font name; an application does not have to get a font collection to access it. It is useful for a text layout application such as Microsoft Word that needs to query the details for a specific font.</p>
<p>The following diagram illustrates the relationship between these objects.</p>
<p><img src="images/fontcollection.png" alt="diagram of the relationship between a font collection, font family, and font face" /></p>
<h3>IDWriteFontFace</h3>
<p>The <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefontface"><strong>IDWriteFontFace</strong></a> object represents a font and provides more detailed information about the font than the <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefont"><strong>IDWriteFont</strong></a> object does. The font and glyph metrics from the <strong>IDWriteFontFace</strong> are useful for applications that implement text layout.</p>
<p>Most mainstream applications will not use these APIs directly, and instead will use <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefont"><strong>IDWriteFont</strong></a> or specify the font family name directly.</p>
<p>The following table summarizes the usage scenarios for the two objects.</p>
<table>
<thead>
<tr>
<th>Category</th>
<th><a href="/windows/win32/api/dwrite/nn-dwrite-idwritefont"><strong>IDWriteFont</strong></a></th>
<th><a href="/windows/win32/api/dwrite/nn-dwrite-idwritefontface"><strong>IDWriteFontFace</strong></a></th>
</tr>
</thead>
<tbody>
<tr>
<td>APIs to support user interaction such as a font-chooser user interface: description and other informational APIs</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>APIs to support font mapping: family, style, weight, stretch, character coverage</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>DrawText API</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>APIs used for rendering</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>APIs used for text layout: glyph metrics, and so on</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>APIs for UI control and text layout: font-wide metrics</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>The following is an example application that enumerates the fonts in the system font collection.</p>
<pre lang="C++"><code>#include &lt;dwrite.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;new&gt;

// SafeRelease inline function.
template &lt;class T&gt; inline void SafeRelease(T **ppT)
{
    if (*ppT)
    {
        (*ppT)-&gt;Release();
        *ppT = NULL;
    }
}

void wmain()
{
    IDWriteFactory* pDWriteFactory = NULL;

    HRESULT hr = DWriteCreateFactory(
            DWRITE_FACTORY_TYPE_SHARED,
            __uuidof(IDWriteFactory),
            reinterpret_cast&lt;IUnknown**&gt;(&amp;pDWriteFactory)
            );

    IDWriteFontCollection* pFontCollection = NULL;

    // Get the system font collection.
    if (SUCCEEDED(hr))
    {
        hr = pDWriteFactory-&gt;GetSystemFontCollection(&amp;pFontCollection);
    }

    UINT32 familyCount = 0;

    // Get the number of font families in the collection.
    if (SUCCEEDED(hr))
    {
        familyCount = pFontCollection-&gt;GetFontFamilyCount();
    }

    for (UINT32 i = 0; i &lt; familyCount; ++i)
    {
        IDWriteFontFamily* pFontFamily = NULL;

        // Get the font family.
        if (SUCCEEDED(hr))
        {
            hr = pFontCollection-&gt;GetFontFamily(i, &amp;pFontFamily);
        }

        IDWriteLocalizedStrings* pFamilyNames = NULL;
        
        // Get a list of localized strings for the family name.
        if (SUCCEEDED(hr))
        {
            hr = pFontFamily-&gt;GetFamilyNames(&amp;pFamilyNames);
        }

        UINT32 index = 0;
        BOOL exists = false;
        
        wchar_t localeName[LOCALE_NAME_MAX_LENGTH];

        if (SUCCEEDED(hr))
        {
            // Get the default locale for this user.
            int defaultLocaleSuccess = GetUserDefaultLocaleName(localeName, LOCALE_NAME_MAX_LENGTH);

            // If the default locale is returned, find that locale name, otherwise use &quot;en-us&quot;.
            if (defaultLocaleSuccess)
            {
                hr = pFamilyNames-&gt;FindLocaleName(localeName, &amp;index, &amp;exists);
            }
            if (SUCCEEDED(hr) &amp;&amp; !exists) // if the above find did not find a match, retry with US English
            {
                hr = pFamilyNames-&gt;FindLocaleName(L&quot;en-us&quot;, &amp;index, &amp;exists);
            }
        }
        
        // If the specified locale doesn't exist, select the first on the list.
        if (!exists)
            index = 0;

        UINT32 length = 0;

        // Get the string length.
        if (SUCCEEDED(hr))
        {
            hr = pFamilyNames-&gt;GetStringLength(index, &amp;length);
        }

        // Allocate a string big enough to hold the name.
        wchar_t* name = new (std::nothrow) wchar_t[length+1];
        if (name == NULL)
        {
            hr = E_OUTOFMEMORY;
        }

        // Get the family name.
        if (SUCCEEDED(hr))
        {
            hr = pFamilyNames-&gt;GetString(index, name, length+1);
        }
        if (SUCCEEDED(hr))
        {
            // Print out the family name.
            wprintf(L&quot;%s\n&quot;, name);
        }

        SafeRelease(&amp;pFontFamily);
        SafeRelease(&amp;pFamilyNames);

        delete [] name;
    }

    SafeRelease(&amp;pFontCollection);
    SafeRelease(&amp;pDWriteFactory);
}

</code></pre>
<h2>Text rendering</h2>
<p>The text rendering APIs enable glyphs in a <a href="direct-write-portal.html">DirectWrite</a> font to be rendered to a <a href="../direct2d/direct2d-portal.html">Direct2D</a> surface or to a GDI device independent bitmap, or to be converted to outlines or bitmaps. The ClearType rendering in DirectWrite supports sub-pixel positioning with improved sharpness and contrast compared to previous implementations on Windows. DirectWrite also supports aliased black-and-white text to support scenarios involving East Asian fonts with embedded bitmaps, or where the user has disabled font smoothing of any type.</p>
<p>All the options are adjustable by all the available ClearType knobs accessible through the <a href="direct-write-portal.html">DirectWrite</a> APIs, and also exposed via the new WindowsÂ 7 ClearType tuner control panel applet.</p>
<p>There are two APIs available for rendering glyphs, one providing hardware-accelerated rendering through <a href="../direct2d/direct2d-portal.html">Direct2D</a> and the other providing software rendering to a GDI bitmap. An application using <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout"><strong>IDWriteTextLayout</strong></a> and implementing the <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextrenderer"><strong>IDWriteTextRenderer</strong></a> callback can call either of these functions in response to a <a href="/windows/win32/api/dwrite/nf-dwrite-idwritetextrenderer-drawglyphrun"><strong>DrawGlyphRun</strong></a> callback. Also, applications that implement their own layout or deal with glyph-level data can use these APIs.</p>
<ol>
<li>
<p><a href="/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun"><strong>ID2DRenderTarget::DrawGlyphRun</strong></a></p>
<p>Applications can use the <a href="../direct2d/direct2d-portal.html">Direct2D</a> API <a href="/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun"><strong>DrawGlyphRun</strong></a> to provide hardware acceleration for text rendering using the GPU. Hardware acceleration affects all phases of the text rendering pipelineâ€”from merging glyphs into glyph runs and filtering the glyph-run bitmap, to applying the ClearType blending algorithm to the final displayed output. This is the recommended API for getting the best rendering performance.</p>
</li>
<li>
<p><a href="/windows/win32/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun"><strong>IDWriteBitmapRenderTarget::DrawGlyphRun</strong></a></p>
<p>Applications can use the <a href="/windows/win32/api/dwrite/nf-dwrite-idwritebitmaprendertarget-drawglyphrun"><strong>IDWriteBitmapRenderTarget::DrawGlyphRun</strong></a> method to perform a software-rendering of a run of glyphs to a 32-bpp bitmap. The <a href="/windows/win32/api/dwrite/nn-dwrite-idwritebitmaprendertarget"><strong>IDWriteBitmapRenderTarget</strong></a> object encapsulates a bitmap and a memory device context that can be used for rendering glyphs. This API is useful if you want to stay with GDI because you have an existing code base that renders in GDI.</p>
</li>
</ol>
<p>If you have an application that has existing text layout code that uses GDI, and you want to preserve its existing layout code but use <a href="direct-write-portal.html">DirectWrite</a> just for the final step of rendering glyphs, <a href="/windows/win32/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfacefromhdc"><strong>IDWriteGdiInterop::CreateFontFaceFromHdc</strong></a> provides the bridge between the two APIs. Before calling this function, the application will use the <strong>IDWriteGdiInterop::CreateFontFaceFromHdc</strong> function to get a font-face reference from a device context.</p>
<blockquote>
<p>[!Note]<br />
For most scenarios, applications may not need to use these glyph-rendering APIs. After an application has created an <a href="/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout"><strong>IDWriteTextLayout</strong></a> object, it can use the <a href="/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout"><strong>ID2D1RenderTarget::DrawTextLayout</strong></a> method to render the text.</p>
</blockquote>
<p>Â </p>
<h2>Custom Rendering Modes</h2>
<p>A number of parameters affect text rendering, such as gamma, ClearType level, pixel geometry, and enhanced contrast. Rendering parameters are encapsulated by an object, which implements the public <a href="/windows/win32/api/dwrite/nn-dwrite-idwriterenderingparams"><strong>IDWriteRenderingParams</strong></a> interface. The rendering parameters object is automatically initialized based on hardware properties and/or user preferences specified through the ClearType control panel applet in WindowsÂ 7. Generally, if a client uses the <a href="direct-write-portal.html">DirectWrite</a> layout API, DirectWrite will automatically select a rendering mode that corresponds to the specified measuring mode.</p>
<p>Applications that want more control can use <a href="/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomrenderingparams"><strong>IDWriteFactory::CreateCustomRenderingParams</strong></a> to implement the different rendering options. This function can also be used to set the gamma, pixel geometry, and enhanced contrast.</p>
<p>The following are the various rendering options available:</p>
<ul>
<li>
<p>Sub-pixel anti-aliasing</p>
<p>The application sets the <em>renderingMode</em> parameter to DWRITE_RENDERING_MODE_NATURAL to specify rendering with anti-aliasing in the horizontal dimension only.</p>
</li>
<li>
<p>Sub-pixel anti-aliasing in both horizontal and vertical dimensions.</p>
<p>The application sets the <em>renderingMode</em> parameter to DWRITE_RENDERING_MODE_NATURAL_SYMMETRIC to specify rendering with anti-aliasing in both horizontal and vertical dimensions. This makes curves and diagonal lines look smoother at the expense of some softness, and is typically used at sizes above 16 ppem.</p>
</li>
<li>
<p>Aliased Text</p>
<p>The application sets the <em>renderingMode</em> parameter to DWRITE_RENDERING_MODE_ALIASED to specify aliased text.</p>
</li>
<li>
<p>Grayscale Text</p>
<p>The application sets the <em>pixelGeometry</em> parameter to DWRITE_PIXEL_GEOMETRY_FLAT to specify grayscale text.</p>
</li>
<li>
<p>GDI compatible-width (including East Asian embedded bitmap)</p>
<p>The application sets the <em>renderingMode</em> parameter to DWRITE_RENDERING_MODE_GDI_CLASSIC to specify GDI compatible-width anti-aliasing.</p>
</li>
<li>
<p>GDI natural-width</p>
<p>The application sets the <em>renderingMode</em> parameter to DWRITE_RENDERING_MODE_GDI_NATURAL to specify GDI natural-width compatible anti-aliasing.</p>
</li>
<li>
<p>Outline text</p>
<p>For rendering at large sizes, an application developer might prefer to render by using the font outline rather than by rasterizing into a bitmap. The application sets the <em>renderingMode</em> parameter to <strong>DWRITE_RENDERING_MODE_OUTLINE</strong> to specify that rendering should bypass the rasterizer and use the outlines directly.</p>
</li>
</ul>
<h2>GDI Interoperability</h2>
<p>The <a href="/windows/win32/api/dwrite/nn-dwrite-idwritegdiinterop"><strong>IDWriteGdiInterop</strong></a> interface provides interoperability with GDI. This enables applications to continue their existing investment in GDI code bases and selectively use <a href="direct-write-portal.html">DirectWrite</a> for either rendering or layout.</p>
<p>The following are the APIs that enable an application to migrate to or from the GDI font system:</p>
<ul>
<li>
<p><a href="/windows/win32/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfromlogfont"><strong>CreateFontFromLOGFONT</strong></a></p>
<p>Creates an <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefont"><strong>IDWriteFont</strong></a> object that matches the properties specified by the <a href="/windows/win32/api/wingdi/ns-wingdi-logfonta"><strong>LOGFONT</strong></a> structure.</p>
</li>
<li>
<p><a href="/windows/win32/api/dwrite/nf-dwrite-idwritegdiinterop-convertfonttologfont"><strong>ConvertFontToLOGFONT</strong></a></p>
<p>Initializes a <a href="/windows/win32/api/wingdi/ns-wingdi-logfonta"><strong>LOGFONT</strong></a> structure based on the GDI-compatible properties of the specified <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefont"><strong>IDWriteFont</strong></a>.</p>
</li>
<li>
<p><a href="/windows/win32/api/dwrite/nf-dwrite-idwritegdiinterop-convertfontfacetologfont"><strong>ConvertFontFaceToLOGFONT</strong></a></p>
<p>Initializes a <a href="/windows/win32/api/wingdi/ns-wingdi-logfonta"><strong>LOGFONT</strong></a> structure based on the GDI-compatible properties of the specified <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefontface"><strong>IDWriteFontFace</strong></a>.</p>
</li>
<li>
<p><a href="/windows/win32/api/dwrite/nf-dwrite-idwritegdiinterop-createfontfacefromhdc"><strong>CreateFontFaceFromHdc</strong></a></p>
<p>Creates an <a href="/windows/win32/api/dwrite/nn-dwrite-idwritefontface"><strong>IDWriteFontFace</strong></a> object that corresponds to the currently selected <strong>HFONT</strong>.</p>
</li>
</ul>
<h2>Conclusion</h2>
<p>Improving the reading experience is of great value to users whether it is on the screen or on paper. <a href="direct-write-portal.html">DirectWrite</a> provides the ease of use and the layered programming model for application developers to improve the text experience for their Windows applications. Applications can use DirectWrite to render richly formatted text for their UI and documents with the layout API. For more complex scenarios, an application can work directly with glyphs, access fonts, and so on, and harness the power of DirectWrite to deliver high-quality typography.</p>
<p>The interoperability capabilities of <a href="direct-write-portal.html">DirectWrite</a> enable application developers to carry forward their existing Win32 codebases and adopt DirectWrite selectively within their applications.</p>
<p>Â </p>
<p>Â </p>
</body>
