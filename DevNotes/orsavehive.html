<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ORSaveHive function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Writes the specified offline registry hive to a file.
ms.assetid: 26f2eed9-e6e0-4dc0-8b91-212cde072744
title: ORSaveHive function (Offreg.h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>ORSaveHive
api_type:</li>
<li>DllExport
api_location:</li>
<li>Offreg.dll</li>
</ul>
<hr />
<h1>ORSaveHive function</h1>
<p>Writes the specified offline registry hive to a file.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>DWORD ORSaveHive(
  _In_Â ORHKEY Handle,
  _In_Â PCWSTR lpHivePath,
  _In_Â DWORD Â dwOsMajorVersion,
  _In_Â DWORD Â dwOsMinorVersion
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>Handle</em> [in]</p>
<!-- raw HTML omitted -->
<p>A handle to the offline registry hive to save.</p>
<!-- raw HTML omitted -->
<p><em>lpHivePath</em> [in]</p>
<!-- raw HTML omitted -->
<p>A pointer to a Unicode string that specifies the name of the registry hive file. This cannot be the name of an existing file.</p>
<!-- raw HTML omitted -->
<p><em>dwOsMajorVersion</em> [in]</p>
<!-- raw HTML omitted -->
<p>The major version number of the operating system. This member can be one of the following values.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->5<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>If <em>dwOsMinorVersion</em> is 1, the operating system is WindowsÂ XP.<!-- raw HTML omitted --> If <em>dwOsMinorVersion</em> is 2, the operating system is Windows ServerÂ 2003Â R2, Windows ServerÂ 2003, or WindowsÂ XP Professional x64 Edition.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->6<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>If <em>dwOsMinorVersion</em> is 0, the operating system is Windows ServerÂ 2008 or WindowsÂ Vista.<!-- raw HTML omitted --> If <em>dwOsMinorVersion</em> is 1, the operating system is Windows ServerÂ 2008 R2 or WindowsÂ 7.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<p><em>dwOsMinorVersion</em> [in]</p>
<!-- raw HTML omitted -->
<p>The minor version number of the operating system. This member can be one of the following values.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->0<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>If <em>dwOsMajorVersion</em> is 6, the operating system is Windows ServerÂ 2008 or WindowsÂ Vista.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->1<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>If <em>dwOsMajorVersion</em> is 5, the operating system is WindowsÂ XP.<!-- raw HTML omitted --> If <em>dwOsMajorVersion</em> is 6, the operating system is Windows ServerÂ 2008 R2 or WindowsÂ 7.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->2<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>If <em>dwOsMajorVersion</em> is 5, the operating system is Windows ServerÂ 2003Â R2, Windows ServerÂ 2003, or WindowsÂ XP Professional x64 Edition. <!-- raw HTML omitted --> If <em>dwOsMajorVersion</em> is 6, the <em>dwOsMinorVersion</em> parameter must be 0 or 1. <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If the function succeeds, the return value is ERROR_SUCCESS.</p>
<p>If the function fails, the return value is a nonzero error code defined in Winerror.h. You can use the <a href="/windows/win32/api/winbase/nf-winbase-formatmessage">FormatMessage</a> function with the FORMAT_MESSAGE_FROM_SYSTEM flag to get a generic description of the error. Possible error codes include the following:</p>
<ul>
<li>If the caller does not have the necessary access rights to write the file, the function returns ERROR_ACCESS_DENIED.</li>
<li>If the specified file already exists, the function returns ERROR_ALREADY_EXISTS.</li>
</ul>
<h2>Remarks</h2>
<p>The <strong>ORSaveHive</strong> function must be used to save changes made to an offline registry hive. Changes are not preserved until <strong>ORSaveHive</strong> is called to save the hive to a file.</p>
<p>The <em>dwOsMajorVersion</em> and <em>dwOsMinorVersion</em> parameters together specify the target format of the registry hive file. The following table summarizes the most recent operating system version numbers.</p>
<table>
<thead>
<tr>
<th>Operating system</th>
<th>Version number</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows ServerÂ 2008 R2</td>
<td>6.1</td>
</tr>
<tr>
<td>WindowsÂ 7</td>
<td>6.1</td>
</tr>
<tr>
<td>Windows ServerÂ 2008</td>
<td>6.0</td>
</tr>
<tr>
<td>WindowsÂ Vista</td>
<td>6.0</td>
</tr>
<tr>
<td>Windows ServerÂ 2003Â R2</td>
<td>5.2</td>
</tr>
<tr>
<td>Windows ServerÂ 2003</td>
<td>5.2</td>
</tr>
<tr>
<td>WindowsÂ XP Professional x64 Edition</td>
<td>5.2</td>
</tr>
<tr>
<td>WindowsÂ XP</td>
<td>5.1</td>
</tr>
</tbody>
</table>
<p>Â </p>
<p>Use the <a href="/windows/win32/api/sysinfoapi/nf-sysinfoapi-getversionexa">GetVersionEx</a> function to retrieve information about the current operating system.</p>
<p>The <strong>ORSaveHive</strong> function locks the registry hive while it is writing the hive to the file, then closes the file and releases the lock. The registry hive remains in memory until it is closed by calling the <a href="orclosehive.html"><strong>ORCloseHive</strong></a> function. It is possible to make further changes to the registry hive while it is open; however, to preserve these changes the hive must be saved to a new file, because the <strong>ORSaveHive</strong> function will not overwrite an existing file.</p>
<p>The <strong>ORSaveHive</strong> function can be used to save part of the offline registry hive. The key specified in the <em>Handle</em> parameter becomes the root key of a hive that consists of the specified key and all of its subkeys.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Redistributable<!-- raw HTML omitted --></td>
<td>Windows Offline Registry library version 1.0 or later<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Offreg.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Offreg.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="/windows/win32/api/sysinfoapi/nf-sysinfoapi-getversionexa">GetVersionEx</a></p>
<!-- raw HTML omitted -->
<p><a href="orclosehive.html"><strong>ORCloseHive</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="oropenhive.html"><strong>OROpenHive</strong></a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
