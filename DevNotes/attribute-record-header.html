<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ATTRIBUTE_RECORD_HEADER structure</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Represents an attribute record.
ms.assetid: f9d9458c-b179-441c-9f62-ff0ac2f75329
title: ATTRIBUTE_RECORD_HEADER structure
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>ATTRIBUTE_RECORD_HEADER
api_type:</li>
<li>NA
api_location:</li>
</ul>
<hr />
<h1>ATTRIBUTE_RECORD_HEADER structure</h1>
<p>[This structure is valid only for version 3 of NTFS volumes; it may be altered in future versions.]</p>
<p>Represents an attribute record.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>typedef struct _ATTRIBUTE_RECORD_HEADER {
  ATTRIBUTE_TYPE_CODE TypeCode;
  ULONG Â Â Â Â Â Â Â Â Â Â Â Â Â Â RecordLength;
  UCHAR Â Â Â Â Â Â Â Â Â Â Â Â Â Â FormCode;
  UCHAR Â Â Â Â Â Â Â Â Â Â Â Â Â Â NameLength;
  USHORT Â Â Â Â Â Â Â Â Â Â Â Â Â NameOffset;
  USHORT Â Â Â Â Â Â Â Â Â Â Â Â Â Flags;
  USHORT Â Â Â Â Â Â Â Â Â Â Â Â Â Instance;
  union {
    struct {
      ULONG Â ValueLength;
      USHORT ValueOffset;
      UCHAR Â Reserved[2];
    }Â Resident;
    struct {
      VCN Â Â Â Â Â LowestVcn;
      VCN Â Â Â Â Â HighestVcn;
      USHORT Â Â MappingPairsOffset;
      UCHAR Â Â Â Reserved[6];
      LONGLONG AllocatedLength;
      LONGLONG FileSize;
      LONGLONG ValidDataLength;
      LONGLONG TotalAllocated;
    }Â Nonresident;
  }Â Form;
} ATTRIBUTE_RECORD_HEADER, *PATTRIBUTE_RECORD_HEADER;
</code></pre>
<h2>Members</h2>
<!-- raw HTML omitted -->
<p><strong>TypeCode</strong></p>
<!-- raw HTML omitted -->
<p>The attribute type code.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$STANDARD_INFORMATION</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x10<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>File attributes (such as read-only and archive), time stamps (such as file creation and last modified), and the hard link count.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$ATTRIBUTE_LIST</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x20<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A list of attributes that make up the file and the file reference of the MFT file record in which each attribute is located.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$FILE_NAME</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x30<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The name of the file, in Unicode characters.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$OBJECT_ID</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x40<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>An 64-byte object identifier assigned by the link-tracking service.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$VOLUME_NAME</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x60<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The volume label. Present in the $Volume file.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$VOLUME_INFORMATION</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x70<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The volume information. Present in the $Volume file.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$DATA</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x80<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The contents of the file.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$INDEX_ROOT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x90<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Used to implement filename allocation for large directories.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$INDEX_ALLOCATION</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0xA0<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Used to implement filename allocation for large directories.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$BITMAP</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0xB0<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>A bitmap index for a large directory.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>$REPARSE_POINT</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0xC0<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The reparse point data.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<p><strong>RecordLength</strong></p>
<!-- raw HTML omitted -->
<p>The size of the attribute record, in bytes. This value reflects the required size for the record variant and is always rounded to the nearest quadword boundary.</p>
<!-- raw HTML omitted -->
<p><strong>FormCode</strong></p>
<!-- raw HTML omitted -->
<p>The attribute form code.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>RESIDENT_FORM</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x00<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The value is contained in the file record and immediately follows the attribute record header.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>NONRESIDENT_FORM</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0x01<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>The value is contained in other sectors on the disk.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Â </p>
<!-- raw HTML omitted -->
<p><strong>NameLength</strong></p>
<!-- raw HTML omitted -->
<p>The size of the optional attribute name, in characters, or 0 if there is no attribute name. The maximum attribute name length is 255 characters.</p>
<!-- raw HTML omitted -->
<p><strong>NameOffset</strong></p>
<!-- raw HTML omitted -->
<p>The offset of the attribute name from the start of the attribute record, in bytes. If the <strong>NameLength</strong> member is 0, this member is undefined.</p>
<!-- raw HTML omitted -->
<p><strong>Flags</strong></p>
<!-- raw HTML omitted -->
<p>The attribute flags.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>ATTRIBUTE_FLAG_COMPRESSION_MASK</strong> (0x00FF)</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>ATTRIBUTE_FLAG_SPARSE</strong> (0x8000)</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>ATTRIBUTE_FLAG_ENCRYPTED</strong> (0x4000)</p>
<!-- raw HTML omitted -->
<p><strong>Instance</strong></p>
<!-- raw HTML omitted -->
<p>The unique instance for this attribute in the file record.</p>
<!-- raw HTML omitted -->
<p><strong>Form</strong></p>
<!-- raw HTML omitted -->
<p>If the <strong>FormCode</strong> member is RESIDENT_FORM, the union is a <strong>Resident</strong> structure. If <strong>FormCode</strong> is NONRESIDENT_FORM, the union is a <strong>Nonresident</strong> structure.</p>
<!-- raw HTML omitted -->
<p><strong>Resident</strong></p>
<!-- raw HTML omitted -->
<p><strong>ValueLength</strong></p>
<!-- raw HTML omitted -->
<p>The size of the attribute value, in bytes.</p>
<!-- raw HTML omitted -->
<p><strong>ValueOffset</strong></p>
<!-- raw HTML omitted -->
<p>The offset to the value from the start of the attribute record, in bytes.</p>
<!-- raw HTML omitted -->
<p><strong>Reserved</strong></p>
<!-- raw HTML omitted -->
<p>Reserved.</p>
<!-- raw HTML omitted -->
<p><strong>Nonresident</strong></p>
<!-- raw HTML omitted -->
<p><strong>LowestVcn</strong></p>
<!-- raw HTML omitted -->
<p>The lowest virtual cluster number (VCN) covered by this attribute record.</p>
<!-- raw HTML omitted -->
<p><strong>HighestVcn</strong></p>
<!-- raw HTML omitted -->
<p>The highest VCN covered by this attribute record.</p>
<!-- raw HTML omitted -->
<p><strong>MappingPairsOffset</strong></p>
<!-- raw HTML omitted -->
<p>The offset to the mapping pairs array from the start of the attribute record, in bytes. For more information, see Remarks.</p>
<!-- raw HTML omitted -->
<p><strong>Reserved</strong></p>
<!-- raw HTML omitted -->
<p>Reserved.</p>
<!-- raw HTML omitted -->
<p><strong>AllocatedLength</strong></p>
<!-- raw HTML omitted -->
<p>The allocated size of the file, in bytes. This value is an even multiple of the cluster size. This member is not valid if the <strong>LowestVcn</strong> member is nonzero.</p>
<!-- raw HTML omitted -->
<p><strong>FileSize</strong></p>
<!-- raw HTML omitted -->
<p>The file size (highest byte that can be read plus 1), in bytes. This member is not valid if <strong>LowestVcn</strong> is nonzero.</p>
<!-- raw HTML omitted -->
<p><strong>ValidDataLength</strong></p>
<!-- raw HTML omitted -->
<p>The valid data length (highest initialized byte plus 1), in bytes. This value is rounded to the nearest cluster boundary. This member is not valid if <strong>LowestVcn</strong> is nonzero.</p>
<!-- raw HTML omitted -->
<p><strong>TotalAllocated</strong></p>
<!-- raw HTML omitted -->
<p>The total allocated for the file (the sum of the allocated clusters).</p>
<!-- raw HTML omitted -->
<h2>Remarks</h2>
<p>Note that there is no associated header file for this structure.</p>
<p>This structure definition is valid only for major version 3 and minor version 0 or 1, as reported by <a href="/windows/win32/api/winioctl/ni-winioctl-fsctl_get_ntfs_volume_data"><strong>FSCTL_GET_NTFS_VOLUME_DATA</strong></a>.</p>
<p>Attribute records are always aligned on a quadword boundary.</p>
<p>If the attribute is nonresident, the attribute record header contains a list of retrieval information that provides a mapping between VCN and logical cluster number (LCN) for the attribute. If the retrieval information does not fit in the base file segment, it can be stored in an external file record segment by itself. If it still does not fit into one external file record segment, there is a provision in the attribute list to contain multiple entries for an attribute that requires additional retrieval information.</p>
<p>The mapping pairs array is stored in a compressed form and assumes that the information is decompressed and cached by the system. It consists of a series of NextVcn/CurrentLcn pairs. For example, if a file has a single run of 8 clusters starting at LCN 128 and the file starts at LowestVcn 0, then the mapping pairs array has just one entry, which is NextVcn=8 and CurrentLcn=128. The array is a byte stream that stores the changes to the working variables when processed sequentially. The byte stream is to be interpreted as a zero-terminated stream of triples, as follows:</p>
<p>count byte = <em>v</em> + (<em>l</em> * 16)</p>
<p>where <em>v</em> is the number of changed low-order VCN bytes and <em>l</em> is the number of changed low-order LCN bytes.</p>
<p>The decompression algorithm is as follows:</p>
<ol>
<li>Initialize NextVcn to <code>Attribute-&gt;LowestVcn</code> and CurrentLcn to 0.</li>
<li>Initialize the byte stream pointer to <code>(PCHAR)Attribute + Attribute-&gt;AttributeForm-&gt;Nonresident-&gt;MappingPairsOffset</code>.</li>
<li>Set CurrentVcn to NextVcn.</li>
<li>Read the next byte from the stream. If it is 0, then break; else extract <em>v</em> and <em>l</em> as previously described.</li>
<li>Interpret the next <em>v</em> bytes as a signed quantity, with the low-order byte first. Unpack it sign-extended into 64 bits and add it to NextVcn.</li>
<li>Interpret the next <em>l</em> bytes as a signed quantity, with the low-order byte first. Unpack it sign-extended into 64 bits and add it to CurrentLcn. If this produces a CurrentLcn of 0, then the VCNs from CurrentVcn to NextVcnâ€“1 are unallocated.</li>
<li>Update the cached mapping information from CurrentVcn, NextVcn, and CurrentLcn.</li>
<li>Go to step 3.</li>
</ol>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="master-file-table.html">Master File Table</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
