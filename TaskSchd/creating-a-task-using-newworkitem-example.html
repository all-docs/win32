<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Creating a Task Using NewWorkItem Example</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: Creating a Task Using NewWorkItem Example
description: When creating a task, you will use two Task Scheduler interfaces ITaskScheduler and ITask.
ms.assetid: 1cbdba6a-e017-4f00-87cb-970686a69e0a
keywords:</p>
<ul>
<li>creating work items Task Scheduler</li>
<li>work items Task Scheduler , creating tasks
ms.topic: article
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1>Creating a Task Using NewWorkItem Example</h1>
<p>When creating a task, you will use two Task Scheduler interfaces: <a href="/windows/desktop/api/Mstask/nn-mstask-itaskscheduler"><strong>ITaskScheduler</strong></a> and <a href="/windows/desktop/api/Mstask/nn-mstask-itask"><strong>ITask</strong></a>. You must provide a unique name for the task, the class identifier of the task object, and the interface identifier of <strong>ITask</strong>. The class identifier and interface identifier are shown in the code example following this topic.</p>
<blockquote>
<p>[!Note]<br />
You can also create a task by calling <a href="/windows/desktop/api/Mstask/nf-mstask-itaskscheduler-addworkitem"><strong>ITaskScheduler::AddWorkItem</strong></a>. When you take this route, it is your responsibility to create an instance of the <strong>Task</strong> object (which supports the <a href="/windows/desktop/api/Mstask/nn-mstask-itask"><strong>ITask</strong></a> interface) and then add the task with the name you supply.</p>
</blockquote>
<p>Â </p>
<blockquote>
<p>[!Note]<br />
By default, only a member of the Administrators, Backup Operators, or Server Operators group can create tasks on Windows ServerÂ 2003. A member of the Administrators group may change the security descriptor of the Windows\Task folder to let others create tasks.</p>
</blockquote>
<p>Â </p>
<p>The name you supply for the task must be unique within the Scheduled Tasks folder. If a task with the same name already exists, <a href="/windows/desktop/api/Mstask/nf-mstask-itaskscheduler-newworkitem"><strong>ITaskScheduler::NewWorkItem</strong></a> returns ERROR_FILE_EXISTS. If you get this return value, you should specify a different name and attempt to create the task again.</p>
<p>The following procedure describes how to create a new work item task.</p>
<p><strong>To create a new work item task</strong></p>
<ol>
<li>Call <a href="/windows/win32/api/objbase/nf-objbase-coinitialize"><strong>CoInitialize</strong></a> to initialize the COM library and <a href="/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance"><strong>CoCreateInstance</strong></a> to get a Task Scheduler object. (This example assumes that the Task Scheduler service is running.)</li>
<li>Call <a href="/windows/desktop/api/Mstask/nf-mstask-itaskscheduler-newworkitem"><strong>ITaskScheduler::NewWorkItem</strong></a> to create a new task. (This method returns a pointer to an <a href="/windows/desktop/api/Mstask/nn-mstask-itask"><strong>ITask</strong></a> interface.)</li>
<li>Save the new task to disk by calling <a href="/windows/win32/api/objidl/nf-objidl-ipersistfile-save"><strong>IPersistFile::Save</strong></a>. (The <a href="/windows/win32/api/objidl/nn-objidl-ipersistfile"><strong>IPersistFile</strong></a> interface is a standard COM interface supported by the <strong>ITask</strong> interface.)</li>
<li>Call <strong>ITask::Release</strong> to release all resources. (Note that <a href="/windows/win32/api/unknwn/nf-unknwn-iunknown-release"><strong>Release</strong></a> is an <a href="/windows/win32/api/unknwn/nn-unknwn-iunknown"><strong>IUnknown</strong></a> method inherited by <a href="/windows/desktop/api/Mstask/nn-mstask-itask"><strong>ITask</strong></a>.)</li>
</ol>
<table>
<thead>
<tr>
<th>For a code example of</th>
<th>See</th>
</tr>
</thead>
<tbody>
<tr>
<td>Creating a single task</td>
<td><a href="c-c-code-example-creating-a-task-using-newworkitem.html">C/C++ Code Example: Creating a Task Using NewWorkItem</a></td>
</tr>
</tbody>
</table>
<p>Â </p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="task-scheduler-1-0-examples.html">Task Scheduler 1.0 Examples</a></p>
<!-- raw HTML omitted -->
<p>Â </p>
<p>Â </p>
</body>
