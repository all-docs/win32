<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Persistence Interfaces</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: Persistence Interfaces
description: Persistence Interfaces
ms.assetid: a93582b3-bdbf-430d-b4a6-c0df7bc35dc0
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Persistence Interfaces</h1>
<p>Objects that have a persistent state of any kind must implement at least one IPersist* interface, and preferably multiple interfaces, in order to provide the container with the most flexible choice of how it wishes to save a control's state.</p>
<p>If a control has any persistent state whatsoever, it must, as a minimum, implement either <a href="/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream"><strong>IPersistStream</strong></a> or <a href="/windows/desktop/api/OCIdl/nn-ocidl-ipersiststreaminit"><strong>IPersistStreamInit</strong></a> (the two are mutually exclusive and shouldn't be implemented together for the most part). The latter is used when a control wishes to know when it is created new as opposed to reloaded from an existing persistent state (<strong>IPersistStream</strong> does not have the created new capability). The existence of either interface indicates that the control can save and load its persistent state into a stream, that is, an instance of <a href="/windows/desktop/api/objidl/nn-objidl-istream"><strong>IStream</strong></a>.</p>
<p>Beyond these two stream-based interfaces, the IPersist* interfaces listed in the following table can be optionally provided in order to support persistence to locations other than an expandable <a href="/windows/desktop/api/objidl/nn-objidl-istream"><strong>IStream</strong></a>.</p>
<p>A set of component categories is identified to cover the support for persistency interfaces see <a href="component-categories.html">Component Categories</a>.</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768210(v=vs.85)"><strong>IPersistMemory</strong></a><!-- raw HTML omitted --></td>
<td>The object can save and load its state into a fixed-length sequential byte array (in memory).<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><a href="/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage"><strong>IPersistStorage</strong></a><!-- raw HTML omitted --></td>
<td>The object can save and load its state into an <a href="/windows/desktop/api/objidl/nn-objidl-istorage"><strong>IStorage</strong></a> instance. Controls that wish to be marked Insertable as other compound document objects (for insertion into non-control aware containers) must support this interface.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><a href="/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag"><strong>IPersistPropertyBag</strong></a><!-- raw HTML omitted --></td>
<td>The object can save and load its state as individual properties written to IPropertyBag which the container implements. This is used for Save As Text functionality in some containers.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><a href="/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)"><strong>IPersistMoniker</strong></a><!-- raw HTML omitted --></td>
<td>The object can save and load its state to a location named by a moniker. The control calls <a href="/windows/desktop/api/ObjIdl/nf-objidl-imoniker-bindtostorage"><strong>IMoniker::BindToStorage</strong></a> to retrieve the storage interface it requires, such as <a href="/windows/desktop/api/objidl/nn-objidl-istorage"><strong>IStorage</strong></a>, <a href="/windows/desktop/api/objidl/nn-objidl-istream"><strong>IStream</strong></a>, <a href="/windows/desktop/api/objidl/nn-objidl-ilockbytes"><strong>ILockBytes</strong></a>, <a href="/windows/desktop/api/ObjIdl/nn-objidl-idataobject"><strong>IDataObject</strong></a>, etc.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>While support for <a href="/windows/win32/api/ocidl/nn-ocidl-ipersistpropertybag"><strong>IPersistPropertyBag</strong></a> is optional, it is strongly recommended as an optimization for containers with Save As Text features, such as Visual Basic.</p>
<p>With the exception of <a href="/windows/desktop/api/ObjIdl/nf-objidl-ipersiststream-getsizemax"><strong>IPersistStream::GetSizeMax</strong></a>, <a href="/windows/desktop/api/OCIdl/nf-ocidl-ipersiststreaminit-getsizemax"><strong>IPersistStreamInit::GetSizeMax</strong></a>, and <a href="/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa768208(v=vs.85)"><strong>IPersistMemory::GetSizeMax</strong></a>, all methods of each interface must be fully implemented.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="controls.html">Controls</a></p>
<!-- raw HTML omitted -->
</body>
