<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SWbemLocator.ConnectServer method</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: Connects to the namespace on the computer that is specified in the strServer parameter.
ms.assetid: 31364c68-b031-4cf0-851f-b4e302f077e0
ms.tgt_platform: multiple
title: SWbemLocator.ConnectServer method (Wbemdisp.h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>SWbemLocator.ConnectServer</li>
<li>ISWbemLocator.ConnectServer</li>
<li>ISWbemLocator.ConnectServer
api_type:</li>
<li>COM
api_location:</li>
<li>Wbemdisp.dll</li>
</ul>
<hr />
<h1>SWbemLocator.ConnectServer method</h1>
<p>The <strong>ConnectServer</strong> method of the <a href="swbemlocator.html"><strong>SWbemLocator</strong></a> object connects to the namespace on the computer that is specified in the <em>strServer</em> parameter. The target computer can be either local or remote, but it must have WMI installed. For examples and a comparison with the moniker type of connection, see <a href="creating-a-wmi-script.html">Creating a WMI Script</a>.</p>
<p>Starting with Windows Vista, <strong>SWbemLocator.ConnectServer</strong> can connect with computers running IPv6 using an IPv6 address in the <em>strServer</em> parameter. For more information, see <a href="ipv6-and-ipv4-support-in-wmi.html">IPv6 and IPv4 Support in WMI</a>.</p>
<p>For an explanation of this syntax, see <a href="document-conventions-for-the-scripting-api.html">Document Conventions for the Scripting API</a>.</p>
<h2>Syntax</h2>
<pre lang="VB"><code>objwbemServices = .ConnectServer( _
  [ ByVal strServer ], _
  [ ByVal strNamespace ], _
  [ ByVal strUser ], _
  [ ByVal strPassword ], _
  [ ByVal strLocale ], _
  [ ByVal strAuthority ], _
  [ ByVal iSecurityFlags ], _
  [ ByVal objwbemNamedValueSet ] _
)
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>strServer</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Computer name to which you are connecting. If the remote computer is in a different domain than the user account under which you log in, then use the fully qualified computer name. If you do not provide this parameter, the call defaults to the local computer.</p>
<p>Example: <code>server1.network.fabrikam</code></p>
<p>You also can use an IP address in this parameter. If the IP address is in IPv6 format, the target computer must be running IPv6. An address in IPv4 looks like <code>123.123.123.123</code></p>
<p>An IP address in IPv6 format looks like <code>2010:836B:4179::836B:4179</code></p>
<p>For more information on DNS and IPv4, see the Remarks section.</p>
<!-- raw HTML omitted -->
<p><em>strNamespace</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>String that specifies the namespace to which you log on. For example, to log on to the root\default namespace, use root\default. If you do not specify this parameter, it defaults to the namespace that is configured as the default namespace for scripting. For more information, see <a href="creating-a-wmi-application-or-script.html">Creating a WMI Application or Script</a>.</p>
<p>Example: &quot;root\CIMV2&quot;</p>
<!-- raw HTML omitted -->
<p><em>strUser</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>User name to use to connect. The string can be in the form of either a user name or a Domain\Username. Leave this parameter blank to use the current security context. The <em>strUser</em> parameter should only be used with connections to remote WMI servers. If you attempt to specify <em>strUser</em> for a local WMI connection, the connection attempt fails. If Kerberos authentication is in use, then the username and password that is specified in <em>strUser</em> and <em>strPassword</em> cannot be intercepted on a network. You can use the UPN format to specify the <em>strUser</em>.</p>
<p>Example: &quot;DomainName\UserName&quot;</p>
<blockquote>
<p>[!Note]<br />
If a domain is specified in <em>strAuthority</em>, then the domain must not be specified here. Specifying the domain in both parameters results in an Invalid Parameter error.</p>
</blockquote>
<!-- raw HTML omitted -->
<p><em>strPassword</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>String that specifies the password to use when attempting to connect. Leave the parameter blank to use the current security context. The <em>strPassword</em> parameter should only be used with connections to remote WMI servers. If you attempt to specify <em>strPassword</em> for a local WMI connection, the connection attempt fails. If Kerberos authentication is in use then the username and password that is specified in <em>strUser</em> and <em>strPassword</em> cannot be intercepted on the network.</p>
<!-- raw HTML omitted -->
<p><em>strLocale</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>String that specifies the localization code. If you want to use the current locale, leave it blank. If not blank, this parameter must be a string that indicates the desired locale where information must be retrieved. For Microsoft locale identifiers, the format of the string is &quot;MS_xxxx&quot;, where xxxx is a string in the hexadecimal form that indicates the LCID. For example, American English would appear as &quot;MS_409&quot;.</p>
<!-- raw HTML omitted -->
<p><em>strAuthority</em> [in, optional]</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>&quot;&quot;</p>
<!-- raw HTML omitted -->
<p>This parameter is optional. However, if it is specified, only Kerberos or NTLMDomain can be used.</p>
<!-- raw HTML omitted -->
<p>Kerberos:</p>
<!-- raw HTML omitted -->
<p>If the <em>strAuthority</em> parameter begins with the string &quot;Kerberos:&quot;, then Kerberos authentication is used and this parameter should contain a Kerberos principal name. The Kerberos principal name is specified as Kerberos:<em>domain</em>, such as <code>Kerberos:fabrikam</code> where <code>fabrikam</code> is the server to which you are attempting to connect.</p>
<p>Example: &quot;Kerberos:DOMAIN&quot;</p>
<!-- raw HTML omitted -->
<p>NTLMDomain:</p>
<!-- raw HTML omitted -->
<p>To use NT Lan Manager (NTLM) authentication, you must specify it as NTLMDomain:<em>domain</em>, such as <code>NTLMDomain:fabrikam</code> where <code>fabrikam</code> is the name of the domain.</p>
<p>Example: &quot;NTLMDomain:DOMAIN&quot;</p>
<!-- raw HTML omitted -->
<p>If you leave this parameter blank, the operating system negotiates with COM to determine whether NTLM or Kerberos authentication is used. This parameter should only be used with connections to remote WMI servers. If you attempt to set the authority for a local WMI connection, the connection attempt fails.</p>
<blockquote>
<p>[!Note]<br />
If the domain is specified in <em>strUser</em>, which is the preferred location, then it must not be specified here. Specifying the domain in both parameters results in an Invalid Parameter error.</p>
</blockquote>
<!-- raw HTML omitted -->
<p><em>iSecurityFlags</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Used to pass flag values to <strong>ConnectServer</strong>.</p>
<!-- raw HTML omitted -->
<p>0 (0x0)</p>
<!-- raw HTML omitted -->
<p>A value of 0 for this parameter causes the call to <strong>ConnectServer</strong> to return only after the connection to the server is established. This could cause your program to stop responding indefinitely if the connection cannot be established.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>wbemConnectFlagUseMaxWait</strong> (128 (0x80))</p>
<!-- raw HTML omitted -->
<p>The <strong>ConnectServer</strong> call is guaranteed to return in 2 minutes or less. Use this flag to prevent your program from ceasing to respond indefinitely if the connection cannot be established.</p>
<!-- raw HTML omitted -->
<p><em>objwbemNamedValueSet</em> [in, optional]</p>
<!-- raw HTML omitted -->
<p>Typically, this is undefined. Otherwise, this is an <a href="swbemnamedvalueset.html"><strong>SWbemNamedValueSet</strong></a> object whose elements represent the context information that can be used by the provider that is servicing the request. A provider that supports or requires such information must document the recognized value names, data type of the value, allowed values, and semantics.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If successful, WMI returns an <a href="swbemservices.html"><strong>SWbemServices</strong></a> object that is bound to the namespace that is specified in <em>strNamespace</em> on the computer that is specified in <em>strServer</em>.</p>
<h2>Error codes</h2>
<p>After the completion of the <strong>ConnectServer</strong> method, the <a href="/previous-versions//sbf5ze0e(v=vs.85)">Err</a> object may contain one of the error codes in the following list.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrAccessDenied</strong> - 2147749891 (0x80041003)</p>
<!-- raw HTML omitted -->
<p>The current or specified user name and password were not valid or authorized to make the connection.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrFailed</strong> - 2147749889 (0x80041001)</p>
<!-- raw HTML omitted -->
<p>Unspecified error.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrInvalidNamespace</strong> - 2147749902 (0x8004100E)</p>
<!-- raw HTML omitted -->
<p>The specified namespace did not exist on the server.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrInvalidParameter</strong> - 2147749896 (0x80041008)</p>
<!-- raw HTML omitted -->
<p>An invalid parameter was specified, or the namespace could not be parsed.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrOutOfMemory</strong> - 2147749894 (0x80041006)</p>
<!-- raw HTML omitted -->
<p>Not enough memory to complete the operation.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrTransportFailure</strong> - 2147749909</p>
<!-- raw HTML omitted -->
<p>A networking error occurred, preventing normal operation.</p>
<!-- raw HTML omitted -->
<h2>Remarks</h2>
<p>The <strong>ConnectServer</strong> method is often used when connecting to an account with a different username and password credentials on a remote computer because you cannot specify a different password in a <a href="constructing-a-moniker-string.html">moniker</a> string. For more information, see <a href="connecting-to-wmi-on-a-remote-computer.html">Connecting to WMI on a Remote Computer</a>.</p>
<p>Using an IPv4 address to connect to a remote server may result in unexpected behavior. The likely cause is stale DNS entries in your environment. In these circumstances, the stale PTR entry for the machine will be used, with unpredictable results. To avoid this behavior, you can append a period (&quot;.&quot;) to the IP address before calling ConnectServer. This causes the reverse DNS lookup to fail, but may allow the <strong>ConnectServer</strong> call to succeed on the correct machine.</p>
<h2>Examples</h2>
<p>The following VBScript code example describes how to connect to a remote computer to obtain <a href="/previous-versions/windows/desktop/wmiiprouteprov/win32-ip4routetable"><strong>Win32_IP4RouteTable</strong></a> data. The domain name that is specified in <em>strDomain</em> is used in <em>strAuthority</em>.</p>
<pre lang="VB"><code>Const intMin = 3600
strComputer = &quot;RemoteComputer&quot; 
strDomain = &quot;DomainName&quot;  
Wscript.StdOut.Write &quot;Please enter your user name:&quot;
strUser = Wscript.StdIn.ReadLine 
Set objPassword = CreateObject(&quot;ScriptPW.Password&quot;)
Wscript.StdOut.Write &quot;Please enter your password:&quot;
strPassword = objPassword.GetPassword()
Wscript.Echo

Set objSWbemLocator = CreateObject(&quot;WbemScripting.SWbemLocator&quot;) 
Set objWMIService = objSWbemLocator.ConnectServer(strComputer, _ 
                                                  &quot;root\CIMV2&quot;, _ 
                                                  strUser, _ 
                                                  strPassword, _ 
                                                  &quot;MS_409&quot;, _ 
                                                  &quot;NTLMDomain:&quot; + strDomain) 
Set colItems = objWMIService.ExecQuery(&quot;SELECT * FROM Win32_IP4RouteTable&quot;,,48) 
For Each objItem in colItems
    WScript.Echo &quot;Age in Minutes: &quot; &amp; int(objItem.Age/intMin) &amp; VBNewLine _
               &amp; &quot;Description:    &quot; &amp; objItem.Description &amp; VBNewLine _
               &amp; &quot;Destination:    &quot; &amp; objItem.Destination &amp; VBNewLine _
               &amp; &quot;InterfaceIndex: &quot; &amp; objItem.InterfaceIndex &amp; VBNewLine _
               &amp; &quot;Mask:           &quot; &amp; objItem.Mask &amp; VBNewLine _
               &amp; &quot;Metric1:        &quot; &amp; objItem.Metric1 &amp; VBNewLine _
               &amp; &quot;Metric2:        &quot; &amp; objItem.Metric2 &amp; VBNewLine _
               &amp; &quot;Metric3:        &quot; &amp; objItem.Metric3 &amp; VBNewLine _
               &amp; &quot;Metric4:        &quot; &amp; objItem.Metric4 &amp; VBNewLine _
               &amp; &quot;Metric5:        &quot; &amp; objItem.Metric5 &amp; VBNewLine _
               &amp; &quot;Name:           &quot; &amp; objItem.Name &amp; VBNewLine _
               &amp; &quot;NextHop:        &quot; &amp; objItem.NextHop &amp; VBNewLine _
               &amp; &quot;Protocol:       &quot; &amp; objItem.Protocol &amp; VBNewLine _
               &amp; &quot;Type: &quot; &amp; objItem.Type
    WScript.Echo
   &lt;/example&gt;
Next
</code></pre>
<p>The following PowerShell snippet access a remote server and lists the available WMI classes.</p>
<pre lang="PowerShell"><code>$NameSpace = 'root\ccm'
$ComputerName = 'sccm.company.com'
$WbemLocator = New-Object -ComObject &quot;WbemScripting.SWbemLocator&quot;
$WbemServices = $WbemLocator.ConnectServer($ComputerName, $Namespace)
$WbemClasses = $WbemServices.SubclassesOf()
$WbemClasses
</code></pre>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows Vista<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2008<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wbemdisp.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Type library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wbemdisp.tlb<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wbemdisp.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>CLSID<!-- raw HTML omitted --></td>
<td>CLSID_SWbemLocator<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>IID<!-- raw HTML omitted --></td>
<td>IID_ISWbemLocator<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="swbemlocator.html"><strong>SWbemLocator</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="swbemservices.html"><strong>SWbemServices</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="connecting-to-wmi-on-a-remote-computer.html">Connecting to WMI on a Remote Computer</a></p>
<!-- raw HTML omitted -->
<p><a href="creating-a-wmi-script.html">Creating a WMI Script</a></p>
<!-- raw HTML omitted -->
</body>
