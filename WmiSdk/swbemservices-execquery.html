<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SWbemServices.ExecQuery method</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: SWbemServices.ExecQuery method - Executes a query to retrieve objects.
ms.assetid: 06b9d4c9-cd72-49b2-92b0-d18d94dfbd9f
ms.tgt_platform: multiple
title: SWbemServices.ExecQuery method (Wbemdisp.h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:</p>
<ul>
<li>APIRef</li>
<li>kbSyntax
api_name:</li>
<li>SWbemServices.ExecQuery</li>
<li>ISWbemServices.ExecQuery</li>
<li>ISWbemServices.ExecQuery
api_type:</li>
<li>COM
api_location:</li>
<li>Wbemdisp.dll</li>
</ul>
<hr />
<h1>SWbemServices.ExecQuery method</h1>
<p>The <strong>ExecQuery</strong> method of the <a href="swbemservices.html"><strong>SWbemServices</strong></a> object executes a query to retrieve objects. These objects are available through the returned <a href="swbemobjectset.html"><strong>SWbemObjectSet</strong></a> collection.</p>
<p>This method is called in the semisynchronous mode. For more information, see <a href="calling-a-method.html">Calling a Method</a>.</p>
<p>For an explanation of this syntax, see <a href="document-conventions-for-the-scripting-api.html">Document Conventions for the Scripting API</a>.</p>
<h2>Syntax</h2>
<pre lang="VB"><code>objWbemObjectSet = .ExecQuery( _
  ByVal strQuery, _
  [ ByVal strQueryLanguage ], _
  [ ByVal iFlags ], _
  [ ByVal objWbemNamedValueSet ] _
)
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>strQuery</em></p>
<!-- raw HTML omitted -->
<p>Required. String that contains the text of the query. This parameter cannot be blank. For more information on building WMI query strings, see <a href="querying-with-wql.html">Querying with WQL</a> and the <a href="wql-sql-for-wmi.html">WQL</a> reference.</p>
<!-- raw HTML omitted -->
<p><em>strQueryLanguage</em> [optional]</p>
<!-- raw HTML omitted -->
<p>String that contains the query language to be used. If specified, this value must be &quot;WQL&quot;.</p>
<!-- raw HTML omitted -->
<p><em>iFlags</em> [optional]</p>
<!-- raw HTML omitted -->
<p>Integer that determines the behavior of the query and determines whether this call returns immediately. The default value for this parameter is <strong>wbemFlagReturnImmediately</strong>. This parameter can accept the following values.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>wbemFlagForwardOnly</strong> (32 (0x20))</p>
<!-- raw HTML omitted -->
<p>Causes a forward-only enumerator to be returned. Forward-only enumerators are generally much faster and use less memory than conventional enumerators, but they do not allow calls to <a href="swbemobject-clone-.html"><strong>SWbemObject.Clone_</strong></a>.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>wbemFlagBidirectional</strong> (0 (0x0))</p>
<!-- raw HTML omitted -->
<p>Causes WMI to retain pointers to objects of the enumeration until the client releases the enumerator.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>wbemFlagReturnImmediately</strong> (16 (0x10))</p>
<!-- raw HTML omitted -->
<p>Causes the call to return immediately.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>wbemFlagReturnWhenComplete</strong> (0 (0x0))</p>
<!-- raw HTML omitted -->
<p>Causes this call to block until the query is complete. This flag calls the method in the synchronous mode.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>wbemQueryFlagPrototype</strong> (2 (0x2))</p>
<!-- raw HTML omitted -->
<p>Used for prototyping. This flag stops the query from happening and returns an object that looks like a typical result object.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>wbemFlagUseAmendedQualifiers</strong> (131072 (0x20000))</p>
<!-- raw HTML omitted -->
<p>Causes WMI to return class amendment data with the base class definition. For more information, see <a href="localizing-wmi-class-information.html">Localizing WMI Class Information</a>.</p>
<!-- raw HTML omitted -->
<p><em>objWbemNamedValueSet</em> [optional]</p>
<!-- raw HTML omitted -->
<p>Typically, this is undefined. Otherwise, this is an <a href="swbemnamedvalueset.html"><strong>SWbemNamedValueSet</strong></a> object whose elements represent the context information that can be used by the provider that is servicing the request. A provider that supports or requires such information must document the recognized value names, data type of the value, allowed values, and semantics.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If no error occurs, this method returns an <a href="swbemobjectset.html"><strong>SWbemObjectSet</strong></a> object. This is an object collection that contains the result set of the query. The caller can examine the collection using the implementation of collections for the programming language you are using. For more information, see <a href="accessing-a-collection.html">Accessing a Collection</a>.</p>
<h2>Error codes</h2>
<p>After the completion of the <strong>ExecQuery</strong> method, the <a href="/previous-versions//sbf5ze0e(v=vs.85)">Err</a> object can contain one of the error codes in the following list.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrAccessDenied</strong> - 2147749891 (0x80041003)</p>
<!-- raw HTML omitted -->
<p>Current user does not have the permission to view the result set.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrFailed</strong> - 2147749889 (0x80041001)</p>
<!-- raw HTML omitted -->
<p>Unspecified error.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrInvalidParameter</strong> - 2147749896 (0x80041008)</p>
<!-- raw HTML omitted -->
<p>Invalid parameter was specified.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrInvalidQuery</strong> - 2147749911 (0x80041017)</p>
<!-- raw HTML omitted -->
<p>Query syntax is not valid.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrInvalidQueryType</strong> - 2147749912 (0x80041018)</p>
<!-- raw HTML omitted -->
<p>Requested query language is not supported.</p>
<!-- raw HTML omitted -->
<p><strong>wbemErrOutOfMemory</strong> - 2147749894 (0x80041006)</p>
<!-- raw HTML omitted -->
<p>Not enough memory to complete the operation.</p>
<!-- raw HTML omitted -->
<h2>Remarks</h2>
<p><strong>ExecQuery</strong> is one of the most commonly-used calls to retrieve WMI information. A standard call to <strong>ExecQuery</strong> looks like the following:</p>
<pre lang="VB"><code>strComputer = &quot;.&quot;
Set objWMIService = GetObject(&quot;winmgmts:&quot; &amp; &quot;{impersonationLevel=impersonate}!\\&quot; &amp; strComputer &amp; &quot;\root\cimv2&quot;)

Set colServices = objWMIService.ExecQuery (&quot;Select * from Win32_Service where Name='Alerter'&quot;)
For Each objService in colServices
    Return = objService.StopService()
    If Return &lt;&gt; 0 Then
        Wscript.Echo &quot;Failed &quot; &amp;VBNewLine &amp; &quot;Error code = &quot; &amp; Return 
    Else
       WScript.Echo &quot;Succeeded&quot;
    End If
Next
</code></pre>
<p>Note that you create the <a href="swbemservices.html"><strong>SWbemServices</strong></a> object with a moniker that represents the appropriate namespace and security, then make the <strong>ExecQuery</strong> call through the service. For a more complete discussion, see <a href="creating-a-wmi-script.html">Creating a WMI Script</a> and <a href="enumerating-wmi.html">Enumerating WMI</a>.</p>
<p>Like the <a href="swbemservices-instancesof.html"><strong>InstancesOf</strong></a> method, the <strong>ExecQuery</strong> method always returns an <a href="swbemobjectset.html"><strong>SWbemObjectSet</strong></a> collection. Thus your WMI script must enumerate the collection ExecQuery returns in order to access each managed resource instance in the collection, as shown here:</p>
<pre lang="VB"><code>strComputer = &quot;.&quot;
Set objSWbemServices = GetObject(&quot;winmgmts:\\&quot; &amp; strComputer &amp; &quot;\root\cimv2&quot;)
Set colSWbemObjectSet = objSWbemServices.ExecQuery _
   (&quot;SELECT * FROM Win32_Service&quot;)
For Each objSWbemObject In colSWbemObjectSet
    Wscript.Echo &quot;Name: &quot; &amp; objSWbemObject.Name
Next
</code></pre>
<p>Other <a href="swbemservices.html"><strong>SWbemServices</strong></a> methods that return an <a href="swbemobjectset.html"><strong>SWbemObjectSet</strong></a> include <a href="swbemservices-associatorsof.html"><strong>AssociatorsOf</strong></a>, <a href="swbemservices-referencesto.html"><strong>ReferencesTo</strong></a>, and <a href="swbemservices-subclassesof.html"><strong>SubclassesOf</strong></a>.</p>
<p>It is not an error for the query to return an empty result set. The <strong>ExecQuery</strong> method returns key properties whether or not the key property is requested in the <em>strQuery</em> argument. If an error occurs when executing this method and you do not use the <strong>wbemFlagReturnImmediately</strong> flag, the <a href="/previous-versions//sbf5ze0e(v=vs.85)">Err</a> object is not set until you attempt to access the returned object set. However, if you use the <strong>wbemFlagReturnWhenComplete</strong> flag, the Err object is set when the <strong>ExecQuery</strong> method is called.</p>
<p>There are limits to the number of <strong>AND</strong> and <strong>OR</strong> keywords that can be used in WQL queries. Large numbers of WQL keywords that are used in a complex query can cause WMI to return the <strong>WBEM_E_QUOTA_VIOLATION</strong> error code as an <strong>HRESULT</strong> value. The limit of WQL keywords depends on how complex the query is.</p>
<h2>Examples</h2>
<p>The following VBScript code example locates all the disk drives on the local computer and displays the device ID and the type of the disk drive.</p>
<pre lang="VB"><code>Set colDisks = GetObject( _
    &quot;Winmgmts:&quot;).ExecQuery(&quot;Select * from Win32_LogicalDisk&quot;)
For Each objDisk in colDisks
 
    Select Case objDisk.DriveType
        Case 1
            Wscript.Echo &quot;No root directory. Drive type could not be determined.&quot;
        Case 2
            Wscript.Echo &quot;DeviceID= &quot;&amp; objDisk.DeviceID &amp; &quot;  DriveType = Removable drive&quot; 
        Case 3
            Wscript.Echo &quot;DeviceID= &quot;&amp; objDisk.DeviceID &amp; &quot;  DriveType = Local hard disk&quot; 
        Case 4
            Wscript.Echo &quot;DeviceID= &quot;&amp; objDisk.DeviceID &amp; &quot;  DriveType = Network disk&quot; 
        Case 5
            Wscript.Echo &quot;DeviceID= &quot;&amp; objDisk.DeviceID &amp; &quot;  DriveType = Compact disk&quot; 
        Case 6
            Wscript.Echo &quot;DeviceID= &quot;&amp; objDisk.DeviceID &amp; &quot;  DriveType = RAM disk&quot; 
        Case Else
            Wscript.Echo &quot;Drive type could not be determined.&quot;
    End Select
Next
</code></pre>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows Vista<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2008<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wbemdisp.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Type library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wbemdisp.tlb<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Wbemdisp.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>CLSID<!-- raw HTML omitted --></td>
<td>CLSID_SWbemServices<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>IID<!-- raw HTML omitted --></td>
<td>IID_ISWbemServices<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="swbemservices.html"><strong>SWbemServices</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="swbemservices-get.html"><strong>SWbemServices.Get</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="querying-with-wql.html">Querying with WQL</a></p>
<!-- raw HTML omitted -->
<p><a href="creating-a-wmi-script.html">Creating a WMI Script</a></p>
<!-- raw HTML omitted -->
<p><a href="enumerating-wmi.html">Enumerating WMI</a></p>
<!-- raw HTML omitted -->
</body>
