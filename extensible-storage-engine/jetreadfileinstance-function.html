<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>JetReadFileInstance Function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>description: &quot;Learn more about: JetReadFileInstance Function&quot;
title: JetReadFileInstance Function
TOCTitle: JetReadFileInstance Function
ms:assetid: b17b4b43-86e5-4507-8a85-bbd5eac0aa3c
ms:mtpsurl: <a href="https://msdn.microsoft.com/library/Gg294060(v=EXCHG.10)">https://msdn.microsoft.com/library/Gg294060(v=EXCHG.10)</a>
ms:contentKeyID: 32765675
ms.date: 04/11/2016
ms.topic: reference
api_name:</p>
<ul>
<li>JetReadFileInstance
topic_type:</li>
<li>apiref</li>
<li>kbArticle
api_type:</li>
<li>COM</li>
<li>DLLExport
api_location:</li>
<li>ESENT.DLL
ROBOTS: INDEX,FOLLOW</li>
</ul>
<hr />
<h1>JetReadFileInstance Function</h1>
<p><em><strong>Applies to:</strong> WindowsÂ | Windows Server</em></p>
<h2>JetReadFileInstance Function</h2>
<p>The <strong>JetReadFileInstance</strong> function retrieves the contents of a file opened with the <a href="./jetopenfileinstance-function.html">JetOpenFileInstance</a> function.</p>
<p><strong>WindowsÂ XP</strong>:Â Â  <strong>JetReadFileInstance</strong> is introduced in WindowsÂ XP.</p>
<pre lang="cpp"><code>    JET_ERR JET_API JetReadFileInstance(
      __in          JET_INSTANCE instance,
      __in          JET_HANDLE hfFile,
      __out         void* pv,
      __in          unsigned long cb,
      __out_opt     unsigned long* pcb
    );
</code></pre>
<h3>Parameters</h3>
<p><em>instance</em></p>
<p>The instance to use for a particular API call.</p>
<p>Note that for WindowsÂ 2000, the API variant that accepts this parameter is not available because only one instance is supported. The use of this one global instance is implied in this case.</p>
<p>For WindowsÂ XP and later releases, you can call the API variant that does not accept this parameter only when the engine is in legacy mode (WindowsÂ 2000 compatibility mode) in cases where only one instance is supported. Otherwise, the operation will fail and return the JET_errRunningInMultiInstanceMode error.</p>
<p><em>hfFile</em></p>
<p>The handle of the file to be read.</p>
<p><em>pv</em></p>
<p>The output buffer that will receive the file data.</p>
<p><em>cb</em></p>
<p>The maximum size, in bytes, of the output buffer.</p>
<p><em>pcb</em></p>
<p>The actual amount of file data retrieved.</p>
<h3>Return Value</h3>
<p>This function facilitates the return of any <a href="./jet-err.html">JET_ERR</a> data types that are defined in the Extensible Storage Engine (ESE) API. For more information about JET errors, see <a href="./extensible-storage-engine-errors.html">Extensible Storage Engine Errors</a> and <a href="./error-handling-parameters.html">Error Handling Parameters</a>.</p>
<table>
<thead>
<tr>
<th><!-- raw HTML omitted -->Return code<!-- raw HTML omitted --></th>
<th><!-- raw HTML omitted -->Meaning<!-- raw HTML omitted --></th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted -->JET_errSuccess<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->The operation completed successfully.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errBackupAbortByServer<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->The operation failed because the current external backup has been aborted by a call to the <!-- raw HTML omitted -->JetStopService<!-- raw HTML omitted --> function. This error will be returned only by WindowsÂ XP and later Windows versions.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errClientRequestToStopJetService<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->It is not possible to complete the operation because all activity on the instance associated with the session has ceased as a result of a call to the <!-- raw HTML omitted -->JetStopService<!-- raw HTML omitted --> function.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errInstanceUnavailable<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->It is not possible to complete the operation because the instance associated with the session has encountered a fatal error requiring that access to all data be revoked to protect the integrity of that data. This error will be returned only by WindowsÂ XP and later Windows versions.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errInvalidParameter<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->One of the specified parameters contained either an unexpected value or a value that did not make sense when combined with the value of another parameter. This can happen for the <!-- raw HTML omitted -->JetReadFileInstance<!-- raw HTML omitted --> function when any of the following occurs:<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->The specified instance handle is invalid. WindowsÂ XP and later Windows versions.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->The output buffer size is not a multiple of the database page size (<!-- raw HTML omitted -->JET_paramDatabasePageSize<!-- raw HTML omitted -->). WindowsÂ XP and later Windows versions.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->The output buffer size is smaller than three database pages (<!-- raw HTML omitted -->JET_paramDatabasePageSize<!-- raw HTML omitted -->), and this is the first call to the <!-- raw HTML omitted -->JetReadFileInstance<!-- raw HTML omitted --> function for the specified handle. WindowsÂ XP and later Windows versions.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errLogReadVerifyFailure<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->The operation failed because unrecoverable data corruption was detected while reading a transaction log file. This error will be returned only by WindowsÂ XP and later Windows versions.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errNoBackup<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->The operation failed because no external backup is in progress.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errNotInitialized<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->It is not possible to complete the operation because the instance associated with this session has not been initialized yet.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errReadVerifyFailure<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->The operation failed because unrecoverable data corruption was detected while reading a database page from a database file or database patch file.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errRestoreInProgress<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->It is not possible to complete the operation because a restore operation is in progress on the instance associated with this session.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errRunningInMultiInstanceMode<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->The operation failed because an attempt was made to use the engine in legacy mode (WindowsÂ 2000 compatibility mode) in a case where only one instance is supported but multiple instances already exist.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->JET_errTermInProgress<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->It is not possible to complete the operation because the instance associated with this session is being shut down.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>On success, the next chunk of data from the file will be read into the output buffer. The actual number of bytes retrieved will also be returned. The file offset at which the next read will occur will be advanced by this amount.</p>
<p>On failure, the state of the output buffer is undefined. The failure will result in the cancellation of the entire backup process for the current instance. In WindowsÂ XP and later Windows versions, the backup will not be canceled if an error occurred while reading a database file. However, the backup of that database file will still be canceled and the corresponding handle will automatically be closed.</p>
<h4>Remarks</h4>
<p>Any call to the <strong>JetReadFileInstance</strong> function made by using a handle that has already returned all the data in the underlying file (such as if a previous call returned fewer bytes than the size of the output buffer) will always succeed but will return zero bytes of data.</p>
<p>You should use a large output buffer to maximize backup performance. You might need to experiment to find the optimal tradeoff between resource consumption and throughput for a particular situation. In any case, the output buffer should be no smaller than 64 KB. The pointer that you pass to <strong>JetReadFileInstance</strong> must be aligned with a memory page boundary (either 4 KB or 8 KB). You can do this by calling the <strong>VirtualAlloc</strong> function.</p>
<p>Multiple concurrent calls to <strong>JetReadFileInstance</strong> made by using the same file handle are not supported. This means that it is not possible to queue several buffers for concurrent reading against the same file to achieve high sequential throughput. You should use a single large buffer instead.</p>
<p>If you have configured a particular instance such that database page scrubbing is enabled (see the <a href="./transaction-log-parameters.html">JET_paramCircularLog</a> parameter in <a href="./extensible-storage-engine-system-parameters.html">System Parameters</a>), deleted data will be removed from the database as a side-effect of a call to <strong>JetReadFileInstance</strong> against the database file.</p>
<p>It is very important to understand how backup and data corruption interact. If the database engine detects data corruption during a backup, it will fail the backup of either the affected database or the entire instance. This is a conscious design decision intended to protect against data loss. If the database engine allowed a backup to succeed where data corruption was present, it is possible that an older, uncorrupted backup could be discarded as a result. This would be unfortunate because then it would be possible to fix the data corruption on the live instance by restoring that backup and replaying all the transaction log files against that database. This zero-data-loss scenario presumes that circular logging is not enabled (see <a href="./transaction-log-parameters.html">JET_paramCircularLog</a> in <a href="./extensible-storage-engine-system-parameters.html">System Parameters</a>).</p>
<p>It is also important to understand that cases of data corruption are usually first detected during streaming backup. This is because streaming backup is the only process that routinely scans every single page of the database file. It is also likely that streaming backup will be the first process to detect the early signs of hardware failure as manifested by intermittent data corruption errors, because of both the amount of data retrieved by backup and the speed at which that data is retrieved.</p>
<p>Data corruption is detected by the database engine through the use of block checksums. These checksums are set just before a database page write and are verified on a database page read. This scheme enables the database engine to determine that data has been corrupted at some point, but it does not enable the database engine to determine the source of that corruption. Historically, instances of such data corruption have originated from sources other than the database engine itself.</p>
<h4>Requirements</h4>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted -->Client<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->Requires WindowsÂ Vista or WindowsÂ XP.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->Server<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->Requires Windows ServerÂ 2008 or Windows ServerÂ 2003.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->Is declared in Esent.h.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->Library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->Uses ESENT.lib.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><!-- raw HTML omitted -->DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted -->Requires ESENT.dll.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h4>See Also</h4>
<p><a href="./jet-err.html">JET_ERR</a><br />
<a href="./jet-handle.html">JET_HANDLE</a><br />
<a href="./jet-instance.html">JET_INSTANCE</a><br />
<a href="./jetopenfileinstance-function.html">JetOpenFileInstance</a><br />
<a href="./jetstopservice-function.html">JetStopService</a><br />
<a href="./extensible-storage-engine-system-parameters.html">System Parameters</a></p>
</body>
