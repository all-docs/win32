<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Logging With Network Policy Server</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>title: Logging With Network Policy Server
description: Logging With Network Policy Server
ms.assetid: 903d89bd-c223-4f29-9eaf-1dc28d27a32a
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018</h2>
<h1>Logging With Network Policy Server</h1>
<blockquote>
<p>[!Note]<br />
Internet Authentication Service (IAS) was renamed Network Policy Server (NPS) starting with Windows Server 2008. The content of this topic applies to both IAS and NPS. Throughout the text, NPS is used to refer to all versions of the service, including the versions originally referred to as IAS.</p>
</blockquote>
<p>The following table describes only the most important aspects of the RADIUS accounting packets. The RADIUS Accounting Request for Comments document (<a href="https://www.ietf.org/rfc/rfc2866.txt">RFC 2866</a>) provides detailed information on these packets.</p>
<p>RADIUS accounting packets can be divided into the following categories.</p>
<table>
<thead>
<tr>
<th>Accounting packet</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Accounting-On</td>
<td>Sent by the Network Access Server (NAS) to indicate that it has restarted.<!-- raw HTML omitted --> Contains nas-identifier/ipaddress.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Accounting-Off</td>
<td>Sent by the NAS to indicate that it is being shutdown.<!-- raw HTML omitted --> Contains nas-identifier/ipaddress.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Accounting-Start</td>
<td>Sent by the NAS, after the user was authenticated and authorized, to indicate the start of a user session. <!-- raw HTML omitted --> Contains userid, nas-identifier/ipaddress, plus other information received from the NAS.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Accounting-Stop</td>
<td>Sent by the NAS to indicate the end of a user session.<!-- raw HTML omitted --> Contains userid, nas-identifier/ipaddress, plus other information received from the NAS.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Accounting-Interim</td>
<td>Could be sent periodically by the NAS for each user that is logged on at the NAS. <!-- raw HTML omitted --> This feature is generally supported in newer versions of NAS.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>The following issues are important to consider when collecting accounting information made available through RADIUS:</p>
<ul>
<li>In rare cases, packets could be lost during transmission and may never reach the RADIUS server.</li>
<li>The RADIUS server is not notified if the NAS aborts.</li>
<li>ISDN supports multiple sessions and each session generates an Accounting-Start/-Stop pair of packets. There is an accounting attribute called multi-session identifier that clearly identifies such multi-session packets. Check for the multi-session identifier in addition to the session identifier to calculate the number of sessions.</li>
</ul>
<h2>Requests Logged by NPS</h2>
<p>By default, NPS does not log any data. NPS can be configured, using the NPS user interface (nps.msc), to log the following requests.</p>
<table>
<thead>
<tr>
<th>Logged packet</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Accounting Request</td>
<td>Any of the accounting packets described in the previous table.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Authentication Request</td>
<td>Sent by the NAS on behalf of the connecting user.<!-- raw HTML omitted --> The log entries contain only incoming attributes.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Authentication Accept</td>
<td>Sent by NPS to indicate that the user connection should be accepted.<!-- raw HTML omitted --> The log entries contain only outgoing attributes.<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Authentication Reject</td>
<td>Sent by NPS to indicate that the user connection should be rejected.<!-- raw HTML omitted --> The log entries contain only outgoing attributes.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Data logged by NPS can go to a text file on the NPS server or to a central SQL database. For more information on NPS SQL logging, see <a href="sql-programmability.html">SQL Programmability</a>.</p>
<h2>Related topics</h2>
<!-- raw HTML omitted -->
<p><a href="internet-authentication-service-vs-network-policy-server.html">Internet Authentication Service and Network Policy Server</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/Nps/ias-radius-authentication-and-accounting">RADIUS Authentication, Authorization, and Accounting</a></p>
<!-- raw HTML omitted -->
<p><a href="/windows/desktop/Nps/ias-working-with-a-state-server">Working with a State Server</a></p>
<!-- raw HTML omitted -->
</body>
