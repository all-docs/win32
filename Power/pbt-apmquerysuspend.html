<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PBT_APMQUERYSUSPEND event</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<h2>description: Requests permission to suspend the computer. An application that grants permission should carry out preparations for the suspension before returning.
ms.assetid: 83cb0fdc-437e-4d03-87f0-6a416281c0d5
title: PBT_APMQUERYSUSPEND event (WinUser.h)
ms.topic: reference
ms.date: 05/31/2018</h2>
<h1>PBT_APMQUERYSUSPEND event</h1>
<p><strong>PBT_APMQUERYSUSPEND</strong> is available for use in the operating systems specified in the Requirements section. Support for this event was removed in Windows Vista. Use <a href="/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate"><strong>SetThreadExecutionState</strong></a> instead.]</p>
<p>Requests permission to suspend the computer. An application that grants permission should carry out preparations for the suspension before returning.</p>
<p>A window receives this event through the <a href="wm-powerbroadcast.html"><strong>WM_POWERBROADCAST</strong></a> message. The <em>wParam</em> and <em>lParam</em> parameters are set as described following.</p>
<pre lang="C++"><code>LRESULT 
CALLBACK 
WindowProc( HWND   hwnd,    // handle to window
            UINT   uMsg,    // WM_POWERBROADCAST
            WPARAM wParam,  // PBT_APMQUERYSUSPEND
            LPARAM lParam); // action flags
</code></pre>
<h2>Parameters</h2>
<p><em>hwnd</em></p>
<p>A handle to window.</p>
<p><em>uMsg</em></p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong><a href="wm-powerbroadcast.html"><strong>WM_POWERBROADCAST</strong></a></strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->536 (0x218)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Message identifier.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p><em>wParam</em></p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><strong>PBT_APMQUERYSUSPEND</strong><!-- raw HTML omitted --> <!-- raw HTML omitted -->0 (0x0)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
<td>Event identifier.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p><em>lParam</em></p>
<p>The action flags. If bit 0 is 1, the application can prompt the user for directions on how to prepare for the suspension; otherwise, the application must prepare without user interaction. All other bit values are reserved.</p>
<h2>Return value</h2>
<p>Return <strong>TRUE</strong> to grant the request to suspend. To deny the request, return <strong>BROADCAST_QUERY_DENY</strong>.</p>
<h2>Remarks</h2>
<p>An application should process this event as quickly as possible. The application can prompt the user for directions on how to prepare for suspension only if bit 0 in the <em>Flags</em> parameter is set. However, if this message is issued because the user is closing the laptop lid, it will not be possible to prompt the user. Applications should respect that the user expects a certain behavior when they close the laptop lid or press the power button and allow the transition to succeed.</p>
<p>The system allows approximately 20 seconds for an application to remove the <a href="wm-powerbroadcast.html"><strong>WM_POWERBROADCAST</strong></a> message that is sending the PBT_APMQUERYSUSPEND event from the application's message queue. If an application does not remove the message from its queue in less than 20 seconds, the system will assume that the application is in a non-responsive state, and that the application agrees to the sleep request. Applications that do not process their message queues may have their operations interrupted. After it removes the message from the message queue, an application can take as much time as needed to perform any required operations before entering the sleep state. Any operations that could take longer then 20 seconds should be performed at this time, since the system allows only 20 seconds for operations to complete during <a href="pbt-apmsuspend.html">PBT_APMSUSPEND</a> processing.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows XP [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2003 [desktop apps only]<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>End of client support<!-- raw HTML omitted --></td>
<td>Windows XP<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>End of server support<!-- raw HTML omitted --></td>
<td>Windows Server 2003<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->WinUser.h (include Windows.h)<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<ul>
<li><a href="system-wake-up-events.html">System Wake-up Events</a></li>
<li><a href="power-management-events.html">Power Management Events</a></li>
<li><a href="pbt-apmsuspend.html">PBT_APMSUSPEND</a></li>
<li><a href="wm-powerbroadcast.html"><strong>WM_POWERBROADCAST</strong></a></li>
</ul>
</body>
