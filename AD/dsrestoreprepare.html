<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>DsRestorePrepare function</title>
<style>
table th { border: 1px solid; }
table td { border: 1px solid; }
</style>
</head>
<body>
<hr />
<p>title: DsRestorePrepare function (Ntdsbcli.h)
description: Connects to the specified directory server and prepares it for the restore operation.
ms.assetid: e847d57a-32e1-49c0-800c-7ce0e5f442fa
ms.tgt_platform: multiple
keywords:</p>
<ul>
<li>DsRestorePrepare function Active Directory
topic_type:</li>
<li>apiref
api_name:</li>
<li>DsRestorePrepare</li>
<li>DsRestorePrepareA</li>
<li>DsRestorePrepareW
api_location:</li>
<li>Ntdsbcli.dll
api_type:</li>
<li>DllExport
ms.topic: reference
ms.date: 05/31/2018</li>
</ul>
<hr />
<h1>DsRestorePrepare function</h1>
<p>[This function is available for use in the operating systems specified in the Requirements section. It may be altered or unavailable in subsequent versions. Beginning with Windows Vista, use <a href="../vss/volume-shadow-copy-service-overview.html">Volume Shadow Copy Service (VSS)</a> instead.]</p>
<p>The <strong>DsRestorePrepare</strong> function connects to the specified directory server and prepares it for the restore operation.</p>
<h2>Syntax</h2>
<pre lang="C++"><code>HRESULT DsRestorePrepare(
  _In_  LPCWSTR szServerName,
  _In_  ULONG   rtFlag,
  _In_  PVOID   pvExpiryToken,
  _In_  DWORD   cbExpiryTokenSize,
  _Out_ HBC     *phbc
);
</code></pre>
<h2>Parameters</h2>
<!-- raw HTML omitted -->
<p><em>szServerName</em> [in]</p>
<!-- raw HTML omitted -->
<p>Pointer to a null-terminated string that contains the name of the server to restore. Preceding backslashes are optional. The server must be the same computer that this function is called from. The server name cannot contain any underscore (_) characters. An example of a server name is &quot;\\server1&quot;.</p>
<!-- raw HTML omitted -->
<p><em>rtFlag</em> [in]</p>
<!-- raw HTML omitted -->
<p>Specifies the type of restoration to perform. This can be zero or one of the following values.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>RESTORE_TYPE_CATCHUP</strong></p>
<!-- raw HTML omitted -->
<p>Default. The restored version is reconciled through the standard reconciliation logic so that the restored DIT can synchronize with other enterprise server computers.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>RESTORE_TYPE_AUTHORATATIVE</strong></p>
<!-- raw HTML omitted -->
<p>Not Supported.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong>RESTORE_TYPE_ONLINE</strong></p>
<!-- raw HTML omitted -->
<p>Not Supported. Restoration is performed when NTDS is online.</p>
<!-- raw HTML omitted -->
<p><em>pvExpiryToken</em> [in]</p>
<!-- raw HTML omitted -->
<p>Pointer to the expiry token associated with the backup being restored. This token was obtained from the <a href="dsbackupprepare.html"><strong>DsBackupPrepare</strong></a> function when the directory was backed up.</p>
<p>If this parameter is <strong>NULL</strong>, the handle returned in <em>phbc</em> can only be used to obtain the restoration directories with the <a href="dsrestoregetdatabaselocations.html"><strong>DsRestoreGetDatabaseLocations</strong></a> function. The handle cannot be used for any other restoration functions.</p>
<!-- raw HTML omitted -->
<p><em>cbExpiryTokenSize</em> [in]</p>
<!-- raw HTML omitted -->
<p>Contains the size, in bytes, of the expiry token in <em>pvExpiryToken</em>.</p>
<!-- raw HTML omitted -->
<p><em>phbc</em> [out]</p>
<!-- raw HTML omitted -->
<p>Pointer to an <strong>HBC</strong> value that receives the handle for the restore. This handle is used when calling other Directory Service restore functions, such as <a href="dsbackupopenfile.html"><strong>DsBackupOpenFile</strong></a> and <a href="dsrestoreend.html"><strong>DsRestoreEnd</strong></a>.</p>
<!-- raw HTML omitted -->
<h2>Return value</h2>
<p>If successful, returns a standard <strong>HRESULT</strong> codes; otherwise, a failure code is returned.</p>
<h2>Remarks</h2>
<p>The <strong>DsRestorePrepare</strong> function requires that the caller is a member of the Administrators group on the server.</p>
<p><strong>DsRestorePrepare</strong> may be used with or without a token provided. If the token is provided, it is checked for expiration, and all operations are allowed on the context returned. If the token is not provided, the context returned is restricted, and may be used only for the <a href="dsrestoregetdatabaselocations.html"><strong>DsRestoreGetDatabaseLocations</strong></a> function. It may not be used for the <a href="dsrestoreregister.html"><strong>DsRestoreRegister</strong></a> function.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client<!-- raw HTML omitted --></td>
<td>Windows Vista<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Minimum supported server<!-- raw HTML omitted --></td>
<td>Windows Server 2008<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Header<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Ntdsbcli.h<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Library<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Ntdsbcli.lib<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>DLL<!-- raw HTML omitted --></td>
<td><!-- raw HTML omitted --> <!-- raw HTML omitted -->Ntdsbcli.dll<!-- raw HTML omitted --> <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>Unicode and ANSI names<!-- raw HTML omitted --></td>
<td><strong>DsRestorePrepareW</strong> (Unicode) and <strong>DsRestorePrepareA</strong> (ANSI)<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<!-- raw HTML omitted -->
<p><a href="restoring-an-active-directory-server.html">Restoring an Active Directory Server</a></p>
<!-- raw HTML omitted -->
<p><a href="directory-backup-functions.html">Directory Backup Functions</a></p>
<!-- raw HTML omitted -->
<p><a href="dsrestoregetdatabaselocations.html"><strong>DsRestoreGetDatabaseLocations</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="dsrestoreregister.html"><strong>DsRestoreRegister</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="dsrestoreregistercomplete.html"><strong>DsRestoreRegisterComplete</strong></a></p>
<!-- raw HTML omitted -->
<p><a href="dsrestoreend.html"><strong>DsRestoreEnd</strong></a></p>
<!-- raw HTML omitted -->
</body>
